(self.webpackChunkmapas_app=self.webpackChunkmapas_app||[]).push([[179],{255:qn=>{function Bt(Ge){return Promise.resolve().then(()=>{var fe=new Error("Cannot find module '"+Ge+"'");throw fe.code="MODULE_NOT_FOUND",fe})}Bt.keys=()=>[],Bt.resolve=Bt,Bt.id=255,qn.exports=Bt},583:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{mr:()=>nn,ez:()=>ia,K0:()=>Ot,JJ:()=>Qa,Do:()=>ii,V_:()=>Se,Ye:()=>Ai,S$:()=>dn,sg:()=>Go,PC:()=>hr,b0:()=>_t,lw:()=>Ve,EM:()=>la,JF:()=>ca,w_:()=>ht,bD:()=>Do,q:()=>Kt,Mx:()=>Qn,HT:()=>Zt});var fe=Ge(639);let te=null;function Kt(){return te}function Zt(N){te||(te=N)}class ht{}const Ot=new fe.OlP("DocumentToken");let Ve=(()=>{class N{historyGo(U){throw new Error("Not implemented")}}return N.\u0275fac=function(U){return new(U||N)},N.\u0275prov=(0,fe.Yz7)({factory:Me,token:N,providedIn:"platform"}),N})();function Me(){return(0,fe.LFG)(We)}const Se=new fe.OlP("Location Initialized");let We=(()=>{class N extends Ve{constructor(U){super(),this._doc=U,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Kt().getBaseHref(this._doc)}onPopState(U){const J=Kt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("popstate",U,!1),()=>J.removeEventListener("popstate",U)}onHashChange(U){const J=Kt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("hashchange",U,!1),()=>J.removeEventListener("hashchange",U)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(U){this.location.pathname=U}pushState(U,J,Te){st()?this._history.pushState(U,J,Te):this.location.hash=Te}replaceState(U,J,Te){st()?this._history.replaceState(U,J,Te):this.location.hash=Te}forward(){this._history.forward()}back(){this._history.back()}historyGo(U=0){this._history.go(U)}getState(){return this._history.state}}return N.\u0275fac=function(U){return new(U||N)(fe.LFG(Ot))},N.\u0275prov=(0,fe.Yz7)({factory:bt,token:N,providedIn:"platform"}),N})();function st(){return!!window.history.pushState}function bt(){return new We((0,fe.LFG)(Ot))}function ut(N,W){if(0==N.length)return W;if(0==W.length)return N;let U=0;return N.endsWith("/")&&U++,W.startsWith("/")&&U++,2==U?N+W.substring(1):1==U?N+W:N+"/"+W}function St(N){const W=N.match(/#|\?|$/),U=W&&W.index||N.length;return N.slice(0,U-("/"===N[U-1]?1:0))+N.slice(U)}function ct(N){return N&&"?"!==N[0]?"?"+N:N}let dn=(()=>{class N{historyGo(U){throw new Error("Not implemented")}}return N.\u0275fac=function(U){return new(U||N)},N.\u0275prov=(0,fe.Yz7)({factory:Vn,token:N,providedIn:"root"}),N})();function Vn(N){const W=(0,fe.LFG)(Ot).location;return new _t((0,fe.LFG)(Ve),W&&W.origin||"")}const nn=new fe.OlP("appBaseHref");let _t=(()=>{class N extends dn{constructor(U,J){if(super(),this._platformLocation=U,this._removeListenerFns=[],null==J&&(J=this._platformLocation.getBaseHrefFromDOM()),null==J)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=J}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}prepareExternalUrl(U){return ut(this._baseHref,U)}path(U=!1){const J=this._platformLocation.pathname+ct(this._platformLocation.search),Te=this._platformLocation.hash;return Te&&U?`${J}${Te}`:J}pushState(U,J,Te,Je){const pt=this.prepareExternalUrl(Te+ct(Je));this._platformLocation.pushState(U,J,pt)}replaceState(U,J,Te,Je){const pt=this.prepareExternalUrl(Te+ct(Je));this._platformLocation.replaceState(U,J,pt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(U=0){var J,Te;null===(Te=(J=this._platformLocation).historyGo)||void 0===Te||Te.call(J,U)}}return N.\u0275fac=function(U){return new(U||N)(fe.LFG(Ve),fe.LFG(nn,8))},N.\u0275prov=fe.Yz7({token:N,factory:N.\u0275fac}),N})(),ii=(()=>{class N extends dn{constructor(U,J){super(),this._platformLocation=U,this._baseHref="",this._removeListenerFns=[],null!=J&&(this._baseHref=J)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}path(U=!1){let J=this._platformLocation.hash;return null==J&&(J="#"),J.length>0?J.substring(1):J}prepareExternalUrl(U){const J=ut(this._baseHref,U);return J.length>0?"#"+J:J}pushState(U,J,Te,Je){let pt=this.prepareExternalUrl(Te+ct(Je));0==pt.length&&(pt=this._platformLocation.pathname),this._platformLocation.pushState(U,J,pt)}replaceState(U,J,Te,Je){let pt=this.prepareExternalUrl(Te+ct(Je));0==pt.length&&(pt=this._platformLocation.pathname),this._platformLocation.replaceState(U,J,pt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(U=0){var J,Te;null===(Te=(J=this._platformLocation).historyGo)||void 0===Te||Te.call(J,U)}}return N.\u0275fac=function(U){return new(U||N)(fe.LFG(Ve),fe.LFG(nn,8))},N.\u0275prov=fe.Yz7({token:N,factory:N.\u0275fac}),N})(),Ai=(()=>{class N{constructor(U,J){this._subject=new fe.vpe,this._urlChangeListeners=[],this._platformStrategy=U;const Te=this._platformStrategy.getBaseHref();this._platformLocation=J,this._baseHref=St(bo(Te)),this._platformStrategy.onPopState(Je=>{this._subject.emit({url:this.path(!0),pop:!0,state:Je.state,type:Je.type})})}path(U=!1){return this.normalize(this._platformStrategy.path(U))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(U,J=""){return this.path()==this.normalize(U+ct(J))}normalize(U){return N.stripTrailingSlash(function(N,W){return N&&W.startsWith(N)?W.substring(N.length):W}(this._baseHref,bo(U)))}prepareExternalUrl(U){return U&&"/"!==U[0]&&(U="/"+U),this._platformStrategy.prepareExternalUrl(U)}go(U,J="",Te=null){this._platformStrategy.pushState(Te,"",U,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+ct(J)),Te)}replaceState(U,J="",Te=null){this._platformStrategy.replaceState(Te,"",U,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+ct(J)),Te)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(U=0){var J,Te;null===(Te=(J=this._platformStrategy).historyGo)||void 0===Te||Te.call(J,U)}onUrlChange(U){this._urlChangeListeners.push(U),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(J=>{this._notifyUrlChangeListeners(J.url,J.state)}))}_notifyUrlChangeListeners(U="",J){this._urlChangeListeners.forEach(Te=>Te(U,J))}subscribe(U,J,Te){return this._subject.subscribe({next:U,error:J,complete:Te})}}return N.\u0275fac=function(U){return new(U||N)(fe.LFG(dn),fe.LFG(Ve))},N.normalizeQueryParams=ct,N.joinWithSlash=ut,N.stripTrailingSlash=St,N.\u0275prov=(0,fe.Yz7)({factory:Tr,token:N,providedIn:"root"}),N})();function Tr(){return new Ai((0,fe.LFG)(dn),(0,fe.LFG)(Ve))}function bo(N){return N.replace(/\/index.html$/,"")}var Mn=(()=>((Mn=Mn||{})[Mn.Decimal=0]="Decimal",Mn[Mn.Percent=1]="Percent",Mn[Mn.Currency=2]="Currency",Mn[Mn.Scientific=3]="Scientific",Mn))(),or=(()=>((or=or||{})[or.Zero=0]="Zero",or[or.One=1]="One",or[or.Two=2]="Two",or[or.Few=3]="Few",or[or.Many=4]="Many",or[or.Other=5]="Other",or))(),Et=(()=>((Et=Et||{})[Et.Decimal=0]="Decimal",Et[Et.Group=1]="Group",Et[Et.List=2]="List",Et[Et.PercentSign=3]="PercentSign",Et[Et.PlusSign=4]="PlusSign",Et[Et.MinusSign=5]="MinusSign",Et[Et.Exponential=6]="Exponential",Et[Et.SuperscriptingExponent=7]="SuperscriptingExponent",Et[Et.PerMille=8]="PerMille",Et[Et.Infinity=9]="Infinity",Et[Et.NaN=10]="NaN",Et[Et.TimeSeparator=11]="TimeSeparator",Et[Et.CurrencyDecimal=12]="CurrencyDecimal",Et[Et.CurrencyGroup=13]="CurrencyGroup",Et))();function Wr(N,W){const U=(0,fe.cg1)(N),J=U[fe.wAp.NumberSymbols][W];if(void 0===J){if(W===Et.CurrencyDecimal)return U[fe.wAp.NumberSymbols][Et.Decimal];if(W===Et.CurrencyGroup)return U[fe.wAp.NumberSymbols][Et.Group]}return J}const mr=fe.kL8,Be=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Rt(N){const W=parseInt(N);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+N);return W}class wn{}let Ht=(()=>{class N extends wn{constructor(U){super(),this.locale=U}getPluralCategory(U,J){switch(mr(J||this.locale)(U)){case or.Zero:return"zero";case or.One:return"one";case or.Two:return"two";case or.Few:return"few";case or.Many:return"many";default:return"other"}}}return N.\u0275fac=function(U){return new(U||N)(fe.LFG(fe.soG))},N.\u0275prov=fe.Yz7({token:N,factory:N.\u0275fac}),N})();function Qn(N,W){W=encodeURIComponent(W);for(const U of N.split(";")){const J=U.indexOf("="),[Te,Je]=-1==J?[U,""]:[U.slice(0,J),U.slice(J+1)];if(Te.trim()===W)return decodeURIComponent(Je)}return null}class Vt{constructor(W,U,J,Te){this.$implicit=W,this.ngForOf=U,this.index=J,this.count=Te}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Go=(()=>{class N{constructor(U,J,Te){this._viewContainer=U,this._template=J,this._differs=Te,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(U){this._ngForOf=U,this._ngForOfDirty=!0}set ngForTrackBy(U){this._trackByFn=U}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(U){U&&(this._template=U)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const U=this._ngForOf;if(!this._differ&&U)try{this._differ=this._differs.find(U).create(this.ngForTrackBy)}catch(J){throw new Error(`Cannot find a differ supporting object '${U}' of type '${function(N){return N.name||typeof N}(U)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const U=this._differ.diff(this._ngForOf);U&&this._applyChanges(U)}}_applyChanges(U){const J=[];U.forEachOperation((Te,Je,pt)=>{if(null==Te.previousIndex){const Yt=this._viewContainer.createEmbeddedView(this._template,new Vt(null,this._ngForOf,-1,-1),null===pt?void 0:pt),tn=new Qr(Te,Yt);J.push(tn)}else if(null==pt)this._viewContainer.remove(null===Je?void 0:Je);else if(null!==Je){const Yt=this._viewContainer.get(Je);this._viewContainer.move(Yt,pt);const tn=new Qr(Te,Yt);J.push(tn)}});for(let Te=0;Te<J.length;Te++)this._perViewChange(J[Te].view,J[Te].record);for(let Te=0,Je=this._viewContainer.length;Te<Je;Te++){const pt=this._viewContainer.get(Te);pt.context.index=Te,pt.context.count=Je,pt.context.ngForOf=this._ngForOf}U.forEachIdentityChange(Te=>{this._viewContainer.get(Te.currentIndex).context.$implicit=Te.item})}_perViewChange(U,J){U.context.$implicit=J.item}static ngTemplateContextGuard(U,J){return!0}}return N.\u0275fac=function(U){return new(U||N)(fe.Y36(fe.s_b),fe.Y36(fe.Rgc),fe.Y36(fe.ZZ4))},N.\u0275dir=fe.lG2({type:N,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),N})();class Qr{constructor(W,U){this.record=W,this.view=U}}let hr=(()=>{class N{constructor(U,J,Te){this._ngEl=U,this._differs=J,this._renderer=Te,this._ngStyle=null,this._differ=null}set ngStyle(U){this._ngStyle=U,!this._differ&&U&&(this._differ=this._differs.find(U).create())}ngDoCheck(){if(this._differ){const U=this._differ.diff(this._ngStyle);U&&this._applyChanges(U)}}_setStyle(U,J){const[Te,Je]=U.split(".");null!=(J=null!=J&&Je?`${J}${Je}`:J)?this._renderer.setStyle(this._ngEl.nativeElement,Te,J):this._renderer.removeStyle(this._ngEl.nativeElement,Te)}_applyChanges(U){U.forEachRemovedItem(J=>this._setStyle(J.key,null)),U.forEachAddedItem(J=>this._setStyle(J.key,J.currentValue)),U.forEachChangedItem(J=>this._setStyle(J.key,J.currentValue))}}return N.\u0275fac=function(U){return new(U||N)(fe.Y36(fe.SBq),fe.Y36(fe.aQg),fe.Y36(fe.Qsj))},N.\u0275dir=fe.lG2({type:N,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),N})();let Qa=(()=>{class N{constructor(U){this._locale=U}transform(U,J,Te){if(!function(N){return!(null==N||""===N||N!=N)}(U))return null;Te=Te||this._locale;try{return function(N,W,U){return function(N,W,U,J,Te,Je,pt=!1){let Yt="",tn=!1;if(isFinite(N)){let br=function(N){let J,Te,Je,pt,Yt,W=Math.abs(N)+"",U=0;for((Te=W.indexOf("."))>-1&&(W=W.replace(".","")),(Je=W.search(/e/i))>0?(Te<0&&(Te=Je),Te+=+W.slice(Je+1),W=W.substring(0,Je)):Te<0&&(Te=W.length),Je=0;"0"===W.charAt(Je);Je++);if(Je===(Yt=W.length))J=[0],Te=1;else{for(Yt--;"0"===W.charAt(Yt);)Yt--;for(Te-=Je,J=[],pt=0;Je<=Yt;Je++,pt++)J[pt]=Number(W.charAt(Je))}return Te>22&&(J=J.splice(0,21),U=Te-1,Te=1),{digits:J,exponent:U,integerLen:Te}}(N);pt&&(br=function(N){if(0===N.digits[0])return N;const W=N.digits.length-N.integerLen;return N.exponent?N.exponent+=2:(0===W?N.digits.push(0,0):1===W&&N.digits.push(0),N.integerLen+=2),N}(br));let dr=W.minInt,Rn=W.minFrac,An=W.maxFrac;if(Je){const So=Je.match(Be);if(null===So)throw new Error(`${Je} is not a valid digit info`);const wi=So[1],oi=So[3],js=So[5];null!=wi&&(dr=Rt(wi)),null!=oi&&(Rn=Rt(oi)),null!=js?An=Rt(js):null!=oi&&Rn>An&&(An=Rn)}!function(N,W,U){if(W>U)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${U}).`);let J=N.digits,Te=J.length-N.integerLen;const Je=Math.min(Math.max(W,Te),U);let pt=Je+N.integerLen,Yt=J[pt];if(pt>0){J.splice(Math.max(N.integerLen,pt));for(let Rn=pt;Rn<J.length;Rn++)J[Rn]=0}else{Te=Math.max(0,Te),N.integerLen=1,J.length=Math.max(1,pt=Je+1),J[0]=0;for(let Rn=1;Rn<pt;Rn++)J[Rn]=0}if(Yt>=5)if(pt-1<0){for(let Rn=0;Rn>pt;Rn--)J.unshift(0),N.integerLen++;J.unshift(1),N.integerLen++}else J[pt-1]++;for(;Te<Math.max(0,Je);Te++)J.push(0);let tn=0!==Je;const br=W+N.integerLen,dr=J.reduceRight(function(Rn,An,wr,fr){return fr[wr]=(An+=Rn)<10?An:An-10,tn&&(0===fr[wr]&&wr>=br?fr.pop():tn=!1),An>=10?1:0},0);dr&&(J.unshift(dr),N.integerLen++)}(br,Rn,An);let wr=br.digits,fr=br.integerLen;const Io=br.exponent;let Ir=[];for(tn=wr.every(So=>!So);fr<dr;fr++)wr.unshift(0);for(;fr<0;fr++)wr.unshift(0);fr>0?Ir=wr.splice(fr,wr.length):(Ir=wr,wr=[0]);const bi=[];for(wr.length>=W.lgSize&&bi.unshift(wr.splice(-W.lgSize,wr.length).join(""));wr.length>W.gSize;)bi.unshift(wr.splice(-W.gSize,wr.length).join(""));wr.length&&bi.unshift(wr.join("")),Yt=bi.join(Wr(U,J)),Ir.length&&(Yt+=Wr(U,Te)+Ir.join("")),Io&&(Yt+=Wr(U,Et.Exponential)+"+"+Io)}else Yt=Wr(U,Et.Infinity);return Yt=N<0&&!tn?W.negPre+Yt+W.negSuf:W.posPre+Yt+W.posSuf,Yt}(N,function(N,W="-"){const U={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},J=N.split(";"),Te=J[0],Je=J[1],pt=-1!==Te.indexOf(".")?Te.split("."):[Te.substring(0,Te.lastIndexOf("0")+1),Te.substring(Te.lastIndexOf("0")+1)],Yt=pt[0],tn=pt[1]||"";U.posPre=Yt.substr(0,Yt.indexOf("#"));for(let dr=0;dr<tn.length;dr++){const Rn=tn.charAt(dr);"0"===Rn?U.minFrac=U.maxFrac=dr+1:"#"===Rn?U.maxFrac=dr+1:U.posSuf+=Rn}const br=Yt.split(",");if(U.gSize=br[1]?br[1].length:0,U.lgSize=br[2]||br[1]?(br[2]||br[1]).length:0,Je){const dr=Te.length-U.posPre.length-U.posSuf.length,Rn=Je.indexOf("#");U.negPre=Je.substr(0,Rn).replace(/'/g,""),U.negSuf=Je.substr(Rn+dr).replace(/'/g,"")}else U.negPre=W+U.posPre,U.negSuf=U.posSuf;return U}(function(N,W){return(0,fe.cg1)(N)[fe.wAp.NumberFormats][W]}(W,Mn.Decimal),Wr(W,Et.MinusSign)),W,Et.Group,Et.Decimal,U)}(function(N){if("string"==typeof N&&!isNaN(Number(N)-parseFloat(N)))return Number(N);if("number"!=typeof N)throw new Error(`${N} is not a number`);return N}(U),Te,J)}catch(Je){throw function(N,W){return Error(`InvalidPipeArgument: '${W}' for pipe '${(0,fe.AaK)(N)}'`)}(N,Je.message)}}}return N.\u0275fac=function(U){return new(U||N)(fe.Y36(fe.soG,16))},N.\u0275pipe=fe.Yjl({name:"number",type:N,pure:!0}),N})();let ia=(()=>{class N{}return N.\u0275fac=function(U){return new(U||N)},N.\u0275mod=fe.oAB({type:N}),N.\u0275inj=fe.cJS({providers:[{provide:wn,useClass:Ht}]}),N})();const Do="browser";let la=(()=>{class N{}return N.\u0275prov=(0,fe.Yz7)({token:N,providedIn:"root",factory:()=>new Ln((0,fe.LFG)(Ot),window)}),N})();class Ln{constructor(W,U){this.document=W,this.window=U,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const U=function(N,W){const U=N.getElementById(W)||N.getElementsByName(W)[0];if(U)return U;if("function"==typeof N.createTreeWalker&&N.body&&(N.body.createShadowRoot||N.body.attachShadow)){const J=N.createTreeWalker(N.body,NodeFilter.SHOW_ELEMENT);let Te=J.currentNode;for(;Te;){const Je=Te.shadowRoot;if(Je){const pt=Je.getElementById(W)||Je.querySelector(`[name="${W}"]`);if(pt)return pt}Te=J.nextNode()}}return null}(this.document,W);U&&(this.scrollToElement(U),this.attemptFocus(U))}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const U=this.window.history;U&&U.scrollRestoration&&(U.scrollRestoration=W)}}scrollToElement(W){const U=W.getBoundingClientRect(),J=U.left+this.window.pageXOffset,Te=U.top+this.window.pageYOffset,Je=this.offset();this.window.scrollTo(J-Je[0],Te-Je[1])}attemptFocus(W){return W.focus(),this.document.activeElement===W}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=mo(this.window.history)||mo(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch(W){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(W){return!1}}}function mo(N){return Object.getOwnPropertyDescriptor(N,"scrollRestoration")}class ca{}},639:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{deG:()=>X,tb:()=>K0,AFp:()=>W0,ip1:()=>cy,CZH:()=>vd,hGG:()=>AD,z2F:()=>Qf,sBO:()=>_E,Sil:()=>Kf,_Vd:()=>hd,EJc:()=>J0,SBq:()=>fc,qLn:()=>Ms,vpe:()=>pc,gxx:()=>qc,tBr:()=>Wo,XFs:()=>$t,OlP:()=>B,zs3:()=>ri,ZZ4:()=>Rm,aQg:()=>km,soG:()=>Gm,YKP:()=>Vx,v3s:()=>lD,h0i:()=>ih,PXZ:()=>nD,R0b:()=>Da,FiY:()=>Js,Lbi:()=>Y0,g9A:()=>X0,Qsj:()=>nE,FYo:()=>Pm,JOm:()=>Va,Tiy:()=>z_,q3G:()=>ci,tp0:()=>Xo,EAV:()=>dD,Rgc:()=>Bf,dDg:()=>rb,DyG:()=>D,GfV:()=>Rx,s_b:()=>Om,ifc:()=>yn,eFA:()=>cb,G48:()=>XT,_c5:()=>wD,VLi:()=>WT,c2e:()=>Q0,zSh:()=>Su,wAp:()=>_n,vHH:()=>Tr,EiD:()=>Rd,mCW:()=>Oc,qzn:()=>Lc,JVY:()=>va,pB0:()=>Hn,eBb:()=>ug,L6k:()=>cg,LAX:()=>Hi,cg1:()=>S_,Tjo:()=>xD,kL8:()=>tx,yhl:()=>zu,dqk:()=>Dn,sIi:()=>hi,CqO:()=>x_,QGY:()=>v_,F4k:()=>lv,RDi:()=>Je,AaK:()=>ct,z3N:()=>pl,TTD:()=>Pa,xp6:()=>Jd,uIk:()=>yr,Suo:()=>D0,Xpm:()=>Ee,lG2:()=>Ye,Yz7:()=>mr,cJS:()=>Yn,oAB:()=>Ut,Yjl:()=>bn,Y36:()=>Rf,_UZ:()=>iv,qZA:()=>y_,TgZ:()=>__,EpF:()=>av,Ikx:()=>I_,LFG:()=>En,$8M:()=>za,NdJ:()=>b_,CRH:()=>I0,oxw:()=>dv,ALo:()=>x0,xi3:()=>b0,Q6J:()=>m_,VKq:()=>p0,iGM:()=>C0,MAs:()=>od,CHM:()=>vc,LSH:()=>du,kYT:()=>gt,YNc:()=>id,_uU:()=>zv,Oqu:()=>T_,hij:()=>Cm,lnq:()=>D_,Gf:()=>T0});var fe=Ge(574),te=Ge(869),Kt=Ge(282),d=Ge(693),ht=Ge(709),Ot=Ge(319),Ve=Ge(441);var We=Ge(307);function st(){return new ht.xQ}function ut(t){for(let n in t)if(t[n]===ut)return n;throw Error("Could not find renamed property on target object.")}function ct(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ct).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const o=n.indexOf("\n");return-1===o?n:n.substring(0,o)}function dn(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Vn=ut({__forward_ref__:ut});function nn(t){return t.__forward_ref__=nn,t.toString=function(){return ct(this())},t}function _t(t){return function(t){return"function"==typeof t&&t.hasOwnProperty(Vn)&&t.__forward_ref__===nn}(t)?t():t}class Tr extends Error{constructor(n,o){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,o)),this.code=n}}function jt(t){return"string"==typeof t?t:null==t?"":String(t)}function Mn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():jt(t)}function zn(t,n){const o=n?` in ${n}`:"";throw new Tr("201",`No provider for ${Mn(t)} found${o}`)}function Ur(t,n){null==t&&function(t,n,o,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${o} ${a} ${n} <=Actual]`))}(n,t,null,"!=")}function mr(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Yn(t){return{providers:t.providers||[],imports:t.imports||[]}}function Xr(t){return Zi(t,ai)||Zi(t,Ns)}function Zi(t,n){return t.hasOwnProperty(n)?t[n]:null}function Eo(t){return t&&(t.hasOwnProperty(Wi)||t.hasOwnProperty(Yr))?t[Wi]:null}const ai=ut({\u0275prov:ut}),Wi=ut({\u0275inj:ut}),Ns=ut({ngInjectableDef:ut}),Yr=ut({ngInjectorDef:ut});var $t=(()=>(($t=$t||{})[$t.Default=0]="Default",$t[$t.Host=1]="Host",$t[$t.Self=2]="Self",$t[$t.SkipSelf=4]="SkipSelf",$t[$t.Optional=8]="Optional",$t))();let ur;function Qt(t){const n=ur;return ur=t,n}function Mi(t,n,o){const a=Xr(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:o&$t.Optional?null:void 0!==n?n:void zn(ct(t),"Injector")}function Kr(t){return{toString:t}.toString()}var Zn=(()=>((Zn=Zn||{})[Zn.OnPush=0]="OnPush",Zn[Zn.Default=1]="Default",Zn))(),yn=(()=>((yn=yn||{})[yn.Emulated=0]="Emulated",yn[yn.None=2]="None",yn[yn.ShadowDom=3]="ShadowDom",yn))();const Ri="undefined"!=typeof globalThis&&globalThis,Bn="undefined"!=typeof window&&window,Bs="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Dn=Ri||"undefined"!=typeof global&&global||Bn||Bs,fi={},Pn=[],ie=ut({\u0275cmp:ut}),$=ut({\u0275dir:ut}),q=ut({\u0275pipe:ut}),ae=ut({\u0275mod:ut}),he=ut({\u0275loc:ut}),be=ut({\u0275fac:ut}),Le=ut({__NG_ELEMENT_ID__:ut});let Oe=0;function Ee(t){return Kr(()=>{const o={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:o,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===Zn.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||Pn,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||yn.Emulated,id:"c",styles:t.styles||Pn,_:null,setInput:null,schemas:t.schemas||null,tView:null},u=t.directives,g=t.features,b=t.pipes;return a.id+=Oe++,a.inputs=Pe(t.inputs,o),a.outputs=Pe(t.outputs),g&&g.forEach(E=>E(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(tt):null,a.pipeDefs=b?()=>("function"==typeof b?b():b).map(yt):null,a})}function tt(t){return sn(t)||function(t){return t[$]||null}(t)}function yt(t){return function(t){return t[q]||null}(t)}const je={};function Ut(t){return Kr(()=>{const n={type:t.type,bootstrap:t.bootstrap||Pn,declarations:t.declarations||Pn,imports:t.imports||Pn,exports:t.exports||Pn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(je[t.id]=t.type),n})}function gt(t,n){return Kr(()=>{const o=an(t,!0);o.declarations=n.declarations||Pn,o.imports=n.imports||Pn,o.exports=n.exports||Pn})}function Pe(t,n){if(null==t)return fi;const o={};for(const a in t)if(t.hasOwnProperty(a)){let u=t[a],g=u;Array.isArray(u)&&(g=u[1],u=u[0]),o[u]=a,n&&(n[u]=g)}return o}const Ye=Ee;function bn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function sn(t){return t[ie]||null}function an(t,n){const o=t[ae]||null;if(!o&&!0===n)throw new Error(`Type ${ct(t)} does not have '\u0275mod' property.`);return o}function Or(t){return Array.isArray(t)&&"object"==typeof t[1]}function mi(t){return Array.isArray(t)&&!0===t[1]}function Us(t){return 0!=(8&t.flags)}function Ia(t){return 2==(2&t.flags)}function ho(t){return 1==(1&t.flags)}function ki(t){return null!==t.template}function Ka(t){return 0!=(512&t[2])}function Ji(t,n){return t.hasOwnProperty(be)?t[be]:null}class sa{constructor(n,o,a){this.previousValue=n,this.currentValue=o,this.firstChange=a}isFirstChange(){return this.firstChange}}function Pa(){return aa}function aa(t){return t.type.prototype.ngOnChanges&&(t.setInput=Ln),la}function la(){const t=gs(this),n=null==t?void 0:t.current;if(n){const o=t.previous;if(o===fi)t.previous=n;else for(let a in n)o[a]=n[a];t.current=null,this.ngOnChanges(n)}}function Ln(t,n,o,a){const u=gs(t)||function(t,n){return t[mo]=n}(t,{previous:fi,current:null}),g=u.current||(u.current={}),b=u.previous,E=this.declaredInputs[o],S=b[E];g[E]=new sa(S&&S.currentValue,n,b===fi),t[a]=n}Pa.ngInherit=!0;const mo="__ngSimpleChanges__";function gs(t){return t[mo]||null}let Te;function Je(t){Te=t}function tn(t){return!!t.listen}const dr={createRenderer:(t,n)=>void 0!==Te?Te:"undefined"!=typeof document?document:void 0};function An(t){for(;Array.isArray(t);)t=t[0];return t}function Ir(t,n){return An(n[t.index])}function So(t,n){return t.data[n]}function wi(t,n){return t[n]}function oi(t,n){const o=n[t];return Or(o)?o:o[0]}function js(t){return 4==(4&t[2])}function Ra(t){return 128==(128&t[2])}function eo(t,n){return null==n?null:t[n]}function ua(t){t[18]=0}function _s(t,n){t[5]+=n;let o=t,a=t[3];for(;null!==a&&(1===n&&1===o[5]||-1===n&&0===o[5]);)a[5]+=n,o=a,a=a[3]}const mn={lFrame:tl(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function yc(){return mn.bindingsEnabled}function ft(){return mn.lFrame.lView}function $n(){return mn.lFrame.tView}function vc(t){return mn.lFrame.contextLView=t,t[8]}function Jr(){let t=ys();for(;null!==t&&64===t.type;)t=t.parent;return t}function ys(){return mn.lFrame.currentTNode}function Ei(t,n){const o=mn.lFrame;o.currentTNode=t,o.isParent=n}function Ho(){return mn.lFrame.isParent}function Gs(){return mn.isInCheckNoChangesMode}function Ol(t){mn.isInCheckNoChangesMode=t}function Li(){const t=mn.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function $i(){return mn.lFrame.bindingIndex}function vs(){return mn.lFrame.bindingIndex++}function to(t,n){const o=mn.lFrame;o.bindingIndex=o.bindingRootIndex=t,rs(n)}function rs(t){mn.lFrame.currentDirectiveIndex=t}function wc(){return mn.lFrame.currentQueryIndex}function Po(t){mn.lFrame.currentQueryIndex=t}function Hs(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function go(t,n,o){if(o&$t.SkipSelf){let u=n,g=t;for(;!(u=u.parent,null!==u||o&$t.Host||(u=Hs(g),null===u||(g=g[15],10&u.type))););if(null===u)return!1;n=u,t=g}const a=mn.lFrame=zl();return a.currentTNode=n,a.lView=t,!0}function qo(t){const n=zl(),o=t[1];mn.lFrame=n,n.currentTNode=o.firstChild,n.lView=t,n.tView=o,n.contextLView=t,n.bindingIndex=o.bindingStartIndex,n.inI18n=!1}function zl(){const t=mn.lFrame,n=null===t?null:t.child;return null===n?tl(t):n}function tl(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function bs(){const t=mn.lFrame;return mn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Nl=bs;function ws(){const t=bs();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Ci(){return mn.lFrame.selectedIndex}function no(t){mn.lFrame.selectedIndex=t}function pr(){const t=mn.lFrame;return So(t.tView,t.selectedIndex)}function Ul(t,n){for(let o=n.directiveStart,a=n.directiveEnd;o<a;o++){const g=t.data[o].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:E,ngAfterViewInit:S,ngAfterViewChecked:L,ngOnDestroy:H}=g;b&&(t.contentHooks||(t.contentHooks=[])).push(-o,b),E&&((t.contentHooks||(t.contentHooks=[])).push(o,E),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(o,E)),S&&(t.viewHooks||(t.viewHooks=[])).push(-o,S),L&&((t.viewHooks||(t.viewHooks=[])).push(o,L),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(o,L)),null!=H&&(t.destroyHooks||(t.destroyHooks=[])).push(o,H)}}function qs(t,n,o){pa(t,n,3,o)}function fa(t,n,o,a){(3&t[2])===o&&pa(t,n,o,a)}function rl(t,n){let o=t[2];(3&o)===n&&(o&=2047,o+=1,t[2]=o)}function pa(t,n,o,a){const g=null!=a?a:-1,b=n.length-1;let E=0;for(let S=void 0!==a?65535&t[18]:0;S<b;S++)if("number"==typeof n[S+1]){if(E=n[S],null!=a&&E>=a)break}else n[S]<0&&(t[18]+=65536),(E<g||-1==g)&&(il(t,o,n,S),t[18]=(4294901760&t[18])+S+2),S++}function il(t,n,o,a){const u=o[a]<0,g=o[a+1],E=t[u?-o[a]:o[a]];if(u){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(E)}finally{}}}else try{g.call(E)}finally{}}class Es{constructor(n,o,a){this.factory=n,this.resolving=!1,this.canSeeViewProviders=o,this.injectImpl=a}}function Gl(t,n,o){const a=tn(t);let u=0;for(;u<o.length;){const g=o[u];if("number"==typeof g){if(0!==g)break;u++;const b=o[u++],E=o[u++],S=o[u++];a?t.setAttribute(n,E,S,b):n.setAttributeNS(b,E,S)}else{const b=g,E=o[++u];Hl(b)?a&&t.setProperty(n,b,E):a?t.setAttribute(n,b,E):n.setAttribute(b,E),u++}}return u}function Ti(t){return 3===t||4===t||6===t}function Hl(t){return 64===t.charCodeAt(0)}function Ro(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let o=-1;for(let a=0;a<n.length;a++){const u=n[a];"number"==typeof u?o=u:0===o||Ws(t,o,u,null,-1===o||2===o?n[++a]:null)}}return t}function Ws(t,n,o,a,u){let g=0,b=t.length;if(-1===n)b=-1;else for(;g<t.length;){const E=t[g++];if("number"==typeof E){if(E===n){b=-1;break}if(E>n){b=g-1;break}}}for(;g<t.length;){const E=t[g];if("number"==typeof E)break;if(E===o){if(null===a)return void(null!==u&&(t[g+1]=u));if(a===t[g+1])return void(t[g+2]=u)}g++,null!==a&&g++,null!==u&&g++}-1!==b&&(t.splice(b,0,n),g=b+1),t.splice(g++,0,o),null!==a&&t.splice(g++,0,a),null!==u&&t.splice(g++,0,u)}function iu(t){return-1!==t}function Cs(t){return 32767&t}function ma(t,n){let o=function(t){return t>>16}(t),a=n;for(;o>0;)a=a[15],o--;return a}let Di=!0;function Ts(t){const n=Di;return Di=t,n}let is=0;function Oa(t,n){const o=_a(t,n);if(-1!==o)return o;const a=n[1];a.firstCreatePass&&(t.injectorIndex=n.length,ga(a.data,t),ga(n,null),ga(a.blueprint,null));const u=Ds(t,n),g=t.injectorIndex;if(iu(u)){const b=Cs(u),E=ma(u,n),S=E[1].data;for(let L=0;L<8;L++)n[g+L]=E[b+L]|S[b+L]}return n[g+8]=u,g}function ga(t,n){t.push(0,0,0,0,0,0,0,0,n)}function _a(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Ds(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let o=0,a=null,u=n;for(;null!==u;){const g=u[1],b=g.type;if(a=2===b?g.declTNode:1===b?u[6]:null,null===a)return-1;if(o++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|o<<16}return-1}function al(t,n,o){!function(t,n,o){let a;"string"==typeof o?a=o.charCodeAt(0)||0:o.hasOwnProperty(Le)&&(a=o[Le]),null==a&&(a=o[Le]=is++);const u=255&a;n.data[t+(u>>5)]|=1<<u}(t,n,o)}function Zl(t,n,o){if(o&$t.Optional)return t;zn(n,"NodeInjector")}function ll(t,n,o,a){if(o&$t.Optional&&void 0===a&&(a=null),0==(o&($t.Self|$t.Host))){const u=t[9],g=Qt(void 0);try{return u?u.get(n,a,o&$t.Optional):Mi(n,a,o&$t.Optional)}finally{Qt(g)}}return Zl(a,n,o)}function ou(t,n,o,a=$t.Default,u){if(null!==t){const g=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Le)?t[Le]:void 0;return"number"==typeof n?n>=0?255&n:Ic:n}(o);if("function"==typeof g){if(!go(n,t,a))return a&$t.Host?Zl(u,o,a):ll(n,o,a,u);try{const b=g(a);if(null!=b||a&$t.Optional)return b;zn(o)}finally{Nl()}}else if("number"==typeof g){let b=null,E=_a(t,n),S=-1,L=a&$t.Host?n[16][6]:null;for((-1===E||a&$t.SkipSelf)&&(S=-1===E?Ds(t,n):n[E+8],-1!==S&&Xl(a,!1)?(b=n[1],E=Cs(S),n=ma(S,n)):E=-1);-1!==E;){const H=n[1];if(Ac(g,E,H.data)){const K=Wl(E,n,o,b,a,L);if(K!==Fo)return K}S=n[E+8],-1!==S&&Xl(a,n[1].data[E+8]===L)&&Ac(g,E,n)?(b=H,E=Cs(S),n=ma(S,n)):E=-1}}}return ll(n,o,a,u)}const Fo={};function Ic(){return new Ks(Jr(),ft())}function Wl(t,n,o,a,u,g){const b=n[1],E=b.data[t+8],H=Is(E,b,o,null==a?Ia(E)&&Di:a!=b&&0!=(3&E.type),u&$t.Host&&g===E);return null!==H?Ys(n,b,H,E):Fo}function Is(t,n,o,a,u){const g=t.providerIndexes,b=n.data,E=1048575&g,S=t.directiveStart,H=g>>20,le=u?E+H:t.directiveEnd;for(let we=a?E:E+H;we<le;we++){const ke=b[we];if(we<S&&o===ke||we>=S&&ke.type===o)return we}if(u){const we=b[S];if(we&&ki(we)&&we.type===o)return S}return null}function Ys(t,n,o,a){let u=t[o];const g=n.data;if(function(t){return t instanceof Es}(u)){const b=u;b.resolving&&function(t,n){throw new Tr("200",`Circular dependency in DI detected for ${t}`)}(Mn(g[o]));const E=Ts(b.canSeeViewProviders);b.resolving=!0;const S=b.injectImpl?Qt(b.injectImpl):null;go(t,a,$t.Default);try{u=t[o]=b.factory(void 0,g,t,a),n.firstCreatePass&&o>=a.directiveStart&&function(t,n,o){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:g}=n.type.prototype;if(a){const b=aa(n);(o.preOrderHooks||(o.preOrderHooks=[])).push(t,b),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(t,b)}u&&(o.preOrderHooks||(o.preOrderHooks=[])).push(0-t,u),g&&((o.preOrderHooks||(o.preOrderHooks=[])).push(t,g),(o.preOrderCheckHooks||(o.preOrderCheckHooks=[])).push(t,g))}(o,g[o],n)}finally{null!==S&&Qt(S),Ts(E),b.resolving=!1,Nl()}}return u}function Ac(t,n,o){return!!(o[n+(t>>5)]&1<<t)}function Xl(t,n){return!(t&$t.Self||t&$t.Host&&n)}class Ks{constructor(n,o){this._tNode=n,this._lView=o}get(n,o,a){return ou(this._tNode,this._lView,n,a,o)}}function za(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const o=t.attrs;if(o){const a=o.length;let u=0;for(;u<a;){const g=o[u];if(Ti(g))break;if(0===g)u+=2;else if("number"==typeof g)for(u++;u<a&&"string"==typeof o[u];)u++;else{if(g===n)return o[u+1];u+=2}}}return null}(Jr(),t)}const Ss="__parameters__";function ro(t,n,o){return Kr(()=>{const a=function(t){return function(...o){if(t){const a=t(...o);for(const u in a)this[u]=a[u]}}}(n);function u(...g){if(this instanceof u)return a.apply(this,g),this;const b=new u(...g);return E.annotation=b,E;function E(S,L,H){const K=S.hasOwnProperty(Ss)?S[Ss]:Object.defineProperty(S,Ss,{value:[]})[Ss];for(;K.length<=H;)K.push(null);return(K[H]=K[H]||[]).push(b),S}}return o&&(u.prototype=Object.create(o.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}class B{constructor(n,o){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof o?this.__NG_ELEMENT_ID__=o:void 0!==o&&(this.\u0275prov=mr({token:this,providedIn:o.providedIn||"root",factory:o.factory}))}toString(){return`InjectionToken ${this._desc}`}}const X=new B("AnalyzeForEntryComponents"),D=Function;function V(t,n){void 0===n&&(n=t);for(let o=0;o<t.length;o++){let a=t[o];Array.isArray(a)?(n===t&&(n=t.slice(0,o)),V(a,n)):n!==t&&n.push(a)}return n}function j(t,n){t.forEach(o=>Array.isArray(o)?j(o,n):n(o))}function Y(t,n,o){n>=t.length?t.push(o):t.splice(n,0,o)}function ee(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}const rn={},ln="__NG_DI_FLAG__",qt="ngTempTokenPath",Jn=/\n/gm,Ii="__source",Gi=ut({provide:String,useValue:ut});let $r;function Lo(t){const n=$r;return $r=t,n}function Qs(t,n=$t.Default){if(void 0===$r)throw new Error("inject() must be called from an injection context");return null===$r?Mi(t,void 0,n):$r.get(t,n&$t.Optional?null:void 0,n)}function En(t,n=$t.Default){return(ur||Qs)(_t(t),n)}function lr(t){const n=[];for(let o=0;o<t.length;o++){const a=_t(t[o]);if(Array.isArray(a)){if(0===a.length)throw new Error("Arguments array must have arguments.");let u,g=$t.Default;for(let b=0;b<a.length;b++){const E=a[b],S=Sr(E);"number"==typeof S?-1===S?u=E.token:g|=S:u=E}n.push(En(u,g))}else n.push(En(a))}return n}function li(t,n){return t[ln]=n,t.prototype[ln]=n,t}function Sr(t){return t[ln]}function Oo(t,n,o,a){const u=t[qt];throw n[Ii]&&u.unshift(n[Ii]),t.message=function(t,n,o,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let u=ct(n);if(Array.isArray(n))u=n.map(ct).join(" -> ");else if("object"==typeof n){let g=[];for(let b in n)if(n.hasOwnProperty(b)){let E=n[b];g.push(b+":"+("string"==typeof E?JSON.stringify(E):ct(E)))}u=`{${g.join(", ")}}`}return`${o}${a?"("+a+")":""}[${u}]: ${t.replace(Jn,"\n  ")}`}("\n"+t.message,u,o,a),t.ngTokenPath=u,t[qt]=null,t}const Wo=li(ro("Inject",t=>({token:t})),-1),Js=li(ro("Optional"),8),Xo=li(ro("SkipSelf"),4);let Mc;function Pc(t){var n;return(null===(n=function(){if(void 0===Mc&&(Mc=null,Dn.trustedTypes))try{Mc=Dn.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(t){}return Mc}())||void 0===n?void 0:n.createHTML(t))||t}class ss{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class fl extends ss{getTypeName(){return"HTML"}}class Fc extends ss{getTypeName(){return"Style"}}class sg extends ss{getTypeName(){return"Script"}}class ag extends ss{getTypeName(){return"URL"}}class lg extends ss{getTypeName(){return"ResourceURL"}}function pl(t){return t instanceof ss?t.changingThisBreaksApplicationSecurity:t}function Lc(t,n){const o=zu(t);if(null!=o&&o!==n){if("ResourceURL"===o&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${o} (see https://g.co/ng/security#xss)`)}return o===n}function zu(t){return t instanceof ss&&t.getTypeName()||null}function va(t){return new fl(t)}function cg(t){return new Fc(t)}function ug(t){return new sg(t)}function Hi(t){return new ag(t)}function Hn(t){return new lg(t)}class sp{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const o=(new window.DOMParser).parseFromString(Pc(n),"text/html").body;return null===o?this.inertDocumentHelper.getInertBodyElement(n):(o.removeChild(o.firstChild),o)}catch(o){return null}}}class gr{constructor(n){if(this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const o=this.inertDocument.createElement("html");this.inertDocument.appendChild(o);const a=this.inertDocument.createElement("body");o.appendChild(a)}}getInertBodyElement(n){const o=this.inertDocument.createElement("template");if("content"in o)return o.innerHTML=Pc(n),o;const a=this.inertDocument.createElement("body");return a.innerHTML=Pc(n),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(a),a}stripCustomNsAttrs(n){const o=n.attributes;for(let u=o.length-1;0<u;u--){const b=o.item(u).name;("xmlns:ns1"===b||0===b.indexOf("ns1:"))&&n.removeAttribute(b)}let a=n.firstChild;for(;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}const lp=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Id=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Oc(t){return(t=String(t)).match(lp)||t.match(Id)?t:"unsafe:"+t}function qi(t){const n={};for(const o of t.split(","))n[o]=!0;return n}function zc(...t){const n={};for(const o of t)for(const a in o)o.hasOwnProperty(a)&&(n[a]=!0);return n}const ml=qi("area,br,col,hr,img,wbr"),Nu=qi("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),mh=qi("rp,rt"),Sd=zc(ml,zc(Nu,qi("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),zc(mh,qi("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),zc(mh,Nu)),xa=qi("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),gl=qi("srcset"),Md=zc(xa,gl,qi("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),qi("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),dg=qi("script,style,template");class dp{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let o=n.firstChild,a=!0;for(;o;)if(o.nodeType===Node.ELEMENT_NODE?a=this.startElement(o):o.nodeType===Node.TEXT_NODE?this.chars(o.nodeValue):this.sanitizedSomething=!0,a&&o.firstChild)o=o.firstChild;else for(;o;){o.nodeType===Node.ELEMENT_NODE&&this.endElement(o);let u=this.checkClobberedElement(o,o.nextSibling);if(u){o=u;break}o=this.checkClobberedElement(o,o.parentNode)}return this.buf.join("")}startElement(n){const o=n.nodeName.toLowerCase();if(!Sd.hasOwnProperty(o))return this.sanitizedSomething=!0,!dg.hasOwnProperty(o);this.buf.push("<"),this.buf.push(o);const a=n.attributes;for(let u=0;u<a.length;u++){const g=a.item(u),b=g.name,E=b.toLowerCase();if(!Md.hasOwnProperty(E)){this.sanitizedSomething=!0;continue}let S=g.value;xa[E]&&(S=Oc(S)),gl[E]&&(t=S,S=(t=String(t)).split(",").map(n=>Oc(n.trim())).join(", ")),this.buf.push(" ",b,'="',fp(S),'"')}var t;return this.buf.push(">"),!0}endElement(n){const o=n.nodeName.toLowerCase();Sd.hasOwnProperty(o)&&!ml.hasOwnProperty(o)&&(this.buf.push("</"),this.buf.push(o),this.buf.push(">"))}chars(n){this.buf.push(fp(n))}checkClobberedElement(n,o){if(o&&(n.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return o}}const fg=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Pd=/([^\#-~ |!])/g;function fp(t){return t.replace(/&/g,"&amp;").replace(fg,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(Pd,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let cu;function Rd(t,n){let o=null;try{cu=cu||function(t){const n=new gr(t);return function(){try{return!!(new window.DOMParser).parseFromString(Pc(""),"text/html")}catch(t){return!1}}()?new sp(n):n}(t);let a=n?String(n):"";o=cu.getInertBodyElement(a);let u=5,g=a;do{if(0===u)throw new Error("Failed to sanitize html because the input is unstable");u--,a=g,g=o.innerHTML,o=cu.getInertBodyElement(a)}while(a!==g);return Pc((new dp).sanitizeChildren(gh(o)||o))}finally{if(o){const a=gh(o)||o;for(;a.firstChild;)a.removeChild(a.firstChild)}}}function gh(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var ci=(()=>((ci=ci||{})[ci.NONE=0]="NONE",ci[ci.HTML=1]="HTML",ci[ci.STYLE=2]="STYLE",ci[ci.SCRIPT=3]="SCRIPT",ci[ci.URL=4]="URL",ci[ci.RESOURCE_URL=5]="RESOURCE_URL",ci))();function du(t){const n=function(){const t=ft();return t&&t[12]}();return n?n.sanitize(ci.URL,t)||"":Lc(t,"URL")?pl(t):Oc(jt(t))}const Fd="__ngContext__";function yo(t,n){t[Fd]=n}function yh(t){const n=function(t){return t[Fd]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function pu(t){return t.ngOriginalError}function Bd(t,...n){t.error(...n)}class Ms{constructor(){this._console=console}handleError(n){const o=this._findOriginalError(n),a=this._findContext(n),u=(t=n)&&t.ngErrorLogger||Bd;var t;u(this._console,"ERROR",n),o&&u(this._console,"ORIGINAL ERROR",o),a&&u(this._console,"ERROR CONTEXT",a)}_findContext(n){return n?n.ngDebugContext||this._findContext(pu(n)):null}_findOriginalError(n){let o=n&&pu(n);for(;o&&pu(o);)o=pu(o);return o||null}}const Dp=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Dn))();function Ba(t){return t instanceof Function?t():t}var Va=(()=>((Va=Va||{})[Va.Important=1]="Important",Va[Va.DashCase=2]="DashCase",Va))();function gu(t,n){return undefined(t,n)}function nc(t){const n=t[3];return mi(n)?n[3]:n}function Eh(t){return Ch(t[13])}function Bc(t){return Ch(t[4])}function Ch(t){for(;null!==t&&!mi(t);)t=t[4];return t}function yu(t,n,o,a,u){if(null!=a){let g,b=!1;mi(a)?g=a:Or(a)&&(b=!0,a=a[0]);const E=An(a);0===t&&null!==o?null==u?Fp(n,o,E):rc(n,o,E,u||null,!0):1===t&&null!==o?rc(n,o,E,u||null,!0):2===t?function(t,n,o){const a=Sh(t,n);a&&function(t,n,o,a){tn(t)?t.removeChild(n,o,a):n.removeChild(o)}(t,a,n,o)}(n,E,b):3===t&&n.destroyNode(E),null!=g&&function(t,n,o,a,u){const g=o[7];g!==An(o)&&yu(n,t,a,g,u);for(let E=10;E<o.length;E++){const S=o[E];qu(S[1],S,t,n,a,g)}}(n,t,g,o,u)}}function Gu(t,n,o){return tn(t)?t.createElement(n,o):null===o?t.createElement(n):t.createElementNS(o,n)}function Pp(t,n){const o=t[9],a=o.indexOf(n),u=n[3];1024&n[2]&&(n[2]&=-1025,_s(u,-1)),o.splice(a,1)}function Gd(t,n){if(t.length<=10)return;const o=10+n,a=t[o];if(a){const u=a[17];null!==u&&u!==t&&Pp(u,a),n>0&&(t[o-1][4]=a[4]);const g=ee(t,10+n);!function(t,n){qu(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(a[1],a);const b=g[19];null!==b&&b.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Rp(t,n){if(!(256&n[2])){const o=n[11];tn(o)&&o.destroyNode&&qu(t,n,o,3,null,null),function(t){let n=t[13];if(!n)return Ih(t[1],t);for(;n;){let o=null;if(Or(n))o=n[13];else{const a=n[10];a&&(o=a)}if(!o){for(;n&&!n[4]&&n!==t;)Or(n)&&Ih(n[1],n),n=n[3];null===n&&(n=t),Or(n)&&Ih(n[1],n),o=n&&n[4]}n=o}}(n)}}function Ih(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let o;if(null!=t&&null!=(o=t.destroyHooks))for(let a=0;a<o.length;a+=2){const u=n[o[a]];if(!(u instanceof Es)){const g=o[a+1];if(Array.isArray(g))for(let b=0;b<g.length;b+=2){const E=u[g[b]],S=g[b+1];try{S.call(E)}finally{}}else try{g.call(u)}finally{}}}}(t,n),function(t,n){const o=t.cleanup,a=n[7];let u=-1;if(null!==o)for(let g=0;g<o.length-1;g+=2)if("string"==typeof o[g]){const b=o[g+1],E="function"==typeof b?b(n):An(n[b]),S=a[u=o[g+2]],L=o[g+3];"boolean"==typeof L?E.removeEventListener(o[g],S,L):L>=0?a[u=L]():a[u=-L].unsubscribe(),g+=2}else{const b=a[u=o[g+1]];o[g].call(b)}if(null!==a){for(let g=u+1;g<a.length;g++)a[g]();n[7]=null}}(t,n),1===n[1].type&&tn(n[11])&&n[11].destroy();const o=n[17];if(null!==o&&mi(n[3])){o!==n[3]&&Pp(o,n);const a=n[19];null!==a&&a.detachView(t)}}}function kp(t,n,o){return function(t,n,o){let a=n;for(;null!==a&&40&a.type;)a=(n=a).parent;if(null===a)return o[0];if(2&a.flags){const u=t.data[a.directiveStart].encapsulation;if(u===yn.None||u===yn.Emulated)return null}return Ir(a,o)}(t,n.parent,o)}function rc(t,n,o,a,u){tn(t)?t.insertBefore(n,o,a,u):n.insertBefore(o,a,u)}function Fp(t,n,o){tn(t)?t.appendChild(n,o):n.appendChild(o)}function Lp(t,n,o,a,u){null!==a?rc(t,n,o,a,u):Fp(t,n,o)}function Sh(t,n){return tn(t)?t.parentNode(n):n.parentNode}let Ah=function(t,n,o){return 40&t.type?Ir(t,o):null};function ic(t,n,o,a){const u=kp(t,a,n),g=n[11],E=function(t,n,o){return Ah(t,n,o)}(a.parent||n[6],a,n);if(null!=u)if(Array.isArray(o))for(let S=0;S<o.length;S++)Lp(g,u,o[S],E,!1);else Lp(g,u,o,E,!1)}function Hu(t,n){if(null!==n){const o=n.type;if(3&o)return Ir(n,t);if(4&o)return Xd(-1,t[n.index]);if(8&o){const a=n.child;if(null!==a)return Hu(t,a);{const u=t[n.index];return mi(u)?Xd(-1,u):An(u)}}if(32&o)return gu(n,t)()||An(t[n.index]);{const a=Wd(t,n);return null!==a?Array.isArray(a)?a[0]:Hu(nc(t[16]),a):Hu(t,n.next)}}return null}function Wd(t,n){return null!==n?t[16][6].projection[n.projection]:null}function Xd(t,n){const o=10+t+1;if(o<n.length){const a=n[o],u=a[1].firstChild;if(null!==u)return Hu(a,u)}return n[7]}function Yd(t,n,o,a,u,g,b){for(;null!=o;){const E=a[o.index],S=o.type;if(b&&0===n&&(E&&yo(An(E),a),o.flags|=4),64!=(64&o.flags))if(8&S)Yd(t,n,o.child,a,u,g,!1),yu(n,t,u,E,g);else if(32&S){const L=gu(o,a);let H;for(;H=L();)yu(n,t,u,H,g);yu(n,t,u,E,g)}else 16&S?Np(t,n,a,o,u,g):yu(n,t,u,E,g);o=b?o.projectionNext:o.next}}function qu(t,n,o,a,u,g){Yd(o,a,t.firstChild,n,u,g,!1)}function Np(t,n,o,a,u,g){const b=o[16],S=b[6].projection[a.projection];if(Array.isArray(S))for(let L=0;L<S.length;L++)yu(n,t,u,S[L],g);else Yd(t,n,S,b[3],u,g,!0)}function Bp(t,n,o){tn(t)?t.setAttribute(n,"style",o):n.style.cssText=o}function Ph(t,n,o){tn(t)?""===o?t.removeAttribute(n,"class"):t.setAttribute(n,"class",o):n.className=o}function Kd(t,n,o){let a=t.length;for(;;){const u=t.indexOf(n,o);if(-1===u)return u;if(0===u||t.charCodeAt(u-1)<=32){const g=n.length;if(u+g===a||t.charCodeAt(u+g)<=32)return u}o=u+1}}const Vp="ng-template";function Lg(t,n,o){let a=0;for(;a<t.length;){let u=t[a++];if(o&&"class"===u){if(u=t[a],-1!==Kd(u.toLowerCase(),n,0))return!0}else if(1===u){for(;a<t.length&&"string"==typeof(u=t[a++]);)if(u.toLowerCase()===n)return!0;return!1}}return!1}function Up(t){return 4===t.type&&t.value!==Vp}function Og(t,n,o){return n===(4!==t.type||o?t.value:Vp)}function jp(t,n,o){let a=4;const u=t.attrs||[],g=function(t){for(let n=0;n<t.length;n++)if(Ti(t[n]))return n;return t.length}(u);let b=!1;for(let E=0;E<n.length;E++){const S=n[E];if("number"!=typeof S){if(!b)if(4&a){if(a=2|1&a,""!==S&&!Og(t,S,o)||""===S&&1===n.length){if(ba(a))return!1;b=!0}}else{const L=8&a?S:n[++E];if(8&a&&null!==t.attrs){if(!Lg(t.attrs,L,o)){if(ba(a))return!1;b=!0}continue}const K=oo(8&a?"class":S,u,Up(t),o);if(-1===K){if(ba(a))return!1;b=!0;continue}if(""!==L){let le;le=K>g?"":u[K+1].toLowerCase();const we=8&a?le:null;if(we&&-1!==Kd(we,L,0)||2&a&&L!==le){if(ba(a))return!1;b=!0}}}}else{if(!b&&!ba(a)&&!ba(S))return!1;if(b&&ba(S))continue;b=!1,a=S|1&a}}return ba(a)||b}function ba(t){return 0==(1&t)}function oo(t,n,o,a){if(null===n)return-1;let u=0;if(a||!o){let g=!1;for(;u<n.length;){const b=n[u];if(b===t)return u;if(3===b||6===b)g=!0;else{if(1===b||2===b){let E=n[++u];for(;"string"==typeof E;)E=n[++u];continue}if(4===b)break;if(0===b){u+=4;continue}}u+=g?1:2}return-1}return function(t,n){let o=t.indexOf(4);if(o>-1)for(o++;o<t.length;){const a=t[o];if("number"==typeof a)return-1;if(a===n)return o;o++}return-1}(n,t)}function wa(t,n,o=!1){for(let a=0;a<n.length;a++)if(jp(t,n[a],o))return!0;return!1}function $p(t,n){return t?":not("+n.trim()+")":n}function Zu(t){let n=t[0],o=1,a=2,u="",g=!1;for(;o<t.length;){let b=t[o];if("string"==typeof b)if(2&a){const E=t[++o];u+="["+b+(E.length>0?'="'+E+'"':"")+"]"}else 8&a?u+="."+b:4&a&&(u+=" "+b);else""!==u&&!ba(b)&&(n+=$p(g,u),u=""),a=b,g=g||!ba(a);o++}return""!==u&&(n+=$p(g,u)),n}const In={};function Jd(t){Eu($n(),ft(),Ci()+t,Gs())}function Eu(t,n,o,a){if(!a)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&qs(n,g,o)}else{const g=t.preOrderHooks;null!==g&&fa(n,g,0,o)}no(o)}function cf(t,n){const o=t.contentQueries;if(null!==o)for(let a=0;a<o.length;a+=2){const u=o[a],g=o[a+1];if(-1!==g){const b=t.data[g];Po(u),b.contentQueries(2,n[g],g)}}}function $a(t,n,o,a,u,g,b,E,S,L){const H=n.blueprint.slice();return H[0]=u,H[2]=140|a,ua(H),H[3]=H[15]=t,H[8]=o,H[10]=b||t&&t[10],H[11]=E||t&&t[11],H[12]=S||t&&t[12]||null,H[9]=L||t&&t[9]||null,H[6]=g,H[16]=2==n.type?t[16]:H,H}function Uc(t,n,o,a,u){let g=t.data[n];if(null===g)g=function(t,n,o,a,u){const g=ys(),b=Ho(),S=t.data[n]=function(t,n,o,a,u,g){return{type:o,index:a,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?g:g&&g.parent,o,n,a,u);return null===t.firstChild&&(t.firstChild=S),null!==g&&(b?null==g.child&&null!==S.parent&&(g.child=S):null===g.next&&(g.next=S)),S}(t,n,o,a,u),mn.lFrame.inI18n&&(g.flags|=64);else if(64&g.type){g.type=o,g.value=a,g.attrs=u;const b=function(){const t=mn.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===b?-1:b.injectorIndex}return Ei(g,!0),g}function jc(t,n,o,a){if(0===o)return-1;const u=n.length;for(let g=0;g<o;g++)n.push(a),t.blueprint.push(a),t.data.push(null);return u}function oc(t,n,o){qo(n);try{const a=t.viewQuery;null!==a&&na(1,a,o);const u=t.template;null!==u&&Jp(t,n,u,1,o),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&cf(t,n),t.staticViewQueries&&na(2,t.viewQuery,o);const g=t.components;null!==g&&function(t,n){for(let o=0;o<n.length;o++)Xh(t,n[o])}(n,g)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{n[2]&=-5,ws()}}function xl(t,n,o,a){const u=n[2];if(256==(256&u))return;qo(n);const g=Gs();try{ua(n),function(t){mn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==o&&Jp(t,n,o,2,a);const b=3==(3&u);if(!g)if(b){const L=t.preOrderCheckHooks;null!==L&&qs(n,L,null)}else{const L=t.preOrderHooks;null!==L&&fa(n,L,0,null),rl(n,0)}if(function(t){for(let n=Eh(t);null!==n;n=Bc(n)){if(!n[2])continue;const o=n[9];for(let a=0;a<o.length;a++){const u=o[a],g=u[3];0==(1024&u[2])&&_s(g,1),u[2]|=1024}}}(n),function(t){for(let n=Eh(t);null!==n;n=Bc(n))for(let o=10;o<n.length;o++){const a=n[o],u=a[1];Ra(a)&&xl(u,a,u.template,a[8])}}(n),null!==t.contentQueries&&cf(t,n),!g)if(b){const L=t.contentCheckHooks;null!==L&&qs(n,L)}else{const L=t.contentHooks;null!==L&&fa(n,L,1),rl(n,1)}!function(t,n){const o=t.hostBindingOpCodes;if(null!==o)try{for(let a=0;a<o.length;a++){const u=o[a];if(u<0)no(~u);else{const g=u,b=o[++a],E=o[++a];to(b,g),E(2,n[g])}}}finally{no(-1)}}(t,n);const E=t.components;null!==E&&function(t,n){for(let o=0;o<n.length;o++)lm(t,n[o])}(n,E);const S=t.viewQuery;if(null!==S&&na(2,S,a),!g)if(b){const L=t.viewCheckHooks;null!==L&&qs(n,L)}else{const L=t.viewHooks;null!==L&&fa(n,L,2),rl(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,_s(n[3],-1))}finally{ws()}}function Wg(t,n,o,a){const u=n[10],g=!Gs(),b=js(n);try{g&&!b&&u.begin&&u.begin(),b&&oc(t,n,a),xl(t,n,o,a)}finally{g&&!b&&u.end&&u.end()}}function Jp(t,n,o,a,u){const g=Ci(),b=2&a;try{no(-1),b&&n.length>20&&Eu(t,n,20,Gs()),o(a,u)}finally{no(g)}}function hf(t,n,o){!yc()||(function(t,n,o,a){const u=o.directiveStart,g=o.directiveEnd;t.firstCreatePass||Oa(o,n),yo(a,n);const b=o.initialInputs;for(let E=u;E<g;E++){const S=t.data[E],L=ki(S);L&&sm(n,o,S);const H=Ys(n,t,E,o);yo(H,n),null!==b&&am(0,E-u,H,S,0,b),L&&(oi(o.index,n)[8]=H)}}(t,n,o,Ir(o,n)),128==(128&o.flags)&&function(t,n,o){const a=o.directiveStart,u=o.directiveEnd,b=o.index,E=mn.lFrame.currentDirectiveIndex;try{no(b);for(let S=a;S<u;S++){const L=t.data[S],H=n[S];rs(S),(null!==L.hostBindings||0!==L.hostVars||null!==L.hostAttrs)&&Ku(L,H)}}finally{no(-1),rs(E)}}(t,n,o))}function df(t,n,o=Ir){const a=n.localNames;if(null!==a){let u=n.index+1;for(let g=0;g<a.length;g+=2){const b=a[g+1],E=-1===b?o(n,t):t[b];t[u++]=E}}}function $c(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Du(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function Du(t,n,o,a,u,g,b,E,S,L){const H=20+a,K=H+u,le=function(t,n){const o=[];for(let a=0;a<n;a++)o.push(a<t?null:In);return o}(H,K),we="function"==typeof L?L():L;return le[1]={type:t,blueprint:le,template:o,queries:null,viewQuery:E,declTNode:n,data:le.slice().fill(null,H),bindingStartIndex:H,expandoStartIndex:K,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:S,consts:we,incompleteFirstPass:!1}}function tm(t,n,o,a){const u=wl(n);null===o?u.push(a):(u.push(o),t.firstCreatePass&&Qu(t).push(a,u.length-1))}function pf(t,n,o){for(let a in t)if(t.hasOwnProperty(a)){const u=t[a];(o=null===o?{}:o).hasOwnProperty(a)?o[a].push(n,u):o[a]=[n,u]}return o}function Qo(t,n,o,a,u,g,b,E){const S=Ir(n,o);let H,L=n.inputs;!E&&null!=L&&(H=L[a])?(wf(t,o,H,a,u),Ia(n)&&function(t,n){const o=oi(n,t);16&o[2]||(o[2]|=64)}(o,n.index)):3&n.type&&(a=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),u=null!=b?b(u,n.value||"",a):u,tn(g)?g.setProperty(S,a,u):Hl(a)||(S.setProperty?S.setProperty(a,u):S[a]=u))}function Yu(t,n,o,a){let u=!1;if(yc()){const g=function(t,n,o){const a=t.directiveRegistry;let u=null;if(a)for(let g=0;g<a.length;g++){const b=a[g];wa(o,b.selectors,!1)&&(u||(u=[]),al(Oa(o,n),t,b.type),ki(b)?(im(t,o),u.unshift(b)):u.push(b))}return u}(t,n,o),b=null===a?null:{"":-1};if(null!==g){u=!0,Hh(o,t.data.length,g.length);for(let H=0;H<g.length;H++){const K=g[H];K.providersResolver&&K.providersResolver(K)}let E=!1,S=!1,L=jc(t,n,g.length,null);for(let H=0;H<g.length;H++){const K=g[H];o.mergedAttrs=Ro(o.mergedAttrs,K.hostAttrs),om(t,o,n,L,K),t_(L,K,b),null!==K.contentQueries&&(o.flags|=8),(null!==K.hostBindings||null!==K.hostAttrs||0!==K.hostVars)&&(o.flags|=128);const le=K.type.prototype;!E&&(le.ngOnChanges||le.ngOnInit||le.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(o.index),E=!0),!S&&(le.ngOnChanges||le.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(o.index),S=!0),L++}!function(t,n){const a=n.directiveEnd,u=t.data,g=n.attrs,b=[];let E=null,S=null;for(let L=n.directiveStart;L<a;L++){const H=u[L],K=H.inputs,le=null===g||Up(n)?null:Zh(K,g);b.push(le),E=pf(K,L,E),S=pf(H.outputs,L,S)}null!==E&&(E.hasOwnProperty("class")&&(n.flags|=16),E.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=b,n.inputs=E,n.outputs=S}(t,o)}b&&function(t,n,o){if(n){const a=t.localNames=[];for(let u=0;u<n.length;u+=2){const g=o[n[u+1]];if(null==g)throw new Tr("301",`Export of name '${n[u+1]}' not found!`);a.push(n[u],g)}}}(o,a,b)}return o.mergedAttrs=Ro(o.mergedAttrs,o.attrs),u}function bl(t,n,o,a,u,g){const b=g.hostBindings;if(b){let E=t.hostBindingOpCodes;null===E&&(E=t.hostBindingOpCodes=[]);const S=~n.index;(function(t){let n=t.length;for(;n>0;){const o=t[--n];if("number"==typeof o&&o<0)return o}return 0})(E)!=S&&E.push(S),E.push(a,u,b)}}function Ku(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function im(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function t_(t,n,o){if(o){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)o[n.exportAs[a]]=t;ki(n)&&(o[""]=t)}}function Hh(t,n,o){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+o,t.providerIndexes=n}function om(t,n,o,a,u){t.data[a]=u;const g=u.factory||(u.factory=Ji(u.type)),b=new Es(g,ki(u),null);t.blueprint[a]=b,o[a]=b,bl(t,n,0,a,jc(t,o,u.hostVars,In),u)}function sm(t,n,o){const a=Ir(n,t),u=$c(o),g=t[10],b=Iu(t,$a(t,u,null,o.onPush?64:16,a,n,g,g.createRenderer(a,o),null,null));t[n.index]=b}function Ca(t,n,o,a,u,g){const b=Ir(t,n);!function(t,n,o,a,u,g,b){if(null==g)tn(t)?t.removeAttribute(n,u,o):n.removeAttribute(u);else{const E=null==b?jt(g):b(g,a||"",u);tn(t)?t.setAttribute(n,u,E,o):o?n.setAttributeNS(o,u,E):n.setAttribute(u,E)}}(n[11],b,g,t.value,o,a,u)}function am(t,n,o,a,u,g){const b=g[n];if(null!==b){const E=a.setInput;for(let S=0;S<b.length;){const L=b[S++],H=b[S++],K=b[S++];null!==E?a.setInput(o,K,L,H):o[H]=K}}}function Zh(t,n){let o=null,a=0;for(;a<n.length;){const u=n[a];if(0!==u)if(5!==u){if("number"==typeof u)break;t.hasOwnProperty(u)&&(null===o&&(o=[]),o.push(u,t[u],n[a+1])),a+=2}else a+=2;else a+=4}return o}function Wh(t,n,o,a){return new Array(t,!0,!1,n,null,0,a,o,null,null)}function lm(t,n){const o=oi(n,t);if(Ra(o)){const a=o[1];80&o[2]?xl(a,o,a.template,o[8]):o[5]>0&&vf(o)}}function vf(t){for(let a=Eh(t);null!==a;a=Bc(a))for(let u=10;u<a.length;u++){const g=a[u];if(1024&g[2]){const b=g[1];xl(b,g,b.template,g[8])}else g[5]>0&&vf(g)}const o=t[1].components;if(null!==o)for(let a=0;a<o.length;a++){const u=oi(o[a],t);Ra(u)&&u[5]>0&&vf(u)}}function Xh(t,n){const o=oi(n,t),a=o[1];(function(t,n){for(let o=n.length;o<t.blueprint.length;o++)n.push(t.blueprint[o])})(a,o),oc(a,o,o[8])}function Iu(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function Yh(t){for(;t;){t[2]|=64;const n=nc(t);if(Ka(t)&&!n)return t;t=n}return null}function Kh(t,n,o){const a=n[10];a.begin&&a.begin();try{xl(t,n,t.template,o)}catch(u){throw Qh(n,u),u}finally{a.end&&a.end()}}function xf(t){!function(t){for(let n=0;n<t.components.length;n++){const o=t.components[n],a=yh(o),u=a[1];Wg(u,a,u.template,o)}}(t[8])}function na(t,n,o){Po(0),n(t,o)}const Ga=(()=>Promise.resolve(null))();function wl(t){return t[7]||(t[7]=[])}function Qu(t){return t.cleanup||(t.cleanup=[])}function Qh(t,n){const o=t[9],a=o?o.get(Ms,null):null;a&&a.handleError(n)}function wf(t,n,o,a,u){for(let g=0;g<o.length;){const b=o[g++],E=o[g++],S=n[b],L=t.data[b];null!==L.setInput?L.setInput(S,u,a,E):S[E]=u}}function Ha(t,n,o){const a=function(t,n){return An(n[t])}(n,t);!function(t,n,o){tn(t)?t.setValue(n,o):n.textContent=o}(t[11],a,o)}function Jh(t,n,o){let a=o?t.styles:null,u=o?t.classes:null,g=0;if(null!==n)for(let b=0;b<n.length;b++){const E=n[b];"number"==typeof E?g=E:1==g?u=dn(u,E):2==g&&(a=dn(a,E+": "+n[++b]+";"))}o?t.styles=a:t.stylesWithoutHost=a,o?t.classes=u:t.classesWithoutHost=u}const qc=new B("INJECTOR",-1);class Ef{get(n,o=rn){if(o===rn){const a=new Error(`NullInjectorError: No provider for ${ct(n)}!`);throw a.name="NullInjectorError",a}return o}}const Su=new B("Set Injector scope."),Au={},ac={};let ed;function Ju(){return void 0===ed&&(ed=new Ef),ed}function Zc(t,n=null,o=null,a){return new Cf(t,o,n||Ju(),a)}class Cf{constructor(n,o,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];o&&j(o,E=>this.processProvider(E,n,o)),j([n],E=>this.processInjectorType(E,[],g)),this.records.set(qc,No(void 0,this));const b=this.records.get(Su);this.scope=null!=b?b.value:null,this.source=u||("object"==typeof n?null:ct(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,o=rn,a=$t.Default){this.assertNotDestroyed();const u=Lo(this),g=Qt(void 0);try{if(!(a&$t.SkipSelf)){let E=this.records.get(n);if(void 0===E){const S=("function"==typeof(t=n)||"object"==typeof t&&t instanceof B)&&Xr(n);E=S&&this.injectableDefInScope(S)?No(eh(n),Au):null,this.records.set(n,E)}if(null!=E)return this.hydrate(n,E)}return(a&$t.Self?Ju():this.parent).get(n,o=a&$t.Optional&&o===rn?null:o)}catch(b){if("NullInjectorError"===b.name){if((b[qt]=b[qt]||[]).unshift(ct(n)),u)throw b;return Oo(b,n,"R3InjectorError",this.source)}throw b}finally{Qt(g),Lo(u)}var t}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((a,u)=>n.push(ct(u))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,o,a){if(!(n=_t(n)))return!1;let u=Eo(n);const g=null==u&&n.ngModule||void 0,b=void 0===g?n:g,E=-1!==a.indexOf(b);if(void 0!==g&&(u=Eo(g)),null==u)return!1;if(null!=u.imports&&!E){let H;a.push(b);try{j(u.imports,K=>{this.processInjectorType(K,o,a)&&(void 0===H&&(H=[]),H.push(K))})}finally{}if(void 0!==H)for(let K=0;K<H.length;K++){const{ngModule:le,providers:we}=H[K];j(we,ke=>this.processProvider(ke,le,we||Pn))}}this.injectorDefTypes.add(b);const S=Ji(b)||(()=>new b);this.records.set(b,No(S,Au));const L=u.providers;if(null!=L&&!E){const H=n;j(L,K=>this.processProvider(K,H,L))}return void 0!==g&&void 0!==n.providers}processProvider(n,o,a){let u=El(n=_t(n))?n:_t(n&&n.provide);const g=lc(t=n)?No(void 0,t.useValue):No(function(t,n,o){let a;if(El(t)){const u=_t(t);return Ji(u)||eh(u)}if(lc(t))a=()=>_t(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...lr(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))a=()=>En(_t(t.useExisting));else{const u=_t(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Ji(u)||eh(u);a=()=>new u(...lr(t.deps))}return a}(t),Au);var t;if(El(n)||!0!==n.multi)this.records.get(u);else{let b=this.records.get(u);b||(b=No(void 0,Au,!0),b.factory=()=>lr(b.multi),this.records.set(u,b)),u=n,b.multi.push(n)}this.records.set(u,g)}hydrate(n,o){return o.value===Au&&(o.value=ac,o.value=o.factory()),"object"==typeof o.value&&o.value&&null!==(t=o.value)&&"object"==typeof t&&"function"==typeof t.ngOnDestroy&&this.onDestroy.add(o.value),o.value;var t}injectableDefInScope(n){if(!n.providedIn)return!1;const o=_t(n.providedIn);return"string"==typeof o?"any"===o||o===this.scope:this.injectorDefTypes.has(o)}}function eh(t){const n=Xr(t),o=null!==n?n.factory:Ji(t);if(null!==o)return o;if(t instanceof B)throw new Error(`Token ${ct(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const a=function(t,n){const o=[];for(let a=0;a<t;a++)o.push(n);return o}(n,"?");throw new Error(`Can't resolve all parameters for ${ct(t)}: (${a.join(", ")}).`)}const o=function(t){const n=t&&(t[ai]||t[Ns]);if(n){const o=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${o}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${o}" class.`),n}return null}(t);return null!==o?()=>o.factory(t):()=>new t}(t);throw new Error("unreachable")}function No(t,n,o=!1){return{factory:t,value:n,multi:o?[]:void 0}}function lc(t){return null!==t&&"object"==typeof t&&Gi in t}function El(t){return"function"==typeof t}const If=function(t,n,o){return function(t,n=null,o=null,a){const u=Zc(t,n,o,a);return u._resolveInjectorDefTypes(),u}({name:o},n,t,o)};let ri=(()=>{class t{static create(o,a){return Array.isArray(o)?If(o,a,""):If(o.providers,o.parent,o.name||"")}}return t.THROW_IF_NOT_FOUND=rn,t.NULL=new Ef,t.\u0275prov=mr({token:t,providedIn:"any",factory:()=>En(qc)}),t.__NG_ELEMENT_ID__=-1,t})();function ot(t,n){Ul(yh(t)[1],Jr())}let Gn=null;function zr(){if(!Gn){const t=Dn.Symbol;if(t&&t.iterator)Gn=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let o=0;o<n.length;++o){const a=n[o];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(Gn=a)}}}return Gn}class vr{constructor(n){this.wrapped=n}static wrap(n){return new vr(n)}static unwrap(n){return vr.isWrapped(n)?n.wrapped:n}static isWrapped(n){return n instanceof vr}}function hi(t){return!!Ar(t)&&(Array.isArray(t)||!(t instanceof Map)&&zr()in t)}function Ar(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Nr(t,n,o){return t[n]=o}function nr(t,n,o){return!Object.is(t[n],o)&&(t[n]=o,!0)}function si(t,n,o,a){const u=nr(t,n,o);return nr(t,n+1,a)||u}function yr(t,n,o,a){const u=ft();return nr(u,vs(),n)&&($n(),Ca(pr(),u,t,n,o,a)),yr}function Mr(t,n,o,a,u,g,b,E){const L=function(t,n,o,a,u){const g=si(t,n,o,a);return nr(t,n+2,u)||g}(t,$i(),o,u,b);return function(t){const n=mn.lFrame,o=n.bindingIndex;n.bindingIndex=n.bindingIndex+t}(3),L?n+jt(o)+a+jt(u)+g+jt(b)+E:In}function id(t,n,o,a,u,g,b,E){const S=ft(),L=$n(),H=t+20,K=L.firstCreatePass?function(t,n,o,a,u,g,b,E,S){const L=n.consts,H=Uc(n,t,4,b||null,eo(L,E));Yu(n,o,H,eo(L,S)),Ul(n,H);const K=H.tViews=Du(2,H,a,u,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,L);return null!==n.queries&&(n.queries.template(n,H),K.queries=n.queries.embeddedTView(H)),H}(H,L,S,n,o,a,u,g,b):L.data[H];Ei(K,!1);const le=S[11].createComment("");ic(L,S,le,K),yo(le,S),Iu(S,S[H]=Wh(le,S,le,K)),ho(K)&&hf(L,S,K),null!=b&&df(S,K,E)}function od(t){return wi(mn.lFrame.contextLView,20+t)}function Rf(t,n=$t.Default){const o=ft();return null===o?En(t,n):ou(Jr(),o,_t(t),n)}function m_(t,n,o){const a=ft();return nr(a,vs(),n)&&Qo($n(),pr(),a,t,n,a[11],o,!1),m_}function g_(t,n,o,a,u){const b=u?"class":"style";wf(t,o,n.inputs[b],b,a)}function __(t,n,o,a){const u=ft(),g=$n(),b=20+t,E=u[11],S=u[b]=Gu(E,n,mn.lFrame.currentNamespace),L=g.firstCreatePass?function(t,n,o,a,u,g,b){const E=n.consts,L=Uc(n,t,2,u,eo(E,g));return Yu(n,o,L,eo(E,b)),null!==L.attrs&&Jh(L,L.attrs,!1),null!==L.mergedAttrs&&Jh(L,L.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,L),L}(b,g,u,0,n,o,a):g.data[b];Ei(L,!0);const H=L.mergedAttrs;null!==H&&Gl(E,S,H);const K=L.classes;null!==K&&Ph(E,S,K);const le=L.styles;null!==le&&Bp(E,S,le),64!=(64&L.flags)&&ic(g,u,S,L),0===mn.lFrame.elementDepthCount&&yo(S,u),mn.lFrame.elementDepthCount++,ho(L)&&(hf(g,u,L),function(t,n,o){if(Us(n)){const u=n.directiveEnd;for(let g=n.directiveStart;g<u;g++){const b=t.data[g];b.contentQueries&&b.contentQueries(1,o[g],g)}}}(g,L,u)),null!==a&&df(u,L)}function y_(){let t=Jr();Ho()?mn.lFrame.isParent=!1:(t=t.parent,Ei(t,!1));const n=t;mn.lFrame.elementDepthCount--;const o=$n();o.firstCreatePass&&(Ul(o,t),Us(t)&&o.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&g_(o,n,ft(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&g_(o,n,ft(),n.stylesWithoutHost,!1)}function iv(t,n,o,a){__(t,n,o,a),y_()}function av(){return ft()}function v_(t){return!!t&&"function"==typeof t.then}function lv(t){return!!t&&"function"==typeof t.subscribe}const x_=lv;function b_(t,n,o,a){const u=ft(),g=$n(),b=Jr();return function(t,n,o,a,u,g,b,E){const S=ho(a),H=t.firstCreatePass&&Qu(t),K=n[8],le=wl(n);let we=!0;if(3&a.type||E){const Ue=Ir(a,n),It=E?E(Ue):Ue,dt=le.length,on=E?Cn=>E(An(Cn[a.index])):a.index;if(tn(o)){let Cn=null;if(!E&&S&&(Cn=function(t,n,o,a){const u=t.cleanup;if(null!=u)for(let g=0;g<u.length-1;g+=2){const b=u[g];if(b===o&&u[g+1]===a){const E=n[7],S=u[g+2];return E.length>S?E[S]:null}"string"==typeof b&&(g+=2)}return null}(t,n,u,a.index)),null!==Cn)(Cn.__ngLastListenerFn__||Cn).__ngNextListenerFn__=g,Cn.__ngLastListenerFn__=g,we=!1;else{g=w_(a,n,K,g,!1);const ir=o.listen(It,u,g);le.push(g,ir),H&&H.push(u,on,dt,dt+1)}}else g=w_(a,n,K,g,!0),It.addEventListener(u,g,b),le.push(g),H&&H.push(u,on,dt,b)}else g=w_(a,n,K,g,!1);const ke=a.outputs;let Ke;if(we&&null!==ke&&(Ke=ke[u])){const Ue=Ke.length;if(Ue)for(let It=0;It<Ue;It+=2){const xo=n[Ke[It]][Ke[It+1]].subscribe(g),Ya=le.length;le.push(g,xo),H&&H.push(u,a.index,Ya,-(Ya+1))}}}(g,u,u[11],b,t,n,!!o,a),b_}function hv(t,n,o,a){try{return!1!==o(a)}catch(u){return Qh(t,u),!1}}function w_(t,n,o,a,u){return function g(b){if(b===Function)return a;const E=2&t.flags?oi(t.index,n):n;0==(32&n[2])&&Yh(E);let S=hv(n,0,a,b),L=g.__ngNextListenerFn__;for(;L;)S=hv(n,0,L,b)&&S,L=L.__ngNextListenerFn__;return u&&!1===S&&(b.preventDefault(),b.returnValue=!1),S}}function dv(t=1){return function(t){return(mn.lFrame.contextLView=function(t,n){for(;t>0;)n=n[15],t--;return n}(t,mn.lFrame.contextLView))[8]}(t)}function zv(t,n=""){const o=ft(),a=$n(),u=t+20,g=a.firstCreatePass?Uc(a,u,1,n,null):a.data[u],b=o[u]=function(t,n){return tn(t)?t.createText(n):t.createTextNode(n)}(o[11],n);ic(a,o,b,g),Ei(g,!1)}function T_(t){return Cm("",t,""),T_}function Cm(t,n,o){const a=ft(),u=function(t,n,o,a){return nr(t,vs(),o)?n+jt(o)+a:In}(a,t,n,o);return u!==In&&Ha(a,Ci(),u),Cm}function D_(t,n,o,a,u,g,b){const E=ft(),S=Mr(E,t,n,o,a,u,g,b);return S!==In&&Ha(E,Ci(),S),D_}function I_(t,n,o){const a=ft();return nr(a,vs(),n)&&Qo($n(),pr(),a,t,n,a[11],o,!0),I_}const rh=void 0;var K1=["en",[["a","p"],["AM","PM"],rh],[["AM","PM"],rh,rh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],rh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],rh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",rh,"{1} 'at' {0}",rh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),o=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===o?1:5}];let cd={};function S_(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let o=nx(n);if(o)return o;const a=n.split("-")[0];if(o=nx(a),o)return o;if("en"===a)return K1;throw new Error(`Missing locale data for the locale "${t}".`)}function tx(t){return S_(t)[_n.PluralCase]}function nx(t){return t in cd||(cd[t]=Dn.ng&&Dn.ng.common&&Dn.ng.common.locales&&Dn.ng.common.locales[t]),cd[t]}var _n=(()=>((_n=_n||{})[_n.LocaleId=0]="LocaleId",_n[_n.DayPeriodsFormat=1]="DayPeriodsFormat",_n[_n.DayPeriodsStandalone=2]="DayPeriodsStandalone",_n[_n.DaysFormat=3]="DaysFormat",_n[_n.DaysStandalone=4]="DaysStandalone",_n[_n.MonthsFormat=5]="MonthsFormat",_n[_n.MonthsStandalone=6]="MonthsStandalone",_n[_n.Eras=7]="Eras",_n[_n.FirstDayOfWeek=8]="FirstDayOfWeek",_n[_n.WeekendRange=9]="WeekendRange",_n[_n.DateFormat=10]="DateFormat",_n[_n.TimeFormat=11]="TimeFormat",_n[_n.DateTimeFormat=12]="DateTimeFormat",_n[_n.NumberSymbols=13]="NumberSymbols",_n[_n.NumberFormats=14]="NumberFormats",_n[_n.CurrencyCode=15]="CurrencyCode",_n[_n.CurrencySymbol=16]="CurrencySymbol",_n[_n.CurrencyName=17]="CurrencyName",_n[_n.Currencies=18]="Currencies",_n[_n.Directionality=19]="Directionality",_n[_n.PluralCase=20]="PluralCase",_n[_n.ExtraData=21]="ExtraData",_n))();const Tm="en-US";let rx=Tm;function A_(t){Ur(t,"Expected localeId to be defined"),"string"==typeof t&&(rx=t.toLowerCase().replace(/_/g,"-"))}class Sx{}const Mx="ngComponent";class Qw{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${ct(t)}. Did you add it to @NgModule.entryComponents?`);return n[Mx]=t,n}(n)}}let hd=(()=>{class t{}return t.NULL=new Qw,t})();function Mm(...t){}function dd(t,n){return new fc(Ir(t,n))}const tE=function(){return dd(Jr(),ft())};let fc=(()=>{class t{constructor(o){this.nativeElement=o}}return t.__NG_ELEMENT_ID__=tE,t})();function Px(t){return t instanceof fc?t.nativeElement:t}class Pm{}let nE=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>iE(),t})();const iE=function(){const t=ft(),o=oi(Jr().index,t);return function(t){return t[11]}(Or(o)?o:t)};let z_=(()=>{class t{}return t.\u0275prov=mr({token:t,providedIn:"root",factory:()=>null}),t})();class Rx{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const kx=new Rx("12.2.15");class Fx{constructor(){}supports(n){return hi(n)}create(n){return new lE(n)}}const aE=(t,n)=>n;class lE{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||aE}forEachItem(n){let o;for(o=this._itHead;null!==o;o=o._next)n(o)}forEachOperation(n){let o=this._itHead,a=this._removalsHead,u=0,g=null;for(;o||a;){const b=!a||o&&o.currentIndex<Ox(a,u,g)?o:a,E=Ox(b,u,g),S=b.currentIndex;if(b===a)u--,a=a._nextRemoved;else if(o=o._next,null==b.previousIndex)u++;else{g||(g=[]);const L=E-u,H=S-u;if(L!=H){for(let le=0;le<L;le++){const we=le<g.length?g[le]:g[le]=0,ke=we+le;H<=ke&&ke<L&&(g[le]=we+1)}g[b.previousIndex]=H-L}}E!==S&&n(b,E,S)}}forEachPreviousItem(n){let o;for(o=this._previousItHead;null!==o;o=o._nextPrevious)n(o)}forEachAddedItem(n){let o;for(o=this._additionsHead;null!==o;o=o._nextAdded)n(o)}forEachMovedItem(n){let o;for(o=this._movesHead;null!==o;o=o._nextMoved)n(o)}forEachRemovedItem(n){let o;for(o=this._removalsHead;null!==o;o=o._nextRemoved)n(o)}forEachIdentityChange(n){let o;for(o=this._identityChangesHead;null!==o;o=o._nextIdentityChange)n(o)}diff(n){if(null==n&&(n=[]),!hi(n))throw new Error(`Error trying to diff '${ct(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let u,g,b,o=this._itHead,a=!1;if(Array.isArray(n)){this.length=n.length;for(let E=0;E<this.length;E++)g=n[E],b=this._trackByFn(E,g),null!==o&&Object.is(o.trackById,b)?(a&&(o=this._verifyReinsertion(o,g,b,E)),Object.is(o.item,g)||this._addIdentityChange(o,g)):(o=this._mismatch(o,g,b,E),a=!0),o=o._next}else u=0,function(t,n){if(Array.isArray(t))for(let o=0;o<t.length;o++)n(t[o]);else{const o=t[zr()]();let a;for(;!(a=o.next()).done;)n(a.value)}}(n,E=>{b=this._trackByFn(u,E),null!==o&&Object.is(o.trackById,b)?(a&&(o=this._verifyReinsertion(o,E,b,u)),Object.is(o.item,E)||this._addIdentityChange(o,E)):(o=this._mismatch(o,E,b,u),a=!0),o=o._next,u++}),this.length=u;return this._truncate(o),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,o,a,u){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._reinsertAfter(n,g,u)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(n.item,o)||this._addIdentityChange(n,o),this._moveAfter(n,g,u)):n=this._addAfter(new cE(o,a),g,u),n}_verifyReinsertion(n,o,a,u){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?n=this._reinsertAfter(g,n._prev,u):n.currentIndex!=u&&(n.currentIndex=u,this._addToMoves(n,u)),n}_truncate(n){for(;null!==n;){const o=n._next;this._addToRemovals(this._unlink(n)),n=o}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,o,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const u=n._prevRemoved,g=n._nextRemoved;return null===u?this._removalsHead=g:u._nextRemoved=g,null===g?this._removalsTail=u:g._prevRemoved=u,this._insertAfter(n,o,a),this._addToMoves(n,a),n}_moveAfter(n,o,a){return this._unlink(n),this._insertAfter(n,o,a),this._addToMoves(n,a),n}_addAfter(n,o,a){return this._insertAfter(n,o,a),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,o,a){const u=null===o?this._itHead:o._next;return n._next=u,n._prev=o,null===u?this._itTail=n:u._prev=n,null===o?this._itHead=n:o._next=n,null===this._linkedRecords&&(this._linkedRecords=new Lx),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const o=n._prev,a=n._next;return null===o?this._itHead=a:o._next=a,null===a?this._itTail=o:a._prev=o,n}_addToMoves(n,o){return n.previousIndex===o||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Lx),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,o){return n.item=o,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class cE{constructor(n,o){this.item=n,this.trackById=o,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class uE{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,o){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===o||o<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){const o=n._prevDup,a=n._nextDup;return null===o?this._head=a:o._nextDup=a,null===a?this._tail=o:a._prevDup=o,null===this._head}}class Lx{constructor(){this.map=new Map}put(n){const o=n.trackById;let a=this.map.get(o);a||(a=new uE,this.map.set(o,a)),a.add(n)}get(n,o){const u=this.map.get(n);return u?u.get(n,o):null}remove(n){const o=n.trackById;return this.map.get(o).remove(n)&&this.map.delete(o),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ox(t,n,o){const a=t.previousIndex;if(null===a)return a;let u=0;return o&&a<o.length&&(u=o[a]),a+n+u}class zx{constructor(){}supports(n){return n instanceof Map||Ar(n)}create(){return new hE}}class hE{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let o;for(o=this._mapHead;null!==o;o=o._next)n(o)}forEachPreviousItem(n){let o;for(o=this._previousMapHead;null!==o;o=o._nextPrevious)n(o)}forEachChangedItem(n){let o;for(o=this._changesHead;null!==o;o=o._nextChanged)n(o)}forEachAddedItem(n){let o;for(o=this._additionsHead;null!==o;o=o._nextAdded)n(o)}forEachRemovedItem(n){let o;for(o=this._removalsHead;null!==o;o=o._nextRemoved)n(o)}diff(n){if(n){if(!(n instanceof Map||Ar(n)))throw new Error(`Error trying to diff '${ct(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let o=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,u)=>{if(o&&o.key===u)this._maybeAddToChanges(o,a),this._appendAfter=o,o=o._next;else{const g=this._getOrCreateRecordForKey(u,a);o=this._insertBeforeOrAppend(o,g)}}),o){o._prev&&(o._prev._next=null),this._removalsHead=o;for(let a=o;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,o){if(n){const a=n._prev;return o._next=n,o._prev=a,n._prev=o,a&&(a._next=o),n===this._mapHead&&(this._mapHead=o),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=o,o._prev=this._appendAfter):this._mapHead=o,this._appendAfter=o,null}_getOrCreateRecordForKey(n,o){if(this._records.has(n)){const u=this._records.get(n);this._maybeAddToChanges(u,o);const g=u._prev,b=u._next;return g&&(g._next=b),b&&(b._prev=g),u._next=null,u._prev=null,u}const a=new dE(n);return this._records.set(n,a),a.currentValue=o,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,o){Object.is(o,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=o,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,o){n instanceof Map?n.forEach(o):Object.keys(n).forEach(a=>o(n[a],a))}}class dE{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Nx(){return new Rm([new Fx])}let Rm=(()=>{class t{constructor(o){this.factories=o}static create(o,a){if(null!=a){const u=a.factories.slice();o=o.concat(u)}return new t(o)}static extend(o){return{provide:t,useFactory:a=>t.create(o,a||Nx()),deps:[[t,new Xo,new Js]]}}find(o){const a=this.factories.find(u=>u.supports(o));if(null!=a)return a;throw new Error(`Cannot find a differ supporting object '${o}' of type '${function(t){return t.name||typeof t}(o)}'`)}}return t.\u0275prov=mr({token:t,providedIn:"root",factory:Nx}),t})();function Bx(){return new km([new zx])}let km=(()=>{class t{constructor(o){this.factories=o}static create(o,a){if(a){const u=a.factories.slice();o=o.concat(u)}return new t(o)}static extend(o){return{provide:t,useFactory:a=>t.create(o,a||Bx()),deps:[[t,new Xo,new Js]]}}find(o){const a=this.factories.find(u=>u.supports(o));if(a)return a;throw new Error(`Cannot find a differ supporting object '${o}'`)}}return t.\u0275prov=mr({token:t,providedIn:"root",factory:Bx}),t})();function Fm(t,n,o,a,u=!1){for(;null!==o;){const g=n[o.index];if(null!==g&&a.push(An(g)),mi(g))for(let E=10;E<g.length;E++){const S=g[E],L=S[1].firstChild;null!==L&&Fm(S[1],S,L,a)}const b=o.type;if(8&b)Fm(t,n,o.child,a);else if(32&b){const E=gu(o,n);let S;for(;S=E();)a.push(S)}else if(16&b){const E=Wd(n,o);if(Array.isArray(E))a.push(...E);else{const S=nc(n[16]);Fm(S[1],S,E,a,!0)}}o=u?o.projectionNext:o.next}return a}class Nf{constructor(n,o){this._lView=n,this._cdRefInjectingView=o,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,o=n[1];return Fm(o,n,o.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(mi(n)){const o=n[8],a=o?o.indexOf(this):-1;a>-1&&(Gd(n,a),ee(o,a))}this._attachedToViewContainer=!1}Rp(this._lView[1],this._lView)}onDestroy(n){tm(this._lView[1],this._lView,null,n)}markForCheck(){Yh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Kh(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,o){Ol(!0);try{Kh(t,n,o)}finally{Ol(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var n;this._appRef=null,qu(this._lView[1],n=this._lView,n[11],2,null,null)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class pE extends Nf{constructor(n){super(n),this._view=n}detectChanges(){xf(this._view)}checkNoChanges(){!function(t){Ol(!0);try{xf(t)}finally{Ol(!1)}}(this._view)}get context(){return null}}const gE=function(t){return function(t,n,o){if(Ia(t)&&!o){const a=oi(t.index,n);return new Nf(a,a)}return 47&t.type?new Nf(n[16],n):null}(Jr(),ft(),16==(16&t))};let _E=(()=>{class t{}return t.__NG_ELEMENT_ID__=gE,t})();const xE=[new zx],wE=new Rm([new Fx]),EE=new km(xE),TE=function(){return Lm(Jr(),ft())};let Bf=(()=>{class t{}return t.__NG_ELEMENT_ID__=TE,t})();const DE=Bf,IE=class extends DE{constructor(n,o,a){super(),this._declarationLView=n,this._declarationTContainer=o,this.elementRef=a}createEmbeddedView(n){const o=this._declarationTContainer.tViews,a=$a(this._declarationLView,o,n,16,null,o.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(o)),oc(o,a,n),new Nf(a)}};function Lm(t,n){return 4&t.type?new IE(n,t,dd(t,n)):null}class ih{}class Vx{}const ME=function(){return $x(Jr(),ft())};let Om=(()=>{class t{}return t.__NG_ELEMENT_ID__=ME,t})();const RE=Om,Ux=class extends RE{constructor(n,o,a){super(),this._lContainer=n,this._hostTNode=o,this._hostLView=a}get element(){return dd(this._hostTNode,this._hostLView)}get injector(){return new Ks(this._hostTNode,this._hostLView)}get parentInjector(){const n=Ds(this._hostTNode,this._hostLView);if(iu(n)){const o=ma(n,this._hostLView),a=Cs(n);return new Ks(o[1].data[a+8],o)}return new Ks(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const o=jx(this._lContainer);return null!==o&&o[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,o,a){const u=n.createEmbeddedView(o||{});return this.insert(u,a),u}createComponent(n,o,a,u,g){const b=a||this.parentInjector;if(!g&&null==n.ngModule&&b){const S=b.get(ih,null);S&&(g=S)}const E=n.create(b,u,void 0,g);return this.insert(E.hostView,o),E}insert(n,o){const a=n._lView,u=a[1];if(mi(a[3])){const H=this.indexOf(n);if(-1!==H)this.detach(H);else{const K=a[3],le=new Ux(K,K[6],K[3]);le.detach(le.indexOf(n))}}const g=this._adjustIndex(o),b=this._lContainer;!function(t,n,o,a){const u=10+a,g=o.length;a>0&&(o[u-1][4]=n),a<g-10?(n[4]=o[u],Y(o,10+a,n)):(o.push(n),n[4]=null),n[3]=o;const b=n[17];null!==b&&o!==b&&function(t,n){const o=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===o?t[9]=[n]:o.push(n)}(b,n);const E=n[19];null!==E&&E.insertView(t),n[2]|=128}(u,a,b,g);const E=Xd(g,b),S=a[11],L=Sh(S,b[7]);return null!==L&&function(t,n,o,a,u,g){a[0]=u,a[6]=n,qu(t,a,o,1,u,g)}(u,b[6],S,a,L,E),n.attachToViewContainerRef(),Y(N_(b),g,n),n}move(n,o){return this.insert(n,o)}indexOf(n){const o=jx(this._lContainer);return null!==o?o.indexOf(n):-1}remove(n){const o=this._adjustIndex(n,-1),a=Gd(this._lContainer,o);a&&(ee(N_(this._lContainer),o),Rp(a[1],a))}detach(n){const o=this._adjustIndex(n,-1),a=Gd(this._lContainer,o);return a&&null!=ee(N_(this._lContainer),o)?new Nf(a):null}_adjustIndex(n,o=0){return null==n?this.length+o:n}};function jx(t){return t[8]}function N_(t){return t[8]||(t[8]=[])}function $x(t,n){let o;const a=n[t.index];if(mi(a))o=a;else{let u;if(8&t.type)u=An(a);else{const g=n[11];u=g.createComment("");const b=Ir(t,n);rc(g,Sh(g,b),u,function(t,n){return tn(t)?t.nextSibling(n):n.nextSibling}(g,b),!1)}n[t.index]=o=Wh(a,n,u,t),Iu(n,o)}return new Ux(o,t,n)}const gd={};class c0 extends hd{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const o=sn(n);return new h0(o,this.ngModule)}}function u0(t){const n=[];for(let o in t)t.hasOwnProperty(o)&&n.push({propName:t[o],templateName:o});return n}const SC=new B("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Dp});class h0 extends Sx{constructor(n,o){super(),this.componentDef=n,this.ngModule=o,this.componentType=n.type,this.selector=n.selectors.map(Zu).join(","),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!o}get inputs(){return u0(this.componentDef.inputs)}get outputs(){return u0(this.componentDef.outputs)}create(n,o,a,u){const g=(u=u||this.ngModule)?function(t,n){return{get:(o,a,u)=>{const g=t.get(o,gd,u);return g!==gd||a===gd?g:n.get(o,a,u)}}}(n,u.injector):n,b=g.get(Pm,dr),E=g.get(z_,null),S=b.createRenderer(null,this.componentDef),L=this.componentDef.selectors[0][0]||"div",H=a?function(t,n,o){if(tn(t))return t.selectRootElement(n,o===yn.ShadowDom);let a="string"==typeof n?t.querySelector(n):n;return a.textContent="",a}(S,a,this.componentDef.encapsulation):Gu(b.createRenderer(null,this.componentDef),L,function(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(L)),K=this.componentDef.onPush?576:528,le=function(t,n){return{components:[],scheduler:t||Dp,clean:Ga,playerHandler:n||null,flags:0}}(),we=Du(0,null,null,1,0,null,null,null,null,null),ke=$a(null,we,le,K,null,null,b,S,E,g);let Ke,Ue;qo(ke);try{const It=function(t,n,o,a,u,g){const b=o[1];o[20]=t;const S=Uc(b,20,2,"#host",null),L=S.mergedAttrs=n.hostAttrs;null!==L&&(Jh(S,L,!0),null!==t&&(Gl(u,t,L),null!==S.classes&&Ph(u,t,S.classes),null!==S.styles&&Bp(u,t,S.styles)));const H=a.createRenderer(t,n),K=$a(o,$c(n),null,n.onPush?64:16,o[20],S,a,H,g||null,null);return b.firstCreatePass&&(al(Oa(S,o),b,n.type),im(b,S),Hh(S,o.length,1)),Iu(o,K),o[20]=K}(H,this.componentDef,ke,b,S);if(H)if(a)Gl(S,H,["ng-version",kx.full]);else{const{attrs:dt,classes:on}=function(t){const n=[],o=[];let a=1,u=2;for(;a<t.length;){let g=t[a];if("string"==typeof g)2===u?""!==g&&n.push(g,t[++a]):8===u&&o.push(g);else{if(!ba(u))break;u=g}a++}return{attrs:n,classes:o}}(this.componentDef.selectors[0]);dt&&Gl(S,H,dt),on&&on.length>0&&Ph(S,H,on.join(" "))}if(Ue=So(we,20),void 0!==o){const dt=Ue.projection=[];for(let on=0;on<this.ngContentSelectors.length;on++){const Cn=o[on];dt.push(null!=Cn?Array.from(Cn):null)}}Ke=function(t,n,o,a,u){const g=o[1],b=function(t,n,o){const a=Jr();t.firstCreatePass&&(o.providersResolver&&o.providersResolver(o),om(t,a,n,jc(t,n,1,null),o));const u=Ys(n,t,a.directiveStart,a);yo(u,n);const g=Ir(a,n);return g&&yo(g,n),u}(g,o,n);if(a.components.push(b),t[8]=b,u&&u.forEach(S=>S(b,n)),n.contentQueries){const S=Jr();n.contentQueries(1,b,S.directiveStart)}const E=Jr();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(no(E.index),bl(o[1],E,0,E.directiveStart,E.directiveEnd,n),Ku(n,b)),b}(It,this.componentDef,ke,le,[ot]),oc(we,ke,null)}finally{ws()}return new PC(this.componentType,Ke,dd(Ue,ke),ke,Ue)}}class PC extends class{}{constructor(n,o,a,u,g){super(),this.location=a,this._rootLView=u,this._tNode=g,this.instance=o,this.hostView=this.changeDetectorRef=new pE(u),this.componentType=n}get injector(){return new Ks(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const _d=new Map;class FC extends ih{constructor(n,o){super(),this._parent=o,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new c0(this);const a=an(n),u=n[he]||null;u&&A_(u),this._bootstrapComponents=Ba(a.bootstrap),this._r3Injector=Zc(n,o,[{provide:ih,useValue:this},{provide:hd,useValue:this.componentFactoryResolver}],ct(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,o=ri.THROW_IF_NOT_FOUND,a=$t.Default){return n===ri||n===ih||n===qc?this:this._r3Injector.get(n,o,a)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(o=>o()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class K_ extends Vx{constructor(n){super(),this.moduleType=n,null!==an(n)&&function(t){const n=new Set;!function o(a){const u=an(a,!0),g=u.id;null!==g&&(function(t,n,o){if(n&&n!==o)throw new Error(`Duplicate module registered for ${t} - ${ct(n)} vs ${ct(n.name)}`)}(g,_d.get(g),a),_d.set(g,a));const b=Ba(u.imports);for(const E of b)n.has(E)||(n.add(E),o(E))}(t)}(n)}create(n){return new FC(this.moduleType,n)}}function p0(t,n,o,a){return function(t,n,o,a,u,g){const b=n+o;return nr(t,b,u)?Nr(t,b+1,g?a.call(g,u):a(u)):Zf(t,b+1)}(ft(),Li(),t,n,o,a)}function Zf(t,n){const o=t[n];return o===In?void 0:o}function x0(t,n){const o=$n();let a;const u=t+20;o.firstCreatePass?(a=function(t,n){if(n)for(let o=n.length-1;o>=0;o--){const a=n[o];if(t===a.name)return a}throw new Tr("302",`The pipe '${t}' could not be found!`)}(n,o.pipeRegistry),o.data[u]=a,a.onDestroy&&(o.destroyHooks||(o.destroyHooks=[])).push(u,a.onDestroy)):a=o.data[u];const g=a.factory||(a.factory=Ji(a.type)),b=Qt(Rf);try{const E=Ts(!1),S=g();return Ts(E),function(t,n,o,a){o>=t.data.length&&(t.data[o]=null,t.blueprint[o]=null),n[o]=a}(o,ft(),u,S),S}finally{Qt(b)}}function b0(t,n,o,a){const u=t+20,g=ft(),b=wi(g,u);return function(t,n){vr.isWrapped(n)&&(n=vr.unwrap(n),t[$i()]=In);return n}(g,function(t,n){return t[1].data[n].pure}(g,u)?function(t,n,o,a,u,g,b){const E=n+o;return si(t,E,u,g)?Nr(t,E+2,b?a.call(b,u,g):a(u,g)):Zf(t,E+2)}(g,Li(),n,b.transform,o,a,b):b.transform(o,a))}function Q_(t){return n=>{setTimeout(t,void 0,n)}}const pc=class extends ht.xQ{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,o,a){var u,g,b;let E=n,S=o||(()=>null),L=a;if(n&&"object"==typeof n){const K=n;E=null===(u=K.next)||void 0===u?void 0:u.bind(K),S=null===(g=K.error)||void 0===g?void 0:g.bind(K),L=null===(b=K.complete)||void 0===b?void 0:b.bind(K)}this.__isAsync&&(S=Q_(S),E&&(E=Q_(E)),L&&(L=Q_(L)));const H=super.subscribe({next:E,error:S,complete:L});return n instanceof Ot.w&&n.add(H),H}};function YC(){return this._results[zr()]()}class Um{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const o=zr(),a=Um.prototype;a[o]||(a[o]=YC)}get changes(){return this._changes||(this._changes=new pc)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,o){return this._results.reduce(n,o)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,o){const a=this;a.dirty=!1;const u=V(n);(this._changesDetected=!function(t,n,o){if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++){let u=t[a],g=n[a];if(o&&(u=o(u),g=o(g)),g!==u)return!1}return!0}(a._results,u,o))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class J_{constructor(n){this.queryList=n,this.matches=null}clone(){return new J_(this.queryList)}setDirty(){this.queryList.setDirty()}}class ey{constructor(n=[]){this.queries=n}createEmbeddedView(n){const o=n.queries;if(null!==o){const a=null!==n.contentQueries?n.contentQueries[0]:o.length,u=[];for(let g=0;g<a;g++){const b=o.getByIndex(g);u.push(this.queries[b.indexInDeclarationView].clone())}return new ey(u)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let o=0;o<this.queries.length;o++)null!==M0(n,o).matches&&this.queries[o].setDirty()}}class w0{constructor(n,o,a=null){this.predicate=n,this.flags=o,this.read=a}}class ty{constructor(n=[]){this.queries=n}elementStart(n,o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,o)}elementEnd(n){for(let o=0;o<this.queries.length;o++)this.queries[o].elementEnd(n)}embeddedTView(n){let o=null;for(let a=0;a<this.length;a++){const u=null!==o?o.length:0,g=this.getByIndex(a).embeddedTView(n,u);g&&(g.indexInDeclarationView=a,null!==o?o.push(g):o=[g])}return null!==o?new ty(o):null}template(n,o){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,o)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class ny{constructor(n,o=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=o}elementStart(n,o){this.isApplyingToNode(o)&&this.matchTNode(n,o)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,o){this.elementStart(n,o)}embeddedTView(n,o){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,o),new ny(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const o=this._declarationNodeIndex;let a=n.parent;for(;null!==a&&8&a.type&&a.index!==o;)a=a.parent;return o===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(n,o){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const g=a[u];this.matchTNodeWithReadOption(n,o,JC(o,g)),this.matchTNodeWithReadOption(n,o,Is(o,n,g,!1,!1))}else a===Bf?4&o.type&&this.matchTNodeWithReadOption(n,o,-1):this.matchTNodeWithReadOption(n,o,Is(o,n,a,!1,!1))}matchTNodeWithReadOption(n,o,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===fc||u===Om||u===Bf&&4&o.type)this.addMatch(o.index,-2);else{const g=Is(o,n,u,!1,!1);null!==g&&this.addMatch(o.index,g)}else this.addMatch(o.index,a)}}addMatch(n,o){null===this.matches?this.matches=[n,o]:this.matches.push(n,o)}}function JC(t,n){const o=t.localNames;if(null!==o)for(let a=0;a<o.length;a+=2)if(o[a]===n)return o[a+1];return null}function tT(t,n,o,a){return-1===o?function(t,n){return 11&t.type?dd(t,n):4&t.type?Lm(t,n):null}(n,t):-2===o?function(t,n,o){return o===fc?dd(n,t):o===Bf?Lm(n,t):o===Om?$x(n,t):void 0}(t,n,a):Ys(t,t[1],o,n)}function E0(t,n,o,a){const u=n[19].queries[a];if(null===u.matches){const g=t.data,b=o.matches,E=[];for(let S=0;S<b.length;S+=2){const L=b[S];E.push(L<0?null:tT(n,g[L],b[S+1],o.metadata.read))}u.matches=E}return u.matches}function ry(t,n,o,a){const u=t.queries.getByIndex(o),g=u.matches;if(null!==g){const b=E0(t,n,u,o);for(let E=0;E<g.length;E+=2){const S=g[E];if(S>0)a.push(b[E/2]);else{const L=g[E+1],H=n[-S];for(let K=10;K<H.length;K++){const le=H[K];le[17]===le[3]&&ry(le[1],le,L,a)}if(null!==H[9]){const K=H[9];for(let le=0;le<K.length;le++){const we=K[le];ry(we[1],we,L,a)}}}}}return a}function C0(t){const n=ft(),o=$n(),a=wc();Po(a+1);const u=M0(o,a);if(t.dirty&&js(n)===(2==(2&u.metadata.flags))){if(null===u.matches)t.reset([]);else{const g=u.crossesNgTemplate?ry(o,n,a,[]):E0(o,n,u,a);t.reset(g,Px),t.notifyOnChanges()}return!0}return!1}function T0(t,n,o){const a=$n();a.firstCreatePass&&(A0(a,new w0(t,n,o),-1),2==(2&n)&&(a.staticViewQueries=!0)),S0(a,ft(),n)}function D0(t,n,o,a){const u=$n();if(u.firstCreatePass){const g=Jr();A0(u,new w0(n,o,a),g.index),function(t,n){const o=t.contentQueries||(t.contentQueries=[]);n!==(o.length?o[o.length-1]:-1)&&o.push(t.queries.length-1,n)}(u,t),2==(2&o)&&(u.staticContentQueries=!0)}S0(u,ft(),o)}function I0(){return t=ft(),n=wc(),t[19].queries[n].queryList;var t,n}function S0(t,n,o){const a=new Um(4==(4&o));tm(t,n,a,a.destroy),null===n[19]&&(n[19]=new ey),n[19].queries.push(new J_(a))}function A0(t,n,o){null===t.queries&&(t.queries=new ty),t.queries.track(new ny(n,o))}function M0(t,n){return t.queries.getByIndex(n)}const cy=new B("Application Initializer");let vd=(()=>{class t{constructor(o){this.appInits=o,this.resolve=Mm,this.reject=Mm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const o=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const g=this.appInits[u]();if(v_(g))o.push(g);else if(x_(g)){const b=new Promise((E,S)=>{g.subscribe({complete:E,error:S})});o.push(b)}}Promise.all(o).then(()=>{a()}).catch(u=>{this.reject(u)}),0===o.length&&a(),this.initialized=!0}}return t.\u0275fac=function(o){return new(o||t)(En(cy,8))},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();const W0=new B("AppId"),RT={provide:W0,useFactory:function(){return`${uy()}${uy()}${uy()}`},deps:[]};function uy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const X0=new B("Platform Initializer"),Y0=new B("Platform ID"),K0=new B("appBootstrapListener");let Q0=(()=>{class t{log(o){console.log(o)}warn(o){console.warn(o)}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();const Gm=new B("LocaleId"),J0=new B("DefaultCurrencyCode");class FT{constructor(n,o){this.ngModuleFactory=n,this.componentFactories=o}}const hy=function(t){return new K_(t)},LT=hy,OT=function(t){return Promise.resolve(hy(t))},eb=function(t){const n=hy(t),a=Ba(an(t).declarations).reduce((u,g)=>{const b=sn(g);return b&&u.push(new h0(b)),u},[]);return new FT(n,a)},zT=eb,NT=function(t){return Promise.resolve(eb(t))};let Kf=(()=>{class t{constructor(){this.compileModuleSync=LT,this.compileModuleAsync=OT,this.compileModuleAndAllComponentsSync=zT,this.compileModuleAndAllComponentsAsync=NT}clearCache(){}clearCacheFor(o){}getModuleId(o){}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();const UT=(()=>Promise.resolve(0))();function dy(t){"undefined"==typeof Zone?UT.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Da{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:o=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new pc(!1),this.onMicrotaskEmpty=new pc(!1),this.onStable=new pc(!1),this.onError=new pc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&o,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function(){let t=Dn.requestAnimationFrame,n=Dn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const o=t[Zone.__symbol__("OriginalDelegate")];o&&(t=o);const a=n[Zone.__symbol__("OriginalDelegate")];a&&(n=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Dn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,py(t),t.isCheckStableRunning=!0,fy(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),py(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(o,a,u,g,b,E)=>{try{return tb(t),o.invokeTask(u,g,b,E)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),nb(t)}},onInvoke:(o,a,u,g,b,E,S)=>{try{return tb(t),o.invoke(u,g,b,E,S)}finally{t.shouldCoalesceRunChangeDetection&&n(),nb(t)}},onHasTask:(o,a,u,g)=>{o.hasTask(u,g),a===u&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,py(t),fy(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(o,a,u,g)=>(o.handleError(u,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(u)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Da.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Da.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,o,a){return this._inner.run(n,o,a)}runTask(n,o,a,u){const g=this._inner,b=g.scheduleEventTask("NgZoneEvent: "+u,n,$T,Mm,Mm);try{return g.runTask(b,o,a)}finally{g.cancelTask(b)}}runGuarded(n,o,a){return this._inner.runGuarded(n,o,a)}runOutsideAngular(n){return this._outer.run(n)}}const $T={};function fy(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function py(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function tb(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function nb(t){t._nesting--,fy(t)}class qT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new pc,this.onMicrotaskEmpty=new pc,this.onStable=new pc,this.onError=new pc}run(n,o,a){return n.apply(o,a)}runGuarded(n,o,a){return n.apply(o,a)}runOutsideAngular(n){return n()}runTask(n,o,a,u){return n.apply(o,a)}}let rb=(()=>{class t{constructor(o){this._ngZone=o,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),o.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Da.assertNotInAngularZone(),dy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())dy(()=>{for(;0!==this._callbacks.length;){let o=this._callbacks.pop();clearTimeout(o.timeoutId),o.doneCb(this._didWork)}this._didWork=!1});else{let o=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(o)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(o=>({source:o.source,creationLocation:o.creationLocation,data:o.data})):[]}addCallback(o,a,u){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==g),o(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:o,timeoutId:g,updateCb:u})}whenStable(o,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(o,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(o,a,u){return[]}}return t.\u0275fac=function(o){return new(o||t)(En(Da))},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})(),ib=(()=>{class t{constructor(){this._applications=new Map,my.addToWindow(this)}registerApplication(o,a){this._applications.set(o,a)}unregisterApplication(o){this._applications.delete(o)}unregisterAllApplications(){this._applications.clear()}getTestability(o){return this._applications.get(o)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(o,a=!0){return my.findTestabilityInTree(this,o,a)}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();class ZT{addToWindow(n){}findTestabilityInTree(n,o,a){return null}}function WT(t){my=t}let my=new ZT,ob=!0,sb=!1;function XT(){if(sb)throw new Error("Cannot enable prod mode after platform setup.");ob=!1}let Sl;const lb=new B("AllowMultipleToken");class nD{constructor(n,o){this.name=n,this.token=o}}function cb(t,n,o=[]){const a=`Platform: ${n}`,u=new B(a);return(g=[])=>{let b=ub();if(!b||b.injector.get(lb,!1))if(t)t(o.concat(g).concat({provide:u,useValue:!0}));else{const E=o.concat(g).concat({provide:u,useValue:!0},{provide:Su,useValue:"platform"});!function(t){if(Sl&&!Sl.destroyed&&!Sl.injector.get(lb,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Sl=t.get(hb);const n=t.get(X0,null);n&&n.forEach(o=>o())}(ri.create({providers:E,name:a}))}return function(t){const n=ub();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(u)}}function ub(){return Sl&&!Sl.destroyed?Sl:null}let hb=(()=>{class t{constructor(o){this._injector=o,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(o,a){const E=function(t,n){let o;return o="noop"===t?new qT:("zone.js"===t?void 0:t)||new Da({enableLongStackTrace:(sb=!0,ob),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),o}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),S=[{provide:Da,useValue:E}];return E.run(()=>{const L=ri.create({providers:S,parent:this.injector,name:o.moduleType.name}),H=o.create(L),K=H.injector.get(Ms,null);if(!K)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return E.runOutsideAngular(()=>{const le=E.onError.subscribe({next:we=>{K.handleError(we)}});H.onDestroy(()=>{gy(this._modules,H),le.unsubscribe()})}),function(t,n,o){try{const a=o();return v_(a)?a.catch(u=>{throw n.runOutsideAngular(()=>t.handleError(u)),u}):a}catch(a){throw n.runOutsideAngular(()=>t.handleError(a)),a}}(K,E,()=>{const le=H.injector.get(vd);return le.runInitializers(),le.donePromise.then(()=>(A_(H.injector.get(Gm,Tm)||Tm),this._moduleDoBootstrap(H),H))})})}bootstrapModule(o,a=[]){const u=db({},a);return function(t,n,o){const a=new K_(o);return Promise.resolve(a)}(0,0,o).then(g=>this.bootstrapModuleFactory(g,u))}_moduleDoBootstrap(o){const a=o.injector.get(Qf);if(o._bootstrapComponents.length>0)o._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!o.instance.ngDoBootstrap)throw new Error(`The module ${ct(o.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);o.instance.ngDoBootstrap(a)}this._modules.push(o)}onDestroy(o){this._destroyListeners.push(o)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(o){return new(o||t)(En(ri))},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();function db(t,n){return Array.isArray(n)?n.reduce(db,t):Object.assign(Object.assign({},t),n)}let Qf=(()=>{class t{constructor(o,a,u,g,b){this._zone=o,this._injector=a,this._exceptionHandler=u,this._componentFactoryResolver=g,this._initStatus=b,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const E=new fe.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),S=new fe.y(L=>{let H;this._zone.runOutsideAngular(()=>{H=this._zone.onStable.subscribe(()=>{Da.assertNotInAngularZone(),dy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const K=this._zone.onUnstable.subscribe(()=>{Da.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{H.unsubscribe(),K.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,o=null,a=t[t.length-1];return(0,te.K)(a)?(o=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof a&&(n=t.pop()),null===o&&1===t.length&&t[0]instanceof fe.y?t[0]:(0,Kt.J)(n)((0,d.n)(t,o))}(E,S.pipe(t=>(0,We.x)()(function(t,n){return function(a){let u;u="function"==typeof t?t:function(){return t};const g=Object.create(a,Ve.N);return g.source=a,g.subjectFactory=u,g}}(st)(t))))}bootstrap(o,a){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let u;u=o instanceof Sx?o:this._componentFactoryResolver.resolveComponentFactory(o),this.componentTypes.push(u.componentType);const g=function(t){return t.isBoundToModule}(u)?void 0:this._injector.get(ih),E=u.create(ri.NULL,[],a||u.selector,g),S=E.location.nativeElement,L=E.injector.get(rb,null),H=L&&E.injector.get(ib);return L&&H&&H.registerApplication(S,L),E.onDestroy(()=>{this.detachView(E.hostView),gy(this.components,E),H&&H.unregisterApplication(S)}),this._loadComponent(E),E}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let o of this._views)o.detectChanges()}catch(o){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(o))}finally{this._runningTick=!1}}attachView(o){const a=o;this._views.push(a),a.attachToAppRef(this)}detachView(o){const a=o;gy(this._views,a),a.detachFromAppRef()}_loadComponent(o){this.attachView(o.hostView),this.tick(),this.components.push(o),this._injector.get(K0,[]).concat(this._bootstrapListeners).forEach(u=>u(o))}ngOnDestroy(){this._views.slice().forEach(o=>o.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(o){return new(o||t)(En(Da),En(ri),En(Ms),En(hd),En(vd))},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();function gy(t,n){const o=t.indexOf(n);o>-1&&t.splice(o,1)}class lD{}class uD{}const hD={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let dD=(()=>{class t{constructor(o,a){this._compiler=o,this._config=a||hD}load(o){return this.loadAndCompile(o)}loadAndCompile(o){let[a,u]=o.split("#");return void 0===u&&(u="default"),Ge(255)(a).then(g=>g[u]).then(g=>gb(g,a,u)).then(g=>this._compiler.compileModuleAsync(g))}loadFactory(o){let[a,u]=o.split("#"),g="NgFactory";return void 0===u&&(u="default",g=""),Ge(255)(this._config.factoryPathPrefix+a+this._config.factoryPathSuffix).then(b=>b[u+g]).then(b=>gb(b,a,u))}}return t.\u0275fac=function(o){return new(o||t)(En(Kf),En(uD,8))},t.\u0275prov=mr({token:t,factory:t.\u0275fac}),t})();function gb(t,n,o){if(!t)throw new Error(`Cannot find '${o}' in '${n}'`);return t}const xD=function(t){return null},wD=cb(null,"core",[{provide:Y0,useValue:"unknown"},{provide:hb,deps:[ri]},{provide:ib,deps:[]},{provide:Q0,deps:[]}]),ID=[{provide:Qf,useClass:Qf,deps:[Da,ri,Ms,hd,vd]},{provide:SC,deps:[Da],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(o){n.push(o)}}},{provide:vd,useClass:vd,deps:[[new Js,cy]]},{provide:Kf,useClass:Kf,deps:[]},RT,{provide:Rm,useFactory:function(){return wE},deps:[]},{provide:km,useFactory:function(){return EE},deps:[]},{provide:Gm,useFactory:function(t){return A_(t=t||"undefined"!=typeof $localize&&$localize.locale||Tm),t},deps:[[new Wo(Gm),new Js,new Xo]]},{provide:J0,useValue:"USD"}];let AD=(()=>{class t{constructor(o){}}return t.\u0275fac=function(o){return new(o||t)(En(Qf))},t.\u0275mod=Ut({type:t}),t.\u0275inj=Yn({providers:ID}),t})()},353:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{rH:()=>Xs,Od:()=>Ft,Bz:()=>Sc,lC:()=>ga});var fe=Ge(583),te=Ge(639),Kt=Ge(869),d=Ge(693),Zt=Ge(87);function ht(...M){let T=M[M.length-1];return(0,Kt.K)(T)?(M.pop(),(0,Zt.r)(M,T)):(0,d.n)(M)}var Ot=Ge(709),Ve=Ge(971);class Me extends Ot.xQ{constructor(T){super(),this._value=T}get value(){return this.getValue()}_subscribe(T){const C=super._subscribe(T);return C&&!C.closed&&T.next(this._value),C}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ve.N;return this._value}next(T){super.next(this._value=T)}}var Se=Ge(796),We=Ge(393);class st extends We.L{notifyNext(T,C,F,B,X){this.destination.next(C)}notifyError(T,C){this.destination.error(T)}notifyComplete(T){this.destination.complete()}}class bt extends We.L{constructor(T,C,F){super(),this.parent=T,this.outerValue=C,this.outerIndex=F,this.index=0}_next(T){this.parent.notifyNext(this.outerValue,T,this.outerIndex,this.index++,this)}_error(T){this.parent.notifyError(T,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var ut=Ge(444),St=Ge(574);function ct(M,T,C,F,B=new bt(M,C,F)){if(!B.closed)return T instanceof St.y?T.subscribe(B):(0,ut.s)(T)(B)}const dn={};class nn{constructor(T){this.resultSelector=T}call(T,C){return C.subscribe(new _t(T,this.resultSelector))}}class _t extends st{constructor(T,C){super(T),this.resultSelector=C,this.active=0,this.values=[],this.observables=[]}_next(T){this.values.push(dn),this.observables.push(T)}_complete(){const T=this.observables,C=T.length;if(0===C)this.destination.complete();else{this.active=C,this.toRespond=C;for(let F=0;F<C;F++)this.add(ct(this,T[F],void 0,F))}}notifyComplete(T){0==(this.active-=1)&&this.destination.complete()}notifyNext(T,C,F){const B=this.values,ve=this.toRespond?B[F]===dn?--this.toRespond:this.toRespond:0;B[F]=C,0===ve&&(this.resultSelector?this._tryResultSelector(B):this.destination.next(B.slice()))}_tryResultSelector(T){let C;try{C=this.resultSelector.apply(this,T)}catch(F){return void this.destination.error(F)}this.destination.next(C)}}const Ai=(()=>{function M(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return M.prototype=Object.create(Error.prototype),M})();var Tr=Ge(282);function bo(...M){return(0,Tr.J)(1)(ht(...M))}var jt=Ge(402);const Mn=new St.y(M=>M.complete());function or(M){return M?function(M){return new St.y(T=>M.schedule(()=>T.complete()))}(M):Mn}function cn(M){return new St.y(T=>{let C;try{C=M()}catch(B){return void T.error(B)}return(C?(0,jt.D)(C):or()).subscribe(T)})}var zn=Ge(441),Et=Ge(2),Zr=Ge(345);function sr(M,T){return"function"==typeof T?C=>C.pipe(sr((F,B)=>(0,jt.D)(M(F,B)).pipe((0,Et.U)((X,ve)=>T(F,X,B,ve))))):C=>C.lift(new jo(M))}class jo{constructor(T){this.project=T}call(T,C){return C.subscribe(new Nn(T,this.project))}}class Nn extends Zr.Ds{constructor(T,C){super(T),this.project=C,this.index=0}_next(T){let C;const F=this.index++;try{C=this.project(T,F)}catch(B){return void this.destination.error(B)}this._innerSub(C)}_innerSub(T){const C=this.innerSubscription;C&&C.unsubscribe();const F=new Zr.IY(this),B=this.destination;B.add(F),this.innerSubscription=(0,Zr.ft)(T,F),this.innerSubscription!==F&&B.add(this.innerSubscription)}_complete(){const{innerSubscription:T}=this;(!T||T.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(T){this.destination.next(T)}}const ds=(()=>{function M(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return M.prototype=Object.create(Error.prototype),M})();function Bi(M){return T=>0===M?or():T.lift(new fs(M))}class fs{constructor(T){if(this.total=T,this.total<0)throw new ds}call(T,C){return C.subscribe(new lo(T,this.total))}}class lo extends We.L{constructor(T,C){super(T),this.total=C,this.count=0}_next(T){const C=this.total,F=++this.count;F<=C&&(this.destination.next(T),F===C&&(this.destination.complete(),this.unsubscribe()))}}function yi(M,T){let C=!1;return arguments.length>=2&&(C=!0),function(B){return B.lift(new Wr(M,T,C))}}class Wr{constructor(T,C,F=!1){this.accumulator=T,this.seed=C,this.hasSeed=F}call(T,C){return C.subscribe(new Ur(T,this.accumulator,this.seed,this.hasSeed))}}class Ur extends We.L{constructor(T,C,F,B){super(T),this.accumulator=C,this._seed=F,this.hasSeed=B,this.index=0}get seed(){return this._seed}set seed(T){this.hasSeed=!0,this._seed=T}_next(T){if(this.hasSeed)return this._tryNext(T);this.seed=T,this.destination.next(T)}_tryNext(T){const C=this.index++;let F;try{F=this.accumulator(this.seed,T,C)}catch(B){this.destination.error(B)}this.seed=F,this.destination.next(F)}}function Sn(M,T){return function(F){return F.lift(new vi(M,T))}}class vi{constructor(T,C){this.predicate=T,this.thisArg=C}call(T,C){return C.subscribe(new ra(T,this.predicate,this.thisArg))}}class ra extends We.L{constructor(T,C,F){super(T),this.predicate=C,this.thisArg=F,this.count=0}_next(T){let C;try{C=this.predicate.call(this.thisArg,T,this.count++)}catch(F){return void this.destination.error(F)}C&&this.destination.next(T)}}function gn(M){return function(C){const F=new mr(M),B=C.lift(F);return F.caught=B}}class mr{constructor(T){this.selector=T}call(T,C){return C.subscribe(new wo(T,this.selector,this.caught))}}class wo extends Zr.Ds{constructor(T,C,F){super(T),this.selector=C,this.caught=F}error(T){if(!this.isStopped){let C;try{C=this.selector(T,this.caught)}catch(X){return void super.error(X)}this._unsubscribeAndRecycle();const F=new Zr.IY(this);this.add(F);const B=(0,Zr.ft)(C,F);B!==F&&this.add(B)}}}var Yn=Ge(773);function Xr(M,T){return(0,Yn.zg)(M,T,1)}function Zi(M){return function(C){return 0===M?or():C.lift(new Lr(M))}}class Lr{constructor(T){if(this.total=T,this.total<0)throw new ds}call(T,C){return C.subscribe(new co(T,this.total))}}class co extends We.L{constructor(T,C){super(T),this.total=C,this.ring=new Array,this.count=0}_next(T){const C=this.ring,F=this.total,B=this.count++;C.length<F?C.push(T):C[B%F]=T}_complete(){const T=this.destination;let C=this.count;if(C>0){const F=this.count>=this.total?this.total:this.count,B=this.ring;for(let X=0;X<F;X++){const ve=C++%F;T.next(B[ve])}}T.complete()}}function Eo(M=Ns){return T=>T.lift(new ai(M))}class ai{constructor(T){this.errorFactory=T}call(T,C){return C.subscribe(new Wi(T,this.errorFactory))}}class Wi extends We.L{constructor(T,C){super(T),this.errorFactory=C,this.hasValue=!1}_next(T){this.hasValue=!0,this.destination.next(T)}_complete(){if(this.hasValue)return this.destination.complete();{let T;try{T=this.errorFactory()}catch(C){T=C}this.destination.error(T)}}}function Ns(){return new Ai}function Yr(M=null){return T=>T.lift(new $t(M))}class $t{constructor(T){this.defaultValue=T}call(T,C){return C.subscribe(new ur(T,this.defaultValue))}}class ur extends We.L{constructor(T,C){super(T),this.defaultValue=C,this.isEmpty=!0}_next(T){this.isEmpty=!1,this.destination.next(T)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var Xt=Ge(487);function Mi(M,T){const C=arguments.length>=2;return F=>F.pipe(M?Sn((B,X)=>M(B,X,F)):Xt.y,Bi(1),C?Yr(T):Eo(()=>new Ai))}function di(){}var Kr=Ge(105);function Zn(M,T,C){return function(B){return B.lift(new Pi(M,T,C))}}class Pi{constructor(T,C,F){this.nextOrObserver=T,this.error=C,this.complete=F}call(T,C){return C.subscribe(new $o(T,this.nextOrObserver,this.error,this.complete))}}class $o extends We.L{constructor(T,C,F,B){super(T),this._tapNext=di,this._tapError=di,this._tapComplete=di,this._tapError=F||di,this._tapComplete=B||di,(0,Kr.m)(C)?(this._context=this,this._tapNext=C):C&&(this._context=C,this._tapNext=C.next||di,this._tapError=C.error||di,this._tapComplete=C.complete||di)}_next(T){try{this._tapNext.call(this._context,T)}catch(C){return void this.destination.error(C)}this.destination.next(T)}_error(T){try{this._tapError.call(this._context,T)}catch(C){return void this.destination.error(C)}this.destination.error(T)}_complete(){try{this._tapComplete.call(this._context)}catch(T){return void this.destination.error(T)}return this.destination.complete()}}var yn=Ge(319);class Bn{constructor(T){this.callback=T}call(T,C){return C.subscribe(new Bs(T,this.callback))}}class Bs extends We.L{constructor(T,C){super(T),this.add(new yn.w(C))}}var Vi=Ge(307);class Dn{constructor(T,C){this.id=T,this.url=C}}class Xi extends Dn{constructor(T,C,F="imperative",B=null){super(T,C),this.navigationTrigger=F,this.restoredState=B}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Co extends Dn{constructor(T,C,F){super(T,C),this.urlAfterRedirects=F}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class fi extends Dn{constructor(T,C,F){super(T,C),this.reason=F}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Pn extends Dn{constructor(T,C,F){super(T,C),this.error=F}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ie extends Dn{constructor(T,C,F,B){super(T,C),this.urlAfterRedirects=F,this.state=B}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class $ extends Dn{constructor(T,C,F,B){super(T,C),this.urlAfterRedirects=F,this.state=B}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class q extends Dn{constructor(T,C,F,B,X){super(T,C),this.urlAfterRedirects=F,this.state=B,this.shouldActivate=X}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ae extends Dn{constructor(T,C,F,B){super(T,C),this.urlAfterRedirects=F,this.state=B}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class he extends Dn{constructor(T,C,F,B){super(T,C),this.urlAfterRedirects=F,this.state=B}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class be{constructor(T){this.route=T}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Le{constructor(T){this.route=T}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Oe{constructor(T){this.snapshot=T}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ee{constructor(T){this.snapshot=T}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Be{constructor(T){this.snapshot=T}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tt{constructor(T){this.snapshot=T}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class yt{constructor(T,C,F){this.routerEvent=T,this.position=C,this.anchor=F}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const je="primary";class Ut{constructor(T){this.params=T||{}}has(T){return Object.prototype.hasOwnProperty.call(this.params,T)}get(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C[0]:C}return null}getAll(T){if(this.has(T)){const C=this.params[T];return Array.isArray(C)?C:[C]}return[]}get keys(){return Object.keys(this.params)}}function gt(M){return new Ut(M)}const Pe="ngNavigationCancelingError";function Ye(M){const T=Error("NavigationCancelingError: "+M);return T[Pe]=!0,T}function sn(M,T,C){const F=C.path.split("/");if(F.length>M.length||"full"===C.pathMatch&&(T.hasChildren()||F.length<M.length))return null;const B={};for(let X=0;X<F.length;X++){const ve=F[X],Ie=M[X];if(ve.startsWith(":"))B[ve.substring(1)]=Ie;else if(ve!==Ie.path)return null}return{consumed:M.slice(0,F.length),posParams:B}}function en(M,T){const C=M?Object.keys(M):void 0,F=T?Object.keys(T):void 0;if(!C||!F||C.length!=F.length)return!1;let B;for(let X=0;X<C.length;X++)if(B=C[X],!an(M[B],T[B]))return!1;return!0}function an(M,T){if(Array.isArray(M)&&Array.isArray(T)){if(M.length!==T.length)return!1;const C=[...M].sort(),F=[...T].sort();return C.every((B,X)=>F[X]===B)}return M===T}function uo(M){return Array.prototype.concat.apply([],M)}function Dr(M){return M.length>0?M[M.length-1]:null}function Ct(M,T){for(const C in M)M.hasOwnProperty(C)&&T(M[C],C)}function Rt(M){return(0,te.CqO)(M)?M:(0,te.QGY)(M)?(0,jt.D)(Promise.resolve(M)):ht(M)}const pi={exact:function Ui(M,T,C){if(!qe(M.segments,T.segments)||!Qr(M.segments,T.segments,C)||M.numberOfChildren!==T.numberOfChildren)return!1;for(const F in T.children)if(!M.children[F]||!Ui(M.children[F],T.children[F],C))return!1;return!0},subset:Vt},Ht={exact:function(M,T){return en(M,T)},subset:function(M,T){return Object.keys(T).length<=Object.keys(M).length&&Object.keys(T).every(C=>an(M[C],T[C]))},ignored:()=>!0};function Yi(M,T,C){return pi[C.paths](M.root,T.root,C.matrixParams)&&Ht[C.queryParams](M.queryParams,T.queryParams)&&!("exact"===C.fragment&&M.fragment!==T.fragment)}function Vt(M,T,C){return Go(M,T,T.segments,C)}function Go(M,T,C,F){if(M.segments.length>C.length){const B=M.segments.slice(0,C.length);return!(!qe(B,C)||T.hasChildren()||!Qr(B,C,F))}if(M.segments.length===C.length){if(!qe(M.segments,C)||!Qr(M.segments,C,F))return!1;for(const B in T.children)if(!M.children[B]||!Vt(M.children[B],T.children[B],F))return!1;return!0}{const B=C.slice(0,M.segments.length),X=C.slice(M.segments.length);return!!(qe(M.segments,B)&&Qr(M.segments,B,F)&&M.children[je])&&Go(M.children[je],T,X,F)}}function Qr(M,T,C){return T.every((F,B)=>Ht[C](M[B].parameters,F.parameters))}class De{constructor(T,C,F){this.root=T,this.queryParams=C,this.fragment=F}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=gt(this.queryParams)),this._queryParamMap}toString(){return xr.serialize(this)}}class ye{constructor(T,C){this.segments=T,this.children=C,this.parent=null,Ct(C,(F,B)=>F.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ki(this)}}class ue{constructor(T,C){this.path=T,this.parameters=C}get parameterMap(){return this._parameterMap||(this._parameterMap=gt(this.parameters)),this._parameterMap}toString(){return mi(this)}}function qe(M,T){return M.length===T.length&&M.every((C,F)=>C.path===T[F].path)}class zt{}class Fn{parse(T){const C=new Pl(T);return new De(C.parseRootSegment(),C.parseQueryParams(),C.parseFragment())}serialize(T){var M;return`${`/${To(T.root,!0)}`}${function(M){const T=Object.keys(M).map(C=>{const F=M[C];return Array.isArray(F)?F.map(B=>`${ji(C)}=${ji(B)}`).join("&"):`${ji(C)}=${ji(F)}`}).filter(C=>!!C);return T.length?`?${T.join("&")}`:""}(T.queryParams)}${"string"==typeof T.fragment?`#${M=T.fragment,encodeURI(M)}`:""}`}}const xr=new Fn;function Ki(M){return M.segments.map(T=>mi(T)).join("/")}function To(M,T){if(!M.hasChildren())return Ki(M);if(T){const C=M.children[je]?To(M.children[je],!1):"",F=[];return Ct(M.children,(B,X)=>{X!==je&&F.push(`${X}:${To(B,!1)}`)}),F.length>0?`${C}(${F.join("//")})`:C}{const C=function(M,T){let C=[];return Ct(M.children,(F,B)=>{B===je&&(C=C.concat(T(F,B)))}),Ct(M.children,(F,B)=>{B!==je&&(C=C.concat(T(F,B)))}),C}(M,(F,B)=>B===je?[To(M.children[je],!1)]:[`${B}:${To(F,!1)}`]);return 1===Object.keys(M.children).length&&null!=M.children[je]?`${Ki(M)}/${C[0]}`:`${Ki(M)}/(${C.join("//")})`}}function hr(M){return encodeURIComponent(M).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ji(M){return hr(M).replace(/%3B/gi,";")}function fn(M){return hr(M).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Vs(M){return decodeURIComponent(M)}function Or(M){return Vs(M.replace(/\+/g,"%20"))}function mi(M){return`${fn(M.path)}${function(M){return Object.keys(M).map(T=>`;${fn(T)}=${fn(M[T])}`).join("")}(M.parameters)}`}const ho=/^[^\/()?;=#]+/;function ki(M){const T=M.match(ho);return T?T[0]:""}const Ka=/^[^=?&#]+/,Sa=/^[^?&#]+/;class Pl{constructor(T){this.url=T,this.remaining=T}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ye([],{}):new ye([],this.parseChildren())}parseQueryParams(){const T={};if(this.consumeOptional("?"))do{this.parseQueryParam(T)}while(this.consumeOptional("&"));return T}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const T=[];for(this.peekStartsWith("(")||T.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),T.push(this.parseSegment());let C={};this.peekStartsWith("/(")&&(this.capture("/"),C=this.parseParens(!0));let F={};return this.peekStartsWith("(")&&(F=this.parseParens(!1)),(T.length>0||Object.keys(C).length>0)&&(F[je]=new ye(T,C)),F}parseSegment(){const T=ki(this.remaining);if(""===T&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(T),new ue(Vs(T),this.parseMatrixParams())}parseMatrixParams(){const T={};for(;this.consumeOptional(";");)this.parseParam(T);return T}parseParam(T){const C=ki(this.remaining);if(!C)return;this.capture(C);let F="";if(this.consumeOptional("=")){const B=ki(this.remaining);B&&(F=B,this.capture(F))}T[Vs(C)]=Vs(F)}parseQueryParam(T){const C=function(M){const T=M.match(Ka);return T?T[0]:""}(this.remaining);if(!C)return;this.capture(C);let F="";if(this.consumeOptional("=")){const ve=function(M){const T=M.match(Sa);return T?T[0]:""}(this.remaining);ve&&(F=ve,this.capture(F))}const B=Or(C),X=Or(F);if(T.hasOwnProperty(B)){let ve=T[B];Array.isArray(ve)||(ve=[ve],T[B]=ve),ve.push(X)}else T[B]=X}parseParens(T){const C={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const F=ki(this.remaining),B=this.remaining[F.length];if("/"!==B&&")"!==B&&";"!==B)throw new Error(`Cannot parse url '${this.url}'`);let X;F.indexOf(":")>-1?(X=F.substr(0,F.indexOf(":")),this.capture(X),this.capture(":")):T&&(X=je);const ve=this.parseChildren();C[X]=1===Object.keys(ve).length?ve[je]:new ye([],ve),this.consumeOptional("//")}return C}peekStartsWith(T){return this.remaining.startsWith(T)}consumeOptional(T){return!!this.peekStartsWith(T)&&(this.remaining=this.remaining.substring(T.length),!0)}capture(T){if(!this.consumeOptional(T))throw new Error(`Expected "${T}".`)}}class Aa{constructor(T){this._root=T}get root(){return this._root.value}parent(T){const C=this.pathFromRoot(T);return C.length>1?C[C.length-2]:null}children(T){const C=Rl(T,this._root);return C?C.children.map(F=>F.value):[]}firstChild(T){const C=Rl(T,this._root);return C&&C.children.length>0?C.children[0].value:null}siblings(T){const C=kl(T,this._root);return C.length<2?[]:C[C.length-2].children.map(B=>B.value).filter(B=>B!==T)}pathFromRoot(T){return kl(T,this._root).map(C=>C.value)}}function Rl(M,T){if(M===T.value)return T;for(const C of T.children){const F=Rl(M,C);if(F)return F}return null}function kl(M,T){if(M===T.value)return[T];for(const C of T.children){const F=kl(M,C);if(F.length)return F.unshift(T),F}return[]}class fo{constructor(T,C){this.value=T,this.children=C}toString(){return`TreeNode(${this.value})`}}function ts(M){const T={};return M&&M.children.forEach(C=>T[C.value.outlet]=C),T}class Qa extends Aa{constructor(T,C){super(T),this.snapshot=C,Do(this,T)}toString(){return this.snapshot.toString()}}function mc(M,T){const C=function(M,T){const ve=new Ma([],{},{},"",{},je,T,null,M.root,-1,{});return new ia("",new fo(ve,[]))}(M,T),F=new Me([new ue("",{})]),B=new Me({}),X=new Me({}),ve=new Me({}),Ie=new Me(""),at=new ps(F,B,ve,Ie,X,je,T,C.root);return at.snapshot=C.root,new Qa(new fo(at,[]),C)}class ps{constructor(T,C,F,B,X,ve,Ie,at){this.url=T,this.params=C,this.queryParams=F,this.fragment=B,this.data=X,this.outlet=ve,this.component=Ie,this._futureSnapshot=at}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Et.U)(T=>gt(T)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Et.U)(T=>gt(T)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Fi(M,T="emptyOnly"){const C=M.pathFromRoot;let F=0;if("always"!==T)for(F=C.length-1;F>=1;){const B=C[F],X=C[F-1];if(B.routeConfig&&""===B.routeConfig.path)F--;else{if(X.component)break;F--}}return function(M){return M.reduce((T,C)=>({params:Object.assign(Object.assign({},T.params),C.params),data:Object.assign(Object.assign({},T.data),C.data),resolve:Object.assign(Object.assign({},T.resolve),C._resolvedData)}),{params:{},data:{},resolve:{}})}(C.slice(F))}class Ma{constructor(T,C,F,B,X,ve,Ie,at,Nt,Kn,un){this.url=T,this.params=C,this.queryParams=F,this.fragment=B,this.data=X,this.outlet=ve,this.component=Ie,this.routeConfig=at,this._urlSegment=Nt,this._lastPathIndex=Kn,this._resolve=un}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=gt(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=gt(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(F=>F.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ia extends Aa{constructor(T,C){super(C),this.url=T,Do(this,C)}toString(){return po(this._root)}}function Do(M,T){T.value._routerState=M,T.children.forEach(C=>Do(M,C))}function po(M){const T=M.children.length>0?` { ${M.children.map(po).join(", ")} } `:"";return`${M.value}${T}`}function ms(M){if(M.snapshot){const T=M.snapshot,C=M._futureSnapshot;M.snapshot=C,en(T.queryParams,C.queryParams)||M.queryParams.next(C.queryParams),T.fragment!==C.fragment&&M.fragment.next(C.fragment),en(T.params,C.params)||M.params.next(C.params),function(M,T){if(M.length!==T.length)return!1;for(let C=0;C<M.length;++C)if(!en(M[C],T[C]))return!1;return!0}(T.url,C.url)||M.url.next(C.url),en(T.data,C.data)||M.data.next(C.data)}else M.snapshot=M._futureSnapshot,M.data.next(M._futureSnapshot.data)}function oa(M,T){return en(M.params,T.params)&&function(M,T){return qe(M,T)&&M.every((C,F)=>en(C.parameters,T[F].parameters))}(M.url,T.url)&&!(!M.parent!=!T.parent)&&(!M.parent||oa(M.parent,T.parent))}function Ji(M,T,C){if(C&&M.shouldReuseRoute(T.value,C.value.snapshot)){const F=C.value;F._futureSnapshot=T.value;const B=function(M,T,C){return T.children.map(F=>{for(const B of C.children)if(M.shouldReuseRoute(F.value,B.value.snapshot))return Ji(M,F,B);return Ji(M,F)})}(M,T,C);return new fo(F,B)}{if(M.shouldAttach(T.value)){const X=M.retrieve(T.value);if(null!==X){const ve=X.route;return sa(T,ve),ve}}const F=function(M){return new ps(new Me(M.url),new Me(M.params),new Me(M.queryParams),new Me(M.fragment),new Me(M.data),M.outlet,M.component,M)}(T.value),B=T.children.map(X=>Ji(M,X));return new fo(F,B)}}function sa(M,T){if(M.value.routeConfig!==T.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(M.children.length!==T.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");T.value._futureSnapshot=M.value;for(let C=0;C<M.children.length;++C)sa(M.children[C],T.children[C])}function Ln(M){return"object"==typeof M&&null!=M&&!M.outlets&&!M.segmentPath}function mo(M){return"object"==typeof M&&null!=M&&M.outlets}function gs(M,T,C,F,B){let X={};return F&&Ct(F,(ve,Ie)=>{X[Ie]=Array.isArray(ve)?ve.map(at=>`${at}`):`${ve}`}),new De(C.root===M?T:Ja(C.root,M,T),X,B)}function Ja(M,T,C){const F={};return Ct(M.children,(B,X)=>{F[X]=B===T?C:Ja(B,T,C)}),new ye(M.segments,F)}class ca{constructor(T,C,F){if(this.isAbsolute=T,this.numberOfDoubleDots=C,this.commands=F,T&&F.length>0&&Ln(F[0]))throw new Error("Root segment cannot have matrix parameters");const B=F.find(mo);if(B&&B!==Dr(F))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class W{constructor(T,C,F){this.segmentGroup=T,this.processChildren=C,this.index=F}}function Je(M,T,C){if(M||(M=new ye([],{})),0===M.segments.length&&M.hasChildren())return pt(M,T,C);const F=function(M,T,C){let F=0,B=T;const X={match:!1,pathIndex:0,commandIndex:0};for(;B<M.segments.length;){if(F>=C.length)return X;const ve=M.segments[B],Ie=C[F];if(mo(Ie))break;const at=`${Ie}`,Nt=F<C.length-1?C[F+1]:null;if(B>0&&void 0===at)break;if(at&&Nt&&"object"==typeof Nt&&void 0===Nt.outlets){if(!Rn(at,Nt,ve))return X;F+=2}else{if(!Rn(at,{},ve))return X;F++}B++}return{match:!0,pathIndex:B,commandIndex:F}}(M,T,C),B=C.slice(F.commandIndex);if(F.match&&F.pathIndex<M.segments.length){const X=new ye(M.segments.slice(0,F.pathIndex),{});return X.children[je]=new ye(M.segments.slice(F.pathIndex),M.children),pt(X,0,B)}return F.match&&0===B.length?new ye(M.segments,{}):F.match&&!M.hasChildren()?tn(M,T,C):F.match?pt(M,0,B):tn(M,T,C)}function pt(M,T,C){if(0===C.length)return new ye(M.segments,{});{const F=function(M){return mo(M[0])?M[0].outlets:{[je]:M}}(C),B={};return Ct(F,(X,ve)=>{"string"==typeof X&&(X=[X]),null!==X&&(B[ve]=Je(M.children[ve],T,X))}),Ct(M.children,(X,ve)=>{void 0===F[ve]&&(B[ve]=X)}),new ye(M.segments,B)}}function tn(M,T,C){const F=M.segments.slice(0,T);let B=0;for(;B<C.length;){const X=C[B];if(mo(X)){const at=br(X.outlets);return new ye(F,at)}if(0===B&&Ln(C[0])){F.push(new ue(M.segments[T].path,dr(C[0]))),B++;continue}const ve=mo(X)?X.outlets[je]:`${X}`,Ie=B<C.length-1?C[B+1]:null;ve&&Ie&&Ln(Ie)?(F.push(new ue(ve,dr(Ie))),B+=2):(F.push(new ue(ve,{})),B++)}return new ye(F,{})}function br(M){const T={};return Ct(M,(C,F)=>{"string"==typeof C&&(C=[C]),null!==C&&(T[F]=tn(new ye([],{}),0,C))}),T}function dr(M){const T={};return Ct(M,(C,F)=>T[F]=`${C}`),T}function Rn(M,T,C){return M==C.path&&en(T,C.parameters)}class wr{constructor(T,C,F,B){this.routeReuseStrategy=T,this.futureState=C,this.currState=F,this.forwardEvent=B}activate(T){const C=this.futureState._root,F=this.currState?this.currState._root:null;this.deactivateChildRoutes(C,F,T),ms(this.futureState.root),this.activateChildRoutes(C,F,T)}deactivateChildRoutes(T,C,F){const B=ts(C);T.children.forEach(X=>{const ve=X.value.outlet;this.deactivateRoutes(X,B[ve],F),delete B[ve]}),Ct(B,(X,ve)=>{this.deactivateRouteAndItsChildren(X,F)})}deactivateRoutes(T,C,F){const B=T.value,X=C?C.value:null;if(B===X)if(B.component){const ve=F.getContext(B.outlet);ve&&this.deactivateChildRoutes(T,C,ve.children)}else this.deactivateChildRoutes(T,C,F);else X&&this.deactivateRouteAndItsChildren(C,F)}deactivateRouteAndItsChildren(T,C){this.routeReuseStrategy.shouldDetach(T.value.snapshot)?this.detachAndStoreRouteSubtree(T,C):this.deactivateRouteAndOutlet(T,C)}detachAndStoreRouteSubtree(T,C){const F=C.getContext(T.value.outlet);if(F&&F.outlet){const B=F.outlet.detach(),X=F.children.onOutletDeactivated();this.routeReuseStrategy.store(T.value.snapshot,{componentRef:B,route:T,contexts:X})}}deactivateRouteAndOutlet(T,C){const F=C.getContext(T.value.outlet),B=F&&T.value.component?F.children:C,X=ts(T);for(const ve of Object.keys(X))this.deactivateRouteAndItsChildren(X[ve],B);F&&F.outlet&&(F.outlet.deactivate(),F.children.onOutletDeactivated(),F.attachRef=null,F.resolver=null,F.route=null)}activateChildRoutes(T,C,F){const B=ts(C);T.children.forEach(X=>{this.activateRoutes(X,B[X.value.outlet],F),this.forwardEvent(new tt(X.value.snapshot))}),T.children.length&&this.forwardEvent(new Ee(T.value.snapshot))}activateRoutes(T,C,F){const B=T.value,X=C?C.value:null;if(ms(B),B===X)if(B.component){const ve=F.getOrCreateContext(B.outlet);this.activateChildRoutes(T,C,ve.children)}else this.activateChildRoutes(T,C,F);else if(B.component){const ve=F.getOrCreateContext(B.outlet);if(this.routeReuseStrategy.shouldAttach(B.snapshot)){const Ie=this.routeReuseStrategy.retrieve(B.snapshot);this.routeReuseStrategy.store(B.snapshot,null),ve.children.onOutletReAttached(Ie.contexts),ve.attachRef=Ie.componentRef,ve.route=Ie.route.value,ve.outlet&&ve.outlet.attach(Ie.componentRef,Ie.route.value),fr(Ie.route)}else{const Ie=function(M){for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig;if(C&&C.component)return null}return null}(B.snapshot),at=Ie?Ie.module.componentFactoryResolver:null;ve.attachRef=null,ve.route=B,ve.resolver=at,ve.outlet&&ve.outlet.activateWith(B,at),this.activateChildRoutes(T,null,ve.children)}}else this.activateChildRoutes(T,null,F)}}function fr(M){ms(M.value),M.children.forEach(fr)}class Ir{constructor(T,C){this.routes=T,this.module=C}}function bi(M){return"function"==typeof M}function wi(M){return M instanceof De}const eo=Symbol("INITIAL_VALUE");function ua(){return sr(M=>function(...M){let T,C;return(0,Kt.K)(M[M.length-1])&&(C=M.pop()),"function"==typeof M[M.length-1]&&(T=M.pop()),1===M.length&&(0,Se.k)(M[0])&&(M=M[0]),(0,d.n)(M,C).lift(new nn(T))}(M.map(T=>T.pipe(Bi(1),function(...M){const T=M[M.length-1];return(0,Kt.K)(T)?(M.pop(),C=>bo(M,C,T)):C=>bo(M,C)}(eo)))).pipe(yi((T,C)=>{let F=!1;return C.reduce((B,X,ve)=>B!==eo?B:(X===eo&&(F=!0),F||!1!==X&&ve!==C.length-1&&!wi(X)?B:X),T)},eo),Sn(T=>T!==eo),(0,Et.U)(T=>wi(T)?T:!0===T),Bi(1)))}let _s=(()=>{class M{}return M.\u0275fac=function(C){return new(C||M)},M.\u0275cmp=te.Xpm({type:M,selectors:[["ng-component"]],decls:1,vars:0,template:function(C,F){1&C&&te._UZ(0,"router-outlet")},directives:function(){return[ga]},encapsulation:2}),M})();function mn(M,T=""){for(let C=0;C<M.length;C++){const F=M[C];ku(F,Fu(T,F))}}function ku(M,T){M.children&&mn(M.children,T)}function Fu(M,T){return T?M||T.path?M&&!T.path?`${M}/`:!M&&T.path?T.path:`${M}/${T.path}`:"":M}function _c(M){const T=M.children&&M.children.map(_c),C=T?Object.assign(Object.assign({},M),{children:T}):Object.assign({},M);return!C.component&&(T||C.loadChildren)&&C.outlet&&C.outlet!==je&&(C.component=_s),C}function Ao(M){return M.outlet||je}function yc(M,T){const C=M.filter(F=>Ao(F)===T);return C.push(...M.filter(F=>Ao(F)!==T)),C}const ha={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function da(M,T,C){var F;if(""===T.path)return"full"===T.pathMatch&&(M.hasChildren()||C.length>0)?Object.assign({},ha):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const X=(T.matcher||sn)(C,M,T);if(!X)return Object.assign({},ha);const ve={};Ct(X.posParams,(at,Nt)=>{ve[Nt]=at.path});const Ie=X.consumed.length>0?Object.assign(Object.assign({},ve),X.consumed[X.consumed.length-1].parameters):ve;return{matched:!0,consumedSegments:X.consumed,lastChild:X.consumed.length,parameters:Ie,positionalParamSegments:null!==(F=X.posParams)&&void 0!==F?F:{}}}function ft(M,T,C,F,B="corrected"){if(C.length>0&&function(M,T,C){return C.some(F=>ns(M,T,F)&&Ao(F)!==je)}(M,C,F)){const ve=new ye(T,function(M,T,C,F){const B={};B[je]=F,F._sourceSegment=M,F._segmentIndexShift=T.length;for(const X of C)if(""===X.path&&Ao(X)!==je){const ve=new ye([],{});ve._sourceSegment=M,ve._segmentIndexShift=T.length,B[Ao(X)]=ve}return B}(M,T,F,new ye(C,M.children)));return ve._sourceSegment=M,ve._segmentIndexShift=T.length,{segmentGroup:ve,slicedSegments:[]}}if(0===C.length&&function(M,T,C){return C.some(F=>ns(M,T,F))}(M,C,F)){const ve=new ye(M.segments,function(M,T,C,F,B,X){const ve={};for(const Ie of F)if(ns(M,C,Ie)&&!B[Ao(Ie)]){const at=new ye([],{});at._sourceSegment=M,at._segmentIndexShift="legacy"===X?M.segments.length:T.length,ve[Ao(Ie)]=at}return Object.assign(Object.assign({},B),ve)}(M,T,C,F,M.children,B));return ve._sourceSegment=M,ve._segmentIndexShift=T.length,{segmentGroup:ve,slicedSegments:C}}const X=new ye(M.segments,M.children);return X._sourceSegment=M,X._segmentIndexShift=T.length,{segmentGroup:X,slicedSegments:C}}function ns(M,T,C){return(!(M.hasChildren()||T.length>0)||"full"!==C.pathMatch)&&""===C.path}function Ei(M,T,C,F){return!!(Ao(M)===F||F!==je&&ns(T,C,M))&&("**"===M.path||da(T,M,C).matched)}function Ho(M,T,C){return 0===T.length&&!M.children[C]}class $s{constructor(T){this.segmentGroup=T||null}}class xc{constructor(T){this.urlTree=T}}function jn(M){return new St.y(T=>T.error(new $s(M)))}function Gs(M){return new St.y(T=>T.error(new xc(M)))}function Ol(M){return new St.y(T=>T.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${M}'`)))}class bc{constructor(T,C,F,B,X){this.configLoader=C,this.urlSerializer=F,this.urlTree=B,this.config=X,this.allowRedirects=!0,this.ngModule=T.get(te.h0i)}apply(){const T=ft(this.urlTree.root,[],[],this.config).segmentGroup,C=new ye(T.segments,T.children);return this.expandSegmentGroup(this.ngModule,this.config,C,je).pipe((0,Et.U)(X=>this.createUrlTree(Mo(X),this.urlTree.queryParams,this.urlTree.fragment))).pipe(gn(X=>{if(X instanceof xc)return this.allowRedirects=!1,this.match(X.urlTree);throw X instanceof $s?this.noMatchError(X):X}))}match(T){return this.expandSegmentGroup(this.ngModule,this.config,T.root,je).pipe((0,Et.U)(B=>this.createUrlTree(Mo(B),T.queryParams,T.fragment))).pipe(gn(B=>{throw B instanceof $s?this.noMatchError(B):B}))}noMatchError(T){return new Error(`Cannot match any routes. URL Segment: '${T.segmentGroup}'`)}createUrlTree(T,C,F){const B=T.segments.length>0?new ye([],{[je]:T}):T;return new De(B,C,F)}expandSegmentGroup(T,C,F,B){return 0===F.segments.length&&F.hasChildren()?this.expandChildren(T,C,F).pipe((0,Et.U)(X=>new ye([],X))):this.expandSegment(T,F,C,F.segments,B,!0)}expandChildren(T,C,F){const B=[];for(const X of Object.keys(F.children))"primary"===X?B.unshift(X):B.push(X);return(0,jt.D)(B).pipe(Xr(X=>{const ve=F.children[X],Ie=yc(C,X);return this.expandSegmentGroup(T,Ie,ve,X).pipe((0,Et.U)(at=>({segment:at,outlet:X})))}),yi((X,ve)=>(X[ve.outlet]=ve.segment,X),{}),function(M,T){const C=arguments.length>=2;return F=>F.pipe(M?Sn((B,X)=>M(B,X,F)):Xt.y,Zi(1),C?Yr(T):Eo(()=>new Ai))}())}expandSegment(T,C,F,B,X,ve){return(0,jt.D)(F).pipe(Xr(Ie=>this.expandSegmentAgainstRoute(T,C,F,Ie,B,X,ve).pipe(gn(Nt=>{if(Nt instanceof $s)return ht(null);throw Nt}))),Mi(Ie=>!!Ie),gn((Ie,at)=>{if(Ie instanceof Ai||"EmptyError"===Ie.name){if(Ho(C,B,X))return ht(new ye([],{}));throw new $s(C)}throw Ie}))}expandSegmentAgainstRoute(T,C,F,B,X,ve,Ie){return Ei(B,C,X,ve)?void 0===B.redirectTo?this.matchSegmentAgainstRoute(T,C,B,X,ve):Ie&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(T,C,F,B,X,ve):jn(C):jn(C)}expandSegmentAgainstRouteUsingRedirect(T,C,F,B,X,ve){return"**"===B.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(T,F,B,ve):this.expandRegularSegmentAgainstRouteUsingRedirect(T,C,F,B,X,ve)}expandWildCardWithParamsAgainstRouteUsingRedirect(T,C,F,B){const X=this.applyRedirectCommands([],F.redirectTo,{});return F.redirectTo.startsWith("/")?Gs(X):this.lineralizeSegments(F,X).pipe((0,Yn.zg)(ve=>{const Ie=new ye(ve,{});return this.expandSegment(T,Ie,C,ve,B,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(T,C,F,B,X,ve){const{matched:Ie,consumedSegments:at,lastChild:Nt,positionalParamSegments:Kn}=da(C,B,X);if(!Ie)return jn(C);const un=this.applyRedirectCommands(at,B.redirectTo,Kn);return B.redirectTo.startsWith("/")?Gs(un):this.lineralizeSegments(B,un).pipe((0,Yn.zg)(ar=>this.expandSegment(T,C,F,ar.concat(X.slice(Nt)),ve,!1)))}matchSegmentAgainstRoute(T,C,F,B,X){if("**"===F.path)return F.loadChildren?(F._loadedConfig?ht(F._loadedConfig):this.configLoader.load(T.injector,F)).pipe((0,Et.U)(ar=>(F._loadedConfig=ar,new ye(B,{})))):ht(new ye(B,{}));const{matched:ve,consumedSegments:Ie,lastChild:at}=da(C,F,B);if(!ve)return jn(C);const Nt=B.slice(at);return this.getChildConfig(T,F,B).pipe((0,Yn.zg)(un=>{const ar=un.module,f=un.routes,{segmentGroup:r,slicedSegments:c}=ft(C,Ie,Nt,f),p=new ye(r.segments,r.children);if(0===c.length&&p.hasChildren())return this.expandChildren(ar,f,p).pipe((0,Et.U)(A=>new ye(Ie,A)));if(0===f.length&&0===c.length)return ht(new ye(Ie,{}));const y=Ao(F)===X;return this.expandSegment(ar,p,f,c,y?je:X,!0).pipe((0,Et.U)(D=>new ye(Ie.concat(D.segments),D.children)))}))}getChildConfig(T,C,F){return C.children?ht(new Ir(C.children,T)):C.loadChildren?void 0!==C._loadedConfig?ht(C._loadedConfig):this.runCanLoadGuards(T.injector,C,F).pipe((0,Yn.zg)(B=>{return B?this.configLoader.load(T.injector,C).pipe((0,Et.U)(X=>(C._loadedConfig=X,X))):(M=C,new St.y(T=>T.error(Ye(`Cannot load children because the guard of the route "path: '${M.path}'" returned false`))));var M})):ht(new Ir([],T))}runCanLoadGuards(T,C,F){const B=C.canLoad;return B&&0!==B.length?ht(B.map(ve=>{const Ie=T.get(ve);let at;if((M=Ie)&&bi(M.canLoad))at=Ie.canLoad(C,F);else{if(!bi(Ie))throw new Error("Invalid CanLoad guard");at=Ie(C,F)}var M;return Rt(at)})).pipe(ua(),Zn(ve=>{if(!wi(ve))return;const Ie=Ye(`Redirecting to "${this.urlSerializer.serialize(ve)}"`);throw Ie.url=ve,Ie}),(0,Et.U)(ve=>!0===ve)):ht(!0)}lineralizeSegments(T,C){let F=[],B=C.root;for(;;){if(F=F.concat(B.segments),0===B.numberOfChildren)return ht(F);if(B.numberOfChildren>1||!B.children[je])return Ol(T.redirectTo);B=B.children[je]}}applyRedirectCommands(T,C,F){return this.applyRedirectCreatreUrlTree(C,this.urlSerializer.parse(C),T,F)}applyRedirectCreatreUrlTree(T,C,F,B){const X=this.createSegmentGroup(T,C.root,F,B);return new De(X,this.createQueryParams(C.queryParams,this.urlTree.queryParams),C.fragment)}createQueryParams(T,C){const F={};return Ct(T,(B,X)=>{if("string"==typeof B&&B.startsWith(":")){const Ie=B.substring(1);F[X]=C[Ie]}else F[X]=B}),F}createSegmentGroup(T,C,F,B){const X=this.createSegments(T,C.segments,F,B);let ve={};return Ct(C.children,(Ie,at)=>{ve[at]=this.createSegmentGroup(T,Ie,F,B)}),new ye(X,ve)}createSegments(T,C,F,B){return C.map(X=>X.path.startsWith(":")?this.findPosParam(T,X,B):this.findOrReturn(X,F))}findPosParam(T,C,F){const B=F[C.path.substring(1)];if(!B)throw new Error(`Cannot redirect to '${T}'. Cannot find '${C.path}'.`);return B}findOrReturn(T,C){let F=0;for(const B of C){if(B.path===T.path)return C.splice(F),B;F++}return T}}function Mo(M){const T={};for(const F of Object.keys(M.children)){const X=Mo(M.children[F]);(X.segments.length>0||X.hasChildren())&&(T[F]=X)}return function(M){if(1===M.numberOfChildren&&M.children[je]){const T=M.children[je];return new ye(M.segments.concat(T.segments),T.children)}return M}(new ye(M.segments,T))}class el{constructor(T){this.path=T,this.route=this.path[this.path.length-1]}}class to{constructor(T,C){this.component=T,this.route=C}}function ka(M,T,C){const F=M._root;return Po(F,T?T._root:null,C,[F.value])}function xs(M,T,C){const F=function(M){if(!M)return null;for(let T=M.parent;T;T=T.parent){const C=T.routeConfig;if(C&&C._loadedConfig)return C._loadedConfig}return null}(T);return(F?F.module.injector:C).get(M)}function Po(M,T,C,F,B={canDeactivateChecks:[],canActivateChecks:[]}){const X=ts(T);return M.children.forEach(ve=>{(function(M,T,C,F,B={canDeactivateChecks:[],canActivateChecks:[]}){const X=M.value,ve=T?T.value:null,Ie=C?C.getContext(M.value.outlet):null;if(ve&&X.routeConfig===ve.routeConfig){const at=function(M,T,C){if("function"==typeof C)return C(M,T);switch(C){case"pathParamsChange":return!qe(M.url,T.url);case"pathParamsOrQueryParamsChange":return!qe(M.url,T.url)||!en(M.queryParams,T.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!oa(M,T)||!en(M.queryParams,T.queryParams);case"paramsChange":default:return!oa(M,T)}}(ve,X,X.routeConfig.runGuardsAndResolvers);at?B.canActivateChecks.push(new el(F)):(X.data=ve.data,X._resolvedData=ve._resolvedData),Po(M,T,X.component?Ie?Ie.children:null:C,F,B),at&&Ie&&Ie.outlet&&Ie.outlet.isActivated&&B.canDeactivateChecks.push(new to(Ie.outlet.component,ve))}else ve&&qo(T,Ie,B),B.canActivateChecks.push(new el(F)),Po(M,null,X.component?Ie?Ie.children:null:C,F,B)})(ve,X[ve.value.outlet],C,F.concat([ve.value]),B),delete X[ve.value.outlet]}),Ct(X,(ve,Ie)=>qo(ve,C.getContext(Ie),B)),B}function qo(M,T,C){const F=ts(M),B=M.value;Ct(F,(X,ve)=>{qo(X,B.component?T?T.children.getContext(ve):null:T,C)}),C.canDeactivateChecks.push(new to(B.component&&T&&T.outlet&&T.outlet.isActivated?T.outlet.component:null,B))}class no{}function pr(M){return new St.y(T=>T.error(M))}class Ec{constructor(T,C,F,B,X,ve){this.rootComponentType=T,this.config=C,this.urlTree=F,this.url=B,this.paramsInheritanceStrategy=X,this.relativeLinkResolution=ve}recognize(){const T=ft(this.urlTree.root,[],[],this.config.filter(ve=>void 0===ve.redirectTo),this.relativeLinkResolution).segmentGroup,C=this.processSegmentGroup(this.config,T,je);if(null===C)return null;const F=new Ma([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},je,this.rootComponentType,null,this.urlTree.root,-1,{}),B=new fo(F,C),X=new ia(this.url,B);return this.inheritParamsAndData(X._root),X}inheritParamsAndData(T){const C=T.value,F=Fi(C,this.paramsInheritanceStrategy);C.params=Object.freeze(F.params),C.data=Object.freeze(F.data),T.children.forEach(B=>this.inheritParamsAndData(B))}processSegmentGroup(T,C,F){return 0===C.segments.length&&C.hasChildren()?this.processChildren(T,C):this.processSegment(T,C,C.segments,F)}processChildren(T,C){const F=[];for(const X of Object.keys(C.children)){const ve=C.children[X],Ie=yc(T,X),at=this.processSegmentGroup(Ie,ve,X);if(null===at)return null;F.push(...at)}const B=Tc(F);return B.sort((T,C)=>T.value.outlet===je?-1:C.value.outlet===je?1:T.value.outlet.localeCompare(C.value.outlet)),B}processSegment(T,C,F,B){for(const X of T){const ve=this.processSegmentAgainstRoute(X,C,F,B);if(null!==ve)return ve}return Ho(C,F,B)?[]:null}processSegmentAgainstRoute(T,C,F,B){if(T.redirectTo||!Ei(T,C,F,B))return null;let X,ve=[],Ie=[];if("**"===T.path){const f=F.length>0?Dr(F).parameters:{};X=new Ma(F,f,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,rl(T),Ao(T),T.component,T,qs(C),fa(C)+F.length,pa(T))}else{const f=da(C,T,F);if(!f.matched)return null;ve=f.consumedSegments,Ie=F.slice(f.lastChild),X=new Ma(ve,f.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,rl(T),Ao(T),T.component,T,qs(C),fa(C)+ve.length,pa(T))}const at=(M=T).children?M.children:M.loadChildren?M._loadedConfig.routes:[],{segmentGroup:Nt,slicedSegments:Kn}=ft(C,ve,Ie,at.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution);var M;if(0===Kn.length&&Nt.hasChildren()){const f=this.processChildren(at,Nt);return null===f?null:[new fo(X,f)]}if(0===at.length&&0===Kn.length)return[new fo(X,[])];const un=Ao(T)===B,ar=this.processSegment(at,Nt,Kn,un?je:B);return null===ar?null:[new fo(X,ar)]}}function Fa(M){const T=M.value.routeConfig;return T&&""===T.path&&void 0===T.redirectTo}function Tc(M){const T=[],C=new Set;for(const F of M){if(!Fa(F)){T.push(F);continue}const B=T.find(X=>F.value.routeConfig===X.value.routeConfig);void 0!==B?(B.children.push(...F.children),C.add(B)):T.push(F)}for(const F of C){const B=Tc(F.children);T.push(new fo(F.value,B))}return T.filter(F=>!C.has(F))}function qs(M){let T=M;for(;T._sourceSegment;)T=T._sourceSegment;return T}function fa(M){let T=M,C=T._segmentIndexShift?T._segmentIndexShift:0;for(;T._sourceSegment;)T=T._sourceSegment,C+=T._segmentIndexShift?T._segmentIndexShift:0;return C-1}function rl(M){return M.data||{}}function pa(M){return M.resolve||{}}function Zs(M){return sr(T=>{const C=M(T);return C?(0,jt.D)(C).pipe((0,Et.U)(()=>T)):ht(T)})}class ru extends class{shouldDetach(T){return!1}store(T,C){}shouldAttach(T){return!1}retrieve(T){return null}shouldReuseRoute(T,C){return T.routeConfig===C.routeConfig}}{}const ol=new te.OlP("ROUTES");class Oi{constructor(T,C,F,B){this.loader=T,this.compiler=C,this.onLoadStartListener=F,this.onLoadEndListener=B}load(T,C){if(C._loader$)return C._loader$;this.onLoadStartListener&&this.onLoadStartListener(C);const B=this.loadModuleFactory(C.loadChildren).pipe((0,Et.U)(X=>{this.onLoadEndListener&&this.onLoadEndListener(C);const ve=X.create(T);return new Ir(uo(ve.injector.get(ol,void 0,te.XFs.Self|te.XFs.Optional)).map(_c),ve)}),gn(X=>{throw C._loader$=void 0,X}));return C._loader$=new zn.c(B,()=>new Ot.xQ).pipe((0,Vi.x)()),C._loader$}loadModuleFactory(T){return"string"==typeof T?(0,jt.D)(this.loader.load(T)):Rt(T()).pipe((0,Yn.zg)(C=>C instanceof te.YKP?ht(C):(0,jt.D)(this.compiler.compileModuleAsync(C))))}}class Gl{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Ti,this.attachRef=null}}class Ti{constructor(){this.contexts=new Map}onChildOutletCreated(T,C){const F=this.getOrCreateContext(T);F.outlet=C,this.contexts.set(T,F)}onChildOutletDestroyed(T){const C=this.getContext(T);C&&(C.outlet=null,C.attachRef=null)}onOutletDeactivated(){const T=this.contexts;return this.contexts=new Map,T}onOutletReAttached(T){this.contexts=T}getOrCreateContext(T){let C=this.getContext(T);return C||(C=new Gl,this.contexts.set(T,C)),C}getContext(T){return this.contexts.get(T)||null}}class Ro{shouldProcessUrl(T){return!0}extract(T){return T}merge(T,C){return T}}function Ws(M){throw M}function iu(M,T,C){return T.parse("/")}function Cs(M,T){return ht(null)}const ql={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ma={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Di=(()=>{class M{constructor(C,F,B,X,ve,Ie,at,Nt){this.rootComponentType=C,this.urlSerializer=F,this.rootContexts=B,this.location=X,this.config=Nt,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Ot.xQ,this.errorHandler=Ws,this.malformedUriErrorHandler=iu,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Cs,afterPreactivation:Cs},this.urlHandlingStrategy=new Ro,this.routeReuseStrategy=new ru,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=ve.get(te.h0i),this.console=ve.get(te.c2e);const ar=ve.get(te.R0b);this.isNgZoneEnabled=ar instanceof te.R0b&&te.R0b.isInAngularZone(),this.resetConfig(Nt),this.currentUrlTree=new De(new ye([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Oi(Ie,at,f=>this.triggerEvent(new be(f)),f=>this.triggerEvent(new Le(f))),this.routerState=mc(this.currentUrlTree,this.rootComponentType),this.transitions=new Me({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var C;return null===(C=this.location.getState())||void 0===C?void 0:C.\u0275routerPageId}setupNavigations(C){const F=this.events;return C.pipe(Sn(B=>0!==B.id),(0,Et.U)(B=>Object.assign(Object.assign({},B),{extractedUrl:this.urlHandlingStrategy.extract(B.rawUrl)})),sr(B=>{let X=!1,ve=!1;return ht(B).pipe(Zn(Ie=>{this.currentNavigation={id:Ie.id,initialUrl:Ie.currentRawUrl,extractedUrl:Ie.extractedUrl,trigger:Ie.source,extras:Ie.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),sr(Ie=>{const at=this.browserUrlTree.toString(),Nt=!this.navigated||Ie.extractedUrl.toString()!==at||at!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||Nt)&&this.urlHandlingStrategy.shouldProcessUrl(Ie.rawUrl))return ko(Ie.source)&&(this.browserUrlTree=Ie.extractedUrl),ht(Ie).pipe(sr(un=>{const ar=this.transitions.getValue();return F.next(new Xi(un.id,this.serializeUrl(un.extractedUrl),un.source,un.restoredState)),ar!==this.transitions.getValue()?Mn:Promise.resolve(un)}),function(M,T,C,F){return sr(B=>function(M,T,C,F,B){return new bc(M,T,C,F,B).apply()}(M,T,C,B.extractedUrl,F).pipe((0,Et.U)(X=>Object.assign(Object.assign({},B),{urlAfterRedirects:X}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Zn(un=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:un.urlAfterRedirects})}),function(M,T,C,F,B){return(0,Yn.zg)(X=>function(M,T,C,F,B="emptyOnly",X="legacy"){try{const ve=new Ec(M,T,C,F,B,X).recognize();return null===ve?pr(new no):ht(ve)}catch(ve){return pr(ve)}}(M,T,X.urlAfterRedirects,C(X.urlAfterRedirects),F,B).pipe((0,Et.U)(ve=>Object.assign(Object.assign({},X),{targetSnapshot:ve}))))}(this.rootComponentType,this.config,un=>this.serializeUrl(un),this.paramsInheritanceStrategy,this.relativeLinkResolution),Zn(un=>{"eager"===this.urlUpdateStrategy&&(un.extras.skipLocationChange||this.setBrowserUrl(un.urlAfterRedirects,un),this.browserUrlTree=un.urlAfterRedirects);const ar=new ie(un.id,this.serializeUrl(un.extractedUrl),this.serializeUrl(un.urlAfterRedirects),un.targetSnapshot);F.next(ar)}));if(Nt&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:ar,extractedUrl:f,source:r,restoredState:c,extras:p}=Ie,y=new Xi(ar,this.serializeUrl(f),r,c);F.next(y);const v=mc(f,this.rootComponentType).snapshot;return ht(Object.assign(Object.assign({},Ie),{targetSnapshot:v,urlAfterRedirects:f,extras:Object.assign(Object.assign({},p),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=Ie.rawUrl,this.browserUrlTree=Ie.urlAfterRedirects,Ie.resolve(null),Mn}),Zs(Ie=>{const{targetSnapshot:at,id:Nt,extractedUrl:Kn,rawUrl:un,extras:{skipLocationChange:ar,replaceUrl:f}}=Ie;return this.hooks.beforePreactivation(at,{navigationId:Nt,appliedUrlTree:Kn,rawUrlTree:un,skipLocationChange:!!ar,replaceUrl:!!f})}),Zn(Ie=>{const at=new $(Ie.id,this.serializeUrl(Ie.extractedUrl),this.serializeUrl(Ie.urlAfterRedirects),Ie.targetSnapshot);this.triggerEvent(at)}),(0,Et.U)(Ie=>Object.assign(Object.assign({},Ie),{guards:ka(Ie.targetSnapshot,Ie.currentSnapshot,this.rootContexts)})),function(M,T){return(0,Yn.zg)(C=>{const{targetSnapshot:F,currentSnapshot:B,guards:{canActivateChecks:X,canDeactivateChecks:ve}}=C;return 0===ve.length&&0===X.length?ht(Object.assign(Object.assign({},C),{guardsResult:!0})):function(M,T,C,F){return(0,jt.D)(M).pipe((0,Yn.zg)(B=>function(M,T,C,F,B){const X=T&&T.routeConfig?T.routeConfig.canDeactivate:null;return X&&0!==X.length?ht(X.map(Ie=>{const at=xs(Ie,T,B);let Nt;if(function(M){return M&&bi(M.canDeactivate)}(at))Nt=Rt(at.canDeactivate(M,T,C,F));else{if(!bi(at))throw new Error("Invalid CanDeactivate guard");Nt=Rt(at(M,T,C,F))}return Nt.pipe(Mi())})).pipe(ua()):ht(!0)}(B.component,B.route,C,T,F)),Mi(B=>!0!==B,!0))}(ve,F,B,M).pipe((0,Yn.zg)(Ie=>Ie&&function(M){return"boolean"==typeof M}(Ie)?function(M,T,C,F){return(0,jt.D)(T).pipe(Xr(B=>bo(function(M,T){return null!==M&&T&&T(new Oe(M)),ht(!0)}(B.route.parent,F),function(M,T){return null!==M&&T&&T(new Be(M)),ht(!0)}(B.route,F),function(M,T,C){const F=T[T.length-1],X=T.slice(0,T.length-1).reverse().map(ve=>function(M){const T=M.routeConfig?M.routeConfig.canActivateChild:null;return T&&0!==T.length?{node:M,guards:T}:null}(ve)).filter(ve=>null!==ve).map(ve=>cn(()=>ht(ve.guards.map(at=>{const Nt=xs(at,ve.node,C);let Kn;if(function(M){return M&&bi(M.canActivateChild)}(Nt))Kn=Rt(Nt.canActivateChild(F,M));else{if(!bi(Nt))throw new Error("Invalid CanActivateChild guard");Kn=Rt(Nt(F,M))}return Kn.pipe(Mi())})).pipe(ua())));return ht(X).pipe(ua())}(M,B.path,C),function(M,T,C){const F=T.routeConfig?T.routeConfig.canActivate:null;return F&&0!==F.length?ht(F.map(X=>cn(()=>{const ve=xs(X,T,C);let Ie;if(function(M){return M&&bi(M.canActivate)}(ve))Ie=Rt(ve.canActivate(T,M));else{if(!bi(ve))throw new Error("Invalid CanActivate guard");Ie=Rt(ve(T,M))}return Ie.pipe(Mi())}))).pipe(ua()):ht(!0)}(M,B.route,C))),Mi(B=>!0!==B,!0))}(F,X,M,T):ht(Ie)),(0,Et.U)(Ie=>Object.assign(Object.assign({},C),{guardsResult:Ie})))})}(this.ngModule.injector,Ie=>this.triggerEvent(Ie)),Zn(Ie=>{if(wi(Ie.guardsResult)){const Nt=Ye(`Redirecting to "${this.serializeUrl(Ie.guardsResult)}"`);throw Nt.url=Ie.guardsResult,Nt}const at=new q(Ie.id,this.serializeUrl(Ie.extractedUrl),this.serializeUrl(Ie.urlAfterRedirects),Ie.targetSnapshot,!!Ie.guardsResult);this.triggerEvent(at)}),Sn(Ie=>!!Ie.guardsResult||(this.restoreHistory(Ie),this.cancelNavigationTransition(Ie,""),!1)),Zs(Ie=>{if(Ie.guards.canActivateChecks.length)return ht(Ie).pipe(Zn(at=>{const Nt=new ae(at.id,this.serializeUrl(at.extractedUrl),this.serializeUrl(at.urlAfterRedirects),at.targetSnapshot);this.triggerEvent(Nt)}),sr(at=>{let Nt=!1;return ht(at).pipe(function(M,T){return(0,Yn.zg)(C=>{const{targetSnapshot:F,guards:{canActivateChecks:B}}=C;if(!B.length)return ht(C);let X=0;return(0,jt.D)(B).pipe(Xr(ve=>function(M,T,C,F){return function(M,T,C,F){const B=Object.keys(M);if(0===B.length)return ht({});const X={};return(0,jt.D)(B).pipe((0,Yn.zg)(ve=>function(M,T,C,F){const B=xs(M,T,F);return Rt(B.resolve?B.resolve(T,C):B(T,C))}(M[ve],T,C,F).pipe(Zn(Ie=>{X[ve]=Ie}))),Zi(1),(0,Yn.zg)(()=>Object.keys(X).length===B.length?ht(X):Mn))}(M._resolve,M,T,F).pipe((0,Et.U)(X=>(M._resolvedData=X,M.data=Object.assign(Object.assign({},M.data),Fi(M,C).resolve),null)))}(ve.route,F,M,T)),Zn(()=>X++),Zi(1),(0,Yn.zg)(ve=>X===B.length?ht(C):Mn))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Zn({next:()=>Nt=!0,complete:()=>{Nt||(this.restoreHistory(at),this.cancelNavigationTransition(at,"At least one route resolver didn't emit any value."))}}))}),Zn(at=>{const Nt=new he(at.id,this.serializeUrl(at.extractedUrl),this.serializeUrl(at.urlAfterRedirects),at.targetSnapshot);this.triggerEvent(Nt)}))}),Zs(Ie=>{const{targetSnapshot:at,id:Nt,extractedUrl:Kn,rawUrl:un,extras:{skipLocationChange:ar,replaceUrl:f}}=Ie;return this.hooks.afterPreactivation(at,{navigationId:Nt,appliedUrlTree:Kn,rawUrlTree:un,skipLocationChange:!!ar,replaceUrl:!!f})}),(0,Et.U)(Ie=>{const at=function(M,T,C){const F=Ji(M,T._root,C?C._root:void 0);return new Qa(F,T)}(this.routeReuseStrategy,Ie.targetSnapshot,Ie.currentRouterState);return Object.assign(Object.assign({},Ie),{targetRouterState:at})}),Zn(Ie=>{this.currentUrlTree=Ie.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(Ie.urlAfterRedirects,Ie.rawUrl),this.routerState=Ie.targetRouterState,"deferred"===this.urlUpdateStrategy&&(Ie.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,Ie),this.browserUrlTree=Ie.urlAfterRedirects)}),((M,T,C)=>(0,Et.U)(F=>(new wr(T,F.targetRouterState,F.currentRouterState,C).activate(M),F)))(this.rootContexts,this.routeReuseStrategy,Ie=>this.triggerEvent(Ie)),Zn({next(){X=!0},complete(){X=!0}}),function(M){return T=>T.lift(new Bn(M))}(()=>{var Ie;if(!X&&!ve){const at=`Navigation ID ${B.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(B),this.cancelNavigationTransition(B,at)):this.cancelNavigationTransition(B,at)}(null===(Ie=this.currentNavigation)||void 0===Ie?void 0:Ie.id)===B.id&&(this.currentNavigation=null)}),gn(Ie=>{if(ve=!0,function(M){return M&&M[Pe]}(Ie)){const at=wi(Ie.url);at||(this.navigated=!0,this.restoreHistory(B,!0));const Nt=new fi(B.id,this.serializeUrl(B.extractedUrl),Ie.message);F.next(Nt),at?setTimeout(()=>{const Kn=this.urlHandlingStrategy.merge(Ie.url,this.rawUrlTree),un={skipLocationChange:B.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ko(B.source)};this.scheduleNavigation(Kn,"imperative",null,un,{resolve:B.resolve,reject:B.reject,promise:B.promise})},0):B.resolve(!1)}else{this.restoreHistory(B,!0);const at=new Pn(B.id,this.serializeUrl(B.extractedUrl),Ie);F.next(at);try{B.resolve(this.errorHandler(Ie))}catch(Nt){B.reject(Nt)}}return Mn}))}))}resetRootComponentType(C){this.rootComponentType=C,this.routerState.root.component=this.rootComponentType}getTransition(){const C=this.transitions.value;return C.urlAfterRedirects=this.browserUrlTree,C}setTransition(C){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),C))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(C=>{const F=this.extractLocationChangeInfoFromEvent(C);this.shouldScheduleNavigation(this.lastLocationChangeInfo,F)&&setTimeout(()=>{const{source:B,state:X,urlTree:ve}=F,Ie={replaceUrl:!0};if(X){const at=Object.assign({},X);delete at.navigationId,delete at.\u0275routerPageId,0!==Object.keys(at).length&&(Ie.state=at)}this.scheduleNavigation(ve,B,X,Ie)},0),this.lastLocationChangeInfo=F}))}extractLocationChangeInfoFromEvent(C){var F;return{source:"popstate"===C.type?"popstate":"hashchange",urlTree:this.parseUrl(C.url),state:(null===(F=C.state)||void 0===F?void 0:F.navigationId)?C.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(C,F){if(!C)return!0;const B=F.urlTree.toString()===C.urlTree.toString();return F.transitionId!==C.transitionId||!B||!("hashchange"===F.source&&"popstate"===C.source||"popstate"===F.source&&"hashchange"===C.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(C){this.events.next(C)}resetConfig(C){mn(C),this.config=C.map(_c),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(C,F={}){const{relativeTo:B,queryParams:X,fragment:ve,queryParamsHandling:Ie,preserveFragment:at}=F,Nt=B||this.routerState.root,Kn=at?this.currentUrlTree.fragment:ve;let un=null;switch(Ie){case"merge":un=Object.assign(Object.assign({},this.currentUrlTree.queryParams),X);break;case"preserve":un=this.currentUrlTree.queryParams;break;default:un=X||null}return null!==un&&(un=this.removeEmptyProps(un)),function(M,T,C,F,B){if(0===C.length)return gs(T.root,T.root,T,F,B);const X=function(M){if("string"==typeof M[0]&&1===M.length&&"/"===M[0])return new ca(!0,0,M);let T=0,C=!1;const F=M.reduce((B,X,ve)=>{if("object"==typeof X&&null!=X){if(X.outlets){const Ie={};return Ct(X.outlets,(at,Nt)=>{Ie[Nt]="string"==typeof at?at.split("/"):at}),[...B,{outlets:Ie}]}if(X.segmentPath)return[...B,X.segmentPath]}return"string"!=typeof X?[...B,X]:0===ve?(X.split("/").forEach((Ie,at)=>{0==at&&"."===Ie||(0==at&&""===Ie?C=!0:".."===Ie?T++:""!=Ie&&B.push(Ie))}),B):[...B,X]},[]);return new ca(C,T,F)}(C);if(X.toRoot())return gs(T.root,new ye([],{}),T,F,B);const ve=function(M,T,C){if(M.isAbsolute)return new W(T.root,!0,0);if(-1===C.snapshot._lastPathIndex){const X=C.snapshot._urlSegment;return new W(X,X===T.root,0)}const F=Ln(M.commands[0])?0:1;return function(M,T,C){let F=M,B=T,X=C;for(;X>B;){if(X-=B,F=F.parent,!F)throw new Error("Invalid number of '../'");B=F.segments.length}return new W(F,!1,B-X)}(C.snapshot._urlSegment,C.snapshot._lastPathIndex+F,M.numberOfDoubleDots)}(X,T,M),Ie=ve.processChildren?pt(ve.segmentGroup,ve.index,X.commands):Je(ve.segmentGroup,ve.index,X.commands);return gs(ve.segmentGroup,Ie,T,F,B)}(Nt,this.currentUrlTree,C,un,null!=Kn?Kn:null)}navigateByUrl(C,F={skipLocationChange:!1}){const B=wi(C)?C:this.parseUrl(C),X=this.urlHandlingStrategy.merge(B,this.rawUrlTree);return this.scheduleNavigation(X,"imperative",null,F)}navigate(C,F={skipLocationChange:!1}){return function(M){for(let T=0;T<M.length;T++){const C=M[T];if(null==C)throw new Error(`The requested path contains ${C} segment at index ${T}`)}}(C),this.navigateByUrl(this.createUrlTree(C,F),F)}serializeUrl(C){return this.urlSerializer.serialize(C)}parseUrl(C){let F;try{F=this.urlSerializer.parse(C)}catch(B){F=this.malformedUriErrorHandler(B,this.urlSerializer,C)}return F}isActive(C,F){let B;if(B=!0===F?Object.assign({},ql):!1===F?Object.assign({},ma):F,wi(C))return Yi(this.currentUrlTree,C,B);const X=this.parseUrl(C);return Yi(this.currentUrlTree,X,B)}removeEmptyProps(C){return Object.keys(C).reduce((F,B)=>{const X=C[B];return null!=X&&(F[B]=X),F},{})}processNavigations(){this.navigations.subscribe(C=>{this.navigated=!0,this.lastSuccessfulId=C.id,this.currentPageId=C.targetPageId,this.events.next(new Co(C.id,this.serializeUrl(C.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,C.resolve(!0)},C=>{this.console.warn(`Unhandled Navigation Error: ${C}`)})}scheduleNavigation(C,F,B,X,ve){var Ie,at;if(this.disposed)return Promise.resolve(!1);const Nt=this.getTransition(),Kn=ko(F)&&Nt&&!ko(Nt.source),f=(this.lastSuccessfulId===Nt.id||this.currentNavigation?Nt.rawUrl:Nt.urlAfterRedirects).toString()===C.toString();if(Kn&&f)return Promise.resolve(!0);let r,c,p;ve?(r=ve.resolve,c=ve.reject,p=ve.promise):p=new Promise((D,A)=>{r=D,c=A});const y=++this.navigationId;let v;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(B=this.location.getState()),v=B&&B.\u0275routerPageId?B.\u0275routerPageId:X.replaceUrl||X.skipLocationChange?null!==(Ie=this.browserPageId)&&void 0!==Ie?Ie:0:(null!==(at=this.browserPageId)&&void 0!==at?at:0)+1):v=0,this.setTransition({id:y,targetPageId:v,source:F,restoredState:B,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:C,extras:X,resolve:r,reject:c,promise:p,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),p.catch(D=>Promise.reject(D))}setBrowserUrl(C,F){const B=this.urlSerializer.serialize(C),X=Object.assign(Object.assign({},F.extras.state),this.generateNgRouterState(F.id,F.targetPageId));this.location.isCurrentPathEqualTo(B)||F.extras.replaceUrl?this.location.replaceState(B,"",X):this.location.go(B,"",X)}restoreHistory(C,F=!1){var B,X;if("computed"===this.canceledNavigationResolution){const ve=this.currentPageId-C.targetPageId;"popstate"!==C.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(B=this.currentNavigation)||void 0===B?void 0:B.finalUrl)||0===ve?this.currentUrlTree===(null===(X=this.currentNavigation)||void 0===X?void 0:X.finalUrl)&&0===ve&&(this.resetState(C),this.browserUrlTree=C.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(ve)}else"replace"===this.canceledNavigationResolution&&(F&&this.resetState(C),this.resetUrlToCurrentUrlTree())}resetState(C){this.routerState=C.currentRouterState,this.currentUrlTree=C.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,C.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(C,F){const B=new fi(C.id,this.serializeUrl(C.extractedUrl),F);this.triggerEvent(B),C.resolve(!1)}generateNgRouterState(C,F){return"computed"===this.canceledNavigationResolution?{navigationId:C,\u0275routerPageId:F}:{navigationId:C}}}return M.\u0275fac=function(C){return new(C||M)(te.LFG(te.DyG),te.LFG(zt),te.LFG(Ti),te.LFG(fe.Ye),te.LFG(te.zs3),te.LFG(te.v3s),te.LFG(te.Sil),te.LFG(void 0))},M.\u0275prov=te.Yz7({token:M,factory:M.\u0275fac}),M})();function ko(M){return"imperative"!==M}let Xs=(()=>{class M{constructor(C,F,B,X,ve){this.router=C,this.route=F,this.commands=[],this.onChanges=new Ot.xQ,null==B&&X.setAttribute(ve.nativeElement,"tabindex","0")}ngOnChanges(C){this.onChanges.next(this)}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:[]}onClick(){const C={skipLocationChange:is(this.skipLocationChange),replaceUrl:is(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,C),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:is(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(te.Y36(Di),te.Y36(ps),te.$8M("tabindex"),te.Y36(te.Qsj),te.Y36(te.SBq))},M.\u0275dir=te.lG2({type:M,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(C,F){1&C&&te.NdJ("click",function(){return F.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[te.TTD]}),M})(),sl=(()=>{class M{constructor(C,F,B){this.router=C,this.route=F,this.locationStrategy=B,this.commands=[],this.onChanges=new Ot.xQ,this.subscription=C.events.subscribe(X=>{X instanceof Co&&this.updateTargetUrlAndHref()})}set routerLink(C){this.commands=null!=C?Array.isArray(C)?C:[C]:[]}ngOnChanges(C){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(C,F,B,X,ve){if(0!==C||F||B||X||ve||"string"==typeof this.target&&"_self"!=this.target)return!0;const Ie={skipLocationChange:is(this.skipLocationChange),replaceUrl:is(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,Ie),!1}updateTargetUrlAndHref(){this.href=this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree))}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:is(this.preserveFragment)})}}return M.\u0275fac=function(C){return new(C||M)(te.Y36(Di),te.Y36(ps),te.Y36(fe.S$))},M.\u0275dir=te.lG2({type:M,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(C,F){1&C&&te.NdJ("click",function(X){return F.onClick(X.button,X.ctrlKey,X.shiftKey,X.altKey,X.metaKey)}),2&C&&(te.Ikx("href",F.href,te.LSH),te.uIk("target",F.target))},inputs:{routerLink:"routerLink",target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[te.TTD]}),M})();function is(M){return""===M||!!M}let Ft=(()=>{class M{constructor(C,F,B,X,ve,Ie){this.router=C,this.element=F,this.renderer=B,this.cdr=X,this.link=ve,this.linkWithHref=Ie,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.routerEventsSubscription=C.events.subscribe(at=>{at instanceof Co&&this.update()})}ngAfterContentInit(){ht(this.links.changes,this.linksWithHrefs.changes,ht(null)).pipe((0,Tr.J)()).subscribe(C=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var C;null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe();const F=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(B=>!!B).map(B=>B.onChanges);this.linkInputChangesSubscription=(0,jt.D)(F).pipe((0,Tr.J)()).subscribe(B=>{this.isActive!==this.isLinkActive(this.router)(B)&&this.update()})}set routerLinkActive(C){const F=Array.isArray(C)?C:C.split(" ");this.classes=F.filter(B=>!!B)}ngOnChanges(C){this.update()}ngOnDestroy(){var C;this.routerEventsSubscription.unsubscribe(),null===(C=this.linkInputChangesSubscription)||void 0===C||C.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const C=this.hasActiveLinks();this.isActive!==C&&(this.isActive=C,this.cdr.markForCheck(),this.classes.forEach(F=>{C?this.renderer.addClass(this.element.nativeElement,F):this.renderer.removeClass(this.element.nativeElement,F)}))})}isLinkActive(C){const F=function(M){return!!M.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return B=>C.isActive(B.urlTree,F)}hasActiveLinks(){const C=this.isLinkActive(this.router);return this.link&&C(this.link)||this.linkWithHref&&C(this.linkWithHref)||this.links.some(C)||this.linksWithHrefs.some(C)}}return M.\u0275fac=function(C){return new(C||M)(te.Y36(Di),te.Y36(te.SBq),te.Y36(te.Qsj),te.Y36(te.sBO),te.Y36(Xs,8),te.Y36(sl,8))},M.\u0275dir=te.lG2({type:M,selectors:[["","routerLinkActive",""]],contentQueries:function(C,F,B){if(1&C&&(te.Suo(B,Xs,5),te.Suo(B,sl,5)),2&C){let X;te.iGM(X=te.CRH())&&(F.links=X),te.iGM(X=te.CRH())&&(F.linksWithHrefs=X)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},exportAs:["routerLinkActive"],features:[te.TTD]}),M})(),ga=(()=>{class M{constructor(C,F,B,X,ve){this.parentContexts=C,this.location=F,this.resolver=B,this.changeDetector=ve,this.activated=null,this._activatedRoute=null,this.activateEvents=new te.vpe,this.deactivateEvents=new te.vpe,this.name=X||je,C.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const C=this.parentContexts.getContext(this.name);C&&C.route&&(C.attachRef?this.attach(C.attachRef,C.route):this.activateWith(C.route,C.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const C=this.activated;return this.activated=null,this._activatedRoute=null,C}attach(C,F){this.activated=C,this._activatedRoute=F,this.location.insert(C.hostView)}deactivate(){if(this.activated){const C=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(C)}}activateWith(C,F){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=C;const ve=(F=F||this.resolver).resolveComponentFactory(C._futureSnapshot.routeConfig.component),Ie=this.parentContexts.getOrCreateContext(this.name).children,at=new _a(C,Ie,this.location.injector);this.activated=this.location.createComponent(ve,this.location.length,at),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return M.\u0275fac=function(C){return new(C||M)(te.Y36(Ti),te.Y36(te.s_b),te.Y36(te._Vd),te.$8M("name"),te.Y36(te.sBO))},M.\u0275dir=te.lG2({type:M,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),M})();class _a{constructor(T,C,F){this.route=T,this.childContexts=C,this.parent=F}get(T,C){return T===ps?this.route:T===Ti?this.childContexts:this.parent.get(T,C)}}class Ds{}class Dc{preload(T,C){return ht(null)}}let Zl=(()=>{class M{constructor(C,F,B,X,ve){this.router=C,this.injector=X,this.preloadingStrategy=ve,this.loader=new Oi(F,B,Nt=>C.triggerEvent(new be(Nt)),Nt=>C.triggerEvent(new Le(Nt)))}setUpPreloading(){this.subscription=this.router.events.pipe(Sn(C=>C instanceof Co),Xr(()=>this.preload())).subscribe(()=>{})}preload(){const C=this.injector.get(te.h0i);return this.processRoutes(C,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(C,F){const B=[];for(const X of F)if(X.loadChildren&&!X.canLoad&&X._loadedConfig){const ve=X._loadedConfig;B.push(this.processRoutes(ve.module,ve.routes))}else X.loadChildren&&!X.canLoad?B.push(this.preloadConfig(C,X)):X.children&&B.push(this.processRoutes(C,X.children));return(0,jt.D)(B).pipe((0,Tr.J)(),(0,Et.U)(X=>{}))}preloadConfig(C,F){return this.preloadingStrategy.preload(F,()=>(F._loadedConfig?ht(F._loadedConfig):this.loader.load(C.injector,F)).pipe((0,Yn.zg)(X=>(F._loadedConfig=X,this.processRoutes(X.module,X.routes)))))}}return M.\u0275fac=function(C){return new(C||M)(te.LFG(Di),te.LFG(te.v3s),te.LFG(te.Sil),te.LFG(te.zs3),te.LFG(Ds))},M.\u0275prov=te.Yz7({token:M,factory:M.\u0275fac}),M})(),ll=(()=>{class M{constructor(C,F,B={}){this.router=C,this.viewportScroller=F,this.options=B,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},B.scrollPositionRestoration=B.scrollPositionRestoration||"disabled",B.anchorScrolling=B.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(C=>{C instanceof Xi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=C.navigationTrigger,this.restoredId=C.restoredState?C.restoredState.navigationId:0):C instanceof Co&&(this.lastId=C.id,this.scheduleScrollEvent(C,this.router.parseUrl(C.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(C=>{C instanceof yt&&(C.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(C.position):C.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(C.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(C,F){this.router.triggerEvent(new yt(C,"popstate"===this.lastSource?this.store[this.restoredId]:null,F))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return M.\u0275fac=function(C){return new(C||M)(te.LFG(Di),te.LFG(fe.EM),te.LFG(void 0))},M.\u0275prov=te.Yz7({token:M,factory:M.\u0275fac}),M})();const Fo=new te.OlP("ROUTER_CONFIGURATION"),Ic=new te.OlP("ROUTER_FORROOT_GUARD"),Is=[fe.Ye,{provide:zt,useClass:Fn},{provide:Di,useFactory:function(M,T,C,F,B,X,ve,Ie={},at,Nt){const Kn=new Di(null,M,T,C,F,B,X,uo(ve));return at&&(Kn.urlHandlingStrategy=at),Nt&&(Kn.routeReuseStrategy=Nt),function(M,T){M.errorHandler&&(T.errorHandler=M.errorHandler),M.malformedUriErrorHandler&&(T.malformedUriErrorHandler=M.malformedUriErrorHandler),M.onSameUrlNavigation&&(T.onSameUrlNavigation=M.onSameUrlNavigation),M.paramsInheritanceStrategy&&(T.paramsInheritanceStrategy=M.paramsInheritanceStrategy),M.relativeLinkResolution&&(T.relativeLinkResolution=M.relativeLinkResolution),M.urlUpdateStrategy&&(T.urlUpdateStrategy=M.urlUpdateStrategy)}(Ie,Kn),Ie.enableTracing&&Kn.events.subscribe(un=>{var ar,f;null===(ar=console.group)||void 0===ar||ar.call(console,`Router Event: ${un.constructor.name}`),console.log(un.toString()),console.log(un),null===(f=console.groupEnd)||void 0===f||f.call(console)}),Kn},deps:[zt,Ti,fe.Ye,te.zs3,te.v3s,te.Sil,ol,Fo,[class{},new te.FiY],[class{},new te.FiY]]},Ti,{provide:ps,useFactory:function(M){return M.routerState.root},deps:[Di]},{provide:te.v3s,useClass:te.EAV},Zl,Dc,class{preload(T,C){return C().pipe(gn(()=>ht(null)))}},{provide:Fo,useValue:{enableTracing:!1}}];function Ys(){return new te.PXZ("Router",Di)}let Sc=(()=>{class M{constructor(C,F){}static forRoot(C,F){return{ngModule:M,providers:[Is,Yl(C),{provide:Ic,useFactory:Ks,deps:[[Di,new te.FiY,new te.tp0]]},{provide:Fo,useValue:F||{}},{provide:fe.S$,useFactory:Xl,deps:[fe.lw,[new te.tBr(fe.mr),new te.FiY],Fo]},{provide:ll,useFactory:Ac,deps:[Di,fe.EM,Fo]},{provide:Ds,useExisting:F&&F.preloadingStrategy?F.preloadingStrategy:Dc},{provide:te.PXZ,multi:!0,useFactory:Ys},[Ss,{provide:te.ip1,multi:!0,useFactory:ya,deps:[Ss]},{provide:ul,useFactory:As,deps:[Ss]},{provide:te.tb,multi:!0,useExisting:ul}]]}}static forChild(C){return{ngModule:M,providers:[Yl(C)]}}}return M.\u0275fac=function(C){return new(C||M)(te.LFG(Ic,8),te.LFG(Di,8))},M.\u0275mod=te.oAB({type:M}),M.\u0275inj=te.cJS({}),M})();function Ac(M,T,C){return C.scrollOffset&&T.setOffset(C.scrollOffset),new ll(M,T,C)}function Xl(M,T,C={}){return C.useHash?new fe.Do(M,T):new fe.b0(M,T)}function Ks(M){return"guarded"}function Yl(M){return[{provide:te.deG,multi:!0,useValue:M},{provide:ol,multi:!0,useValue:M}]}let Ss=(()=>{class M{constructor(C){this.injector=C,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Ot.xQ}appInitializer(){return this.injector.get(fe.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let F=null;const B=new Promise(Ie=>F=Ie),X=this.injector.get(Di),ve=this.injector.get(Fo);return"disabled"===ve.initialNavigation?(X.setUpLocationChangeListener(),F(!0)):"enabled"===ve.initialNavigation||"enabledBlocking"===ve.initialNavigation?(X.hooks.afterPreactivation=()=>this.initNavigation?ht(null):(this.initNavigation=!0,F(!0),this.resultOfPreactivationDone),X.initialNavigation()):F(!0),B})}bootstrapListener(C){const F=this.injector.get(Fo),B=this.injector.get(Zl),X=this.injector.get(ll),ve=this.injector.get(Di),Ie=this.injector.get(te.z2F);C===Ie.components[0]&&(("enabledNonBlocking"===F.initialNavigation||void 0===F.initialNavigation)&&ve.initialNavigation(),B.setUpPreloading(),X.init(),ve.resetRootComponentType(Ie.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return M.\u0275fac=function(C){return new(C||M)(te.LFG(te.zs3))},M.\u0275prov=te.Yz7({token:M,factory:M.\u0275fac}),M})();function ya(M){return M.appInitializer.bind(M)}function As(M){return M.bootstrapListener.bind(M)}const ul=new te.OlP("Router Initializer")},958:function(qn){qn.exports=function(){"use strict";var Bt,Ge,fe;function te(d,Zt){if(Bt)if(Ge){var ht="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Bt+")(sharedChunk); ("+Ge+")(sharedChunk); self.onerror = null;",Ot={};Bt(Ot),fe=Zt(Ot),"undefined"!=typeof window&&(fe.workerUrl=window.URL.createObjectURL(new Blob([ht],{type:"text/javascript"})))}else Ge=Zt;else Bt=Zt}return te(0,function(d){var ht=Ot;function Ot(i,e,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=s,this.p2y=l}Ot.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Ot.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Ot.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Ot.prototype.solveCurveX=function(i,e){var s,l,h,m,_;for(void 0===e&&(e=1e-6),h=i,_=0;_<8;_++){if(m=this.sampleCurveX(h)-i,Math.abs(m)<e)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=m/x}if((h=i)<(s=0))return s;if(h>(l=1))return l;for(;s<l;){if(m=this.sampleCurveX(h),Math.abs(m-i)<e)return h;i>m?s=h:l=h,h=.5*(l-s)+s}return h},Ot.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var Ve=Me;function Me(i,e){this.x=i,this.y=e}Me.prototype={clone:function(){return new Me(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),l=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=l,this},_rotateAround:function(i,e){var s=Math.cos(i),l=Math.sin(i),h=e.y+l*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Me.convert=function(i){return i instanceof Me?i:Array.isArray(i)?new Me(i[0],i[1]):i};var Se="undefined"!=typeof self?self:{};const We=Math.pow(2,53)-1,st=Math.PI/180,bt=180/Math.PI;function ut(i){return i*st}function St(i){return i*bt}const ct=[[0,0],[1,0],[1,1],[0,1]];function dn(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,s=e*i;return 4*(i<.5?s:3*(i-e)+s-.75)}function Vn(i,e,s,l){const h=new ht(i,e,s,l);return function(m){return h.solve(m)}}const nn=Vn(.25,.1,.25,1);function _t(i,e,s){return Math.min(s,Math.max(e,i))}function ii(i,e,s){const l=s-e,h=((i-e)%l+l)%l+e;return h===e?s:h}function Ai(i,e,s){if(!i.length)return s(null,[]);let l=i.length;const h=new Array(i.length);let m=null;i.forEach((_,x)=>{e(_,(w,I)=>{w&&(m=w),h[x]=I,0==--l&&s(m,h)})})}function Tr(i){const e=[];for(const s in i)e.push(i[s]);return e}function Pr(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}let bo=1;function jt(){return bo++}function Mn(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function or(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Xn(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function cn(i,e){i.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function zn(i,e){return-1!==i.indexOf(e,i.length-e.length)}function Et(i,e,s){const l={};for(const h in i)l[h]=e.call(s||this,i[h],h,i);return l}function Zr(i,e,s){const l={};for(const h in i)e.call(s||this,i[h],h,i)&&(l[h]=i[h]);return l}function sr(i){return Array.isArray(i)?i.map(sr):"object"==typeof i&&i?Et(i,sr):i}const jo={};function Nn(i){jo[i]||("undefined"!=typeof console&&console.warn(i),jo[i]=!0)}function Ni(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function ds(i){let e=0;for(let s,l,h=0,m=i.length,_=m-1;h<m;_=h++)s=i[h],l=i[_],e+=(l.x-s.x)*(s.y+l.y);return e}function Bi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function fs(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,m)=>{const _=h||m;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let lo,Tn,yi,Wr=null;function Ur(i){if(null==Wr){const e=i.navigator?i.navigator.userAgent:null;Wr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Wr}function Sn(i){try{const e=Se[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const vi={now:()=>void 0!==yi?yi:Se.performance.now(),setNow(i){yi=i},restoreNow(){yi=void 0},frame(i){const e=Se.requestAnimationFrame(i);return{cancel:()=>Se.cancelAnimationFrame(e)}},getImageData(i,e=0){const s=Se.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(lo||(lo=Se.document.createElement("a")),lo.href=i,lo.href),get devicePixelRatio(){return Se.devicePixelRatio},get prefersReducedMotion(){return!!Se.matchMedia&&(null==Tn&&(Tn=Se.matchMedia("(prefers-reduced-motion: reduce)")),Tn.matches)}};let ra;const gn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ra){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ra=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(e){ra=i}}return ra},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},mr={supported:!1,testSupport:function(i){!Xr&&Yn&&(Zi?Lr(i):wo=i)}};let wo,Yn,Xr=!1,Zi=!1;function Lr(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Yn),i.isContextLost())return;mr.supported=!0}catch(s){}i.deleteTexture(e),Xr=!0}Se.document&&(Yn=Se.document.createElement("img"),Yn.onload=function(){wo&&Lr(wo),wo=null,Zi=!0},Yn.onerror=function(){Xr=!0,wo=null},Yn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const co="01",Eo="NO_ACCESS_TOKEN";function ai(i){return 0===i.indexOf("mapbox:")}function Wi(i){return gn.API_URL_REGEX.test(i)}const Ns=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Yr(i){const e=i.match(Ns);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function $t(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function ur(i){if(!i)return null;const e=i.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Se.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class Xt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=ur(gn.ACCESS_TOKEN);let l="";return l=s&&s.u?Se.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):gn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const e=Sn("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const h=Se.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const m=Se.localStorage.getItem(l);m&&(this.anonId=m)}catch(h){Nn("Unable to read from LocalStorage")}}saveEventData(){const e=Sn("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{Se.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Se.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(h){Nn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,l,h){if(!gn.EVENTS_URL)return;const m=Yr(gn.EVENTS_URL);m.params.push(`access_token=${h||gn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:co,userId:this.anonId},x=s?Pr(_,s):_,w={url:$t(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=ae(w,I=>{this.pendingRequest=null,l(I),this.saveEventData(),this.processRequests(h)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const Qt=new class extends Xt{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){gn.EVENTS_URL&&gn.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>ai(s)||Wi(s))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ur(gn.ACCESS_TOKEN),s=e?e.u:gn.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;Xn(this.anonId)||(this.anonId=Mn(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||m.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},i)}},Mi=Qt.postTurnstileEvent.bind(Qt),di=new class extends Xt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,s,l){this.skuToken=e,this.errorCb=l,gn.EVENTS_URL&&(s||gn.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(Eo)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xn(this.anonId)||(this.anonId=Mn()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i))}},Kr=di.postMapLoadEvent.bind(di),Zn=new class extends Xt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,s,l){if(!gn.API_URL||!gn.SESSION_PATH)return;const h=Yr(gn.API_URL+gn.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${l||gn.ACCESS_TOKEN||""}`);const m={url:$t(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=he(m,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(i,e,s,l){this.skuToken=e,this.errorCb=l,gn.SESSION_PATH&&gn.API_URL&&(s||gn.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(Eo)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i)}},Pi=Zn.getSessionAPI.bind(Zn),$o=new Set,yn="mapbox-tiles";let Ri,Bn,Bs=500,Vi=50;function Dn(){Se.caches&&!Ri&&(Ri=Se.caches.open(yn))}function Xi(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let Co=1/0;const fi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(fi);class Pn extends Error{constructor(e,s,l){401===s&&Wi(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ie=Bi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Se.location.protocol?Se.parent:Se).location.href,$=function(i,e){if(!(/^file:/.test(s=i.url)||/^file:/.test(ie())&&!/^\w+:/.test(s))){if(Se.fetch&&Se.Request&&Se.AbortController&&Se.Request.prototype.hasOwnProperty("signal"))return function(l,h){const m=new Se.AbortController,_=new Se.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:ie(),signal:m.signal});let x=!1,w=!1;const I=(P=_.url).indexOf("sku=")>0&&Wi(P);var P;"json"===l.type&&_.headers.set("Accept","application/json");const R=(G,Z,Q)=>{if(w)return;if(G&&"SecurityError"!==G.message&&Nn(G),Z&&Q)return O(Z);const ce=Date.now();Se.fetch(_).then(me=>{if(me.ok){const xe=I?me.clone():null;return O(me,xe,ce)}return h(new Pn(me.statusText,me.status,l.url))}).catch(me=>{20!==me.code&&h(new Error(me.message))})},O=(G,Z,Q)=>{("arrayBuffer"===l.type?G.arrayBuffer():"json"===l.type?G.json():G.text()).then(ce=>{w||(Z&&Q&&function(me,xe,Ae){if(Dn(),!Ri)return;const Re={status:xe.status,statusText:xe.statusText,headers:new Se.Headers};xe.headers.forEach((ze,it)=>Re.headers.set(it,ze));const Fe=fs(xe.headers.get("Cache-Control")||"");Fe["no-store"]||(Fe["max-age"]&&Re.headers.set("Expires",new Date(Ae+1e3*Fe["max-age"]).toUTCString()),new Date(Re.headers.get("Expires")).getTime()-Ae<42e4||function(ze,it){if(void 0===Bn)try{new Response(new ReadableStream),Bn=!0}catch(Qe){Bn=!1}Bn?it(ze.body):ze.blob().then(it)}(xe,ze=>{const it=new Se.Response(ze,Re);Dn(),Ri&&Ri.then(Qe=>Qe.put(Xi(me.url),it)).catch(Qe=>Nn(Qe.message))}))}(_,Z,Q),x=!0,h(null,ce,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(ce=>{w||h(new Error(ce.message))})};return I?function(G,Z){if(Dn(),!Ri)return Z(null);const Q=Xi(G.url);Ri.then(ce=>{ce.match(Q).then(me=>{const xe=function(Ae){if(!Ae)return!1;const Re=new Date(Ae.headers.get("Expires")||0),Fe=fs(Ae.headers.get("Cache-Control")||"");return Re>Date.now()&&!Fe["no-cache"]}(me);ce.delete(Q),xe&&ce.put(Q,me.clone()),Z(null,me,xe)}).catch(Z)}).catch(Z)}(_,R):R(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(i,e);if(Bi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(l,h){const m=new Se.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===l.type)try{_=JSON.parse(m.response)}catch(x){return h(x)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new Pn(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(i,e)},q=function(i,e){return $(Pr(i,{type:"arrayBuffer"}),e)},ae=function(i,e){return $(Pr(i,{method:"POST"}),e)},he=function(i,e){return $(Pr(i,{method:"GET"}),e)};function be(i){const e=Se.document.createElement("a");return e.href=i,e.protocol===Se.document.location.protocol&&e.host===Se.document.location.host}const Le="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oe,Ee;Oe=[],Ee=0;const Be=function(i,e){if(mr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ee>=gn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oe.push(m),m}Ee++;let s=!1;const l=()=>{if(!s)for(s=!0,Ee--;Oe.length&&Ee<gn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Oe.shift(),{requestParameters:_,callback:x,cancelled:w}=m;w||(m.cancel=Be(_,x).cancel)}},h=q(i,(m,_,x,w)=>{l(),m?e(m):_&&(Se.createImageBitmap?function(I,P){const R=new Se.Blob([new Uint8Array(I)],{type:"image/png"});Se.createImageBitmap(R).then(O=>{P(null,O)}).catch(O=>{P(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(I,P)=>e(I,P,x,w)):function(I,P){const R=new Se.Image,O=Se.URL;R.onload=()=>{P(null,R),O.revokeObjectURL(R.src),R.onload=null,Se.requestAnimationFrame(()=>{R.src=Le})},R.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new Se.Blob([new Uint8Array(I)],{type:"image/png"});R.src=I.byteLength?O.createObjectURL(G):Le}(_,(I,P)=>e(I,P,x,w)))});return{cancel:()=>{h.cancel(),l()}}};function tt(i,e,s){s[i]&&-1!==s[i].indexOf(e)||(s[i]=s[i]||[],s[i].push(e))}function yt(i,e,s){if(s&&s[i]){const l=s[i].indexOf(e);-1!==l&&s[i].splice(l,1)}}class je{constructor(e,s={}){Pr(this,s),this.type=e}}class Ut extends je{constructor(e,s={}){super("error",Pr({error:e},s))}}class gt{on(e,s){return this._listeners=this._listeners||{},tt(e,s,this._listeners),this}off(e,s){return yt(e,s,this._listeners),yt(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},tt(e,s,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,s){"string"==typeof e&&(e=new je(e,s||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of m)yt(l,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(Pr(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Ut&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var Pe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ye{constructor(e,s,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),null!=s&&s.__line__&&(this.line=s.__line__)}}function bn(i){const e=i.value;return e?[new Ye(i.key,e,"constants have been deprecated as of v8")]:[]}function sn(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}function Wt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function en(i){if(Array.isArray(i))return i.map(en);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=en(i[s]);return e}return Wt(i)}class an extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class uo{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(e){return new uo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Dr={kind:"null"},$e={kind:"number"},Ct={kind:"string"},Rt={kind:"boolean"},wn={kind:"color"},pi={kind:"object"},Ht={kind:"value"},Yi={kind:"collator"},Qn={kind:"formatted"},Ui={kind:"resolvedImage"};function jr(i,e){return{kind:"array",itemType:i,N:e}}function Vt(i){if("array"===i.kind){const e=Vt(i.itemType);return"number"==typeof i.N?`array<${e}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${e}>`}return i.kind}const Go=[Dr,$e,Ct,Rt,wn,Qn,pi,jr(Ht),Ui];function Qr(i,e){if("error"===e.kind)return null;if("array"===i.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qr(i.itemType,e.itemType))&&("number"!=typeof i.N||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if("value"===i.kind)for(const s of Go)if(!Qr(s,e))return null}return`Expected ${Vt(i)} but found ${Vt(e)} instead.`}function De(i,e){return e.some(s=>s.kind===i.kind)}function ye(i,e){return e.some(s=>"null"===s?null===i:"array"===s?Array.isArray(i):"object"===s?i&&!Array.isArray(i)&&"object"==typeof i:s===typeof i)}function ue(i){var e={exports:{}};return i(e,e.exports),e.exports}var Ne=ue(function(i,e){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return l("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function m(x){return(w="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function _(x,w,I){return I<0?I+=1:I>1&&(I-=1),6*I<1?x+(w-x)*I*6:2*I<1?w:3*I<2?x+(w-x)*(2/3-I)*6:x}try{e.parseCSSColor=function(x){var w,I=x.replace(/ /g,"").toLowerCase();if(I in s)return s[I].slice();if("#"===I[0])return 4===I.length?(w=parseInt(I.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===I.length&&(w=parseInt(I.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var P=I.indexOf("("),R=I.indexOf(")");if(-1!==P&&R+1===I.length){var O=I.substr(0,P),G=I.substr(P+1,R-(P+1)).split(","),Z=1;switch(O){case"rgba":if(4!==G.length)return null;Z=m(G.pop());case"rgb":return 3!==G.length?null:[h(G[0]),h(G[1]),h(G[2]),Z];case"hsla":if(4!==G.length)return null;Z=m(G.pop());case"hsl":if(3!==G.length)return null;var Q=(parseFloat(G[0])%360+360)%360/360,ce=m(G[1]),me=m(G[2]),xe=me<=.5?me*(ce+1):me+ce-me*ce,Ae=2*me-xe;return[l(255*_(Ae,xe,Q+1/3)),l(255*_(Ae,xe,Q)),l(255*_(Ae,xe,Q-1/3)),Z];default:return null}}return null}}catch(x){}});class qe{constructor(e,s,l,h=1){this.r=e,this.g=s,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof qe)return e;if("string"!=typeof e)return;const s=Ne.parseCSSColor(e);return s?new qe(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,l,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(l)},${h})`}toArray(){const{r:e,g:s,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*s/h,255*l/h,h]}}qe.black=new qe(0,0,0,1),qe.white=new qe(1,1,1,1),qe.transparent=new qe(0,0,0,0),qe.red=new qe(1,0,0,1),qe.blue=new qe(0,0,1,1);class Gt{constructor(e,s,l){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zt{constructor(e,s,l,h,m){this.text=e,this.image=s,this.scale=l,this.fontStack=h,this.textColor=m}}class Fn{constructor(e){this.sections=e}static fromString(e){return new Fn([new zt(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Fn?e:Fn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(l)}return e}}class xr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new xr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ki(i,e,s,l){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[i,e,s,l]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function To(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof qe||i instanceof Gt||i instanceof Fn||i instanceof xr)return!0;if(Array.isArray(i)){for(const e of i)if(!To(e))return!1;return!0}if("object"==typeof i){for(const e in i)if(!To(i[e]))return!1;return!0}return!1}function hr(i){if(null===i)return Dr;if("string"==typeof i)return Ct;if("boolean"==typeof i)return Rt;if("number"==typeof i)return $e;if(i instanceof qe)return wn;if(i instanceof Gt)return Yi;if(i instanceof Fn)return Qn;if(i instanceof xr)return Ui;if(Array.isArray(i)){const e=i.length;let s;for(const l of i){const h=hr(l);if(s){if(s===h)continue;s=Ht;break}s=h}return jr(s||Ht,e)}return pi}function ji(i){const e=typeof i;return null===i?"":"string"===e||"number"===e||"boolean"===e?String(i):i instanceof qe||i instanceof Fn||i instanceof xr?i.toString():JSON.stringify(i)}class Qi{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(2!==e.length)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!To(e[1]))return s.error("invalid value");const l=e[1];let h=hr(l);const m=s.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Qi(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof qe?["rgba"].concat(this.value.toArray()):this.value instanceof Fn?this.value.serialize():this.value}}class fn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Vs={string:Ct,number:$e,boolean:Rt,object:pi};class Or{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l,h=1;const m=e[0];if("array"===m){let x,w;if(e.length>2){const I=e[1];if("string"!=typeof I||!(I in Vs)||"object"===I)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Vs[I],h++}else x=Ht;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=jr(x,w)}else l=Vs[m];const _=[];for(;h<e.length;h++){const x=s.parse(e[h],h,Ht);if(!x)return null;_.push(x)}return new Or(l,_)}evaluate(e){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(e);if(!Qr(this.type,hr(l)))return l;if(s===this.args.length-1)throw new fn(`Expected value to be of type ${Vt(this.type)}, but found ${Vt(hr(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if("array"===e.kind){const l=e.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class mi{constructor(e){this.type=Qn,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=s.parse(x["font-scale"],1,$e),!w))return null;let I=null;if(x["text-font"]&&(I=s.parse(x["text-font"],1,jr(Ct)),!I))return null;let P=null;if(x["text-color"]&&(P=s.parse(x["text-color"],1,wn),!P))return null;const R=h[h.length-1];R.scale=w,R.font=I,R.textColor=P}else{const w=s.parse(e[_],1,Ht);if(!w)return null;const I=w.type.kind;if("string"!==I&&"value"!==I&&"null"!==I&&"resolvedImage"!==I)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new mi(h)}evaluate(e){return new Fn(this.sections.map(s=>{const l=s.content.evaluate(e);return hr(l)===Ui?new zt("",l,null,null,null):new zt(ji(l),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),e.push(l)}return e}}class Us{constructor(e){this.type=Ui,this.input=e}static parse(e,s){if(2!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Ct);return l?new Us(l):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),l=xr.fromString(s);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(s)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ia={"to-boolean":Rt,"to-color":wn,"to-number":$e,"to-string":Ct};class ho{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[0];if(("to-boolean"===l||"to-string"===l)&&2!==e.length)return s.error("Expected one argument.");const h=Ia[l],m=[];for(let _=1;_<e.length;_++){const x=s.parse(e[_],_,Ht);if(!x)return null;m.push(x)}return new ho(h,m)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let s,l;for(const h of this.args){if(s=h.evaluate(e),l=null,s instanceof qe)return s;if("string"==typeof s){const m=e.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Ki(s[0],s[1],s[2],s[3]),!l))return new qe(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new fn(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(e),null===s)return 0;const h=Number(s);if(!isNaN(h))return h}throw new fn(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Fn.fromString(ji(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?xr.fromString(ji(this.args[0].evaluate(e))):ji(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new mi([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Us(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const ki=["Unknown","Point","LineString","Polygon"];class Ka{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ki[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-e[0])+this.featureDistanceData.bearing[1]*(h*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=qe.parse(e)),s}}class xi{constructor(e,s,l,h){this.name=e,this.type=s,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const l=e[0],h=xi.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([I])=>!Array.isArray(I)||I.length===e.length-1);let w=null;for(const[I,P]of x){w=new sa(s.registry,s.path,null,s.scope);const R=[];let O=!1;for(let G=1;G<e.length;G++){const Z=e[G],Q=Array.isArray(I)?I[G-1]:I.type,ce=w.parse(Z,1+R.length,Q);if(!ce){O=!0;break}R.push(ce)}if(!O)if(Array.isArray(I)&&I.length!==R.length)w.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let G=0;G<R.length;G++){const Z=Array.isArray(I)?I[G]:I.type,Q=R[G];w.concat(G+1).checkSubtype(Z,Q.type)}if(0===w.errors.length)return new xi(l,m,P,R)}}if(1===x.length)s.errors.push(...w.errors);else{const I=(x.length?x:_).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(Vt).join(", ")})`:`(${Vt(O.type)}...)`;var O}).join(" | "),P=[];for(let R=1;R<e.length;R++){const O=s.parse(e[R],1+P.length);if(!O)return null;P.push(Vt(O.type))}s.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(e,s){xi.definitions=s;for(const l in s)e[l]=xi}}class Sa{constructor(e,s,l){this.type=Yi,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(2!==e.length)return s.error("Expected one argument.");const l=e[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,Rt);if(!h)return null;const m=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,Rt);if(!m)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,Ct),!_)?null:new Sa(h,m,_)}evaluate(e){return new Gt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const es=8192;function Pl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function Aa(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Rl(i,e){const s=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(s*h*es),Math.round(l*h*es)]}function kl(i,e,s){const l=i[0]-e[0],h=i[1]-e[1],m=i[0]-s[0],_=i[1]-s[1];return l*_-m*h==0&&l*m<=0&&h*_<=0}function fo(i,e){let s=!1;for(let _=0,x=e.length;_<x;_++){const w=e[_];for(let I=0,P=w.length;I<P-1;I++){if(kl(i,w[I],w[I+1]))return!1;(h=w[I])[1]>(l=i)[1]!=(m=w[I+1])[1]>l[1]&&l[0]<(m[0]-h[0])*(l[1]-h[1])/(m[1]-h[1])+h[0]&&(s=!s)}}var l,h,m;return s}function ts(i,e){for(let s=0;s<e.length;s++)if(fo(i,e[s]))return!0;return!1}function Qa(i,e,s,l){const h=l[0]-s[0],m=l[1]-s[1],_=(i[0]-s[0])*m-h*(i[1]-s[1]),x=(e[0]-s[0])*m-h*(e[1]-s[1]);return _>0&&x<0||_<0&&x>0}function mc(i,e,s){for(const I of s)for(let P=0;P<I.length-1;++P)if((x=[(_=I[P+1])[0]-(m=I[P])[0],_[1]-m[1]])[0]*(w=[(h=e)[0]-(l=i)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&Qa(l,h,m,_)&&Qa(m,_,l,h))return!0;var l,h,m,_,x,w;return!1}function gc(i,e){for(let s=0;s<i.length;++s)if(!fo(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if(mc(i[s],i[s+1],e))return!1;return!0}function ps(i,e){for(let s=0;s<e.length;s++)if(gc(i,e[s]))return!0;return!1}function Fi(i,e,s){const l=[];for(let h=0;h<i.length;h++){const m=[];for(let _=0;_<i[h].length;_++){const x=Rl(i[h][_],s);Pl(e,x),m.push(x)}l.push(m)}return l}function Fl(i,e,s){const l=[];for(let h=0;h<i.length;h++){const m=Fi(i[h],e,s);l.push(m)}return l}function Ma(i,e,s,l){if(i[0]<s[0]||i[0]>s[2]){const h=.5*l;let m=i[0]-s[0]>h?-l:s[0]-i[0]>h?l:0;0===m&&(m=i[0]-s[2]>h?-l:s[2]-i[0]>h?l:0),i[0]+=m}Pl(e,i)}function ia(i,e,s,l){const h=Math.pow(2,l.z)*es,m=[l.x*es,l.y*es],_=[];for(const x of i)for(const w of x){const I=[w.x+m[0],w.y+m[1]];Ma(I,e,s,h),_.push(I)}return _}function Do(i,e,s,l){const h=Math.pow(2,l.z)*es,m=[l.x*es,l.y*es],_=[];for(const w of i){const I=[];for(const P of w){const R=[P.x+m[0],P.y+m[1]];Pl(e,R),I.push(R)}_.push(I)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const I of w)Ma(I,e,s,h)}var x;return _}class po{constructor(e,s){this.type=Rt,this.geojson=e,this.geometries=s}static parse(e,s){if(2!==e.length)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(To(e[1])){const l=e[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const m=l.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new po(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new po(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new po(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const x=Fi(l.coordinates,m,_),w=ia(s.geometry(),h,m,_);if(!Aa(h,m))return!1;for(const I of w)if(!fo(I,x))return!1}if("MultiPolygon"===l.type){const x=Fl(l.coordinates,m,_),w=ia(s.geometry(),h,m,_);if(!Aa(h,m))return!1;for(const I of w)if(!ts(I,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const x=Fi(l.coordinates,m,_),w=Do(s.geometry(),h,m,_);if(!Aa(h,m))return!1;for(const I of w)if(!gc(I,x))return!1}if("MultiPolygon"===l.type){const x=Fl(l.coordinates,m,_),w=Do(s.geometry(),h,m,_);if(!Aa(h,m))return!1;for(const I of w)if(!ps(I,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ms(i){if(i instanceof xi&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof po)return!1;let e=!0;return i.eachChild(s=>{e&&!ms(s)&&(e=!1)}),e}function oa(i){if(i instanceof xi&&"feature-state"===i.name)return!1;let e=!0;return i.eachChild(s=>{e&&!oa(s)&&(e=!1)}),e}function Un(i,e){if(i instanceof xi&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(l=>{s&&!Un(l,e)&&(s=!1)}),s}class Ji{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(2!==e.length||"string"!=typeof e[1])return s.error("'var' expression requires exactly one string literal argument.");const l=e[1];return s.scope.has(l)?new Ji(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class sa{constructor(e,s=[],l,h=new uo,m=[]){this.registry=e,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=l}parse(e,s,l,h,m={}){return s?this.concat(s,l,h)._parse(e,m):this._parse(e,m)}_parse(e,s){function l(h,m,_){return"assert"===_?new Or(m,[h]):"coerce"===_?new ho(m,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else _=l(_,x,s.typeAnnotation||"coerce");else _=l(_,x,s.typeAnnotation||"assert")}if(!(_ instanceof Qi)&&"resolvedImage"!==_.type.kind&&Pa(_)){const x=new Ka;try{_=new Qi(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,l){const h="number"==typeof e?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new sa(this.registry,h,s||null,m,this.errors)}error(e,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new an(l,e))}checkSubtype(e,s){const l=Qr(e,s);return l&&this.error(l),l}}function Pa(i){if(i instanceof Ji)return Pa(i.boundExpression);if(i instanceof xi&&"error"===i.name||i instanceof Sa||i instanceof po)return!1;const e=i instanceof ho||i instanceof Or;let s=!0;return i.eachChild(l=>{s=e?s&&Pa(l):s&&l instanceof Qi}),!!s&&ms(i)&&Un(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function aa(i,e){const s=i.length-1;let l,h,m=0,_=s,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),l=i[x],h=i[x+1],l<=e){if(x===s||e<h)return x;m=x+1}else{if(!(l>e))throw new fn("Input is not a number.");_=x-1}return 0}class la{constructor(e,s,l){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(e[1],1,$e);if(!l)return null;const h=[];let m=null;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);for(let _=1;_<e.length;_+=2){const x=1===_?-1/0:e[_],w=e[_+1],I=_,P=_+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const R=s.parse(w,P,m);if(!R)return null;m=m||R.type,h.push([x,R])}return new la(m,l,h)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=s[0])return l[0].evaluate(e);const m=s.length;return h>=s[m-1]?l[m-1].evaluate(e):l[aa(s,h)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}function Ln(i,e,s){return i*(1-s)+e*s}var mo=Object.freeze({__proto__:null,number:Ln,color:function(i,e,s){return new qe(Ln(i.r,e.r,s),Ln(i.g,e.g,s),Ln(i.b,e.b,s),Ln(i.a,e.a,s))},array:function(i,e,s){return i.map((l,h)=>Ln(l,e[h],s))}});const ca=4/29,N=6/29,W=3*N*N,U=Math.PI/180,J=180/Math.PI;function Te(i){return i>.008856451679035631?Math.pow(i,1/3):i/W+ca}function Je(i){return i>N?i*i*i:W*(i-ca)}function pt(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Yt(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function tn(i){const e=Yt(i.r),s=Yt(i.g),l=Yt(i.b),h=Te((.4124564*e+.3575761*s+.1804375*l)/.95047),m=Te((.2126729*e+.7151522*s+.072175*l)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Te((.0193339*e+.119192*s+.9503041*l)/1.08883)),alpha:i.a}}function br(i){let e=(i.l+16)/116,s=isNaN(i.a)?e:e+i.a/500,l=isNaN(i.b)?e:e-i.b/200;return e=1*Je(e),s=.95047*Je(s),l=1.08883*Je(l),new qe(pt(3.2404542*s-1.5371385*e-.4985314*l),pt(-.969266*s+1.8760108*e+.041556*l),pt(.0556434*s-.2040259*e+1.0572252*l),i.alpha)}function dr(i,e,s){const l=e-i;return i+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const Rn={forward:tn,reverse:br,interpolate:function(i,e,s){return{l:Ln(i.l,e.l,s),a:Ln(i.a,e.a,s),b:Ln(i.b,e.b,s),alpha:Ln(i.alpha,e.alpha,s)}}},An={forward:function(i){const{l:e,a:s,b:l}=tn(i),h=Math.atan2(l,s)*J;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:e,alpha:i.a}},reverse:function(i){const e=i.h*U,s=i.c;return br({l:i.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:i.alpha})},interpolate:function(i,e,s){return{h:dr(i.h,e.h,s),c:Ln(i.c,e.c,s),l:Ln(i.l,e.l,s),alpha:Ln(i.alpha,e.alpha,s)}}};var wr=Object.freeze({__proto__:null,lab:Rn,hcl:An});class fr{constructor(e,s,l,h,m){this.type=e,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,s,l,h){let m=0;if("exponential"===e.name)m=Io(s,e.base,l,h);else if("linear"===e.name)m=Io(s,1,l,h);else if("cubic-bezier"===e.name){const _=e.controlPoints;m=new ht(_[0],_[1],_[2],_[3]).solve(Io(s,1,l,h))}return m}static parse(e,s){let[l,h,m,..._]=e;if(!Array.isArray(h)||0===h.length)return s.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const I=h[1];if("number"!=typeof I)return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if("cubic-bezier"!==h[0])return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const I=h.slice(1);if(4!==I.length||I.some(P=>"number"!=typeof P||P<0||P>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,$e),!m)return null;const x=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=wn:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let I=0;I<_.length;I+=2){const P=_[I],R=_[I+1],O=I+3,G=I+4;if("number"!=typeof P)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=P)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const Z=s.parse(R,G,w);if(!Z)return null;w=w||Z.type,x.push([P,Z])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new fr(w,l,h,m,x):s.error(`Type ${Vt(w)} is not interpolatable.`)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=s[0])return l[0].evaluate(e);const m=s.length;if(h>=s[m-1])return l[m-1].evaluate(e);const _=aa(s,h),x=fr.interpolationFactor(this.interpolation,h,s[_],s[_+1]),w=l[_].evaluate(e),I=l[_+1].evaluate(e);return"interpolate"===this.operator?mo[this.type.kind.toLowerCase()](w,I,x):"interpolate-hcl"===this.operator?An.reverse(An.interpolate(An.forward(w),An.forward(I),x)):Rn.reverse(Rn.interpolate(Rn.forward(w),Rn.forward(I),x))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function Io(i,e,s,l){const h=l-s,m=i-s;return 0===h?0:1===e?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class Ir{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&"value"!==h.kind&&(l=h);const m=[];for(const x of e.slice(1)){const w=s.parse(x,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,m.push(w)}const _=h&&m.some(x=>Qr(h,x.type));return new Ir(_?Ht:l,m)}evaluate(e){let s,l=null,h=0;for(const m of this.args)if(h++,l=m.evaluate(e),l&&l instanceof xr&&!l.available&&(s||(s=l.name),l=null,h===this.args.length&&(l=s)),null!==l)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class bi{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=s.parse(e[m+1],m+1);if(!x)return null;l.push([_,x])}const h=s.parse(e[e.length-1],e.length-1,s.expectedType,l);return h?new bi(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,l]of this.bindings)e.push(s,l.serialize());return e.push(this.result.serialize()),e}}class So{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,$e),h=s.parse(e[2],2,jr(s.expectedType||Ht));return l&&h?new So(h.type.itemType,l,h):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new fn(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new fn(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new fn(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class wi{constructor(e,s){this.type=Rt,this.needle=e,this.haystack=s}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Ht),h=s.parse(e[2],2,Ht);return l&&h?De(l.type,[Rt,Ct,$e,Dr,Ht])?new wi(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(l.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!ye(s,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(hr(s))} instead.`);if(!ye(l,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${Vt(hr(l))} instead.`);return l.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class oi{constructor(e,s,l){this.type=$e,this.needle=e,this.haystack=s,this.fromIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Ht),h=s.parse(e[2],2,Ht);if(!l||!h)return null;if(!De(l.type,[Rt,Ct,$e,Dr,Ht]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(l.type)} instead`);if(4===e.length){const m=s.parse(e[3],3,$e);return m?new oi(l,h,m):null}return new oi(l,h)}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!ye(s,["boolean","string","number","null"]))throw new fn(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(hr(s))} instead.`);if(!ye(l,["string","array"]))throw new fn(`Expected second argument to be of type array or string, but found ${Vt(hr(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class js{constructor(e,s,l,h,m,_){this.inputType=e,this.type=s,this.input=l,this.cases=h,this.outputs=m,this.otherwise=_}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&"value"!==s.expectedType.kind&&(h=s.expectedType);const m={},_=[];for(let I=2;I<e.length-1;I+=2){let P=e[I];const R=e[I+1];Array.isArray(P)||(P=[P]);const O=s.concat(I);if(0===P.length)return O.error("Expected at least one branch label.");for(const Z of P){if("number"!=typeof Z&&"string"!=typeof Z)return O.error("Branch labels must be numbers or strings.");if("number"==typeof Z&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof Z&&Math.floor(Z)!==Z)return O.error("Numeric branch labels must be integer values.");if(l){if(O.checkSubtype(l,hr(Z)))return null}else l=hr(Z);if(void 0!==m[String(Z)])return O.error("Branch labels must be unique.");m[String(Z)]=_.length}const G=s.parse(R,I,h);if(!G)return null;h=h||G.type,_.push(G)}const x=s.parse(e[1],1,Ht);if(!x)return null;const w=s.parse(e[e.length-1],e.length-1,h);return w?"value"!==x.type.kind&&s.concat(1).checkSubtype(l,x.type)?null:new js(l,h,x,m,_,w):null}evaluate(e){const s=this.input.evaluate(e);return(hr(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const _ of s){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[x][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of l)e.push(1===x.length?m(x[0]):x.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class Ra{constructor(e,s,l){this.type=e,this.branches=s,this.otherwise=l}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const x=s.parse(e[_],_,Rt);if(!x)return null;const w=s.parse(e[_+1],_+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const m=s.parse(e[e.length-1],e.length-1,l);return m?new Ra(l,h,m):null}evaluate(e){for(const[s,l]of this.branches)if(s.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,l]of this.branches)e(s),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Ll{constructor(e,s,l,h){this.type=e,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Ht),h=s.parse(e[2],2,$e);if(!l||!h)return null;if(!De(l.type,[jr(Ht),Ct,Ht]))return s.error(`Expected first argument to be of type array or string, but found ${Vt(l.type)} instead`);if(4===e.length){const m=s.parse(e[3],3,$e);return m?new Ll(l.type,l,h,m):null}return new Ll(l.type,l,h)}evaluate(e){const s=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!ye(s,["string","array"]))throw new fn(`Expected first argument to be of type array or string, but found ${Vt(hr(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return s.slice(l,h)}return s.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function eo(i,e){return"=="===i||"!="===i?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function ua(i,e,s,l){return 0===l.compare(e,s)}function _s(i,e,s){const l="=="!==i&&"!="!==i;return class Vb{constructor(m,_,x){this.type=Rt,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const x=m[0];let w=_.parse(m[1],1,Ht);if(!w)return null;if(!eo(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Vt(w.type)}'.`);let I=_.parse(m[2],2,Ht);if(!I)return null;if(!eo(x,I.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Vt(I.type)}'.`);if(w.type.kind!==I.type.kind&&"value"!==w.type.kind&&"value"!==I.type.kind)return _.error(`Cannot compare types '${Vt(w.type)}' and '${Vt(I.type)}'.`);l&&("value"===w.type.kind&&"value"!==I.type.kind?w=new Or(I.type,[w]):"value"!==w.type.kind&&"value"===I.type.kind&&(I=new Or(w.type,[I])));let P=null;if(4===m.length){if("string"!==w.type.kind&&"string"!==I.type.kind&&"value"!==w.type.kind&&"value"!==I.type.kind)return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(m[3],3,Yi),!P)return null}return new Vb(w,I,P)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const w=hr(_),I=hr(x);if(w.kind!==I.kind||"string"!==w.kind&&"number"!==w.kind)throw new fn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=hr(_),I=hr(x);if("string"!==w.kind||"string"!==I.kind)return e(m,_,x)}return this.collator?s(m,_,x,this.collator.evaluate(m)):e(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[i];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const mn=_s("==",function(i,e,s){return e===s},ua),ku=_s("!=",function(i,e,s){return e!==s},function(i,e,s,l){return!ua(0,e,s,l)}),Fu=_s("<",function(i,e,s){return e<s},function(i,e,s,l){return l.compare(e,s)<0}),_c=_s(">",function(i,e,s){return e>s},function(i,e,s,l){return l.compare(e,s)>0}),Ao=_s("<=",function(i,e,s){return e<=s},function(i,e,s,l){return l.compare(e,s)<=0}),yc=_s(">=",function(i,e,s){return e>=s},function(i,e,s,l){return l.compare(e,s)>=0});class ha{constructor(e,s,l,h,m){this.type=Ct,this.number=e,this.locale=s,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,s){if(3!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,$e);if(!l)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=s.parse(h.locale,1,Ct),!m))return null;let _=null;if(h.currency&&(_=s.parse(h.currency,1,Ct),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=s.parse(h["min-fraction-digits"],1,$e),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=s.parse(h["max-fraction-digits"],1,$e),!w)?null:new ha(l,m,_,x,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class da{constructor(e){this.type=$e,this.input=e}static parse(e,s){if(2!==e.length)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=s.parse(e[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${Vt(l.type)} instead.`):new da(l):null}evaluate(e){const s=this.input.evaluate(e);if("string"==typeof s||Array.isArray(s))return s.length;throw new fn(`Expected value to be of type string or array, but found ${Vt(hr(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const ft={"==":mn,"!=":ku,">":_c,"<":Fu,">=":yc,"<=":Ao,array:Or,at:So,boolean:Or,case:Ra,coalesce:Ir,collator:Sa,format:mi,image:Us,in:wi,"index-of":oi,interpolate:fr,"interpolate-hcl":fr,"interpolate-lab":fr,length:da,let:bi,literal:Qi,match:js,number:Or,"number-format":ha,object:Or,slice:Ll,step:la,string:Or,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:Ji,within:po};function $n(i,[e,s,l,h]){e=e.evaluate(i),s=s.evaluate(i),l=l.evaluate(i);const m=h?h.evaluate(i):1,_=Ki(e,s,l,m);if(_)throw new fn(_);return new qe(e/255*m,s/255*m,l/255*m,m)}function vc(i,e){return i in e}function Jr(i,e){const s=e[i];return void 0===s?null:s}function ys(i){return{type:i}}function ns(i){return{result:"success",value:i}}function Ei(i){return{result:"error",value:i}}function Ho(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function $s(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xc(i){return!!i.expression&&i.expression.interpolated}function jn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function Gs(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function Ol(i){return i}function Li(i,e){const s="color"===e.type,l=i.stops&&"object"==typeof i.stops[0][0],h=l||!(l||void 0!==i.property),m=i.type||(xc(e)?"exponential":"interval");if(s&&((i=sn({},i)).stops&&(i.stops=i.stops.map(I=>[I[0],qe.parse(I[1])])),i.default=qe.parse(i.default?i.default:e.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!wr[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,x,w;if("exponential"===m)_=Mo;else if("interval"===m)_=vs;else if("categorical"===m){_=bc,x=Object.create(null);for(const I of i.stops)x[I[0]]=I[1];w=typeof i.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=Lu}if(l){const I={},P=[];for(let G=0;G<i.stops.length;G++){const Z=i.stops[G],Q=Z[0].zoom;void 0===I[Q]&&(I[Q]={zoom:Q,type:i.type,property:i.property,default:i.default,stops:[]},P.push(Q)),I[Q].stops.push([Z[0].value,Z[1]])}const R=[];for(const G of P)R.push([I[G].zoom,Li(I[G],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:fr.interpolationFactor.bind(void 0,O),zoomStops:R.map(G=>G[0]),evaluate:({zoom:G},Z)=>Mo({stops:R,base:i.base},e,G).evaluate(G,Z)}}if(h){const I="exponential"===m?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:fr.interpolationFactor.bind(void 0,I),zoomStops:i.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(i,e,P,x,w)}}return{kind:"source",evaluate(I,P){const R=P&&P.properties?P.properties[i.property]:void 0;return void 0===R?$i(i.default,e.default):_(i,e,R,x,w)}}}function $i(i,e,s){return void 0!==i?i:void 0!==e?e:void 0!==s?s:void 0}function bc(i,e,s,l,h){return $i(typeof s===h?l[s]:void 0,i.default,e.default)}function vs(i,e,s){if("number"!==jn(s))return $i(i.default,e.default);const l=i.stops.length;if(1===l||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const h=aa(i.stops.map(m=>m[0]),s);return i.stops[h][1]}function Mo(i,e,s){const l=void 0!==i.base?i.base:1;if("number"!==jn(s))return $i(i.default,e.default);const h=i.stops.length;if(1===h||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[h-1][0])return i.stops[h-1][1];const m=aa(i.stops.map(P=>P[0]),s),_=function(P,R,O,G){const Z=G-O,Q=P-O;return 0===Z?0:1===R?Q/Z:(Math.pow(R,Q)-1)/(Math.pow(R,Z)-1)}(s,l,i.stops[m][0],i.stops[m+1][0]),x=i.stops[m][1],w=i.stops[m+1][1];let I=mo[e.type]||Ol;if(i.colorSpace&&"rgb"!==i.colorSpace){const P=wr[i.colorSpace];I=(R,O)=>P.reverse(P.interpolate(P.forward(R),P.forward(O),_))}return"function"==typeof x.evaluate?{evaluate(...P){const R=x.evaluate.apply(void 0,P),O=w.evaluate.apply(void 0,P);if(void 0!==R&&void 0!==O)return I(R,O,_)}}:I(x,w,_)}function Lu(i,e,s){return"color"===e.type?s=qe.parse(s):"formatted"===e.type?s=Fn.fromString(s.toString()):"resolvedImage"===e.type?s=xr.fromString(s.toString()):jn(s)===e.type||"enum"===e.type&&e.values[s]||(s=void 0),$i(s,i.default,e.default)}xi.register(ft,{error:[{kind:"error"},[Ct],(i,[e])=>{throw new fn(e.evaluate(i))}],typeof:[Ct,[Ht],(i,[e])=>Vt(hr(e.evaluate(i)))],"to-rgba":[jr($e,4),[wn],(i,[e])=>e.evaluate(i).toArray()],rgb:[wn,[$e,$e,$e],$n],rgba:[wn,[$e,$e,$e,$e],$n],has:{type:Rt,overloads:[[[Ct],(i,[e])=>vc(e.evaluate(i),i.properties())],[[Ct,pi],(i,[e,s])=>vc(e.evaluate(i),s.evaluate(i))]]},get:{type:Ht,overloads:[[[Ct],(i,[e])=>Jr(e.evaluate(i),i.properties())],[[Ct,pi],(i,[e,s])=>Jr(e.evaluate(i),s.evaluate(i))]]},"feature-state":[Ht,[Ct],(i,[e])=>Jr(e.evaluate(i),i.featureState||{})],properties:[pi,[],i=>i.properties()],"geometry-type":[Ct,[],i=>i.geometryType()],id:[Ht,[],i=>i.id()],zoom:[$e,[],i=>i.globals.zoom],pitch:[$e,[],i=>i.globals.pitch||0],"distance-from-center":[$e,[],i=>i.distanceFromCenter()],"heatmap-density":[$e,[],i=>i.globals.heatmapDensity||0],"line-progress":[$e,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[$e,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ht,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[$e,ys($e),(i,e)=>{let s=0;for(const l of e)s+=l.evaluate(i);return s}],"*":[$e,ys($e),(i,e)=>{let s=1;for(const l of e)s*=l.evaluate(i);return s}],"-":{type:$e,overloads:[[[$e,$e],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[$e],(i,[e])=>-e.evaluate(i)]]},"/":[$e,[$e,$e],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[$e,[$e,$e],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[$e,[$e],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))],log2:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[$e,[$e],(i,[e])=>Math.sin(e.evaluate(i))],cos:[$e,[$e],(i,[e])=>Math.cos(e.evaluate(i))],tan:[$e,[$e],(i,[e])=>Math.tan(e.evaluate(i))],asin:[$e,[$e],(i,[e])=>Math.asin(e.evaluate(i))],acos:[$e,[$e],(i,[e])=>Math.acos(e.evaluate(i))],atan:[$e,[$e],(i,[e])=>Math.atan(e.evaluate(i))],min:[$e,ys($e),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[$e,ys($e),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[$e,[$e],(i,[e])=>Math.abs(e.evaluate(i))],round:[$e,[$e],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[$e,[$e],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[$e,[$e],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Rt,[Ct,Ht],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[Rt,[Ht],(i,[e])=>i.id()===e.value],"filter-type-==":[Rt,[Ct],(i,[e])=>i.geometryType()===e.value],"filter-<":[Rt,[Ct,Ht],(i,[e,s])=>{const l=i.properties()[e.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Rt,[Ht],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<l}],"filter->":[Rt,[Ct,Ht],(i,[e,s])=>{const l=i.properties()[e.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[Rt,[Ht],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>l}],"filter-<=":[Rt,[Ct,Ht],(i,[e,s])=>{const l=i.properties()[e.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Rt,[Ht],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<=l}],"filter->=":[Rt,[Ct,Ht],(i,[e,s])=>{const l=i.properties()[e.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Rt,[Ht],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>=l}],"filter-has":[Rt,[Ht],(i,[e])=>e.value in i.properties()],"filter-has-id":[Rt,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[Rt,[jr(Ct)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Rt,[jr(Ht)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Rt,[Ct,jr(Ht)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Rt,[Ct,jr(Ht)],(i,[e,s])=>function(l,h,m,_){for(;m<=_;){const x=m+_>>1;if(h[x]===l)return!0;h[x]>l?_=x-1:m=x+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[ys(Rt),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[ys(Rt),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[Rt,[Rt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Rt,[Ct],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[Ct,[Ct],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Ct,[Ct],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Ct,ys(Ht),(i,e)=>e.map(s=>ji(s.evaluate(i))).join("")],"resolved-locale":[Ct,[Yi],(i,[e])=>e.evaluate(i).resolvedLocale()]});class el{constructor(e,s){var l;this.expression=e,this._warningHistory={},this._evaluator=new Ka,this._defaultValue=s?"color"===(l=s).type&&Gs(l.default)?new qe(0,0,0,0):"color"===l.type?qe.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(e,s,l,h,m,_,x,w){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,l,h,m,_,x,w){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const I=this.expression.evaluate(this._evaluator);if(null==I||"number"==typeof I&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new fn(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,"undefined"!=typeof console&&console.warn(I.message)),this._defaultValue}}}function to(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in ft}function ka(i,e){const s=new sa(ft,[],e?function(h){const m={color:wn,string:Ct,number:$e,enum:Ct,boolean:Rt,formatted:Qn,resolvedImage:Ui};return"array"===h.type?jr(m[h.value]||Ht,h.length):m[h.type]}(e):void 0),l=s.parse(i,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return l?ns(new el(l,e)):Ei(s.errors)}class rs{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent="constant"!==e&&!oa(s.expression)}evaluateWithoutErrorHandling(e,s,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,h,m,_)}evaluate(e,s,l,h,m,_){return this._styleExpression.evaluate(e,s,l,h,m,_)}}class xs{constructor(e,s,l,h){this.kind=e,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==e&&!oa(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,s,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,h,m,_)}evaluate(e,s,l,h,m,_){return this._styleExpression.evaluate(e,s,l,h,m,_)}interpolationFactor(e,s,l){return this.interpolationType?fr.interpolationFactor(this.interpolationType,e,s,l):0}}function wc(i,e){if("error"===(i=ka(i,e)).result)return i;const s=i.value.expression,l=ms(s);if(!l&&!Ho(e))return Ei([new an("","data expressions not supported")]);const h=Un(s,["zoom","pitch","distance-from-center"]);if(!h&&!$s(e))return Ei([new an("","zoom expressions not supported")]);const m=Hs(s);return m||h?m instanceof an?Ei([m]):m instanceof fr&&!xc(e)?Ei([new an("",'"interpolate" expressions cannot be used with this property')]):ns(m?new xs(l?"camera":"composite",i.value,m.labels,m instanceof fr?m.interpolation:void 0):new rs(l?"constant":"source",i.value)):Ei([new an("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Po{constructor(e,s){this._parameters=e,this._specification=s,sn(this,Li(this._parameters,this._specification))}static deserialize(e){return new Po(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Hs(i){let e=null;if(i instanceof bi)e=Hs(i.result);else if(i instanceof Ir){for(const s of i.args)if(e=Hs(s),e)break}else(i instanceof la||i instanceof fr)&&i.input instanceof xi&&"zoom"===i.input.name&&(e=i);return e instanceof an||i.eachChild(s=>{const l=Hs(s);l instanceof an?e=l:!e&&l?e=new an("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new an("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function go(i){const e=i.key,s=i.value,l=i.valueSpec||{},h=i.objectElementValidators||{},m=i.style,_=i.styleSpec;let x=[];const w=jn(s);if("object"!==w)return[new Ye(e,s,`object expected, ${w} found`)];for(const I in s){const P=I.split(".")[0],R=l[P]||l["*"];let O;if(h[P])O=h[P];else if(l[P])O=Oi;else if(h["*"])O=h["*"];else{if(!l["*"]){x.push(new Ye(e,s[I],`unknown property "${I}"`));continue}O=Oi}x=x.concat(O({key:(e&&`${e}.`)+I,value:s[I],valueSpec:R,style:m,styleSpec:_,object:s,objectKey:I},s))}for(const I in l)h[I]||l[I].required&&void 0===l[I].default&&void 0===s[I]&&x.push(new Ye(e,s,`missing required property "${I}"`));return x}function qo(i){const e=i.value,s=i.valueSpec,l=i.style,h=i.styleSpec,m=i.key,_=i.arrayElementValidator||Oi;if("array"!==jn(e))return[new Ye(m,e,`array expected, ${jn(e)} found`)];if(s.length&&e.length!==s.length)return[new Ye(m,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Ye(m,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};h.$version<7&&(x.function=s.function),"object"===jn(s.value)&&(x=s.value);let w=[];for(let I=0;I<e.length;I++)w=w.concat(_({array:e,arrayIndex:I,value:e[I],valueSpec:x,style:l,styleSpec:h,key:`${m}[${I}]`}));return w}function zl(i){const e=i.key,s=i.value,l=i.valueSpec;let h=jn(s);if("number"===h&&s!=s&&(h="NaN"),"number"!==h)return[new Ye(e,s,`number expected, ${h} found`)];if("minimum"in l){let m=l.minimum;if("array"===jn(l.minimum)&&(m=l.minimum[i.arrayIndex]),s<m)return[new Ye(e,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===jn(l.maximum)&&(m=l.maximum[i.arrayIndex]),s>m)return[new Ye(e,s,`${s} is greater than the maximum value ${m}`)]}return[]}function tl(i){const e=i.valueSpec,s=Wt(i.value.type);let l,h,m,_={};const x="categorical"!==s&&void 0===i.value.property,w=!x,I="array"===jn(i.value.stops)&&"array"===jn(i.value.stops[0])&&"object"===jn(i.value.stops[0][0]),P=go({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(G){if("identity"===s)return[new Ye(G.key,G.value,'identity function may not have a "stops" property')];let Z=[];const Q=G.value;return Z=Z.concat(qo({key:G.key,value:Q,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:R})),"array"===jn(Q)&&0===Q.length&&Z.push(new Ye(G.key,Q,"array must have at least one stop")),Z},default:function(G){return Oi({key:G.key,value:G.value,valueSpec:e,style:G.style,styleSpec:G.styleSpec})}}});return"identity"===s&&x&&P.push(new Ye(i.key,i.value,'missing required property "property"')),"identity"===s||i.value.stops||P.push(new Ye(i.key,i.value,'missing required property "stops"')),"exponential"===s&&i.valueSpec.expression&&!xc(i.valueSpec)&&P.push(new Ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Ho(i.valueSpec)?P.push(new Ye(i.key,i.value,"property functions not supported")):x&&!$s(i.valueSpec)&&P.push(new Ye(i.key,i.value,"zoom functions not supported"))),"categorical"!==s&&!I||void 0!==i.value.property||P.push(new Ye(i.key,i.value,'"property" property is required')),P;function R(G){let Z=[];const Q=G.value,ce=G.key;if("array"!==jn(Q))return[new Ye(ce,Q,`array expected, ${jn(Q)} found`)];if(2!==Q.length)return[new Ye(ce,Q,`array length 2 expected, length ${Q.length} found`)];if(I){if("object"!==jn(Q[0]))return[new Ye(ce,Q,`object expected, ${jn(Q[0])} found`)];if(void 0===Q[0].zoom)return[new Ye(ce,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new Ye(ce,Q,"object stop key must have value")];if(m&&m>Wt(Q[0].zoom))return[new Ye(ce,Q[0].zoom,"stop zoom values must appear in ascending order")];Wt(Q[0].zoom)!==m&&(m=Wt(Q[0].zoom),h=void 0,_={}),Z=Z.concat(go({key:`${ce}[0]`,value:Q[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:zl,value:O}}))}else Z=Z.concat(O({key:`${ce}[0]`,value:Q[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},Q));return to(en(Q[1]))?Z.concat([new Ye(`${ce}[1]`,Q[1],"expressions are not allowed in function stops.")]):Z.concat(Oi({key:`${ce}[1]`,value:Q[1],valueSpec:e,style:G.style,styleSpec:G.styleSpec}))}function O(G,Z){const Q=jn(G.value),ce=Wt(G.value),me=null!==G.value?G.value:Z;if(l){if(Q!==l)return[new Ye(G.key,me,`${Q} stop domain type must match previous stop domain type ${l}`)]}else l=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new Ye(G.key,me,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==s){let xe=`number expected, ${Q} found`;return Ho(e)&&void 0===s&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(G.key,me,xe)]}return"categorical"!==s||"number"!==Q||isFinite(ce)&&Math.floor(ce)===ce?"categorical"!==s&&"number"===Q&&void 0!==h&&ce<h?[new Ye(G.key,me,"stop domain values must appear in ascending order")]:(h=ce,"categorical"===s&&ce in _?[new Ye(G.key,me,"stop domain values must be unique")]:(_[ce]=!0,[])):[new Ye(G.key,me,`integer expected, found ${ce}`)]}}function bs(i){const e=("property"===i.expressionContext?wc:ka)(en(i.value),i.valueSpec);if("error"===e.result)return e.value.map(l=>new Ye(`${i.key}${l.key}`,i.value,l.message));const s=e.value.expression||e.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!s.outputDefined())return[new Ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!oa(s))return[new Ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return Nl(s,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Un(s,["zoom","feature-state"]))return[new Ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!ms(s))return[new Ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Nl(i,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of e.valueSpec.expression.parameters)s.delete(h);if(0===s.size)return[];const l=[];return i instanceof xi&&s.has(i.name)?[new Ye(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(h=>{l.push(...Nl(h,e))}),l)}function ws(i){const e=i.key,s=i.value,l=i.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(Wt(s))&&h.push(new Ye(e,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(Wt(s))&&h.push(new Ye(e,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function Bl(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Bl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function nl(i,e="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bl(i)||(i=Vl(i));const s=i;let l=!0;try{l=function(I){if(!pr(I))return I;let P=en(I);return no(P),P=Ci(P),P}(s)}catch(I){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const h=Pe[`filter_${e}`],m=ka(l,h);let _=null;if("error"===m.result)throw new Error(m.value.map(I=>`${I.key}: ${I.message}`).join(", "));_=(I,P,R)=>m.value.evaluate(I,P,{},R);let x=null,w=null;if(l!==s){const I=ka(s,h);if("error"===I.result)throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));x=(P,R,O,G,Z)=>I.value.evaluate(P,R,{},O,void 0,void 0,G,Z),w=!ms(I.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:Cc(l),needFeature:!!w}}function Ci(i){if(!Array.isArray(i))return i;const e=function(s){if(tu.has(s[0]))for(let l=1;l<s.length;l++)if(pr(s[l]))return!0;return s}(i);return!0===e?e:e.map(s=>Ci(s))}function no(i){let e=!1;const s=[];if("case"===i[0]){for(let l=1;l<i.length-1;l+=2)e=e||pr(i[l]),s.push(i[l+1]);s.push(i[i.length-1])}else if("match"===i[0]){e=e||pr(i[1]);for(let l=2;l<i.length-1;l+=2)s.push(i[l+1]);s.push(i[i.length-1])}else if("step"===i[0]){e=e||pr(i[1]);for(let l=1;l<i.length-1;l+=2)s.push(i[l+1])}e&&(i.length=0,i.push("any",...s));for(let l=1;l<i.length;l++)no(i[l])}function pr(i){if(!Array.isArray(i))return!1;if("pitch"===(e=i[0])||"distance-from-center"===e)return!0;var e;for(let s=1;s<i.length;s++)if(pr(i[s]))return!0;return!1}const tu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ec(i,e){return i<e?-1:i>e?1:0}function Cc(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let e=1;e<i.length;e++)if(Cc(i[e]))return!0;return!1}function Vl(i){if(!i)return!0;const e=i[0];return i.length<=1?"any"!==e:"=="===e?Fa(i[1],i[2],"=="):"!="===e?qs(Fa(i[1],i[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Fa(i[1],i[2],e):"any"===e?(s=i.slice(1),["any"].concat(s.map(Vl))):"all"===e?["all"].concat(i.slice(1).map(Vl)):"none"===e?["all"].concat(i.slice(1).map(Vl).map(qs)):"in"===e?Tc(i[1],i.slice(2)):"!in"===e?qs(Tc(i[1],i.slice(2))):"has"===e?Ul(i[1]):"!has"===e?qs(Ul(i[1])):"within"!==e||i;var s}function Fa(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function Tc(i,e){if(0===e.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ec)]]:["filter-in-small",i,["literal",e]]}}function Ul(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function qs(i){return["!",i]}function fa(i){if(Bl(en(i.value))){const e=en(i.layerType);return bs(sn({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${e||"fill"}`]}))}return rl(i)}function rl(i){const e=i.value,s=i.key;if("array"!==jn(e))return[new Ye(s,e,`array expected, ${jn(e)} found`)];const l=i.styleSpec;let h,m=[];if(e.length<1)return[new Ye(s,e,"filter array must have at least 1 element")];switch(m=m.concat(ws({key:`${s}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Wt(e[1])&&m.push(new Ye(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&m.push(new Ye(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=jn(e[1]),"string"!==h&&m.push(new Ye(`${s}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=jn(e[_]),"$type"===Wt(e[1])?m=m.concat(ws({key:`${s}[${_}]`,value:e[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new Ye(`${s}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)m=m.concat(rl({key:`${s}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=jn(e[1]),2!==e.length?m.push(new Ye(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new Ye(`${s}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=jn(e[1]),2!==e.length?m.push(new Ye(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new Ye(`${s}[1]`,e[1],`object expected, ${h} found`))}return m}function pa(i,e){const s=i.key,l=i.style,h=i.styleSpec,m=i.value,_=i.objectKey,x=h[`${e}_${i.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if("paint"===e&&w&&x[w[1]]&&x[w[1]].transition)return Oi({key:s,value:m,valueSpec:h.transition,style:l,styleSpec:h});const I=i.valueSpec||x[_];if(!I)return[new Ye(s,m,`unknown property "${_}"`)];let P;if("string"===jn(m)&&Ho(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(m)))return[new Ye(s,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const R=[];return"symbol"===i.layerType&&("text-field"===_&&l&&!l.glyphs&&R.push(new Ye(s,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Gs(en(m))&&"identity"===Wt(m.type)&&R.push(new Ye(s,m,'"text-font" does not support identity functions'))),R.concat(Oi({key:i.key,value:m,valueSpec:I,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:_}))}function il(i){return pa(i,"paint")}function ei(i){return pa(i,"layout")}function Es(i){let e=[];const s=i.value,l=i.key,h=i.style,m=i.styleSpec;s.type||s.ref||e.push(new Ye(l,s,'either "type" or "ref" is required'));let _=Wt(s.type);const x=Wt(s.ref);if(s.id){const w=Wt(s.id);for(let I=0;I<i.arrayIndex;I++){const P=h.layers[I];Wt(P.id)===w&&e.push(new Ye(l,s.id,`duplicate layer id "${s.id}", previously used at line ${P.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&e.push(new Ye(l,s[I],`"${I}" is prohibited for ref layers`))}),h.layers.forEach(I=>{Wt(I.id)===x&&(w=I)}),w?w.ref?e.push(new Ye(l,s.ref,"ref cannot reference another ref layer")):_=Wt(w.type):e.push(new Ye(l,s.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const w=h.sources&&h.sources[s.source],I=w&&Wt(w.type);w?"vector"===I&&"raster"===_?e.push(new Ye(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===I&&"raster"!==_?e.push(new Ye(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==I||s["source-layer"]?"raster-dem"===I&&"hillshade"!==_?e.push(new Ye(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===I&&w.lineMetrics||e.push(new Ye(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ye(l,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Ye(l,s.source,`source "${s.source}" not found`))}else e.push(new Ye(l,s,'missing required property "source"'));return e=e.concat(go({key:l,value:s,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Oi({key:`${l}.type`,value:s.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:w=>fa(sn({layerType:_},w)),layout:w=>go({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":I=>ei(sn({layerType:_},I))}}),paint:w=>go({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":I=>il(sn({layerType:_},I))}})}})),e}function La(i){const e=i.value,s=i.key,l=jn(e);return"string"!==l?[new Ye(s,e,`string expected, ${l} found`)]:[]}const nu={promoteId:function({key:i,value:e}){if("string"===jn(e))return La({key:i,value:e});{const s=[];for(const l in e)s.push(...La({key:`${i}.${l}`,value:e[l]}));return s}}};function Zs(i){const e=i.value,s=i.key,l=i.styleSpec,h=i.style;if(!e.type)return[new Ye(s,e,'"type" is required')];const m=Wt(e.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=go({key:s,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:nu}),_;case"geojson":if(_=go({key:s,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:nu}),e.cluster)for(const x in e.clusterProperties){const[w,I]=e.clusterProperties[x],P="string"==typeof w?[w,["accumulated"],["get",x]]:w;_.push(...bs({key:`${s}.${x}.map`,value:I,expressionContext:"cluster-map"})),_.push(...bs({key:`${s}.${x}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return go({key:s,value:e,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return go({key:s,value:e,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new Ye(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ws({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function jl(i){const e=i.value,s=i.styleSpec,l=s.light,h=i.style;let m=[];const _=jn(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ye("light",e,`object expected, ${_} found`)]),m;for(const x in e){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&l[w[1]]&&l[w[1]].transition?Oi({key:x,value:e[x],valueSpec:s.transition,style:h,styleSpec:s}):l[x]?Oi({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:s}):[new Ye(x,e[x],`unknown property "${x}"`)])}return m}function $l(i){const e=i.value,s=i.key,l=i.style,h=i.styleSpec,m=h.terrain;let _=[];const x=jn(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new Ye("terrain",e,`object expected, ${x} found`)]),_;for(const w in e){const I=w.match(/^(.*)-transition$/);_=_.concat(I&&m[I[1]]&&m[I[1]].transition?Oi({key:w,value:e[w],valueSpec:h.transition,style:l,styleSpec:h}):m[w]?Oi({key:w,value:e[w],valueSpec:m[w],style:l,styleSpec:h}):[new Ye(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],I=w&&Wt(w.type);w?"raster-dem"!==I&&_.push(new Ye(s,e.source,`terrain cannot be used with a source of type ${I}, it only be used with a "raster-dem" source type`)):_.push(new Ye(s,e.source,`source "${e.source}" not found`))}else _.push(new Ye(s,e,'terrain is missing required property "source"'));return _}function ru(i){const e=i.value,s=i.style,l=i.styleSpec,h=l.fog;let m=[];const _=jn(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ye("fog",e,`object expected, ${_} found`)]),m;for(const x in e){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&h[w[1]]&&h[w[1]].transition?Oi({key:x,value:e[x],valueSpec:l.transition,style:s,styleSpec:l}):h[x]?Oi({key:x,value:e[x],valueSpec:h[x],style:s,styleSpec:l}):[new Ye(x,e[x],`unknown property "${x}"`)])}return m}const ol={"*":()=>[],array:qo,boolean:function(i){const e=i.value,s=i.key,l=jn(e);return"boolean"!==l?[new Ye(s,e,`boolean expected, ${l} found`)]:[]},number:zl,color:function(i){const e=i.key,s=i.value,l=jn(s);return"string"!==l?[new Ye(e,s,`color expected, ${l} found`)]:null===Ne.parseCSSColor(s)?[new Ye(e,s,`color expected, "${s}" found`)]:[]},constants:bn,enum:ws,filter:fa,function:tl,layer:Es,object:go,source:Zs,light:jl,terrain:$l,fog:ru,string:La,formatted:function(i){return 0===La(i).length?[]:bs(i)},resolvedImage:function(i){return 0===La(i).length?[]:bs(i)},projection:function(i){const e=i.value,s=i.styleSpec,l=s.projection,h=i.style;let m=[];const _=jn(e);if("object"===_)for(const x in e)m=m.concat(Oi({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:s}));else"string"!==_&&(m=m.concat([new Ye("projection",e,`object or string expected, ${_} found`)]));return m}};function Oi(i){const e=i.value,s=i.valueSpec,l=i.styleSpec;return s.expression&&Gs(Wt(e))?tl(i):s.expression&&to(en(e))?bs(i):s.type&&ol[s.type]?ol[s.type](i):go(sn({},i,{valueSpec:s.type?l[s.type]:s}))}function Gl(i){const e=i.value,s=i.key,l=La(i);return l.length||(-1===e.indexOf("{fontstack}")&&l.push(new Ye(s,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&l.push(new Ye(s,e,'"glyphs" url must include a "{range}" token'))),l}function Ti(i,e=Pe){let s=[];return s=s.concat(Oi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Gl,"*":()=>[]}})),i.constants&&(s=s.concat(bn({key:"constants",value:i.constants,style:i,styleSpec:e}))),Hl(s)}function Hl(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function Ro(i){return function(...e){return Hl(i.apply(this,e))}}Ti.source=Ro(Zs),Ti.light=Ro(jl),Ti.terrain=Ro($l),Ti.fog=Ro(ru),Ti.layer=Ro(Es),Ti.filter=Ro(fa),Ti.paintProperty=Ro(il),Ti.layoutProperty=Ro(ei);const Ws=Ti,iu=Ws.light,Cs=Ws.fog,ql=Ws.paintProperty,ma=Ws.layoutProperty;function Di(i,e){let s=!1;if(e&&e.length)for(const l of e)i.fire(new Ut(new Error(l.message))),s=!0;return s}var Ts=ko;function ko(i,e,s){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(e=h[1])+2*(s=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],x=h[3+m+1];l.push(_===x?null:h.subarray(_,x))}var w=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var I=0;I<this.d*this.d;I++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=s,this.scale=e/i,this.uid=0;var P=s/e*i;this.min=-P,this.max=i+P}ko.prototype.insert=function(i,e,s,l,h){this._forEachCell(e,s,l,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(i,e,s,l,h,m){this.cells[h].push(m)},ko.prototype.query=function(i,e,s,l,h){var m=this.min,_=this.max;if(i<=m&&e<=m&&_<=s&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(i,e,s,l,this._queryCell,x,{},h),x},ko.prototype._queryCell=function(i,e,s,l,h,m,_,x){var w=this.cells[h];if(null!==w)for(var I=this.keys,P=this.bboxes,R=0;R<w.length;R++){var O=w[R];if(void 0===_[O]){var G=4*O;(x?x(P[G+0],P[G+1],P[G+2],P[G+3]):i<=P[G+2]&&e<=P[G+3]&&s>=P[G+0]&&l>=P[G+1])?(_[O]=!0,m.push(I[O])):_[O]=!1}}},ko.prototype._forEachCell=function(i,e,s,l,h,m,_,x){for(var w=this._convertToCellCoord(i),I=this._convertToCellCoord(e),P=this._convertToCellCoord(s),R=this._convertToCellCoord(l),O=w;O<=P;O++)for(var G=I;G<=R;G++){var Z=this.d*G+O;if((!x||x(this._convertFromCellCoord(O),this._convertFromCellCoord(G),this._convertFromCellCoord(O+1),this._convertFromCellCoord(G+1)))&&h.call(this,i,e,s,l,Z,m,_,x))return}},ko.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var h=new Int32Array(e+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=e,_=0;_<i.length;_++){var x=i[_];h[3+_]=m,h.set(x,m),m+=x.length}return h[3+i.length]=m,h.set(this.keys,m),h[3+i.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const{ImageData:Xs,ImageBitmap:sl}=Se,is={};function Ft(i,e,s={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),is[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Ft("Object",Object),Ts.serialize=function(i,e){const s=i.toArrayBuffer();return e&&e.push(s),{buffer:s}},Ts.deserialize=function(i){return new Ts(i.buffer)},Ft("Grid",Ts),Ft("Color",qe),Ft("Error",Error),Ft("ResolvedImage",xr),Ft("StylePropertyFunction",Po),Ft("StyleExpression",el,{omit:["_evaluator"]}),Ft("ZoomDependentExpression",xs),Ft("ZoomConstantExpression",rs),Ft("CompoundExpression",xi,{omit:["_evaluate"]});for(const i in ft)ft[i]._classRegistryKey||Ft(`Expression_${i}`,ft[i]);function Oa(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function ga(i){return sl&&i instanceof sl}function _a(i,e){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Oa(i)||ga(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof Xs)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const l of i)s.push(_a(l,e));return s}if("object"==typeof i){const s=i.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const h=s.serialize?s.serialize(i,e):{};if(!s.serialize){for(const m in i){if(!i.hasOwnProperty(m)||is[l].omit.indexOf(m)>=0)continue;const _=i[m];h[m]=is[l].shallow.indexOf(m)>=0?_:_a(_,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof i)}function Ds(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Oa(i)||ga(i)||ArrayBuffer.isView(i)||i instanceof Xs)return i;if(Array.isArray(i))return i.map(Ds);if("object"==typeof i){const e=i.$name||"Object",{klass:s}=is[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const l=Object.create(s.prototype);for(const h of Object.keys(i)){if("$name"===h)continue;const m=i[h];l[h]=is[e].shallow.indexOf(h)>=0?m:Ds(m)}return l}throw new Error("can't deserialize object of type "+typeof i)}class al{constructor(){this.first=!0}update(e,s){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const Dc=i=>i>=1536&&i<=1791,Zl=i=>i>=1872&&i<=1919,ll=i=>i>=2208&&i<=2303,ou=i=>i>=11904&&i<=12031,Fo=i=>i>=12032&&i<=12255,Ic=i=>i>=12272&&i<=12287,Wl=i=>i>=12288&&i<=12351,Is=i=>i>=12352&&i<=12447,Ys=i=>i>=12448&&i<=12543,Sc=i=>i>=12544&&i<=12591,Ac=i=>i>=12704&&i<=12735,Xl=i=>i>=12736&&i<=12783,Ks=i=>i>=12784&&i<=12799,Yl=i=>i>=12800&&i<=13055,cl=i=>i>=13056&&i<=13311,za=i=>i>=13312&&i<=19903,os=i=>i>=19968&&i<=40959,Ss=i=>i>=40960&&i<=42127,ya=i=>i>=42128&&i<=42191,As=i=>i>=44032&&i<=55215,ul=i=>i>=63744&&i<=64255,ro=i=>i>=64336&&i<=65023,ch=i=>i>=65040&&i<=65055,M=i=>i>=65072&&i<=65103,T=i=>i>=65104&&i<=65135,C=i=>i>=65136&&i<=65279,F=i=>i>=65280&&i<=65519;function B(i){for(const e of i)if(Ie(e.charCodeAt(0)))return!0;return!1}function X(i){for(const e of i)if(!ve(e.charCodeAt(0)))return!1;return!0}function ve(i){return!(Dc(i)||Zl(i)||ll(i)||ro(i)||C(i))}function Ie(i){return!(746!==i&&747!==i&&(i<4352||!(Ac(i)||Sc(i)||M(i)&&!(i>=65097&&i<=65103)||ul(i)||cl(i)||ou(i)||Xl(i)||!(!Wl(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||za(i)||os(i)||Yl(i)||(e=i,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||As(i)||Is(i)||Ic(i)||(e=>e>=12688&&e<=12703)(i)||Fo(i)||Ks(i)||Ys(i)&&12540!==i||!(!F(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!T(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||ch(i)||(e=>e>=19904&&e<=19967)(i)||Ss(i)||ya(i))));var e}function at(i){return!(Ie(i)||(e=i,(s=e)>=128&&s<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(s=>s>=8192&&s<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(s=>s>=8448&&s<=8527)(e)||(s=>s>=8528&&s<=8591)(e)||(s=>s>=8960&&s<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(s=>s>=9216&&s<=9279)(e)&&9251!==e||(s=>s>=9280&&s<=9311)(e)||(s=>s>=9312&&s<=9471)(e)||(s=>s>=9632&&s<=9727)(e)||(s=>s>=9728&&s<=9983)(e)&&!(e>=9754&&e<=9759)||(s=>s>=11008&&s<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Wl(e)||Ys(e)||(s=>s>=57344&&s<=63743)(e)||M(e)||T(e)||F(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,s}function Nt(i){return i>=1424&&i<=2303||ro(i)||C(i)}function Kn(i,e){return!(!e&&Nt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(s=i,s>=6016&&s<=6143));var s}function un(i){for(const e of i)if(Nt(e.charCodeAt(0)))return!0;return!1}const ar="deferred",f="loading",r="loaded";let c=null,p="unavailable",y=null;const v=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(p="error"),c&&c(i)};function D(){A.fire(new je("pluginStateChange",{pluginStatus:p,pluginURL:y}))}const A=new gt,k=function(){return p},z=function(){if(p!==ar||!y)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=f,D(),y&&q({url:y},i=>{i?v(i):(p=r,D())})},V={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===r||null!=V.applyArabicShaping,isLoading:()=>p===f,setState(i){p=i.pluginStatus,y=i.pluginURL},isParsed:()=>null!=V.applyArabicShaping&&null!=V.processBidirectionalText&&null!=V.processStyledBidirectionalText,getPluginURL:()=>y};class j{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new al,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,l){for(const h of s)if(!Kn(h.charCodeAt(0),l))return!1;return!0}(e,V.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Y{constructor(e,s){this.property=e,this.value=s,this.expression=function(l,h){if(Gs(l))return new Po(l,h);if(to(l)){const m=wc(l,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===h.type&&(m=qe.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===s?e.specification.default:s,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,s,l){return this.property.possiblyEvaluate(this,e,s,l)}}class ee{constructor(e){this.property=e,this.value=new Y(e,void 0)}transitioned(e,s){return new ne(this.property,this.value,s,Pr({},e.transition,this.transition),e.now)}untransitioned(){return new ne(this.property,this.value,null,{},0)}}class oe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return sr(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new ee(this._values[e].property)),this._values[e].value=new Y(this._values[e].property,null===s?void 0:sr(s))}getTransition(e){return sr(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new ee(this._values[e].property)),this._values[e].transition=sr(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l);const h=this.getTransition(s);void 0!==h&&(e[`${s}-transition`]=h)}return e}transitioned(e,s){const l=new de(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,s._values[h]);return l}untransitioned(){const e=new de(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class ne{constructor(e,s,l,h,m){const _=h.delay||0,x=h.duration||0;m=m||0,this.property=e,this.value=s,this.begin=m+_,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,s,l){const h=e.now||0,m=this.value.possiblyEvaluate(e,s,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(e,s,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,s,l),m,dn(x))}}return m}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,l){const h=new ge(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,s,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class re{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return sr(this._values[e].value)}setValue(e,s){this._values[e]=new Y(this._values[e].property,null===s?void 0:sr(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l)}return e}possiblyEvaluate(e,s,l){const h=new ge(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,s,l);return h}}class pe{constructor(e,s,l){this.property=e,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,s,l,h){return this.property.evaluate(this.value,this.parameters,e,s,l,h)}}class ge{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class se{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,l){const h=mo[this.specification.type];return h?h(e,s,l):e}}class _e{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,l,h){return new pe(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(s,null,{},l,h)}:e.expression,s)}interpolate(e,s,l){if("constant"!==e.value.kind||"constant"!==s.value.kind)return e;if(void 0===e.value.value||void 0===s.value.value)return new pe(this,{kind:"constant",value:void 0},e.parameters);const h=mo[this.specification.type];return h?new pe(this,{kind:"constant",value:h(e.value.value,s.value.value,l)},e.parameters):e}evaluate(e,s,l,h,m,_){return"constant"===e.kind?e.value:e.evaluate(s,l,h,m,_)}}class Ce extends _e{possiblyEvaluate(e,s,l,h){if(void 0===e.value)return new pe(this,{kind:"constant",value:void 0},s);if("constant"===e.expression.kind){const m=e.expression.evaluate(s,null,{},l,h),_="resolvedImage"===e.property.specification.type&&"string"!=typeof m?m.name:m,x=this._calculate(_,_,_,s);return new pe(this,{kind:"constant",value:x},s)}if("camera"===e.expression.kind){const m=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new pe(this,{kind:"constant",value:m},s)}return new pe(this,e.expression,s)}evaluate(e,s,l,h,m,_){if("source"===e.kind){const x=e.evaluate(s,l,h,m,_);return this._calculate(x,x,x,s)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},l,h),e.evaluate({zoom:Math.floor(s.zoom)},l,h),e.evaluate({zoom:Math.floor(s.zoom)+1},l,h),s):e.value}_calculate(e,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:s,other:l}:{from:l,to:s,other:e}}interpolate(e){return e}}class Ze{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,h){if(void 0!==e.value){if("constant"===e.expression.kind){const m=e.expression.evaluate(s,null,{},l,h);return this._calculate(m,m,m,s)}return this._calculate(e.expression.evaluate(new j(Math.floor(s.zoom-1),s)),e.expression.evaluate(new j(Math.floor(s.zoom),s)),e.expression.evaluate(new j(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:l,to:s}}interpolate(e){return e}}class Xe{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,h){return!!e.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class nt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new Y(l,void 0),m=this.defaultTransitionablePropertyValues[s]=new ee(l);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}function rt(i,e){return 256*(i=_t(Math.floor(i),0,255))+_t(Math.floor(e),0,255)}Ft("DataDrivenProperty",_e),Ft("DataConstantProperty",se),Ft("CrossFadedDataDrivenProperty",Ce),Ft("CrossFadedProperty",Ze),Ft("ColorRampProperty",Xe);const wt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class et{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function He(i,e=1){let s=0,l=0;return{members:i.map(h=>{const m=wt[h.type].BYTES_PER_ELEMENT,_=s=Tt(s,Math.max(e,m)),x=h.components||1;return l=Math.max(l,m),s+=m*x,{name:h.name,type:h.type,components:x,offset:_}}),size:Tt(s,Math.max(l,e)),alignment:e}}function Tt(i,e){return Math.ceil(i/e)*e}class Lt extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.int16[h+0]=s,this.int16[h+1]=l,e}}Lt.prototype.bytesPerElement=4,Ft("StructArrayLayout2i4",Lt);class Jt extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,l,h)}emplace(e,s,l,h,m){const _=4*e;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=m,e}}Jt.prototype.bytesPerElement=8,Ft("StructArrayLayout4i8",Jt);class pn extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,m,_,x)}emplace(e,s,l,h,m,_,x,w){const I=6*e,P=12*e,R=3*e;return this.int16[I+0]=s,this.int16[I+1]=l,this.uint8[P+4]=h,this.uint8[P+5]=m,this.uint8[P+6]=_,this.uint8[P+7]=x,this.float32[R+2]=w,e}}pn.prototype.bytesPerElement=12,Ft("StructArrayLayout2i4ub1f12",pn);class rn extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const m=3*e;return this.float32[m+0]=s,this.float32[m+1]=l,this.float32[m+2]=h,e}}rn.prototype.bytesPerElement=12,Ft("StructArrayLayout3f12",rn);class ln extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w,I,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,s,l,h,m,_,x,w,I,P)}emplace(e,s,l,h,m,_,x,w,I,P,R){const O=10*e;return this.uint16[O+0]=s,this.uint16[O+1]=l,this.uint16[O+2]=h,this.uint16[O+3]=m,this.uint16[O+4]=_,this.uint16[O+5]=x,this.uint16[O+6]=w,this.uint16[O+7]=I,this.uint16[O+8]=P,this.uint16[O+9]=R,e}}ln.prototype.bytesPerElement=20,Ft("StructArrayLayout10ui20",ln);class qt extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w){const I=this.length;return this.resize(I+1),this.emplace(I,e,s,l,h,m,_,x,w)}emplace(e,s,l,h,m,_,x,w,I){const P=8*e;return this.uint16[P+0]=s,this.uint16[P+1]=l,this.uint16[P+2]=h,this.uint16[P+3]=m,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=w,this.uint16[P+7]=I,e}}qt.prototype.bytesPerElement=16,Ft("StructArrayLayout8ui16",qt);class vn extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce){const me=this.length;return this.resize(me+1),this.emplace(me,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce)}emplace(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me){const xe=16*e;return this.int16[xe+0]=s,this.int16[xe+1]=l,this.int16[xe+2]=h,this.int16[xe+3]=m,this.uint16[xe+4]=_,this.uint16[xe+5]=x,this.uint16[xe+6]=w,this.uint16[xe+7]=I,this.int16[xe+8]=P,this.int16[xe+9]=R,this.int16[xe+10]=O,this.int16[xe+11]=G,this.int16[xe+12]=Z,this.int16[xe+13]=Q,this.int16[xe+14]=ce,this.int16[xe+15]=me,e}}vn.prototype.bytesPerElement=32,Ft("StructArrayLayout4i4ui4i4i32",vn);class Jn extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}Jn.prototype.bytesPerElement=4,Ft("StructArrayLayout1ul4",Jn);class gi extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w,I,P,R,O,G){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,s,l,h,m,_,x,w,I,P,R,O,G)}emplace(e,s,l,h,m,_,x,w,I,P,R,O,G,Z){const Q=20*e,ce=10*e;return this.int16[Q+0]=s,this.int16[Q+1]=l,this.int16[Q+2]=h,this.int16[Q+3]=m,this.int16[Q+4]=_,this.float32[ce+3]=x,this.float32[ce+4]=w,this.float32[ce+5]=I,this.float32[ce+6]=P,this.int16[Q+14]=R,this.uint32[ce+8]=O,this.uint16[Q+18]=G,this.uint16[Q+19]=Z,e}}gi.prototype.bytesPerElement=40,Ft("StructArrayLayout5i4f1i1ul2ui40",gi);class Ii extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,h,m,_,x)}emplace(e,s,l,h,m,_,x,w){const I=8*e;return this.int16[I+0]=s,this.int16[I+1]=l,this.int16[I+2]=h,this.int16[I+4]=m,this.int16[I+5]=_,this.int16[I+6]=x,this.int16[I+7]=w,e}}Ii.prototype.bytesPerElement=16,Ft("StructArrayLayout3i2i2i16",Ii);class _o extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,l,h,m)}emplace(e,s,l,h,m,_){const x=4*e,w=8*e;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=m,this.int16[w+7]=_,e}}_o.prototype.bytesPerElement=16,Ft("StructArrayLayout2f1f2i16",_o);class Gi extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,l,h)}emplace(e,s,l,h,m){const _=12*e,x=3*e;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[x+1]=h,this.float32[x+2]=m,e}}Gi.prototype.bytesPerElement=12,Ft("StructArrayLayout2ub2f12",Gi);class $r extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const m=3*e;return this.uint16[m+0]=s,this.uint16[m+1]=l,this.uint16[m+2]=h,e}}$r.prototype.bytesPerElement=6,Ft("StructArrayLayout3ui6",$r);class Lo extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe){const ze=this.length;return this.resize(ze+1),this.emplace(ze,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe)}emplace(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe,ze){const it=30*e,Qe=15*e,At=60*e;return this.int16[it+0]=s,this.int16[it+1]=l,this.int16[it+2]=h,this.float32[Qe+2]=m,this.float32[Qe+3]=_,this.uint16[it+8]=x,this.uint16[it+9]=w,this.uint32[Qe+5]=I,this.uint32[Qe+6]=P,this.uint32[Qe+7]=R,this.uint16[it+16]=O,this.uint16[it+17]=G,this.uint16[it+18]=Z,this.float32[Qe+10]=Q,this.float32[Qe+11]=ce,this.uint8[At+48]=me,this.uint8[At+49]=xe,this.uint8[At+50]=Ae,this.uint32[Qe+13]=Re,this.int16[it+28]=Fe,this.uint8[At+58]=ze,e}}Lo.prototype.bytesPerElement=60,Ft("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Lo);class Qs extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe,ze,it,Qe,At,mt,ot,vt,xt,lt){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe,ze,it,Qe,At,mt,ot,vt,xt,lt)}emplace(e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce,me,xe,Ae,Re,Fe,ze,it,Qe,At,mt,ot,vt,xt,lt,Mt){const kt=38*e,xn=19*e;return this.int16[kt+0]=s,this.int16[kt+1]=l,this.int16[kt+2]=h,this.float32[xn+2]=m,this.float32[xn+3]=_,this.int16[kt+8]=x,this.int16[kt+9]=w,this.int16[kt+10]=I,this.int16[kt+11]=P,this.int16[kt+12]=R,this.int16[kt+13]=O,this.uint16[kt+14]=G,this.uint16[kt+15]=Z,this.uint16[kt+16]=Q,this.uint16[kt+17]=ce,this.uint16[kt+18]=me,this.uint16[kt+19]=xe,this.uint16[kt+20]=Ae,this.uint16[kt+21]=Re,this.uint16[kt+22]=Fe,this.uint16[kt+23]=ze,this.uint16[kt+24]=it,this.uint16[kt+25]=Qe,this.uint16[kt+26]=At,this.uint16[kt+27]=mt,this.uint16[kt+28]=ot,this.uint32[xn+15]=vt,this.float32[xn+16]=xt,this.float32[xn+17]=lt,this.float32[xn+18]=Mt,e}}Qs.prototype.bytesPerElement=76,Ft("StructArrayLayout3i2f6i15ui1ul3f76",Qs);class En extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}En.prototype.bytesPerElement=4,Ft("StructArrayLayout1f4",En);class ti extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,s,l)}emplace(e,s,l,h){const m=3*e;return this.int16[m+0]=s,this.int16[m+1]=l,this.int16[m+2]=h,e}}ti.prototype.bytesPerElement=6,Ft("StructArrayLayout3i6",ti);class Wn extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,l,h)}emplace(e,s,l,h,m){const _=6*e;return this.uint32[3*e+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=m,e}}Wn.prototype.bytesPerElement=12,Ft("StructArrayLayout1ul3ui12",Wn);class lr extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.uint16[h+0]=s,this.uint16[h+1]=l,e}}lr.prototype.bytesPerElement=4,Ft("StructArrayLayout2ui4",lr);class li extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}li.prototype.bytesPerElement=2,Ft("StructArrayLayout1ui2",li);class Sr extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const h=2*e;return this.float32[h+0]=s,this.float32[h+1]=l,e}}Sr.prototype.bytesPerElement=8,Ft("StructArrayLayout2f8",Sr);class Oo extends Dt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,s,l,h)}emplace(e,s,l,h,m){const _=4*e;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=m,e}}Oo.prototype.bytesPerElement=16,Ft("StructArrayLayout4f16",Oo);class Kl extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Kl.prototype.size=40;class Zo extends gi{get(e){return new Kl(this,e)}}Ft("CollisionBoxArray",Zo);class Wo extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wo.prototype.size=60;class Js extends Lo{get(e){return new Wo(this,e)}}Ft("PlacedSymbolArray",Js);class hl extends et{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}hl.prototype.size=76;class Xo extends Qs{get(e){return new hl(this,e)}}Ft("SymbolInstanceArray",Xo);class uh extends En{getoffsetX(e){return this.float32[1*e+0]}}Ft("GlyphOffsetArray",uh);class Ql extends ti{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ft("SymbolLineVertexArray",Ql);class Jl extends et{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Jl.prototype.size=12;class Ou extends Wn{get(e){return new Jl(this,e)}}Ft("FeatureIndexArray",Ou);class Td extends et{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Td.prototype.size=4;class ip extends lr{get(e){return new Td(this,e)}}Ft("FillExtrusionCentroidArray",ip);const tg=He([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),su=He([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var au=ue(function(i){i.exports=function(e,s){var l,h,m,_,x,w,I,P;for(h=e.length-(l=3&e.length),m=s,x=3432918353,w=461845907,P=0;P<h;)I=255&e.charCodeAt(P)|(255&e.charCodeAt(++P))<<8|(255&e.charCodeAt(++P))<<16|(255&e.charCodeAt(++P))<<24,++P,m=27492+(65535&(_=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(I=0,l){case 3:I^=(255&e.charCodeAt(P+2))<<16;case 2:I^=(255&e.charCodeAt(P+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&e.charCodeAt(P)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*w+(((I>>>16)*w&65535)<<16)&4294967295}return m^=e.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),ng=ue(function(i){i.exports=function(e,s){for(var l,h=e.length,m=s^h,_=0;h>=4;)l=1540483477*(65535&(l=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&e.charCodeAt(_+2))<<16;case 2:m^=(255&e.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&e.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),hh=au,op=ng;hh.murmur3=au,hh.murmur2=op;class dh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,l,h){this.ids.push(rg(e)),this.positions.push(s,l,h)}getPositions(e){const s=rg(e);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=s?h=_:l=_+1}const m=[];for(;this.ids[l]===s;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,s){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Dd(l,h,0,l.length-1),s&&s.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const s=new dh;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function rg(i){const e=+i;return!isNaN(e)&&e<=We?e:hh(String(i))}function Dd(i,e,s,l){for(;s<l;){const h=i[s+l>>1];let m=s-1,_=l+1;for(;;){do{m++}while(i[m]<h);do{_--}while(i[_]>h);if(m>=_)break;fh(i,m,_),fh(e,3*m,3*_),fh(e,3*m+1,3*_+1),fh(e,3*m+2,3*_+2)}_-s<l-_?(Dd(i,e,s,_),s=_+1):(Dd(i,e,_+1,l),l=_)}}function fh(i,e,s){const l=i[e];i[e]=i[s],i[s]=l}Ft("FeaturePositionMap",dh);class dl{constructor(e,s){this.gl=e.gl,this.location=s}}class Mc extends dl{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ph extends dl{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Pc extends dl{constructor(e,s){super(e,s),this.current=qe.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const ig=new Float32Array(16),og=new Float32Array(9),Oy=new Float32Array(4);function lu(i){return[rt(255*i.r,255*i.g),rt(255*i.b,255*i.a)]}class Rc{constructor(e,s,l){this.value=e,this.uniformNames=s.map(h=>`u_${h}`),this.type=l}setUniform(e,s,l){e.set(l.constantOr(this.value))}getBinding(e,s,l){return"color"===this.type?new Pc(e,s):new Mc(e,s)}}class kc{constructor(e,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,s,l,h){const m="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new ph(e,s):new Mc(e,s)}}class Na{constructor(e,s,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,s,l,h,m,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new j(0),s,{},m,h,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,s,l,h,m){const _=this.expression.evaluate({zoom:0},l,h,void 0,m);this._setPaintValue(e,s,_)}_setPaintValue(e,s,l){if("color"===this.type){const h=lu(l);for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<s;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ea{constructor(e,s,l,h,m,_){this.expression=e,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,s,l,h,m,_){const x=this.expression.evaluate(new j(this.zoom),s,{},m,h,_),w=this.expression.evaluate(new j(this.zoom+1),s,{},m,h,_),I=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(I,e,x,w)}updatePaintArray(e,s,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,m);this._setPaintValue(e,s,_,x)}_setPaintValue(e,s,l,h){if("color"===this.type){const m=lu(l),_=lu(h);for(let x=e;x<s;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=e;m<s;m++)this.paintVertexArray.emplace(m,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=_t(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,s,l){return new Mc(e,s)}}class ss{constructor(e,s,l,h,m,_,x){this.expression=e,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=x,this.paintVertexAttributes=("array"===l?su:tg).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,s,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(e,s,l,h,m,_){this._setPaintValues(e,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,s,l,h){if(!h||!l)return;const{min:m,mid:_,max:x}=l,w=h[m],I=h[_],P=h[x];if(w&&I&&P)for(let R=e;R<s;R++)this._setPaintValue(this.zoomInPaintVertexArray,R,I,w),this._setPaintValue(this.zoomOutPaintVertexArray,R,I,P)}_setPaintValue(e,s,l,h){e.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class fl{constructor(e,s,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!l(m))continue;const _=e.paint.get(m);if(!(_ instanceof pe&&Ho(_.property.specification)))continue;const x=ag(m,e.type),w=_.value,I=_.property.specification.type,P=_.property.useIntegerZoom,R=_.property.specification["property-type"],O="cross-faded"===R||"cross-faded-data-driven"===R,G="line-dasharray"===String(m)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==w.kind||G)if("source"===w.kind||G||O){const Z=Lc(m,I,"source");this.binders[m]=O?new ss(w,x,I,P,s,Z,e.id):new Na(w,x,I,Z),h.push(`/a_${m}`)}else{const Z=Lc(m,I,"composite");this.binders[m]=new ea(w,x,I,P,s,Z),h.push(`/z_${m}`)}else this.binders[m]=O?new kc(w.value,x):new Rc(w.value,x,I),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof Na||s instanceof ea?s.maxValue:0}populatePaintArrays(e,s,l,h,m,_){for(const x in this.binders){const w=this.binders[x];(w instanceof Na||w instanceof ea||w instanceof ss)&&w.populatePaintArray(e,s,l,h,m,_)}}setConstantPatternPositions(e,s){for(const l in this.binders){const h=this.binders[l];h instanceof kc&&h.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,l,h,m,_){let x=!1;for(const w in e){const I=s.getPositions(w);for(const P of I){const R=l.feature(P.index);for(const O in this.binders){const G=this.binders[O];if((G instanceof Na||G instanceof ea||G instanceof ss)&&!0===G.expression.isStateDependent){const Z=h.paint.get(O);G.expression=Z.value,G.updatePaintArray(P.start,P.end,R,e[w],m,_),x=!0}}}}return x}defines(){const e=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Rc||l instanceof kc)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Na||l instanceof ea||l instanceof ss)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Rc||l instanceof kc||l instanceof ea)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Rc||m instanceof kc||m instanceof ea)for(const _ of m.uniformNames)if(s[_]){const x=m.getBinding(e,s[_],_);l.push({name:_,property:h,binding:x})}}return l}setUniforms(e,s,l,h){for(const{name:m,property:_,binding:x}of s)this.binders[_].setUniform(x,h,l.get(_),m)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(e&&l instanceof ss){const h=2===e.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Na||l instanceof ea)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const s in this.binders){const l=this.binders[s];(l instanceof Na||l instanceof ea||l instanceof ss)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof Na||s instanceof ea||s instanceof ss)&&s.destroy()}}}class Fc{constructor(e,s,l=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new fl(h,s,l);this.needsUpload=!1,this._featureMap=new dh,this._bufferOffset=0}populatePaintArrays(e,s,l,h,m,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,s,h,m,_,x);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,l,h,m){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,s,_,h,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const sg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function ag(i,e){return sg[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const lg={"line-pattern":{source:ln,composite:ln},"fill-pattern":{source:ln,composite:ln},"fill-extrusion-pattern":{source:ln,composite:ln},"line-dasharray":{source:qt,composite:qt}},pl={color:{source:Sr,composite:Oo},number:{source:En,composite:Sr}};function Lc(i,e,s){const l=lg[i];return l&&l[s]||pl[e][s]}Ft("ConstantBinder",Rc),Ft("CrossFadedConstantBinder",kc),Ft("SourceExpressionBinder",Na),Ft("CrossFadedCompositeBinder",ss),Ft("CompositeExpressionBinder",ea),Ft("ProgramConfiguration",fl,{omit:["_buffers"]}),Ft("ProgramConfigurationSet",Fc);const zu="-transition";class va extends gt{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new re(s.layout)),s.paint)){this._transitionablePaint=new oe(s.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ge(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,l={}){null!=s&&this._validate(ma,`layers.${this.id}.layout.${e}`,e,s,l)||("visibility"!==e?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return zn(e,zu)?this._transitionablePaint.getTransition(e.slice(0,-zu.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,l={}){if(null!=s&&this._validate(ql,`layers.${this.id}.paint.${e}`,e,s,l))return!1;if(zn(e,zu))return this._transitionablePaint.setTransition(e.slice(0,-zu.length),s||void 0),!1;{const h=this._transitionablePaint._values[e],m="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(e,x,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Zr(e,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(e,s,l,h,m={}){return(!m||!1!==m.validate)&&Di(this,e.call(Ws,{key:s,layerType:this.type,objectKey:l,value:h,styleSpec:Pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof pe&&Ho(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=nl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const cg=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:ug}=cg;class Hi{constructor(e=[]){this.segments=e}prepareSegment(e,s,l,h){let m=this.segments[this.segments.length-1];return e>Hi.MAX_VERTEX_ARRAY_LENGTH&&Nn(`Max vertices per segment is ${Hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Hi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,l,h){return new Hi([{vertexOffset:e,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}Hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft("SegmentVector",Hi);var Hn=8192;class ec{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof gr?new gr(e.lng,e.lat):gr.convert(e),this}setSouthWest(e){return this._sw=e instanceof gr?new gr(e.lng,e.lat):gr.convert(e),this}extend(e){const s=this._sw,l=this._ne;let h,m;if(e instanceof gr)h=e,m=e;else{if(!(e instanceof ec))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ec.convert(e)):this.extend(gr.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new gr(h.lng,h.lat),this._ne=new gr(m.lng,m.lat)),this}getCenter(){return new gr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new gr(this.getWest(),this.getNorth())}getSouthEast(){return new gr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=gr.convert(e);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return!e||e instanceof ec?e:new ec(e)}}const sp=6371008.8;class gr{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new gr(ii(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,l=this.lat*s,h=e.lat*s,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*s);return sp*Math.acos(Math.min(m,1))}toBounds(e=0){const s=360*e/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new ec(new gr(this.lng-l,this.lat-s),new gr(this.lng+l,this.lat+s))}static convert(e){if(e instanceof gr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new gr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new gr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ap=2*Math.PI*sp;function lp(i){return ap*Math.cos(i*Math.PI/180)}function cp(i){return(180+i)/360}function Id(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Oc(i,e){return i/lp(e)}function tc(i){return 360*i-180}function qi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function zc(i,e){return i*lp(qi(e))}const ml=85.051129;class Nu{constructor(e,s,l=0){this.x=+e,this.y=+s,this.z=+l}static fromLngLat(e,s=0){const l=gr.convert(e);return new Nu(cp(l.lng),Id(l.lat),Oc(s,l.lat))}toLngLat(){return new gr(tc(this.x),qi(this.y))}toAltitude(){return zc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ap*(e=qi(this.y),1/Math.cos(e*Math.PI/180));var e}}function mh(i,e,s,l,h,m,_,x,w){const I=(e+l)/2,P=(s+h)/2,R=new Ve(I,P);x(R),function(O,G,Z,Q,ce,me){const xe=Z-ce,Ae=Q-me;return Math.abs((Q-G)*xe-(Z-O)*Ae)/Math.hypot(xe,Ae)}(R.x,R.y,m.x,m.y,_.x,_.y)>=w?(mh(i,e,s,I,P,m,R,x,w),mh(i,I,P,l,h,R,_,x,w)):i.push(_)}function zy(i,e,s){const l=[];let h,m,_;for(const x of i){const{x:w,y:I}=x;e(x),_?mh(l,h,m,w,I,_,x,e,s):l.push(x),h=w,m=I,_=x}return l}const up=Math.pow(2,14)-1,hg=-up-1;function Sd(i,e){const s=Math.round(i.x*e),l=Math.round(i.y*e);return i.x=_t(s,hg,up),i.y=_t(l,hg,up),(s<i.x||s>i.x+1||l<i.y||l>i.y+1)&&Nn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function xa(i,e,s){const l=i.loadGeometry(),h=i.extent,m=Hn/h;if(e&&s&&"mercator"!==s.projection.name){const _=1<<e.z,{scale:x,x:w,y:I,projection:P}=s,R=O=>{const G=tc((e.x+O.x/h)/_),Z=qi((e.y+O.y/h)/_),Q=P.project(G,Z);O.x=(Q.x*x-w)*h,O.y=(Q.y*x-I)*h};for(let O=0;O<l.length;O++)if(1!==i.type)l[O]=zy(l[O],R,1);else{const G=[];for(const Z of l[O])Z.x<0||Z.x>=h||Z.y<0||Z.y>=h||(R(Z),G.push(Z));l[O]=G}}for(const _ of l)for(const x of _)Sd(x,m);return l}function gl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?xa(i):[]}}function Ad(i,e,s,l,h){i.emplaceBack(2*e+(l+1)/2,2*s+(h+1)/2)}class hp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.indexArray=new $r,this.segments=new Hi,this.programConfigurations=new Fc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,h){const m=this.layers[0],_=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:w,id:I,index:P,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,G=gl(w,O);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),G,l))continue;const Z=x?x.evaluate(G,{},l):void 0,Q={id:I,properties:w.properties,type:w.type,sourceLayerIndex:R,index:P,geometry:O?G.geometry:xa(w,l,h),patterns:{},sortKey:Z};_.push(Q)}x&&_.sort((w,I)=>w.sortKey-I.sortKey);for(const w of _){const{geometry:I,index:P,sourceLayerIndex:R}=w,O=e[P].feature;this.addFeature(w,I,P,s.availableImages,l),s.featureIndex.insert(O,I,P,R,this.index)}}update(e,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ug),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,h,m){for(const _ of s)for(const x of _){const w=x.x,I=x.y;if(w<0||w>=Hn||I<0||I>=Hn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=P.vertexLength;Ad(this.layoutVertexArray,w,I,-1,-1),Ad(this.layoutVertexArray,w,I,1,-1),Ad(this.layoutVertexArray,w,I,1,1),Ad(this.layoutVertexArray,w,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,m)}}function Md(i,e){for(let s=0;s<i.length;s++)if(uu(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(uu(i,e[s]))return!0;return!!Pd(i,e)}function dg(i,e,s){return!!uu(i,e)||!!cu(e,i,s)}function dp(i,e){if(1===i.length)return gh(e,i[0]);for(let s=0;s<e.length;s++){const l=e[s];for(let h=0;h<l.length;h++)if(uu(i,l[h]))return!0}for(let s=0;s<i.length;s++)if(gh(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(Pd(i,e[s]))return!0;return!1}function fg(i,e,s){if(i.length>1){if(Pd(i,e))return!0;for(let l=0;l<e.length;l++)if(cu(e[l],i,s))return!0}for(let l=0;l<i.length;l++)if(cu(i[l],e,s))return!0;return!1}function Pd(i,e){if(0===i.length||0===e.length)return!1;for(let s=0;s<i.length-1;s++){const l=i[s],h=i[s+1];for(let m=0;m<e.length-1;m++)if(fp(l,h,e[m],e[m+1]))return!0}return!1}function fp(i,e,s,l){return Ni(i,s,l)!==Ni(e,s,l)&&Ni(i,e,s)!==Ni(i,e,l)}function cu(i,e,s){const l=s*s;if(1===e.length)return i.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Rd(i,e[h-1],e[h])<l)return!0;return!1}function Rd(i,e,s){const l=e.distSqr(s);if(0===l)return i.distSqr(e);const h=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/l;return i.distSqr(h<0?e:h>1?s:s.sub(e)._mult(h)._add(e))}function gh(i,e){let s,l,h,m=!1;for(let _=0;_<i.length;_++){s=i[_];for(let x=0,w=s.length-1;x<s.length;w=x++)l=s[x],h=s[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function uu(i,e){let s=!1;for(let l=0,h=i.length-1;l<i.length;h=l++){const m=i[l],_=i[h];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(s=!s)}return s}function ci(i,e,s,l,h){for(const _ of i)if(e<=_.x&&s<=_.y&&l>=_.x&&h>=_.y)return!0;const m=[new Ve(e,s),new Ve(e,h),new Ve(l,h),new Ve(l,s)];if(i.length>2)for(const _ of m)if(uu(i,_))return!0;for(let _=0;_<i.length-1;_++)if(pg(i[_],i[_+1],m))return!0;return!1}function pg(i,e,s){const l=s[0],h=s[2];if(i.x<l.x&&e.x<l.x||i.x>h.x&&e.x>h.x||i.y<l.y&&e.y<l.y||i.y>h.y&&e.y>h.y)return!1;const m=Ni(i,e,s[0]);return m!==Ni(i,e,s[1])||m!==Ni(i,e,s[2])||m!==Ni(i,e,s[3])}function hu(i,e,s){const l=e.paint.get(i).value;return"constant"===l.kind?l.value:s.programConfigurations.get(e.id).getMaxValue(i)}function du(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function kd(i,e,s,l,h){if(!e[0]&&!e[1])return i;const m=Ve.convert(e)._mult(h);"viewport"===s&&m._rotate(-l);const _=[];for(let x=0;x<i.length;x++)_.push(i[x].sub(m));return _}function pp(i,e,s,l){const h=Ve.convert(i)._mult(l);return"viewport"===e&&h._rotate(-s),h}Ft("CircleBucket",hp,{omit:["layers"]});const mg=new nt({"circle-sort-key":new _e(Pe.layout_circle["circle-sort-key"])});var gg={paint:new nt({"circle-radius":new _e(Pe.paint_circle["circle-radius"]),"circle-color":new _e(Pe.paint_circle["circle-color"]),"circle-blur":new _e(Pe.paint_circle["circle-blur"]),"circle-opacity":new _e(Pe.paint_circle["circle-opacity"]),"circle-translate":new se(Pe.paint_circle["circle-translate"]),"circle-translate-anchor":new se(Pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new se(Pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new se(Pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _e(Pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _e(Pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _e(Pe.paint_circle["circle-stroke-opacity"])}),layout:mg},zo="undefined"!=typeof Float32Array?Float32Array:Array;function mp(){var i=new zo(9);return zo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function gp(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function _g(i,e,s){var l=e[0],h=e[1],m=e[2],_=e[3],x=e[4],w=e[5],I=e[6],P=e[7],R=e[8],O=e[9],G=e[10],Z=e[11],Q=e[12],ce=e[13],me=e[14],xe=e[15],Ae=s[0],Re=s[1],Fe=s[2],ze=s[3];return i[0]=Ae*l+Re*x+Fe*R+ze*Q,i[1]=Ae*h+Re*w+Fe*O+ze*ce,i[2]=Ae*m+Re*I+Fe*G+ze*me,i[3]=Ae*_+Re*P+Fe*Z+ze*xe,i[4]=(Ae=s[4])*l+(Re=s[5])*x+(Fe=s[6])*R+(ze=s[7])*Q,i[5]=Ae*h+Re*w+Fe*O+ze*ce,i[6]=Ae*m+Re*I+Fe*G+ze*me,i[7]=Ae*_+Re*P+Fe*Z+ze*xe,i[8]=(Ae=s[8])*l+(Re=s[9])*x+(Fe=s[10])*R+(ze=s[11])*Q,i[9]=Ae*h+Re*w+Fe*O+ze*ce,i[10]=Ae*m+Re*I+Fe*G+ze*me,i[11]=Ae*_+Re*P+Fe*Z+ze*xe,i[12]=(Ae=s[12])*l+(Re=s[13])*x+(Fe=s[14])*R+(ze=s[15])*Q,i[13]=Ae*h+Re*w+Fe*O+ze*ce,i[14]=Ae*m+Re*I+Fe*G+ze*me,i[15]=Ae*_+Re*P+Fe*Z+ze*xe,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Bu=_g;function io(){var i=new zo(3);return zo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _h(i){return Math.hypot(i[0],i[1],i[2])}function Nc(i,e,s){var l=new zo(3);return l[0]=i,l[1]=e,l[2]=s,l}function Fd(i,e,s){return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],i}function yo(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i}function fu(i,e,s,l){return i[0]=e[0]+s[0]*l,i[1]=e[1]+s[1]*l,i[2]=e[2]+s[2]*l,i}function yh(i,e){var s=e[0],l=e[1],h=e[2],m=s*s+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i}function _p(i,e,s){var l=s[0],h=s[1],m=s[2],_=e[0],x=e[1],w=e[2],I=h*w-m*x,P=m*_-l*w,R=l*x-h*_,O=h*R-m*P,G=m*I-l*R,Z=l*P-h*I,Q=2*s[3];return P*=Q,R*=Q,G*=2,Z*=2,i[0]=_+(I*=Q)+(O*=2),i[1]=x+P+G,i[2]=w+R+Z,i}var Vu,i,yp=Fd,yg=yo,vp=_h;function Uu(i,e,s){var l=e[0],h=e[1],m=e[2],_=e[3];return i[0]=s[0]*l+s[4]*h+s[8]*m+s[12]*_,i[1]=s[1]*l+s[5]*h+s[9]*m+s[13]*_,i[2]=s[2]*l+s[6]*h+s[10]*m+s[14]*_,i[3]=s[3]*l+s[7]*h+s[11]*m+s[15]*_,i}function vh(){var i=new zo(4);return zo!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function xp(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function bp(i,e,s){s*=.5;var l=e[0],h=e[1],m=e[2],_=e[3],x=Math.sin(s),w=Math.cos(s);return i[0]=l*w+_*x,i[1]=h*w+m*x,i[2]=m*w-h*x,i[3]=_*w-l*x,i}function wp(i,e){return i[0]===e[0]&&i[1]===e[1]}function Ld(i,e,s,l,h,m,_,x,w){if(m&&i.queryGeometry.isAboveHorizon)return!1;m&&(w*=i.pixelToTileUnitsFactor);for(const I of e)for(const P of I){const R=P.add(x),O=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(R.x,R.y,!0):0,G=m?R:Od(R,O,l),Z=m?i.tilespaceRays.map(ce=>Ny(ce,O)):i.queryGeometry.screenGeometry,Q=Uu([],[P.x,P.y,O,1],l);if(!_&&m?w*=Q[3]/s.cameraToCenterDistance:_&&!m&&(w*=s.cameraToCenterDistance/Q[3]),dg(Z,G,w))return!0}return!1}function Od(i,e,s){const l=Uu([],[i.x,i.y,e,1],s);return new Ve(l[0]/l[3],l[1]/l[3])}io(),Vu=new zo(4),zo!=Float32Array&&(Vu[0]=0,Vu[1]=0,Vu[2]=0,Vu[3]=0),io(),Nc(1,0,0),Nc(0,1,0),vh(),vh(),mp(),i=new zo(2),zo!=Float32Array&&(i[0]=0,i[1]=0);const zd=Nc(0,0,0),vg=Nc(0,0,1);function Ny(i,e){const s=io();return zd[2]=e,i.intersectsPlane(zd,vg,s),new Ve(s[0],s[1])}class Nd extends hp{}function pu(i,{width:e,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*s*l);return i.width=e,i.height=s,i.data=h,i}function Ep(i,{width:e,height:s},l){if(e===i.width&&s===i.height)return;const h=pu({},{width:e,height:s},l);Bd(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},l),i.width=e,i.height=s,i.data=h.data}function Bd(i,e,s,l,h,m){if(0===h.width||0===h.height)return e;if(h.width>i.width||h.height>i.height||s.x>i.width-h.width||s.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,x=e.data;for(let w=0;w<h.height;w++){const I=((s.y+w)*i.width+s.x)*m,P=((l.y+w)*e.width+l.x)*m;for(let R=0;R<h.width*m;R++)x[P+R]=_[I+R]}return e}Ft("HeatmapBucket",Nd,{omit:["layers"]});class Ms{constructor(e,s){pu(this,e,1,s)}resize(e){Ep(this,e,1)}clone(){return new Ms({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,h,m){Bd(e,s,l,h,m,1)}}class Ps{constructor(e,s){pu(this,e,4,s)}resize(e){Ep(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ps({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,h,m){Bd(e,s,l,h,m,4)}}Ft("AlphaImage",Ms),Ft("RGBAImage",Ps);var xg={paint:new nt({"heatmap-radius":new _e(Pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _e(Pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new se(Pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xe(Pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new se(Pe.paint_heatmap["heatmap-opacity"])})};function Vd(i){const e={},s=i.resolution||256,l=i.clips?i.clips.length:1,h=i.image||new Ps({width:s,height:l}),m=(_,x,w)=>{e[i.evaluationKey]=w;const I=i.expression.evaluate(e);h.data[_+x+0]=Math.floor(255*I.r/I.a),h.data[_+x+1]=Math.floor(255*I.g/I.a),h.data[_+x+2]=Math.floor(255*I.b/I.a),h.data[_+x+3]=Math.floor(255*I.a)};if(i.clips)for(let _=0,x=0;_<l;++_,x+=4*s)for(let w=0,I=0;w<s;w++,I+=4){const P=w/(s-1),{start:R,end:O}=i.clips[_];m(x,I,R*(1-P)+O*P)}else for(let _=0,x=0;_<s;_++,x+=4)m(0,x,_/(s-1));return h}var bg={paint:new nt({"hillshade-illumination-direction":new se(Pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new se(Pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new se(Pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new se(Pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new se(Pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new se(Pe.paint_hillshade["hillshade-accent-color"])})};const wg=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:xh}=wg;var Yo=bh,Cp=bh;function bh(i,e,s){s=s||2;var l,h,m,_,x,w,I,P=e&&e.length,R=P?e[0]*s:i.length,O=Tp(i,0,R,s,!0),G=[];if(!O||O.next===O.prev)return G;if(P&&(O=function(Q,ce,me,xe){var Ae,Re,Fe,ze=[];for(Ae=0,Re=ce.length;Ae<Re;Ae++)(Fe=Tp(Q,ce[Ae]*xe,Ae<Re-1?ce[Ae+1]*xe:Q.length,xe,!1))===Fe.next&&(Fe.steiner=!0),ze.push(Sp(Fe));for(ze.sort(mu),Ae=0;Ae<ze.length;Ae++)me=_l(me=Ba(ze[Ae],me),me.next);return me}(i,e,O,s)),i.length>80*s){l=m=i[0],h=_=i[1];for(var Z=s;Z<R;Z+=s)(x=i[Z])<l&&(l=x),(w=i[Z+1])<h&&(h=w),x>m&&(m=x),w>_&&(_=w);I=0!==(I=Math.max(m-l,_-h))?1/I:0}return wh(O,G,s,l,h,I),G}function Tp(i,e,s,l,h){var m,_;if(h===Mp(i,e,s,l)>0)for(m=e;m<s;m+=l)_=Eh(m,i[m],i[m+1],_);else for(m=s-l;m>=e;m-=l)_=Eh(m,i[m],i[m+1],_);return _&&gu(_,_.next)&&(Bc(_),_=_.next),_}function _l(i,e){if(!i)return i;e||(e=i);var s,l=i;do{if(s=!1,l.steiner||!gu(l,l.next)&&0!==ni(l.prev,l,l.next))l=l.next;else{if(Bc(l),(l=e=l.prev)===l.next)break;s=!0}}while(s||l!==e);return e}function wh(i,e,s,l,h,m,_){if(i){!_&&m&&function(P,R,O,G){var Z=P;do{null===Z.z&&(Z.z=Ip(Z.x,Z.y,R,O,G)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next}while(Z!==P);Z.prevZ.nextZ=null,Z.prevZ=null,function(Q){var ce,me,xe,Ae,Re,Fe,ze,it,Qe=1;do{for(me=Q,Q=null,Re=null,Fe=0;me;){for(Fe++,xe=me,ze=0,ce=0;ce<Qe&&(ze++,xe=xe.nextZ);ce++);for(it=Qe;ze>0||it>0&&xe;)0!==ze&&(0===it||!xe||me.z<=xe.z)?(Ae=me,me=me.nextZ,ze--):(Ae=xe,xe=xe.nextZ,it--),Re?Re.nextZ=Ae:Q=Ae,Ae.prevZ=Re,Re=Ae;me=xe}Re.nextZ=null,Qe*=2}while(Fe>1)}(Z)}(i,l,h,m);for(var x,w,I=i;i.prev!==i.next;)if(x=i.prev,w=i.next,m?Eg(i,l,h,m):Dp(i))e.push(x.i/s),e.push(i.i/s),e.push(w.i/s),Bc(i),i=w.next,I=w.next;else if((i=w)===I){_?1===_?wh(i=Cg(_l(i),e,s),e,s,l,h,m,2):2===_&&Tg(i,e,s,l,h,m):wh(_l(i),e,s,l,h,m,1);break}}}function Dp(i){var e=i.prev,s=i,l=i.next;if(ni(e,s,l)>=0)return!1;for(var h=i.next.next;h!==i.prev;){if(ju(e.x,e.y,s.x,s.y,l.x,l.y,h.x,h.y)&&ni(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Eg(i,e,s,l){var h=i.prev,m=i,_=i.next;if(ni(h,m,_)>=0)return!1;for(var x=h.x>m.x?h.x>_.x?h.x:_.x:m.x>_.x?m.x:_.x,w=h.y>m.y?h.y>_.y?h.y:_.y:m.y>_.y?m.y:_.y,I=Ip(h.x<m.x?h.x<_.x?h.x:_.x:m.x<_.x?m.x:_.x,h.y<m.y?h.y<_.y?h.y:_.y:m.y<_.y?m.y:_.y,e,s,l),P=Ip(x,w,e,s,l),R=i.prevZ,O=i.nextZ;R&&R.z>=I&&O&&O.z<=P;){if(R!==i.prev&&R!==i.next&&ju(h.x,h.y,m.x,m.y,_.x,_.y,R.x,R.y)&&ni(R.prev,R,R.next)>=0||(R=R.prevZ,O!==i.prev&&O!==i.next&&ju(h.x,h.y,m.x,m.y,_.x,_.y,O.x,O.y)&&ni(O.prev,O,O.next)>=0))return!1;O=O.nextZ}for(;R&&R.z>=I;){if(R!==i.prev&&R!==i.next&&ju(h.x,h.y,m.x,m.y,_.x,_.y,R.x,R.y)&&ni(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;O&&O.z<=P;){if(O!==i.prev&&O!==i.next&&ju(h.x,h.y,m.x,m.y,_.x,_.y,O.x,O.y)&&ni(O.prev,O,O.next)>=0)return!1;O=O.nextZ}return!0}function Cg(i,e,s){var l=i;do{var h=l.prev,m=l.next.next;!gu(h,m)&&Ap(h,l,l.next,m)&&_u(h,m)&&_u(m,h)&&(e.push(h.i/s),e.push(l.i/s),e.push(m.i/s),Bc(l),Bc(l.next),l=i=m),l=l.next}while(l!==i);return _l(l)}function Tg(i,e,s,l,h,m){var _=i;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&Va(_,x)){var w=Ud(_,x);return _=_l(_,_.next),w=_l(w,w.next),wh(_,e,s,l,h,m),void wh(w,e,s,l,h,m)}x=x.next}_=_.next}while(_!==i)}function mu(i,e){return i.x-e.x}function Ba(i,e){var s=function(m,_){var x,w=_,I=m.x,P=m.y,R=-1/0;do{if(P<=w.y&&P>=w.next.y&&w.next.y!==w.y){var O=w.x+(P-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=I&&O>R){if(R=O,O===I){if(P===w.y)return w;if(P===w.next.y)return w.next}x=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!x)return null;if(I===R)return x;var G,Z=x,Q=x.x,ce=x.y,me=1/0;w=x;do{I>=w.x&&w.x>=Q&&I!==w.x&&ju(P<ce?I:R,P,Q,ce,P<ce?R:I,P,w.x,w.y)&&(G=Math.abs(P-w.y)/(I-w.x),_u(w,m)&&(G<me||G===me&&(w.x>x.x||w.x===x.x&&By(x,w)))&&(x=w,me=G)),w=w.next}while(w!==Z);return x}(i,e);if(!s)return e;var l=Ud(s,i),h=_l(s,s.next);return _l(l,l.next),e===s?h:e}function By(i,e){return ni(i.prev,i,e.prev)<0&&ni(e.next,i,i.next)<0}function Ip(i,e,s,l,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*h)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-l)*h)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Sp(i){var e=i,s=i;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==i);return s}function ju(i,e,s,l,h,m,_,x){return(h-_)*(e-x)-(i-_)*(m-x)>=0&&(i-_)*(l-x)-(s-_)*(e-x)>=0&&(s-_)*(m-x)-(h-_)*(l-x)>=0}function Va(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,l){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&Ap(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(i,e)&&(_u(i,e)&&_u(e,i)&&function(s,l){var h=s,m=!1,_=(s.x+l.x)/2,x=(s.y+l.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==s);return m}(i,e)&&(ni(i.prev,i,e.prev)||ni(i,e.prev,e))||gu(i,e)&&ni(i.prev,i,i.next)>0&&ni(e.prev,e,e.next)>0)}function ni(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function gu(i,e){return i.x===e.x&&i.y===e.y}function Ap(i,e,s,l){var h=nc(ni(i,e,s)),m=nc(ni(i,e,l)),_=nc(ni(s,l,i)),x=nc(ni(s,l,e));return h!==m&&_!==x||!(0!==h||!$u(i,s,e))||!(0!==m||!$u(i,l,e))||!(0!==_||!$u(s,i,l))||!(0!==x||!$u(s,e,l))}function $u(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function nc(i){return i>0?1:i<0?-1:0}function _u(i,e){return ni(i.prev,i,i.next)<0?ni(i,e,i.next)>=0&&ni(i,i.prev,e)>=0:ni(i,e,i.prev)<0||ni(i,i.next,e)<0}function Ud(i,e){var s=new Ch(i.i,i.x,i.y),l=new Ch(e.i,e.x,e.y),h=i.next,m=e.prev;return i.next=e,e.prev=i,s.next=h,h.prev=s,l.next=s,s.prev=l,m.next=l,l.prev=m,l}function Eh(i,e,s,l){var h=new Ch(i,e,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Bc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ch(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mp(i,e,s,l){for(var h=0,m=e,_=s-l;m<s;m+=l)h+=(i[_]-i[m])*(i[m+1]+i[_+1]),_=m;return h}function yu(i,e,s,l,h){Th(i,e,s||0,l||i.length-1,h||Dg)}function Th(i,e,s,l,h){for(;l>s;){if(l-s>600){var m=l-s+1,_=e-s+1,x=Math.log(m),w=.5*Math.exp(2*x/3),I=.5*Math.sqrt(x*w*(m-w)/m)*(_-m/2<0?-1:1);Th(i,e,Math.max(s,Math.floor(e-_*w/m+I)),Math.min(l,Math.floor(e+(m-_)*w/m+I)),h)}var P=i[e],R=s,O=l;for(vu(i,s,e),h(i[l],P)>0&&vu(i,s,l);R<O;){for(vu(i,R,O),R++,O--;h(i[R],P)<0;)R++;for(;h(i[O],P)>0;)O--}0===h(i[s],P)?vu(i,s,O):vu(i,++O,l),O<=e&&(s=O+1),e<=O&&(l=O-1)}}function vu(i,e,s){var l=i[e];i[e]=i[s],i[s]=l}function Dg(i,e){return i<e?-1:i>e?1:0}function Gu(i,e){const s=i.length;if(s<=1)return[i];const l=[];let h,m;for(let _=0;_<s;_++){const x=ds(i[_]);0!==x&&(i[_].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(h&&l.push(h),h=[i[_]]):h.push(i[_]))}if(h&&l.push(h),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(yu(l[_],e,1,l[_].length-1,Ig),l[_]=l[_].slice(0,e));return l}function Ig(i,e){return e.area-i.area}function jd(i,e,s){const l=s.patternDependencies;let h=!1;for(const m of e){const _=m.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,l[x.to]=!0,l[x.from]=!0)}return h}function $d(i,e,s,l,h){const m=h.patternDependencies;for(const _ of e){const x=_.paint.get(`${i}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:l-1},s,{},h.availableImages),I=x.evaluate({zoom:l},s,{},h.availableImages),P=x.evaluate({zoom:l+1},s,{},h.availableImages);w=w&&w.name?w.name:w,I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,m[w]=!0,m[I]=!0,m[P]=!0,s.patterns[_.id]={min:w,mid:I,max:P}}}return s}bh.deviation=function(i,e,s,l){var h=e&&e.length,m=Math.abs(Mp(i,0,h?e[0]*s:i.length,s));if(h)for(var _=0,x=e.length;_<x;_++)m-=Math.abs(Mp(i,e[_]*s,_<x-1?e[_+1]*s:i.length,s));var w=0;for(_=0;_<l.length;_+=3){var I=l[_]*s,P=l[_+1]*s,R=l[_+2]*s;w+=Math.abs((i[I]-i[R])*(i[P+1]-i[I+1])-(i[I]-i[P])*(i[R+1]-i[I+1]))}return 0===m&&0===w?0:Math.abs((w-m)/m)},bh.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},l=0,h=0;h<i.length;h++){for(var m=0;m<i[h].length;m++)for(var _=0;_<e;_++)s.vertices.push(i[h][m][_]);h>0&&s.holes.push(l+=i[h-1].length)}return s},Yo.default=Cp;class Dh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lt,this.indexArray=new $r,this.indexArray2=new lr,this.programConfigurations=new Fc(e.layers,e.zoom),this.segments=new Hi,this.segments2=new Hi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,h){this.hasPattern=jd("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:w,index:I,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,O=gl(x,R);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),O,l))continue;const G=m?m.evaluate(O,{},l,s.availableImages):void 0,Z={id:w,properties:x.properties,type:x.type,sourceLayerIndex:P,index:I,geometry:R?O.geometry:xa(x,l,h),patterns:{},sortKey:G};_.push(Z)}m&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:I,sourceLayerIndex:P}=x;if(this.hasPattern){const R=$d("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(R)}else this.addFeature(x,w,I,l,{},s.availableImages);s.featureIndex.insert(e[I].feature,w,I,P,this.index)}}update(e,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,h)}addFeatures(e,s,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,l,h,m,_=[]){for(const x of Gu(s,500)){let w=0;for(const Z of x)w+=Z.length;const I=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),P=I.vertexLength,R=[],O=[];for(const Z of x){if(0===Z.length)continue;Z!==x[0]&&O.push(R.length/2);const Q=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),ce=Q.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(ce+Z.length-1,ce),R.push(Z[0].x),R.push(Z[0].y);for(let me=1;me<Z.length;me++)this.layoutVertexArray.emplaceBack(Z[me].x,Z[me].y),this.indexArray2.emplaceBack(ce+me-1,ce+me),R.push(Z[me].x),R.push(Z[me].y);Q.vertexLength+=Z.length,Q.primitiveLength+=Z.length}const G=Yo(R,O);for(let Z=0;Z<G.length;Z+=3)this.indexArray.emplaceBack(P+G[Z],P+G[Z+1],P+G[Z+2]);I.vertexLength+=w,I.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,h)}}Ft("FillBucket",Dh,{omit:["layers","patternFeatures"]});const Sg=new nt({"fill-sort-key":new _e(Pe.layout_fill["fill-sort-key"])});var Ag={paint:new nt({"fill-antialias":new se(Pe.paint_fill["fill-antialias"]),"fill-opacity":new _e(Pe.paint_fill["fill-opacity"]),"fill-color":new _e(Pe.paint_fill["fill-color"]),"fill-outline-color":new _e(Pe.paint_fill["fill-outline-color"]),"fill-translate":new se(Pe.paint_fill["fill-translate"]),"fill-translate-anchor":new se(Pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ce(Pe.paint_fill["fill-pattern"])}),layout:Sg};const Pp=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gd=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Rp}=Pp;var Ih=xu;function xu(i,e,s,l,h){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=h,i.readFields(Mg,this,e)}function Mg(i,e,s){1==i?e.id=s.readVarint():2==i?function(l,h){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[_]=x}}(s,e):3==i?e.type=s.readVarint():4==i&&(e._geometry=s.pos)}function kp(i){for(var e,s,l=0,h=0,m=i.length,_=m-1;h<m;_=h++)l+=((s=i[_]).x-(e=i[h]).x)*(e.y+s.y);return l}xu.types=["Unknown","Point","LineString","Polygon"],xu.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,l=1,h=0,m=0,_=0,x=[];i.pos<s;){if(h<=0){var w=i.readVarint();l=7&w,h=w>>3}if(h--,1===l||2===l)m+=i.readSVarint(),_+=i.readSVarint(),1===l&&(e&&x.push(e),e=[]),e.push(new Ve(m,_));else{if(7!==l)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&x.push(e),x},xu.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,l=0,h=0,m=0,_=1/0,x=-1/0,w=1/0,I=-1/0;i.pos<e;){if(l<=0){var P=i.readVarint();s=7&P,l=P>>3}if(l--,1===s||2===s)(h+=i.readSVarint())<_&&(_=h),h>x&&(x=h),(m+=i.readSVarint())<w&&(w=m),m>I&&(I=m);else if(7!==s)throw new Error("unknown command "+s)}return[_,w,x,I]},xu.prototype.toGeoJSON=function(i,e,s){var l,h,m=this.extent*Math.pow(2,s),_=this.extent*i,x=this.extent*e,w=this.loadGeometry(),I=xu.types[this.type];function P(G){for(var Z=0;Z<G.length;Z++){var Q=G[Z];G[Z]=[360*(Q.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(l=0;l<w.length;l++)R[l]=w[l][0];P(w=R);break;case 2:for(l=0;l<w.length;l++)P(w[l]);break;case 3:for(w=function(G){var Z=G.length;if(Z<=1)return[G];for(var Q,ce,me=[],xe=0;xe<Z;xe++){var Ae=kp(G[xe]);0!==Ae&&(void 0===ce&&(ce=Ae<0),ce===Ae<0?(Q&&me.push(Q),Q=[G[xe]]):Q.push(G[xe]))}return Q&&me.push(Q),me}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)P(w[l][h])}1===w.length?w=w[0]:I="Multi"+I;var O={type:"Feature",geometry:{type:I,coordinates:w},properties:this.properties};return"id"in this&&(O.id=this.id),O};var Hd=rc;function rc(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Fp,this,e),this.length=this._features.length}function Fp(i,e,s){15===i?e.version=s.readVarint():1===i?e.name=s.readString():5===i?e.extent=s.readVarint():2===i?e._features.push(s.pos):3===i?e._keys.push(s.readString()):4===i&&e._values.push(function(l){for(var h=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(s))}function Lp(i,e,s){if(3===i){var l=new Hd(s,s.readVarint()+s.pos);l.length&&(e[l.name]=l)}}rc.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Ih(this._pbf,e,this.extent,this._keys,this._values)};var Vc={VectorTile:function(i,e){this.layers=i.readFields(Lp,{},e)},VectorTileFeature:Ih,VectorTileLayer:Hd};const Sh=Vc.VectorTileFeature.types,Pg=Math.pow(2,13);function bu(i,e,s,l,h,m,_,x){i.emplaceBack((e<<1)+_,(s<<1)+m,(Math.floor(l*Pg)<<1)+h,Math.round(x))}class qd{constructor(){this.acc=new Ve(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ve(e.x,e.y),this.max=new Ve(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let l=!!this.borders;const h=this.min,m=this.max;e.x<h.x?(h.x=e.x,l=!0):e.x>m.x&&(m.x=e.x,l=!0),e.y<h.y?(h.y=e.y,l=!0):e.y>m.y&&(m.y=e.y,l=!0),((0===e.x||e.x===Hn)&&e.x===s.x)!=((0===e.y||e.y===Hn)&&e.y===s.y)&&this.processBorderOverlap(e,s),l&&this.checkBorderIntersection(e,s)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,Ln(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Hn!=e.x>Hn&&this.addBorderIntersection(1,Ln(s.y,e.y,(Hn-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Ln(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Hn!=e.y>Hn&&this.addBorderIntersection(3,Ln(s.x,e.x,(Hn-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const l=0===e.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,e.y)}else{const l=0===e.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==e?this.acc.div(e)._round():new Ve(0,0)}span(){return new Ve(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Jt,this.centroidVertexArray=new ip,this.indexArray=new $r,this.programConfigurations=new Fc(e.layers,e.zoom),this.segments=new Hi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,l,h){this.features=[],this.hasPattern=jd("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/Hn/(1<<m.z)}(l);for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of e){const I=this.layers[0]._featureFilter.needGeometry,P=gl(m,I);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),P,l))continue;const R={id:_,sourceLayerIndex:w,index:x,geometry:I?P.geometry:xa(m,l,h),properties:m.properties,type:m.type,patterns:{}},O=this.layoutVertexArray.length;this.hasPattern?this.features.push($d("fill-extrusion",this.layers,R,this.zoom,s)):this.addFeature(R,R.geometry,x,l,{},s.availableImages),s.featureIndex.insert(m,R.geometry,x,w,this.index,O)}this.sortBorders()}addFeatures(e,s,l,h){for(const m of this.features){const{geometry:_}=m;this.addFeature(m,_,m.index,s,l,h)}this.sortBorders()}update(e,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,h,m,_){const x=this.enableTerrain?new qd:null;for(const I of Gu(s,500)){let P=0,R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===I.length||(w=I[0]).every(ce=>ce.x<=0)||w.every(ce=>ce.x>=Hn)||w.every(ce=>ce.y<=0)||w.every(ce=>ce.y>=Hn))continue;for(let ce=0;ce<I.length;ce++){const me=I[ce];if(0===me.length)continue;P+=me.length;let xe=0;x&&x.startRing(me[0]);for(let Ae=0;Ae<me.length;Ae++){const Re=me[Ae];if(Ae>=1){const Fe=me[Ae-1];if(!Zd(Re,Fe)){x&&x.append(Re,Fe),R.vertexLength+4>Hi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ze=Re.sub(Fe)._perp(),it=ze.x/(Math.abs(ze.x)+Math.abs(ze.y)),Qe=ze.y>0?1:0,At=Fe.dist(Re);xe+At>32768&&(xe=0),bu(this.layoutVertexArray,Re.x,Re.y,it,Qe,0,0,xe),bu(this.layoutVertexArray,Re.x,Re.y,it,Qe,0,1,xe),xe+=At,bu(this.layoutVertexArray,Fe.x,Fe.y,it,Qe,0,0,xe),bu(this.layoutVertexArray,Fe.x,Fe.y,it,Qe,0,1,xe);const mt=R.vertexLength;this.indexArray.emplaceBack(mt,mt+2,mt+1),this.indexArray.emplaceBack(mt+1,mt+2,mt+3),R.vertexLength+=4,R.primitiveLength+=2}}}}if(R.vertexLength+P>Hi.MAX_VERTEX_ARRAY_LENGTH&&(R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),"Polygon"!==Sh[e.type])continue;const O=[],G=[],Z=R.vertexLength;for(let ce=0;ce<I.length;ce++){const me=I[ce];if(0!==me.length){me!==I[0]&&G.push(O.length/2);for(let xe=0;xe<me.length;xe++){const Ae=me[xe];bu(this.layoutVertexArray,Ae.x,Ae.y,0,0,1,1,0),O.push(Ae.x),O.push(Ae.y),x&&x.currentPolyCount.top++}}}const Q=Yo(O,G);for(let ce=0;ce<Q.length;ce+=3)this.indexArray.emplaceBack(Z+Q[ce],Z+Q[ce+2],Z+Q[ce+1]);R.primitiveLength+=Q.length/3,R.vertexLength+=P}var w;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const I=x.borders,P=this.featuresOnBorder.push(x)-1;for(let R=0;R<4;R++)I[R][0]!==Number.MAX_VALUE&&this.borders[R].push(P)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,l)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,s,l=!0){let h,m;if(e)if(0!==e.y){const x=s.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(e.x+450)),m=0;else h=0,m=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(_++,h,m)}}}function Zd(i,e){return i.x===e.x&&(i.x<0||i.x>Hn)||i.y===e.y&&(i.y<0||i.y>Hn)}Ft("FillExtrusionBucket",Ah,{omit:["layers","features"]}),Ft("PartMetadata",qd);var Op={paint:new nt({"fill-extrusion-opacity":new se(Pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _e(Pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new se(Pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new se(Pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ce(Pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _e(Pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _e(Pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new se(Pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ic(i,e){return i.x*e.x+i.y*e.y}function Hu(i,e){if(1===i.length){let s=0;const l=e[s++];let h;for(;!h||l.equals(h);)if(h=e[s++],!h)return 1/0;for(;s<e.length;s++){const m=e[s],_=i[0],x=h.sub(l),w=m.sub(l),I=_.sub(l),P=ic(x,x),R=ic(x,w),O=ic(w,w),G=ic(I,x),Z=ic(I,w),Q=P*O-R*R,ce=(O*G-R*Z)/Q,me=(P*Z-R*G)/Q,xe=l.z*(1-ce-me)+h.z*ce+m.z*me;if(isFinite(xe))return xe}return 1/0}{let s=1/0;for(const l of e)s=Math.min(s,l.z);return s}}function Wd(i){const e=new Ve(i[0],i[1]);return e.z=i[2],e}function Xd(i,e,s,l,h,m,_,x){const w=_*h.getElevationAt(i,e,!0,!0),I=0!==m[0],P=I?0===m[1]?_*(m[0]/7-450):_*function(R,O,G){const Z=Math.floor(O[0]/8),Q=Math.floor(O[1]/8),ce=10*(O[0]-8*Z),me=10*(O[1]-8*Q),xe=R.getElevationAt(Z,Q,!0,!0),Ae=R.getMeterToDEM(G),Re=Math.floor(.5*(ce*Ae-1)),Fe=Math.floor(.5*(me*Ae-1)),ze=R.tileCoordToPixel(Z,Q),it=2*Re+1,Qe=2*Fe+1,At=(Er=it,hn=Qe,[(Mt=R).getElevationAtPixel(kt=ze.x-Re,xn=ze.y-Fe,!0),Mt.getElevationAtPixel(kt+hn,xn,!0),Mt.getElevationAtPixel(kt,xn+hn,!0),Mt.getElevationAtPixel(kt+Er,xn+hn,!0)]),mt=Math.abs(At[0]-At[1]),ot=Math.abs(At[2]-At[3]),vt=Math.abs(At[0]-At[2])+Math.abs(At[1]-At[3]),xt=Math.min(.25,.5*Ae*(mt+ot)/it),lt=Math.min(.25,.5*Ae*vt/Qe);var Mt,kt,xn,Er,hn;return xe+Math.max(xt*ce,lt*me)}(h,m,x):w;return{base:w+(0===s)?-1:s,top:I?Math.max(P+l,w+s+2):w+l}}const zp=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Yd}=zp,qu=He([{name:"a_packed",components:3,type:"Float32"}]),{members:Rg}=qu,Np=Vc.VectorTileFeature.types,kg=Math.cos(Math.PI/180*37.5);class Mh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new pn,this.layoutVertexArray2=new rn,this.indexArray=new $r,this.programConfigurations=new Fc(e.layers,e.zoom),this.segments=new Hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,h){this.hasPattern=jd("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:P,id:R,index:O,sourceLayerIndex:G}of e){const Z=this.layers[0]._featureFilter.needGeometry,Q=gl(P,Z);if(!this.layers[0]._featureFilter.filter(new j(this.zoom),Q,l))continue;const ce=m?m.evaluate(Q,{},l):void 0,me={id:R,properties:P.properties,type:P.type,sourceLayerIndex:G,index:O,geometry:Z?Q.geometry:xa(P,l,h),patterns:{},sortKey:ce};_.push(me)}m&&_.sort((P,R)=>P.sortKey-R.sortKey);const{lineAtlas:x,featureIndex:w}=s,I=this.addConstantDashes(x);for(const P of _){const{geometry:R,index:O,sourceLayerIndex:G}=P;if(I&&this.addFeatureDashes(P,x),this.hasPattern){const Z=$d("line",this.layers,P,this.zoom,s);this.patternFeatures.push(Z)}else this.addFeature(P,R,O,l,x.positions,s.availableImages);w.insert(e[O].feature,R,O,G,this.index)}}addConstantDashes(e){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)s=!0;else{const _=m.value,x=h.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return s}addFeatureDashes(e,s){const l=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let x,w,I,P,R,O;if("constant"===m.kind){const ce=m.value;if(!ce)continue;x=ce.other||ce.to,w=ce.to,I=ce.from}else x=m.evaluate({zoom:l-1},e),w=m.evaluate({zoom:l},e),I=m.evaluate({zoom:l+1},e);"constant"===_.kind?P=R=O=_.value:(P=_.evaluate({zoom:l-1},e),R=_.evaluate({zoom:l},e),O=_.evaluate({zoom:l+1},e)),s.addDash(x,P),s.addDash(w,R),s.addDash(I,O);const G=s.getKey(x,P),Z=s.getKey(w,R),Q=s.getKey(I,O);e.patterns[h.id]={min:G,mid:Z,max:Q}}}update(e,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,h)}addFeatures(e,s,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Rg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,l,h,m,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),I=x.get("line-cap").evaluate(e,{}),P=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const O of s)this.addLine(O,e,w,I,P,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,_,h)}addLine(e,s,l,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<e.length-1;me++)this.totalDistance+=e[me].dist(e[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Np[s.type];let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let I=0;for(;I<w-1&&e[I].equals(e[I+1]);)I++;if(w<(x?3:2))return;"bevel"===l&&(m=1.05);const P=this.overscaling<=16?122880/(512*this.overscaling):0,R=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let O,G,Z,Q,ce;this.e1=this.e2=-1,x&&(O=e[w-2],ce=e[I].sub(O)._unit()._perp());for(let me=I;me<w;me++){if(Z=me===w-1?x?e[I+1]:void 0:e[me+1],Z&&e[me].equals(Z))continue;ce&&(Q=ce),O&&(G=O),O=e[me],ce=Z?Z.sub(O)._unit()._perp():Q,Q=Q||ce;let xe=Q.add(ce);0===xe.x&&0===xe.y||xe._unit();const Ae=Q.x*ce.x+Q.y*ce.y,Re=xe.x*ce.x+xe.y*ce.y,Fe=0!==Re?1/Re:1/0,ze=2*Math.sqrt(2-2*Re),it=Re<kg&&G&&Z,Qe=Q.x*ce.y-Q.y*ce.x>0;if(it&&me>I){const ot=O.dist(G);if(ot>2*P){const vt=O.sub(O.sub(G)._mult(P/ot)._round());this.updateDistance(G,vt),this.addCurrentVertex(vt,Q,0,0,R),G=vt}}const At=G&&Z;let mt=At?l:x?"butt":h;if(At&&"round"===mt&&(Fe<_?mt="miter":Fe<=2&&(mt="fakeround")),"miter"===mt&&Fe>m&&(mt="bevel"),"bevel"===mt&&(Fe>2&&(mt="flipbevel"),Fe<m&&(mt="miter")),G&&this.updateDistance(G,O),"miter"===mt)xe._mult(Fe),this.addCurrentVertex(O,xe,0,0,R);else if("flipbevel"===mt){if(Fe>100)xe=ce.mult(-1);else{const ot=Fe*Q.add(ce).mag()/Q.sub(ce).mag();xe._perp()._mult(ot*(Qe?-1:1))}this.addCurrentVertex(O,xe,0,0,R),this.addCurrentVertex(O,xe.mult(-1),0,0,R)}else if("bevel"===mt||"fakeround"===mt){const ot=-Math.sqrt(Fe*Fe-1),vt=Qe?ot:0,xt=Qe?0:ot;if(G&&this.addCurrentVertex(O,Q,vt,xt,R),"fakeround"===mt){const lt=Math.round(180*ze/Math.PI/20);for(let Mt=1;Mt<lt;Mt++){let kt=Mt/lt;if(.5!==kt){const Er=kt-.5;kt+=kt*Er*(kt-1)*((1.0904+Ae*(Ae*(3.55645-1.43519*Ae)-3.2452))*Er*Er+(.848013+Ae*(.215638*Ae-1.06021)))}const xn=ce.sub(Q)._mult(kt)._add(Q)._unit()._mult(Qe?-1:1);this.addHalfVertex(O,xn.x,xn.y,!1,Qe,0,R)}}Z&&this.addCurrentVertex(O,ce,-vt,-xt,R)}else if("butt"===mt)this.addCurrentVertex(O,xe,0,0,R);else if("square"===mt){const ot=G?1:-1;G||this.addCurrentVertex(O,xe,ot,ot,R),this.addCurrentVertex(O,xe,0,0,R),G&&this.addCurrentVertex(O,xe,ot,ot,R)}else"round"===mt&&(G&&(this.addCurrentVertex(O,Q,0,0,R),this.addCurrentVertex(O,Q,1,1,R,!0)),Z&&(this.addCurrentVertex(O,ce,-1,-1,R,!0),this.addCurrentVertex(O,ce,0,0,R)));if(it&&me<w-1){const ot=O.dist(Z);if(ot>2*P){const vt=O.add(Z.sub(O)._mult(P/ot)._round());this.updateDistance(O,vt),this.addCurrentVertex(vt,ce,0,0,R),O=vt}}}}addCurrentVertex(e,s,l,h,m,_=!1){const x=s.y*h-s.x,w=-s.y-s.x*h;this.addHalfVertex(e,s.x+s.y*l,s.y-s.x*l,_,!1,l,m),this.addHalfVertex(e,x,w,_,!0,-h,m)}addHalfVertex({x:e,y:s},l,h,m,_,x,w){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),_?this.e2=I:this.e1=I}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Ft("LineBucket",Mh,{omit:["layers","patternFeatures"]});const Bp=new nt({"line-cap":new _e(Pe.layout_line["line-cap"]),"line-join":new _e(Pe.layout_line["line-join"]),"line-miter-limit":new se(Pe.layout_line["line-miter-limit"]),"line-round-limit":new se(Pe.layout_line["line-round-limit"]),"line-sort-key":new _e(Pe.layout_line["line-sort-key"])});var Ph={paint:new nt({"line-opacity":new _e(Pe.paint_line["line-opacity"]),"line-color":new _e(Pe.paint_line["line-color"]),"line-translate":new se(Pe.paint_line["line-translate"]),"line-translate-anchor":new se(Pe.paint_line["line-translate-anchor"]),"line-width":new _e(Pe.paint_line["line-width"]),"line-gap-width":new _e(Pe.paint_line["line-gap-width"]),"line-offset":new _e(Pe.paint_line["line-offset"]),"line-blur":new _e(Pe.paint_line["line-blur"]),"line-dasharray":new Ce(Pe.paint_line["line-dasharray"]),"line-pattern":new Ce(Pe.paint_line["line-pattern"]),"line-gradient":new Xe(Pe.paint_line["line-gradient"])}),layout:Bp};const Kd=new class extends _e{possiblyEvaluate(i,e){return e=new j(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,s,l){return e=Pr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,s,l)}}(Ph.paint.properties["line-width"].specification);function Fg(i,e){return e>0?e+2*i:i}Kd.useIntegerZoom=!0;const Vp=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Lg=He([{name:"a_projected_pos",components:3,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Up=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Og=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const jp=He([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ba=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const wa=128;function Qd(i,e){const{expression:s}=e;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new j(i+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=s;let m=0;for(;m<l.length&&l[m]<=i;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const x=l[m],w=l[_];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:s.evaluate(new j(x)),maxSize:s.evaluate(new j(w)),interpolationType:h}}}function Rh(i,{uSize:e,uSizeT:s},{lowerSize:l,upperSize:h}){return"source"===i.kind?l/wa:"composite"===i.kind?Ln(l/wa,h/wa,s):e}function wu(i,e){let s=0,l=0;if("constant"===i.kind)l=i.layoutSize;else if("source"!==i.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=i,x=h?_t(fr.interpolationFactor(h,e,m,_),0,1):0;"camera"===i.kind?l=Ln(i.minSize,i.maxSize,x):s=x}return{uSizeT:s,uSize:l}}var zg=Object.freeze({__proto__:null,getSizeData:Qd,evaluateSizeForFeature:Rh,evaluateSizeForZoom:wu,SIZE_PACK_FACTOR:wa});function $p(i,e,s){return i.sections.forEach(l=>{l.text=function(h,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),V.applyArabicShaping&&(h=V.applyArabicShaping(h)),h}(l.text,e,s)}),i}const Zu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Ng(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function Bg(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var In=function(i,e,s,l,h){var m,_,x=8*h-l-1,w=(1<<x)-1,I=w>>1,P=-7,R=s?h-1:0,O=s?-1:1,G=i[e+R];for(R+=O,m=G&(1<<-P)-1,G>>=-P,P+=x;P>0;m=256*m+i[e+R],R+=O,P-=8);for(_=m&(1<<-P)-1,m>>=-P,P+=l;P>0;_=256*_+i[e+R],R+=O,P-=8);if(0===m)m=1-I;else{if(m===w)return _?NaN:1/0*(G?-1:1);_+=Math.pow(2,l),m-=I}return(G?-1:1)*_*Math.pow(2,m-l)},Jd=function(i,e,s,l,h,m){var _,x,w,I=8*m-h-1,P=(1<<I)-1,R=P>>1,O=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,G=l?0:m-1,Z=l?1:-1,Q=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=P):(_=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-_))<1&&(_--,w*=2),(e+=_+R>=1?O/w:O*Math.pow(2,1-R))*w>=2&&(_++,w/=2),_+R>=P?(x=0,_=P):_+R>=1?(x=(e*w-1)*Math.pow(2,h),_+=R):(x=e*Math.pow(2,R-1)*Math.pow(2,h),_=0));h>=8;i[s+G]=255&x,G+=Z,x/=256,h-=8);for(_=_<<h|x,I+=h;I>0;i[s+G]=255&_,G+=Z,_/=256,I-=8);i[s+G-Z]|=128*Q},Eu=cr;function cr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}cr.Varint=0,cr.Fixed64=1,cr.Bytes=2,cr.Fixed32=5;var Rs=4294967296,ef=1/Rs,Gp="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Ea(i){return i.type===cr.Bytes?i.readVarint()+i.pos:i.pos+1}function kh(i,e,s){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(l);for(var h=s.pos-1;h>=i;h--)s.buf[h+l]=s.buf[h]}function Hp(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function tf(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function Vy(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function qp(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function Uy(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function yl(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function Fh(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function Lh(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function nf(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function rf(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Cu(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function of(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function jy(i,e,s){e.glyphs=[],1===i&&s.readMessage(Vg,e)}function Vg(i,e,s){if(3===i){const{id:l,bitmap:h,width:m,height:_,left:x,top:w,advance:I}=s.readMessage($y,{});e.glyphs.push({id:l,bitmap:new Ms({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:x,top:w,advance:I}})}else 4===i?e.ascender=s.readSVarint():5===i&&(e.descender=s.readSVarint())}function $y(i,e,s){1===i?e.id=s.readVarint():2===i?e.bitmap=s.readBytes():3===i?e.width=s.readVarint():4===i?e.height=s.readVarint():5===i?e.left=s.readSVarint():6===i?e.top=s.readSVarint():7===i&&(e.advance=s.readVarint())}function Oh(i){let e=0,s=0;for(const _ of i)e+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,x)=>x.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let h=0,m=0;for(const _ of i)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const I=l.pop();x<l.length&&(l[x]=I)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}cr.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),h=l>>3,m=this.pos;this.type=7&l,i(h,e,this),this.pos===m&&this.skip(l)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=rf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=of(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=rf(this.buf,this.pos)+rf(this.buf,this.pos+4)*Rs;return this.pos+=8,i},readSFixed64:function(){var i=rf(this.buf,this.pos)+of(this.buf,this.pos+4)*Rs;return this.pos+=8,i},readFloat:function(){var i=In(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=In(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,l=this.buf;return e=127&(s=l[this.pos++]),s<128?e:(e|=(127&(s=l[this.pos++]))<<7,s<128?e:(e|=(127&(s=l[this.pos++]))<<14,s<128?e:(e|=(127&(s=l[this.pos++]))<<21,s<128?e:function(h,m,_){var x,w,I=_.buf;if(x=(112&(w=I[_.pos++]))>>4,w<128||(x|=(127&(w=I[_.pos++]))<<3,w<128)||(x|=(127&(w=I[_.pos++]))<<10,w<128)||(x|=(127&(w=I[_.pos++]))<<17,w<128)||(x|=(127&(w=I[_.pos++]))<<24,w<128)||(x|=(1&(w=I[_.pos++]))<<31,w<128))return function(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}(h,x,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Gp?Gp.decode(this.buf.subarray(e,i)):function(s,l,h){for(var m="",_=l;_<h;){var x,w,I,P=s[_],R=null,O=P>239?4:P>223?3:P>191?2:1;if(_+O>h)break;1===O?P<128&&(R=P):2===O?128==(192&(x=s[_+1]))&&(R=(31&P)<<6|63&x)<=127&&(R=null):3===O?(w=s[_+2],128==(192&(x=s[_+1]))&&128==(192&w)&&((R=(15&P)<<12|(63&x)<<6|63&w)<=2047||R>=55296&&R<=57343)&&(R=null)):4===O&&(w=s[_+2],I=s[_+3],128==(192&(x=s[_+1]))&&128==(192&w)&&128==(192&I)&&((R=(15&P)<<18|(63&x)<<12|(63&w)<<6|63&I)<=65535||R>=1114112)&&(R=null)),null===R?(R=65533,O=1):R>65535&&(R-=65536,m+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),m+=String.fromCharCode(R),_+=O}return m}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==cr.Bytes)return i.push(this.readVarint(e));var s=Ea(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==cr.Bytes)return i.push(this.readSVarint());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==cr.Bytes)return i.push(this.readBoolean());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==cr.Bytes)return i.push(this.readFloat());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==cr.Bytes)return i.push(this.readDouble());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==cr.Bytes)return i.push(this.readFixed32());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==cr.Bytes)return i.push(this.readSFixed32());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==cr.Bytes)return i.push(this.readFixed64());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==cr.Bytes)return i.push(this.readSFixed64());var e=Ea(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===cr.Varint)for(;this.buf[this.pos++]>127;);else if(e===cr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===cr.Fixed32)this.pos+=4;else{if(e!==cr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Cu(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Cu(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Cu(this.buf,-1&i,this.pos),Cu(this.buf,Math.floor(i*ef),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Cu(this.buf,-1&i,this.pos),Cu(this.buf,Math.floor(i*ef),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var l,h,m,x;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),m=l,(x=s).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(l,h,m){for(var _,x,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!x){_>56319||w+1===h.length?(l[m++]=239,l[m++]=191,l[m++]=189):x=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(l[m++]=239,l[m++]=191,l[m++]=189,x=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&kh(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),Jd(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Jd(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var l=this.pos-s;l>=128&&kh(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,e,s){this.writeTag(i,cr.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Hp,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,tf,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,Uy,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Vy,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,qp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,yl,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,Fh,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Lh,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,nf,e)},writeBytesField:function(i,e){this.writeTag(i,cr.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,cr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,cr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,cr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,cr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,cr.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,cr.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,cr.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,cr.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,cr.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class zh{constructor(e,{pixelRatio:s,version:l,stretchX:h,stretchY:m,content:_}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=h,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zp{constructor(e,s){const l={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(s,h,m);const{w:_,h:x}=Oh(m),w=new Ps({width:_||1,height:x||1});for(const I in e){const P=e[I],R=l[I].paddedRect;Ps.copy(P.data,w,{x:0,y:0},{x:R.x+1,y:R.y+1},P.data)}for(const I in s){const P=s[I],R=h[I].paddedRect,O=R.x+1,G=R.y+1,Z=P.data.width,Q=P.data.height;Ps.copy(P.data,w,{x:0,y:0},{x:O,y:G},P.data),Ps.copy(P.data,w,{x:0,y:Q-1},{x:O,y:G-1},{width:Z,height:1}),Ps.copy(P.data,w,{x:0,y:0},{x:O,y:G+Q},{width:Z,height:1}),Ps.copy(P.data,w,{x:Z-1,y:0},{x:O-1,y:G},{width:1,height:Q}),Ps.copy(P.data,w,{x:0,y:0},{x:O+Z,y:G},{width:1,height:Q})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(e,s,l){for(const h in e){const m=e[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),s[h]=new zh(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),s)}patchUpdatedImage(e,s,l){if(!e||!s||e.version===s.version)return;e.version=s.version;const[h,m]=e.tl;l.update(s.data,void 0,{x:h,y:m})}}Ft("ImagePosition",zh),Ft("ImageAtlas",Zp);const Ko={horizontal:1,vertical:2,horizontalOnly:3};class Nh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const l=new Nh;return l.scale=e||1,l.fontStack=s,l}static forImage(e){const s=new Nh;return s.imageName=e,s}}class Wu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const l=new Wu;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?l.addImageSection(m):l.addTextSection(m,s)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,l){let h="";for(let m=0;m<s.length;m++){const _=s.charCodeAt(m+1)||null,x=s.charCodeAt(m-1)||null;h+=!l&&(_&&at(_)&&!Zu[s[m+1]]||x&&at(x)&&!Zu[s[m-1]])||!Zu[s[m]]?s[m]:Zu[s[m]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&sf[this.text.charCodeAt(l)];l++)e++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&sf[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const l=new Wu;return l.text=this.text.substring(e,s),l.sectionIndex=this.sectionIndex.slice(e,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(Nh.forText(e.scale,e.fontStack||s));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e){const s=e.image?e.image.name:"";if(0===s.length)return void Nn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Nh.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Nn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wp(i,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q){const ce=Wu.fromFeature(i,h);let me;R===Ko.vertical&&ce.verticalizePunctuation(O);const{processBidirectionalText:xe,processStyledBidirectionalText:Ae}=V;if(xe&&1===ce.sections.length){me=[];const ze=xe(ce.toString(),Xp(ce,I,m,e,l,G,Z));for(const it of ze){const Qe=new Wu;Qe.text=it,Qe.sections=ce.sections;for(let At=0;At<it.length;At++)Qe.sectionIndex.push(0);me.push(Qe)}}else if(Ae){me=[];const ze=Ae(ce.text,ce.sectionIndex,Xp(ce,I,m,e,l,G,Z));for(const it of ze){const Qe=new Wu;Qe.text=it[0],Qe.sectionIndex=it[1],Qe.sections=ce.sections,me.push(Qe)}}else me=function(ze,it){const Qe=[],At=ze.text;let mt=0;for(const ot of it)Qe.push(ze.substring(mt,ot)),mt=ot;return mt<At.length&&Qe.push(ze.substring(mt,At.length)),Qe}(ce,Xp(ce,I,m,e,l,G,Z));const Re=[],Fe={positionedLines:Re,text:ce.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:R,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ze,it,Qe,At,mt,ot,vt,xt,lt,Mt,kt,xn){let Er=0,hn=0,er=0;const Pt="right"===xt?1:"left"===xt?0:.5;let Cr=!1;for(const _r of mt){const tr=_r.getSections();for(const Ar of tr){if(Ar.imageName)continue;const Nr=it[Ar.fontStack];if(Nr&&(Cr=void 0!==Nr.ascender&&void 0!==Nr.descender,!Cr))break}if(!Cr)break}let Gn=0;for(const _r of mt){_r.trim();const tr=_r.getMaxScale(),Ar=24*(tr-1),Nr={positionedGlyphs:[],lineOffset:0};ze.positionedLines[Gn]=Nr;const Gr=Nr.positionedGlyphs;let nr=0;if(!_r.length()){hn+=ot,++Gn;continue}let si=0,Rr=0;for(let yr=0;yr<_r.length();yr++){const Br=_r.getSection(yr),Vr=_r.getSectionIndex(yr),kr=_r.getCharCode(yr);let Mr=Br.scale,qr=null,rr=null,_i=null,Bo=24,so=0;const Fs=!(lt===Ko.horizontal||!kt&&!Ie(kr)||kt&&(sf[kr]||(zr=kr,Dc(zr)||Zl(zr)||ll(zr)||ro(zr)||C(zr))));if(Br.imageName){const ls=At[Br.imageName];if(!ls)continue;_i=Br.imageName,ze.iconsInText=ze.iconsInText||!0,rr=ls.paddedRect;const ao=ls.displaySize;Mr=24*Mr/xn,qr={width:ao[0],height:ao[1],left:1,top:-3,advance:Fs?ao[1]:ao[0],localGlyph:!1},so=Cr?-qr.height*Mr:24*tr-17-ao[1]*Mr,Bo=qr.advance;const Za=(Fs?ao[0]:ao[1])*Mr-24*tr;Za>0&&Za>nr&&(nr=Za)}else{const ls=Qe[Br.fontStack];if(!ls)continue;ls[kr]&&(rr=ls[kr]);const ao=it[Br.fontStack];if(!ao)continue;const Za=ao.glyphs[kr];if(!Za)continue;if(qr=Za.metrics,Bo=8203!==kr?24:0,Cr){const Kc=void 0!==ao.ascender?Math.abs(ao.ascender):0,Qc=void 0!==ao.descender?Math.abs(ao.descender):0,Jc=(Kc+Qc)*Mr;si<Jc&&(si=Jc,Rr=(Kc-Qc)/2*Mr),so=-Kc*Mr}else so=24*(tr-Mr)-17}Fs?(ze.verticalizable=!0,Gr.push({glyph:kr,imageName:_i,x:Er,y:hn+so,vertical:Fs,scale:Mr,localGlyph:qr.localGlyph,fontStack:Br.fontStack,sectionIndex:Vr,metrics:qr,rect:rr}),Er+=Bo*Mr+Mt):(Gr.push({glyph:kr,imageName:_i,x:Er,y:hn+so,vertical:Fs,scale:Mr,localGlyph:qr.localGlyph,fontStack:Br.fontStack,sectionIndex:Vr,metrics:qr,rect:rr}),Er+=qr.advance*Mr+Mt)}0!==Gr.length&&(er=Math.max(Er-Mt,er),Cr?Bh(Gr,Pt,nr,Rr,ot*tr/2):Bh(Gr,Pt,nr,0,ot/2)),Er=0;const Hr=ot*tr+nr;Nr.lineOffset=Math.max(nr,Ar),hn+=Hr,++Gn}var zr;const ui=hn,{horizontalAlign:vr,verticalAlign:hi}=Ua(vt);(function(_r,tr,Ar,Nr,Gr,nr){const si=(tr-Ar)*Gr,Rr=-nr*Nr;for(const Hr of _r)for(const yr of Hr.positionedGlyphs)yr.x+=si,yr.y+=Rr})(ze.positionedLines,Pt,vr,hi,er,ui),ze.top+=-hi*ui,ze.bottom=ze.top+ui,ze.left+=-vr*er,ze.right=ze.left+er,ze.hasBaseline=Cr}(Fe,e,s,l,me,_,x,w,R,I,O,Q),!function(ze){for(const it of ze)if(0!==it.positionedGlyphs.length)return!1;return!0}(Re)&&Fe}const sf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Gy={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ug(i,e,s,l,h,m){if(e.imageName){const _=l[e.imageName];return _?_.displaySize[0]*e.scale*24/m+h:0}{const _=s[e.fontStack],x=_&&_.glyphs[i];return x?x.metrics.advance*e.scale+h:0}}function jg(i,e,s,l){const h=Math.pow(i-e,2);return l?i<e?h/2:2*h:h+Math.abs(s)*s}function Hy(i,e,s){let l=0;return 10===i&&(l-=1e4),s&&(l+=150),40!==i&&65288!==i||(l+=50),41!==e&&65289!==e||(l+=50),l}function $g(i,e,s,l,h,m){let _=null,x=jg(e,s,h,m);for(const w of l){const I=jg(e-w.x,s,h,m)+w.badness;I<=x&&(_=w,x=I)}return{index:i,x:e,priorBreak:_,badness:x}}function Gg(i){return i?Gg(i.priorBreak).concat(i.index):[]}function Xp(i,e,s,l,h,m,_){if("point"!==m)return[];if(!i)return[];const x=[],w=function(O,G,Z,Q,ce,me){let xe=0;for(let Ae=0;Ae<O.length();Ae++){const Re=O.getSection(Ae);xe+=Ug(O.getCharCode(Ae),Re,Q,ce,G,me)}return xe/Math.max(1,Math.ceil(xe/Z))}(i,e,s,l,h,_),I=i.text.indexOf("\u200b")>=0;let P=0;for(let O=0;O<i.length();O++){const G=i.getSection(O),Z=i.getCharCode(O);if(sf[Z]||(P+=Ug(Z,G,l,h,e,_)),O<i.length()-1){const Q=!((R=Z)<11904||!(Ac(R)||Sc(R)||M(R)||ul(R)||cl(R)||ou(R)||Xl(R)||Wl(R)||za(R)||os(R)||Yl(R)||F(R)||Is(R)||Ic(R)||Fo(R)||Ks(R)||Ys(R)||ch(R)||ya(R)||Ss(R)));(Gy[Z]||Q||G.imageName)&&x.push($g(O+1,P,w,x,Hy(Z,i.getCharCode(O+1),Q&&I),!1))}}var R;return Gg($g(i.length(),P,w,x,0,!0))}function Ua(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Bh(i,e,s,l,h){if(!(e||s||l||h))return;const m=i.length-1,_=i[m],x=(_.x+_.metrics.advance*_.scale)*e;for(let w=0;w<=m;w++)i[w].x-=x,i[w].y+=s+l+h}function Hg(i,e,s){const{horizontalAlign:l,verticalAlign:h}=Ua(s),m=e[0]-i.displaySize[0]*l,_=e[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function af(i,e,s,l,h,m){const _=i.image;let x;if(_.content){const ce=_.content,me=_.pixelRatio||1;x=[ce[0]/me,ce[1]/me,_.displaySize[0]-ce[2]/me,_.displaySize[1]-ce[3]/me]}const w=e.left*m,I=e.right*m;let P,R,O,G;"width"===s||"both"===s?(G=h[0]+w-l[3],R=h[0]+I+l[1]):(G=h[0]+(w+I-_.displaySize[0])/2,R=G+_.displaySize[0]);const Z=e.top*m,Q=e.bottom*m;return"height"===s||"both"===s?(P=h[1]+Z-l[0],O=h[1]+Q+l[2]):(P=h[1]+(Z+Q-_.displaySize[1])/2,O=P+_.displaySize[1]),{image:_,top:P,right:R,bottom:O,left:G,collisionPadding:x}}class ja extends Ve{constructor(e,s,l,h,m){super(e,s),this.angle=h,this.z=l,void 0!==m&&(this.segment=m)}clone(){return new ja(this.x,this.y,this.z,this.angle,this.segment)}}function lf(i,e,s,l,h){if(void 0===e.segment)return!0;let m=e,_=e.segment+1,x=0;for(;x>-s/2;){if(_--,_<0)return!1;x-=i[_].dist(m),m=i[_]}x+=i[_].dist(i[_+1]),_++;const w=[];let I=0;for(;x<s/2;){const P=i[_],R=i[_+1];if(!R)return!1;let O=i[_-1].angleTo(P)-P.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:O}),I+=O;x-w[0].distance>l;)I-=w.shift().angleDelta;if(I>h)return!1;_++,x+=P.dist(R)}return!0}function Vh(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function Yp(i,e,s){return i?.6*e*s:0}function vl(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Kp(i,e,s,l,h,m){const _=Yp(s,h,m),x=vl(s,l)*m;let w=0;const I=Vh(i)/2;for(let P=0;P<i.length-1;P++){const R=i[P],O=i[P+1],G=R.dist(O);if(w+G>I){const Z=(I-w)/G,Q=Ln(R.x,O.x,Z),ce=Ln(R.y,O.y,Z),me=new ja(Q,ce,0,O.angleTo(R),P);return!_||lf(i,me,x,_,e)?me:void 0}w+=G}}function qg(i,e,s,l,h,m,_,x,w){const I=Yp(l,m,_),P=vl(l,h),R=P*_,O=0===i[0].x||i[0].x===w||0===i[0].y||i[0].y===w;return e-R<e/4&&(e=R+e/4),Zg(i,O?e/2*x%e:(P/2+2*m)*_*x%e,e,I,s,R,O,!1,w)}function Zg(i,e,s,l,h,m,_,x,w){const I=m/2,P=Vh(i);let R=0,O=e-s,G=[];for(let Z=0;Z<i.length-1;Z++){const Q=i[Z],ce=i[Z+1],me=Q.dist(ce),xe=ce.angleTo(Q);for(;O+s<R+me;){O+=s;const Ae=(O-R)/me,Re=Ln(Q.x,ce.x,Ae),Fe=Ln(Q.y,ce.y,Ae);if(Re>=0&&Re<w&&Fe>=0&&Fe<w&&O-I>=0&&O+I<=P){const ze=new ja(Re,Fe,0,xe,Z);ze._round(),l&&!lf(i,ze,m,l,h)||G.push(ze)}}R+=me}return x||G.length||_||(G=Zg(i,R/2,s,l,h,m,_,!0,w)),G}function Uh(i,e,s,l,h){const m=[];for(let _=0;_<i.length;_++){const x=i[_];let w;for(let I=0;I<x.length-1;I++){let P=x[I],R=x[I+1];P.x<e&&R.x<e||(P.x<e?P=new Ve(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<e&&(R=new Ve(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<s&&R.y<s||(P.y<s?P=new Ve(P.x+(s-P.y)/(R.y-P.y)*(R.x-P.x),s)._round():R.y<s&&(R=new Ve(P.x+(s-P.y)/(R.y-P.y)*(R.x-P.x),s)._round()),P.x>=l&&R.x>=l||(P.x>=l?P=new Ve(l,P.y+(l-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=l&&(R=new Ve(l,P.y+(l-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=h&&R.y>=h||(P.y>=h?P=new Ve(P.x+(h-P.y)/(R.y-P.y)*(R.x-P.x),h)._round():R.y>=h&&(R=new Ve(P.x+(h-P.y)/(R.y-P.y)*(R.x-P.x),h)._round()),w&&P.equals(w[w.length-1])||(w=[P],m.push(w)),w.push(R)))))}}return m}Ft("Anchor",ja);const Xu=1e20;function cf(i,e,s,l,h,m,_,x,w){for(let I=e;I<e+l;I++)Qp(i,s*m+I,m,h,_,x,w);for(let I=s;I<s+h;I++)Qp(i,I*m+e,1,l,_,x,w)}function Qp(i,e,s,l,h,m,_){m[0]=0,_[0]=-Xu,_[1]=Xu,h[0]=i[e];for(let x=1,w=0,I=0;x<l;x++){h[x]=i[e+x*s];const P=x*x;do{const R=m[w];I=(h[x]-h[R]+P-R*R)/(x-R)/2}while(I<=_[w]&&--w>-1);w++,m[w]=x,_[w]=I,_[w+1]=Xu}for(let x=0,w=0;x<l;x++){for(;_[w+1]<x;)w++;const I=m[w],P=x-I;i[e+x*s]=h[I]+P*P}}const uf={none:0,ideographs:1,all:2};class $a{constructor(e,s,l){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const l=[];for(const h in e)for(const m of e[h])l.push({stack:h,id:m});Ai(l,({stack:h,id:m},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(void 0!==w)return void _(null,{stack:h,id:m,glyph:w});if(w=this._tinySDF(x,h,m),w)return x.glyphs[m]=w,void _(null,{stack:h,id:m,glyph:w});const I=Math.floor(m/256);if(256*I>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[I])return void _(null,{stack:h,id:m,glyph:w});let P=x.requests[I];P||(P=x.requests[I]=[],$a.loadGlyphRange(h,I,this.url,this.requestManager,(R,O)=>{if(O){x.ascender=O.ascender,x.descender=O.descender;for(const G in O.glyphs)this._doesCharSupportLocalGlyph(+G)||(x.glyphs[+G]=O.glyphs[+G]);x.ranges[I]=!0}for(const G of P)G(R,O);delete x.requests[I]})),P.push((R,O)=>{R?_(R):O&&_(null,{stack:h,id:m,glyph:O.glyphs[m]||null})})},(h,m)=>{if(h)s(h);else if(m){const _={};for(const{stack:x,id:w,glyph:I}of m)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[w]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;s(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==uf.none&&(this.localGlyphMode===uf.all?!!this.localFontFamily:!!this.localFontFamily&&(os(e)||As(e)||Is(e)||Ys(e))||Wl(e))}_tinySDF(e,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let Q="400";/bold/i.test(s)?Q="900":/medium/i.test(s)?Q="500":/light/i.test(s)&&(Q="200"),m=e.tinySDF=new $a.TinySDF({fontFamily:h,fontWeight:Q,fontSize:48,buffer:6,radius:16}),m.fontWeight=Q}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCharCode(l),{data:x,width:w,height:I,glyphWidth:P,glyphHeight:R,glyphLeft:O,glyphTop:G,glyphAdvance:Z}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new Ms({width:w,height:I},x),metrics:{width:P/2,height:R/2,left:O/2,top:G/2-27,advance:Z/2,localGlyph:!0}}}}function Uc(i,e,s,l){const h=[],m=i.image,_=m.pixelRatio,x=m.paddedRect.w-2,w=m.paddedRect.h-2,I=i.right-i.left,P=i.bottom-i.top,R=m.stretchX||[[0,x]],O=m.stretchY||[[0,w]],G=(ot,vt)=>ot+vt[1]-vt[0],Z=R.reduce(G,0),Q=O.reduce(G,0),ce=x-Z,me=w-Q;let xe=0,Ae=Z,Re=0,Fe=Q,ze=0,it=ce,Qe=0,At=me;if(m.content&&l){const ot=m.content;xe=Tu(R,0,ot[0]),Re=Tu(O,0,ot[1]),Ae=Tu(R,ot[0],ot[2]),Fe=Tu(O,ot[1],ot[3]),ze=ot[0]-xe,Qe=ot[1]-Re,it=ot[2]-ot[0]-Ae,At=ot[3]-ot[1]-Fe}const mt=(ot,vt,xt,lt)=>{const Mt=oc(ot.stretch-xe,Ae,I,i.left),kt=xl(ot.fixed-ze,it,ot.stretch,Z),xn=oc(vt.stretch-Re,Fe,P,i.top),Er=xl(vt.fixed-Qe,At,vt.stretch,Q),hn=oc(xt.stretch-xe,Ae,I,i.left),er=xl(xt.fixed-ze,it,xt.stretch,Z),Pt=oc(lt.stretch-Re,Fe,P,i.top),Cr=xl(lt.fixed-Qe,At,lt.stretch,Q),Gn=new Ve(Mt,xn),zr=new Ve(hn,xn),ui=new Ve(hn,Pt),vr=new Ve(Mt,Pt),hi=new Ve(kt/_,Er/_),_r=new Ve(er/_,Cr/_),tr=e*Math.PI/180;if(tr){const Gr=Math.sin(tr),nr=Math.cos(tr),si=[nr,-Gr,Gr,nr];Gn._matMult(si),zr._matMult(si),vr._matMult(si),ui._matMult(si)}const Ar=ot.stretch+ot.fixed,Nr=vt.stretch+vt.fixed;return{tl:Gn,tr:zr,bl:vr,br:ui,tex:{x:m.paddedRect.x+1+Ar,y:m.paddedRect.y+1+Nr,w:xt.stretch+xt.fixed-Ar,h:lt.stretch+lt.fixed-Nr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hi,pixelOffsetBR:_r,minFontScaleX:it/_/I,minFontScaleY:At/_/P,isSDF:s}};if(l&&(m.stretchX||m.stretchY)){const ot=jc(R,ce,Z),vt=jc(O,me,Q);for(let xt=0;xt<ot.length-1;xt++){const lt=ot[xt],Mt=ot[xt+1];for(let kt=0;kt<vt.length-1;kt++)h.push(mt(lt,vt[kt],Mt,vt[kt+1]))}}else h.push(mt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function Tu(i,e,s){let l=0;for(const h of i)l+=Math.max(e,Math.min(s,h[1]))-Math.max(e,Math.min(s,h[0]));return l}function jc(i,e,s){const l=[{fixed:-1,stretch:0}];for(const[h,m]of i){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return l.push({fixed:e+1,stretch:s}),l}function oc(i,e,s,l){return i/e*s+l}function xl(i,e,s,l){return i-e*s/l}function Wg(i,e,s,l){const h=e+i.positionedLines[l].lineOffset;return 0===l?s+h/2:s+(h+(e+i.positionedLines[l-1].lineOffset))/2}$a.loadGlyphRange=function(i,e,s,l,h){const m=256*e,_=m+255,x=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${m}-${_}`),fi.Glyphs);q(x,(w,I)=>{if(w)h(w);else if(I){const P={},R=new Eu(I).readFields(jy,{});for(const O of R.glyphs)P[O.id]=O;h(null,{glyphs:P,ascender:R.ascender,descender:R.descender})}})},$a.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=l,this.radius=s;const x=this.size=i+4*e,w=this._createCanvas(x),I=this.ctx=w.getContext("2d",{willReadFrequently:!0});I.font=`${_} ${m} ${i}px ${h}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(i),_=Math.floor(s),x=Math.min(this.size-this.buffer,Math.ceil(m-h)),w=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),I=x+2*this.buffer,P=w+2*this.buffer,R=I*P,O=new Uint8ClampedArray(R),G={data:O,width:I,height:P,glyphWidth:x,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===x||0===w)return G;const{ctx:Z,buffer:Q,gridInner:ce,gridOuter:me}=this;Z.clearRect(Q,Q,x,w),Z.fillText(i,Q,Q+_+1);const xe=Z.getImageData(Q,Q,x,w);me.fill(Xu,0,R),ce.fill(0,0,R);for(let Ae=0;Ae<w;Ae++)for(let Re=0;Re<x;Re++){const Fe=xe.data[4*(Ae*x+Re)+3]/255;if(0===Fe)continue;const ze=(Ae+Q)*I+Re+Q;if(1===Fe)me[ze]=0,ce[ze]=Xu;else{const it=.5-Fe;me[ze]=it>0?it*it:0,ce[ze]=it<0?it*it:0}}cf(me,0,0,I,P,I,this.f,this.v,this.z),cf(ce,Q,Q,x,w,I,this.f,this.v,this.z);for(let Ae=0;Ae<R;Ae++){const Re=Math.sqrt(me[Ae])-Math.sqrt(ce[Ae]);O[Ae]=Math.round(255-255*(Re/this.radius+this.cutoff))}return G}};class Jp{constructor(e=[],s=em){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:l}=this,h=s[e];for(;e>0;){const m=e-1>>1,_=s[m];if(l(h,_)>=0)break;s[e]=_,e=m}s[e]=h}_down(e){const{data:s,compare:l}=this,h=this.length>>1,m=s[e];for(;e<h;){let _=1+(e<<1),x=s[_];const w=_+1;if(w<this.length&&l(s[w],x)<0&&(_=w,x=s[w]),l(x,m)>=0)break;s[e]=x,e=_}s[e]=m}}function em(i,e){return i<e?-1:i>e?1:0}function hf(i,e=1,s=!1){let l=1/0,h=1/0,m=-1/0,_=-1/0;const x=i[0];for(let G=0;G<x.length;G++){const Z=x[G];(!G||Z.x<l)&&(l=Z.x),(!G||Z.y<h)&&(h=Z.y),(!G||Z.x>m)&&(m=Z.x),(!G||Z.y>_)&&(_=Z.y)}const w=Math.min(m-l,_-h);let I=w/2;const P=new Jp([],df);if(0===w)return new Ve(l,h);for(let G=l;G<m;G+=w)for(let Z=h;Z<_;Z+=w)P.push(new $c(G+I,Z+I,I,i));let R=function(G){let Z=0,Q=0,ce=0;const me=G[0];for(let xe=0,Ae=me.length,Re=Ae-1;xe<Ae;Re=xe++){const Fe=me[xe],ze=me[Re],it=Fe.x*ze.y-ze.x*Fe.y;Q+=(Fe.x+ze.x)*it,ce+=(Fe.y+ze.y)*it,Z+=3*it}return new $c(Q/Z,ce/Z,0,G)}(i),O=P.length;for(;P.length;){const G=P.pop();(G.d>R.d||!R.d)&&(R=G,s&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,O)),G.max-R.d<=e||(I=G.h/2,P.push(new $c(G.p.x-I,G.p.y-I,I,i)),P.push(new $c(G.p.x+I,G.p.y-I,I,i)),P.push(new $c(G.p.x-I,G.p.y+I,I,i)),P.push(new $c(G.p.x+I,G.p.y+I,I,i)),O+=4)}return s&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function df(i,e){return e.max-i.max}function $c(i,e,s,l){this.p=new Ve(i,e),this.h=s,this.d=function(h,m){let _=!1,x=1/0;for(let w=0;w<m.length;w++){const I=m[w];for(let P=0,R=I.length,O=R-1;P<R;O=P++){const G=I[P],Z=I[O];G.y>h.y!=Z.y>h.y&&h.x<(Z.x-G.x)*(h.y-G.y)/(Z.y-G.y)+G.x&&(_=!_),x=Math.min(x,Rd(h,G,Z))}}return(_?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Du=Number.POSITIVE_INFINITY,Xg=Math.sqrt(2);function ff(i,e){return e[1]!==Du?function(s,l,h){let m=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),s){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(s){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,_]}(i,e[0],e[1]):function(s,l){let h=0,m=0;l<0&&(l=0);const _=l/Xg;switch(s){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,m]}(i,e[0])}function qy(i,e,s,l,h,m,_,x,w){i.createArrays(),i.tilePixelRatio=Hn/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const I=i.layers[0].layout,P=i.layers[0]._unevaluatedLayout._values,R={};if("composite"===i.textSizeData.kind){const{minZoom:Z,maxZoom:Q}=i.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new j(Z),x),P["text-size"].possiblyEvaluate(new j(Q),x)]}if("composite"===i.iconSizeData.kind){const{minZoom:Z,maxZoom:Q}=i.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new j(Z),x),P["icon-size"].possiblyEvaluate(new j(Q),x)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new j(w+1),x),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new j(w+1),x),R.textMaxSize=P["text-size"].possiblyEvaluate(new j(18),x);const O="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),G=I.get("text-size");for(const Z of i.features){const Q=I.get("text-font").evaluate(Z,{},x).join(","),ce=G.evaluate(Z,{},x),me=R.layoutTextSize.evaluate(Z,{},x),xe=(R.layoutIconSize.evaluate(Z,{},x),{horizontal:{},vertical:void 0}),Ae=Z.text;let Re,Fe=[0,0];if(Ae){const Qe=Ae.toString(),At=24*I.get("text-letter-spacing").evaluate(Z,{},x),mt=24*I.get("text-line-height").evaluate(Z,{},x),ot=X(Qe)?At:0,vt=I.get("text-anchor").evaluate(Z,{},x),xt=I.get("text-variable-anchor");if(!xt){const hn=I.get("text-radial-offset").evaluate(Z,{},x);Fe=hn?ff(vt,[24*hn,Du]):I.get("text-offset").evaluate(Z,{},x).map(er=>24*er)}let lt=O?"center":I.get("text-justify").evaluate(Z,{},x);const Mt=I.get("symbol-placement"),kt="point"===Mt,xn="point"===Mt?24*I.get("text-max-width").evaluate(Z,{},x):0,Er=hn=>{i.allowVerticalPlacement&&B(Qe)&&(xe.vertical=Wp(Ae,e,s,h,Q,xn,mt,vt,hn,ot,Fe,Ko.vertical,!0,Mt,me,ce))};if(!O&&xt){const hn="auto"===lt?xt.map(Pt=>jh(Pt)):[lt];let er=!1;for(let Pt=0;Pt<hn.length;Pt++){const Cr=hn[Pt];if(!xe.horizontal[Cr])if(er)xe.horizontal[Cr]=xe.horizontal[0];else{const Gn=Wp(Ae,e,s,h,Q,xn,mt,"center",Cr,ot,Fe,Ko.horizontal,!1,Mt,me,ce);Gn&&(xe.horizontal[Cr]=Gn,er=1===Gn.positionedLines.length)}}Er("left")}else{if("auto"===lt&&(lt=jh(vt)),kt||I.get("text-writing-mode").indexOf("horizontal")>=0||!B(Qe)){const hn=Wp(Ae,e,s,h,Q,xn,mt,vt,lt,ot,Fe,Ko.horizontal,!1,Mt,me,ce);hn&&(xe.horizontal[lt]=hn)}Er("point"===Mt?"left":lt)}}let ze=!1;if(Z.icon&&Z.icon.name){const Qe=l[Z.icon.name];Qe&&(Re=Hg(h[Z.icon.name],I.get("icon-offset").evaluate(Z,{},x),I.get("icon-anchor").evaluate(Z,{},x)),ze=Qe.sdf,void 0===i.sdfIcons?i.sdfIcons=Qe.sdf:i.sdfIcons!==Qe.sdf&&Nn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==i.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const it=nm(xe.horizontal)||xe.vertical;i.iconsInText||(i.iconsInText=!!it&&it.iconsInText),(it||Re)&&tm(i,Z,xe,Re,l,R,me,0,Fe,ze,_,x)}m&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)}function jh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tm(i,e,s,l,h,m,_,x,w,I,P,R){let O=m.textMaxSize.evaluate(e,{},R);void 0===O&&(O=_);const G=i.layers[0].layout,Z=G.get("icon-offset").evaluate(e,{},R),Q=nm(s.horizontal)||s.vertical,ce=_/24,me=i.tilePixelRatio*O/24,xe=i.tilePixelRatio*G.get("symbol-spacing"),Ae=G.get("text-padding")*i.tilePixelRatio,Re=G.get("icon-padding")*i.tilePixelRatio,Fe=ut(G.get("text-max-angle")),ze="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),it="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),Qe=G.get("symbol-placement"),At=xe/2,mt=G.get("icon-text-fit");let ot;l&&"none"!==mt&&(i.allowVerticalPlacement&&s.vertical&&(ot=af(l,s.vertical,mt,G.get("icon-text-fit-padding"),Z,ce)),Q&&(l=af(l,Q,mt,G.get("icon-text-fit-padding"),Z,ce)));const vt=(xt,lt)=>{lt.x<0||lt.x>=Hn||lt.y<0||lt.y>=Hn||function(Mt,kt,xn,Er,hn,er,Pt,Cr,Gn,zr,ui,vr,hi,_r,tr,Ar,Nr,Gr,nr,si,Rr,Hr,yr,Br,Vr){const kr=Mt.addToLineVertexArray(kt,Er);let Mr,qr,rr,_i,Bo,so,Fs,ls=0,ao=0,Za=0,Kc=0,Qc=-1,Jc=-1;const Ta={};let Mf=hh(""),Pf=0,id=0;if(void 0===Gn._unevaluatedLayout.getValue("text-radial-offset")?[Pf,id]=Gn.layout.get("text-offset").evaluate(Rr,{},Vr).map(cs=>24*cs):(Pf=24*Gn.layout.get("text-radial-offset").evaluate(Rr,{},Vr),id=Du),Mt.allowVerticalPlacement&&hn.vertical){const cs=hn.vertical;if(tr)so=Qo(cs),Cr&&(Fs=Qo(Cr));else{const Ls=Gn.layout.get("text-rotate").evaluate(Rr,{},Vr)+90;rr=$h(zr,xn,kt,ui,vr,hi,cs,_r,Ls,Ar),Cr&&(_i=$h(zr,xn,kt,ui,vr,hi,Cr,Gr,Ls))}}if(er){const cs=Gn.layout.get("icon-rotate").evaluate(Rr,{},Vr),Ls="none"!==Gn.layout.get("icon-text-fit"),nh=Uc(er,cs,yr,Ls),sd=Cr?Uc(Cr,cs,yr,Ls):void 0;qr=$h(zr,xn,kt,ui,vr,hi,er,Gr,cs),ls=4*nh.length;const bm=Mt.iconSizeData;let uc=null;"source"===bm.kind?(uc=[wa*Gn.layout.get("icon-size").evaluate(Rr,{},Vr)],uc[0]>sc&&Nn(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===bm.kind&&(uc=[wa*Hr.compositeIconSizes[0].evaluate(Rr,{},Vr),wa*Hr.compositeIconSizes[1].evaluate(Rr,{},Vr)],(uc[0]>sc||uc[1]>sc)&&Nn(`${Mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Mt.addSymbols(Mt.icon,nh,uc,si,nr,Rr,!1,xn,kt,kr.lineStartIndex,kr.lineLength,-1,Br,Vr),Qc=Mt.icon.placedSymbolArray.length-1,sd&&(ao=4*sd.length,Mt.addSymbols(Mt.icon,sd,uc,si,nr,Rr,Ko.vertical,xn,kt,kr.lineStartIndex,kr.lineLength,-1,Br,Vr),Jc=Mt.icon.placedSymbolArray.length-1)}for(const cs in hn.horizontal){const Ls=hn.horizontal[cs];Mr||(Mf=hh(Ls.text),tr?Bo=Qo(Ls):Mr=$h(zr,xn,kt,ui,vr,hi,Ls,_r,Gn.layout.get("text-rotate").evaluate(Rr,{},Vr),Ar));const nh=1===Ls.positionedLines.length;if(Za+=pf(Mt,xn,kt,Ls,Pt,Gn,tr,Rr,Ar,kr,hn.vertical?Ko.horizontal:Ko.horizontalOnly,nh?Object.keys(hn.horizontal):[cs],Ta,Qc,Hr,Br,Vr),nh)break}hn.vertical&&(Kc+=pf(Mt,xn,kt,hn.vertical,Pt,Gn,tr,Rr,Ar,kr,Ko.vertical,["vertical"],Ta,Jc,Hr,Br,Vr));let cc=-1;const od=(cs,Ls)=>cs?Math.max(cs,Ls):Ls;cc=od(Bo,cc),cc=od(so,cc),cc=od(Fs,cc);const xm=cc>-1?1:0;Mt.glyphOffsetArray.length>=bl.MAX_GLYPHS&&Nn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Rr.sortKey&&Mt.addToSortKeyRanges(Mt.symbolInstances.length,Rr.sortKey),Mt.symbolInstances.emplaceBack(xn.x,xn.y,xn.z,kt.x,kt.y,Ta.right>=0?Ta.right:-1,Ta.center>=0?Ta.center:-1,Ta.left>=0?Ta.left:-1,Ta.vertical>=0?Ta.vertical:-1,Qc,Jc,Mf,void 0!==Mr?Mr:Mt.collisionBoxArray.length,void 0!==Mr?Mr+1:Mt.collisionBoxArray.length,void 0!==rr?rr:Mt.collisionBoxArray.length,void 0!==rr?rr+1:Mt.collisionBoxArray.length,void 0!==qr?qr:Mt.collisionBoxArray.length,void 0!==qr?qr+1:Mt.collisionBoxArray.length,_i||Mt.collisionBoxArray.length,_i?_i+1:Mt.collisionBoxArray.length,ui,Za,Kc,ls,ao,xm,0,Pf,id,cc)}(i,lt,lt,xt,s,l,h,ot,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ae,ze,w,0,Re,it,Z,e,m,I,P,R)};if("line"===Qe)for(const xt of Uh(e.geometry,0,0,Hn,Hn)){const lt=qg(xt,xe,Fe,s.vertical||Q,l,24,me,i.overscaling,Hn);for(const Mt of lt){const kt=Q;kt&&Yg(i,kt.text,At,Mt)||vt(xt,Mt)}}else if("line-center"===Qe){for(const xt of e.geometry)if(xt.length>1){const lt=Kp(xt,Fe,s.vertical||Q,l,24,me);lt&&vt(xt,lt)}}else if("Polygon"===e.type)for(const xt of Gu(e.geometry,0)){const lt=hf(xt,16);vt(xt[0],new ja(lt.x,lt.y,0,0,void 0))}else if("LineString"===e.type)for(const xt of e.geometry)vt(xt,new ja(xt[0].x,xt[0].y,0,0,void 0));else if("Point"===e.type)for(const xt of e.geometry)for(const lt of xt)vt([lt],new ja(lt.x,lt.y,0,0,void 0))}const sc=32640;function pf(i,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q,ce){const me=function(Re,Fe,ze,it,Qe,At,mt,ot){const vt=[];if(0===Fe.positionedLines.length)return vt;const xt=it.layout.get("text-rotate").evaluate(At,{})*Math.PI/180,lt=function(hn){const er=hn[0],Pt=hn[1],Cr=er*Pt;return Cr>0?[er,-Pt]:Cr<0?[-er,Pt]:0===er?[Pt,er]:[Pt,-er]}(ze);let Mt=Math.abs(Fe.top-Fe.bottom);for(const hn of Fe.positionedLines)Mt-=hn.lineOffset;const kt=Fe.positionedLines.length,xn=Mt/kt;let Er=Fe.top-ze[1];for(let hn=0;hn<kt;++hn){const er=Fe.positionedLines[hn];Er=Wg(Fe,xn,Er,hn);for(const Pt of er.positionedGlyphs){if(!Pt.rect)continue;const Cr=Pt.rect||{};let Gn=4,zr=!0,ui=1,vr=0;if(Pt.imageName){const rr=mt[Pt.imageName];if(!rr)continue;if(rr.sdf){Nn("SDF images are not supported in formatted text and will be ignored.");continue}zr=!1,ui=rr.pixelRatio,Gn=1/ui}const hi=(Qe||ot)&&Pt.vertical,_r=Pt.metrics.advance*Pt.scale/2,tr=Pt.metrics,Ar=Pt.rect;if(null===Ar)continue;ot&&Fe.verticalizable&&(vr=Pt.imageName?_r-Pt.metrics.width*Pt.scale/2:0);const Nr=Qe?[Pt.x+_r,Pt.y]:[0,0];let Gr=[0,0],nr=[0,0],si=!1;Qe||(hi?(nr=[Pt.x+_r+lt[0],Pt.y+lt[1]-vr],si=!0):Gr=[Pt.x+_r+ze[0],Pt.y+ze[1]-vr]);const Rr=Ar.w*Pt.scale/(ui*(Pt.localGlyph?2:1)),Hr=Ar.h*Pt.scale/(ui*(Pt.localGlyph?2:1));let yr,Br,Vr,kr;if(hi){const rr=Pt.y-Er,_i=new Ve(-_r,_r-rr),Bo=-Math.PI/2,so=new Ve(...nr);yr=new Ve(-_r+Gr[0],Gr[1]),yr._rotateAround(Bo,_i)._add(so),yr.x+=-rr+_r,yr.y-=(tr.left-Gn)*Pt.scale;const Fs=Pt.imageName?tr.advance*Pt.scale:24*Pt.scale,ls=String.fromCharCode(Pt.glyph);Ng(ls)?yr.x+=(1-Gn)*Pt.scale:Bg(ls)?yr.x+=Fs-tr.height*Pt.scale+(-Gn-1)*Pt.scale:yr.x+=Pt.imageName||tr.width+2*Gn===Ar.w&&tr.height+2*Gn===Ar.h?(Fs-Hr)/2:(Fs-(tr.height+2*Gn)*Pt.scale)/2,Br=new Ve(yr.x,yr.y-Rr),Vr=new Ve(yr.x+Hr,yr.y),kr=new Ve(yr.x+Hr,yr.y-Rr)}else{const rr=(tr.left-Gn)*Pt.scale-_r+Gr[0],_i=(-tr.top-Gn)*Pt.scale+Gr[1],Bo=rr+Rr,so=_i+Hr;yr=new Ve(rr,_i),Br=new Ve(Bo,_i),Vr=new Ve(rr,so),kr=new Ve(Bo,so)}if(xt){let rr;rr=Qe?new Ve(0,0):si?new Ve(lt[0],lt[1]):new Ve(ze[0],ze[1]),yr._rotateAround(xt,rr),Br._rotateAround(xt,rr),Vr._rotateAround(xt,rr),kr._rotateAround(xt,rr)}const Mr=new Ve(0,0),qr=new Ve(0,0);vt.push({tl:yr,tr:Br,bl:Vr,br:kr,tex:Cr,writingMode:Fe.writingMode,glyphOffset:Nr,sectionIndex:Pt.sectionIndex,isSDF:zr,pixelOffsetTL:Mr,pixelOffsetBR:qr,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,l,w,m,_,x,h,i.allowVerticalPlacement),xe=i.textSizeData;let Ae=null;"source"===xe.kind?(Ae=[wa*m.layout.get("text-size").evaluate(x,{},ce)],Ae[0]>sc&&Nn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===xe.kind&&(Ae=[wa*Z.compositeTextSizes[0].evaluate(x,{},ce),wa*Z.compositeTextSizes[1].evaluate(x,{},ce)],(Ae[0]>sc||Ae[1]>sc)&&Nn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,me,Ae,w,_,x,P,e,s,I.lineStartIndex,I.lineLength,G,Q,ce);for(const Re of R)O[Re]=i.text.placedSymbolArray.length-1;return 4*me.length}function nm(i){for(const e in i)return i[e];return null}function $h(i,e,s,l,h,m,_,x,w,I){let P=_.top,R=_.bottom,O=_.left,G=_.right;const Z=_.collisionPadding;if(Z&&(O-=Z[0],P-=Z[1],G+=Z[2],R+=Z[3]),w){const Q=new Ve(O,P),ce=new Ve(G,P),me=new Ve(O,R),xe=new Ve(G,R),Ae=ut(w);let Re=new Ve(0,0);I&&(Re=new Ve(I[0],I[1])),Q._rotateAround(Ae,Re),ce._rotateAround(Ae,Re),me._rotateAround(Ae,Re),xe._rotateAround(Ae,Re),O=Math.min(Q.x,ce.x,me.x,xe.x),G=Math.max(Q.x,ce.x,me.x,xe.x),P=Math.min(Q.y,ce.y,me.y,xe.y),R=Math.max(Q.y,ce.y,me.y,xe.y)}return i.emplaceBack(e.x,e.y,e.z,s.x,s.y,O,P,G,R,x,l,h,m),i.length-1}function Qo(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Yg(i,e,s,l){const h=i.compareText;if(e in h){const m=h[e];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<s)return!0}else h[e]=[];return h[e].push(l),!1}const Kg=Vc.VectorTileFeature.types,Zy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mf(i,e,s,l,h,m,_,x,w,I,P,R,O,G,Z,Q){const ce=P?Math.min(sc,Math.round(P[0])):0,me=P?Math.min(sc,Math.round(P[1])):0;i.emplaceBack(e,s,Math.round(32*_),Math.round(32*x),w,I,(ce<<1)+(R?1:0),me,16*O,16*G,256*Z,256*Q,l,h,m,0)}function Gh(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function Wy(i){for(const e of i.sections)if(un(e.text))return!0;return!1}class gf{constructor(e){this.layoutVertexArray=new vn,this.indexArray=new $r,this.programConfigurations=e,this.segments=new Hi,this.dynamicLayoutVertexArray=new rn,this.opacityVertexArray=new Jn,this.placedSymbolArray=new Js}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,s,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Lg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Zy,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ft("SymbolBuffers",gf);class Yu{constructor(e,s,l){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Hi,this.collisionVertexArray=new Gi,this.collisionVertexArrayExt=new rn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Up.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Og.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft("CollisionBuffers",Yu);class bl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gp([]),this.placementViewportMatrix=gp([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qd(this.zoom,s["text-size"]),this.iconSizeData=Qd(this.zoom,s["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Ko[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new gf(new Fc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new gf(new Fc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new uh,this.lineVertexArray=new Ql,this.symbolInstances=new Xo}calculateGlyphDependencies(e,s,l,h,m){for(let _=0;_<e.length;_++)if(s[e.charCodeAt(_)]=!0,h&&m){const x=Zu[e.charAt(_)];x&&(s[x.charCodeAt(0)]=!0)}}populate(e,s,l,h){const m=this.layers[0],_=m.layout,x=_.get("text-font"),w=_.get("text-field"),I=_.get("icon-image"),P=("constant"!==w.value.kind||w.value.value instanceof Fn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),R="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,O=_.get("symbol-sort-key");if(this.features=[],!P&&!R)return;const G=s.iconDependencies,Z=s.glyphDependencies,Q=s.availableImages,ce=new j(this.zoom);for(const{feature:me,id:xe,index:Ae,sourceLayerIndex:Re}of e){const Fe=m._featureFilter.needGeometry,ze=gl(me,Fe);if(!m._featureFilter.filter(ce,ze,l))continue;let it,Qe;if(Fe||(ze.geometry=xa(me,l,h)),P){const mt=m.getValueAndResolveTokens("text-field",ze,l,Q),ot=Fn.factory(mt);Wy(ot)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===k()||this.hasRTLText&&V.isParsed())&&(it=$p(ot,m,ze))}if(R){const mt=m.getValueAndResolveTokens("icon-image",ze,l,Q);Qe=mt instanceof xr?mt:xr.fromString(mt)}if(!it&&!Qe)continue;const At=this.sortFeaturesByKey?O.evaluate(ze,{},l):void 0;if(this.features.push({id:xe,text:it,icon:Qe,index:Ae,sourceLayerIndex:Re,geometry:ze.geometry,properties:me.properties,type:Kg[me.type],sortKey:At}),Qe&&(G[Qe.name]=!0),it){const mt=x.evaluate(ze,{},l).join(","),ot="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ko.vertical)>=0;for(const vt of it.sections)if(vt.image)G[vt.image.name]=!0;else{const xt=B(it.toString()),lt=vt.fontStack||mt,Mt=Z[lt]=Z[lt]||{};this.calculateGlyphDependencies(vt.text,Mt,ot,this.allowVerticalPlacement,xt)}}}"line"===_.get("symbol-placement")&&(this.features=function(me){const xe={},Ae={},Re=[];let Fe=0;function ze(mt){Re.push(me[mt]),Fe++}function it(mt,ot,vt){const xt=Ae[mt];return delete Ae[mt],Ae[ot]=xt,Re[xt].geometry[0].pop(),Re[xt].geometry[0]=Re[xt].geometry[0].concat(vt[0]),xt}function Qe(mt,ot,vt){const xt=xe[ot];return delete xe[ot],xe[mt]=xt,Re[xt].geometry[0].shift(),Re[xt].geometry[0]=vt[0].concat(Re[xt].geometry[0]),xt}function At(mt,ot,vt){const xt=vt?ot[0][ot[0].length-1]:ot[0][0];return`${mt}:${xt.x}:${xt.y}`}for(let mt=0;mt<me.length;mt++){const ot=me[mt],vt=ot.geometry,xt=ot.text?ot.text.toString():null;if(!xt){ze(mt);continue}const lt=At(xt,vt),Mt=At(xt,vt,!0);if(lt in Ae&&Mt in xe&&Ae[lt]!==xe[Mt]){const kt=Qe(lt,Mt,vt),xn=it(lt,Mt,Re[kt].geometry);delete xe[lt],delete Ae[Mt],Ae[At(xt,Re[xn].geometry,!0)]=xn,Re[kt].geometry=null}else lt in Ae?it(lt,Mt,vt):Mt in xe?Qe(lt,Mt,vt):(ze(mt),xe[lt]=Fe-1,Ae[Mt]=Fe-1)}return Re.filter(mt=>mt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,xe)=>me.sortKey-xe.sortKey)}update(e,s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const l=this.lineVertexArray.length;if(void 0!==e.segment){let h=e.dist(s[e.segment+1]),m=e.dist(s[e.segment]);const _={};for(let x=e.segment+1;x<s.length;x++)_[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:h},x<s.length-1&&(h+=s[x+1].dist(s[x]));for(let x=e.segment||0;x>=0;x--)_[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:m},x>0&&(m+=s[x-1].dist(s[x]));for(let x=0;x<s.length;x++){const w=_[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,s,l,h,m,_,x,w,I,P,R,O,G,Z){const Q=e.indexArray,ce=e.layoutVertexArray,me=e.segments.prepareSegment(4*s.length,ce,Q,this.canOverlap?_.sortKey:void 0),xe=this.glyphOffsetArray.length,Ae=me.vertexLength,Re=this.allowVerticalPlacement&&x===Ko.vertical?Math.PI/2:0,Fe=_.text&&_.text.sections;for(let ze=0;ze<s.length;ze++){const{tl:it,tr:Qe,bl:At,br:mt,tex:ot,pixelOffsetTL:vt,pixelOffsetBR:xt,minFontScaleX:lt,minFontScaleY:Mt,glyphOffset:kt,isSDF:xn,sectionIndex:Er}=s[ze],hn=me.vertexLength,er=kt[1];mf(ce,w.x,w.y,w.z,I.x,I.y,it.x,er+it.y,ot.x,ot.y,l,xn,vt.x,vt.y,lt,Mt),mf(ce,w.x,w.y,w.z,I.x,I.y,Qe.x,er+Qe.y,ot.x+ot.w,ot.y,l,xn,xt.x,vt.y,lt,Mt),mf(ce,w.x,w.y,w.z,I.x,I.y,At.x,er+At.y,ot.x,ot.y+ot.h,l,xn,vt.x,xt.y,lt,Mt),mf(ce,w.x,w.y,w.z,I.x,I.y,mt.x,er+mt.y,ot.x+ot.w,ot.y+ot.h,l,xn,xt.x,xt.y,lt,Mt),Gh(e.dynamicLayoutVertexArray,w,Re),Q.emplaceBack(hn,hn+1,hn+2),Q.emplaceBack(hn+1,hn+2,hn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),ze!==s.length-1&&Er===s[ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,_,_.index,{},G,Z,Fe&&Fe[Er])}e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,I.x,I.y,xe,this.glyphOffsetArray.length-xe,Ae,P,R,I.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,O,0)}_commitLayoutVertex(e,s,l,h,m,_,x){e.emplaceBack(s,l,h,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,s,l,h,m,_,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),I=w.vertexLength,P=x.tileAnchorX,R=x.tileAnchorY;for(let G=0;G<4;G++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,R,new Ve(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,R,new Ve(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,R,new Ve(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,P,R,new Ve(e.x1,e.y2)),w.vertexLength+=4;const O=l.indexArray;O.emplaceBack(I,I+1),O.emplaceBack(I+1,I+2),O.emplaceBack(I+2,I+3),O.emplaceBack(I+3,I),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),I=this.getSymbolInstanceTextSize(e,_,s,x);this._addCollisionDebugVertices(w,I,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,s,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),I=this.getSymbolInstanceIconSize(e,s,x);this._addCollisionDebugVertices(w,I,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yu(Ii,jp.members,lr),this.iconCollisionBox=new Yu(Ii,jp.members,lr);const l=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,s,l,h){const m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),_=Rh(this.textSizeData,e,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,s,l){const h=this.icon.placedSymbolArray.get(l),m=Rh(this.iconSizeData,e,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,s,l){e.emplaceBack(s,-l,-l),e.emplaceBack(s,l,-l),e.emplaceBack(s,l,l),e.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(e,s,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),I=this.getSymbolInstanceTextSize(e,_,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,w.padding)}}_updateIconDebugCollisionBoxes(e,s,l,h,m){for(let _=h;_<m;_++){const x=l.get(_),w=this.getSymbolInstanceIconSize(e,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,l,h,m,_,x,w,I){const P={};for(let R=s;R<l;R++){const O=e.get(R);P.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.textFeatureIndex=O.featureIndex;break}for(let R=h;R<m;R++){const O=e.get(R);P.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.verticalTextFeatureIndex=O.featureIndex;break}for(let R=_;R<x;R++){const O=e.get(R);P.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.iconFeatureIndex=O.featureIndex;break}for(let R=w;R<I;R++){const O=e.get(R);P.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,padding:O.padding,projectedAnchorX:O.projectedAnchorX,projectedAnchorY:O.projectedAnchorY,projectedAnchorZ:O.projectedAnchorZ,tileAnchorX:O.tileAnchorX,tileAnchorY:O.tileAnchorY},P.verticalIconFeatureIndex=O.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const l=e.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(e),l=Math.cos(e),h=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),m.push(w.featureIndex)}return _.sort((x,w)=>h[x]-h[w]||m[w]-m[x]),_}addToSortKeyRanges(e,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,m,_)=>{h>=0&&_.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ft("SymbolBucket",bl,{omit:["layers","collisionBoxArray","features","compareText"]}),bl.MAX_GLYPHS=65535,bl.addDynamicAttributes=Gh;const Qg=new nt({"symbol-placement":new se(Pe.layout_symbol["symbol-placement"]),"symbol-spacing":new se(Pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new se(Pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _e(Pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new se(Pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new se(Pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new se(Pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new se(Pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new se(Pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new _e(Pe.layout_symbol["icon-size"]),"icon-text-fit":new se(Pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new se(Pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new _e(Pe.layout_symbol["icon-image"]),"icon-rotate":new _e(Pe.layout_symbol["icon-rotate"]),"icon-padding":new se(Pe.layout_symbol["icon-padding"]),"icon-keep-upright":new se(Pe.layout_symbol["icon-keep-upright"]),"icon-offset":new _e(Pe.layout_symbol["icon-offset"]),"icon-anchor":new _e(Pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new se(Pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new se(Pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new se(Pe.layout_symbol["text-rotation-alignment"]),"text-field":new _e(Pe.layout_symbol["text-field"]),"text-font":new _e(Pe.layout_symbol["text-font"]),"text-size":new _e(Pe.layout_symbol["text-size"]),"text-max-width":new _e(Pe.layout_symbol["text-max-width"]),"text-line-height":new _e(Pe.layout_symbol["text-line-height"]),"text-letter-spacing":new _e(Pe.layout_symbol["text-letter-spacing"]),"text-justify":new _e(Pe.layout_symbol["text-justify"]),"text-radial-offset":new _e(Pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new se(Pe.layout_symbol["text-variable-anchor"]),"text-anchor":new _e(Pe.layout_symbol["text-anchor"]),"text-max-angle":new se(Pe.layout_symbol["text-max-angle"]),"text-writing-mode":new se(Pe.layout_symbol["text-writing-mode"]),"text-rotate":new _e(Pe.layout_symbol["text-rotate"]),"text-padding":new se(Pe.layout_symbol["text-padding"]),"text-keep-upright":new se(Pe.layout_symbol["text-keep-upright"]),"text-transform":new _e(Pe.layout_symbol["text-transform"]),"text-offset":new _e(Pe.layout_symbol["text-offset"]),"text-allow-overlap":new se(Pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new se(Pe.layout_symbol["text-ignore-placement"]),"text-optional":new se(Pe.layout_symbol["text-optional"])});var _f={paint:new nt({"icon-opacity":new _e(Pe.paint_symbol["icon-opacity"]),"icon-color":new _e(Pe.paint_symbol["icon-color"]),"icon-halo-color":new _e(Pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new _e(Pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _e(Pe.paint_symbol["icon-halo-blur"]),"icon-translate":new se(Pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new se(Pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new _e(Pe.paint_symbol["text-opacity"]),"text-color":new _e(Pe.paint_symbol["text-color"],{runtimeType:wn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new _e(Pe.paint_symbol["text-halo-color"]),"text-halo-width":new _e(Pe.paint_symbol["text-halo-width"]),"text-halo-blur":new _e(Pe.paint_symbol["text-halo-blur"]),"text-translate":new se(Pe.paint_symbol["text-translate"]),"text-translate-anchor":new se(Pe.paint_symbol["text-translate-anchor"])}),layout:Qg};class rm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Dr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft("FormatSectionOverride",rm,{omit:["defaultValue"]});class Ku extends va{constructor(e){super(e,_f)}recalculate(e,s){super.recalculate(e,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,l,h){const m=this.layout.get(e).evaluate(s,{},l,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||to(_.value)||!m?m:(x=s.properties,m.replace(/{([^{}]+)}/g,(I,P)=>P in x?String(x[P]):""));var x}createBucket(e){return new bl(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of _f.paint.overridableProperties){if(!Ku.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),l=new rm(s),h=new el(l,s.property.specification);let m=null;m="constant"===s.value.kind||"source"===s.value.kind?new rs("source",h):new xs("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new pe(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&Ku.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const l=e.get("text-field"),h=_f.paint.properties[s];let m=!1;const _=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof Fn)_(l.value.value.sections);else if("source"===l.value.kind){const x=I=>{m||(I instanceof Qi&&hr(I.value)===Qn?_(I.value.sections):I instanceof mi?_(I.sections):I.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(e){return new fl(this,e)}}var Jg={paint:new nt({"background-color":new se(Pe.paint_background["background-color"]),"background-pattern":new Ze(Pe.paint_background["background-pattern"]),"background-opacity":new se(Pe.paint_background["background-opacity"])})},im={paint:new nt({"raster-opacity":new se(Pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new se(Pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new se(Pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new se(Pe.paint_raster["raster-brightness-max"]),"raster-saturation":new se(Pe.paint_raster["raster-saturation"]),"raster-contrast":new se(Pe.paint_raster["raster-contrast"]),"raster-resampling":new se(Pe.paint_raster["raster-resampling"]),"raster-fade-duration":new se(Pe.paint_raster["raster-fade-duration"])})};class e_ extends va{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var t_={paint:new nt({"sky-type":new se(Pe.paint_sky["sky-type"]),"sky-atmosphere-sun":new se(Pe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new se(Pe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new se(Pe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new se(Pe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Xe(Pe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new se(Pe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new se(Pe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new se(Pe.paint_sky["sky-opacity"])})};function Hh(i,e,s){const l=Nc(0,0,1),h=xp(vh());return function(m,_,x){x*=.5;var w=_[0],I=_[1],P=_[2],R=_[3],O=Math.sin(x),G=Math.cos(x);m[0]=w*G-P*O,m[1]=I*G+R*O,m[2]=P*G+w*O,m[3]=R*G-I*O}(h,h,s?-ut(i)+Math.PI:ut(i)),bp(h,h,-ut(e)),_p(l,l,h),yh(l,l)}const om={circle:class extends va{constructor(i){super(i,gg)}createBucket(i){return new hp(i)}queryRadius(i){const e=i;return hu("circle-radius",this,e)+hu("circle-stroke-width",this,e)+du(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,s,l,h,m,_,x){const w=pp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return Ld(i,l,m,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,I)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new fl(this,i)}},heatmap:class extends va{createBucket(i){return new Nd(i)}constructor(i){super(i,xg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return hu("heatmap-radius",this,i)}queryIntersectsFeature(i,e,s,l,h,m,_,x){const w=this.paint.get("heatmap-radius").evaluate(e,s);return Ld(i,l,m,_,x,!0,!0,new Ve(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new fl(this,i)}},hillshade:class extends va{constructor(i){super(i,bg)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new fl(this,i)}},fill:class extends va{constructor(i){super(i,Ag)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(i){return new fl(this,i)}recalculate(i,e){super.recalculate(i,e);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Dh(i)}queryRadius(){return du(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,s,l,h,m){return!i.queryGeometry.isAboveHorizon&&dp(kd(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends va{constructor(i){super(i,Op)}createBucket(i){return new Ah(i)}queryRadius(){return du(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new fl(this,i)}queryIntersectsFeature(i,e,s,l,h,m,_,x,w){const I=pp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(e,s),R=this.paint.get("fill-extrusion-base").evaluate(e,s),O=[0,0],G=x&&m.elevation,Z=m.elevation?m.elevation.exaggeration():1;if(G){const me=i.tile.getBucket(this).centroidVertexArray,xe=w+1;if(xe<me.length){const Ae=me.get(xe);O[0]=Ae.a_centroid_pos0,O[1]=Ae.a_centroid_pos1}}if(0===O[0]&&1===O[1])return!1;const Q=(me=l,xe=R,Ae=P,Re=I,Fe=_,(ze=G?x:null)?function(mt,ot,vt,xt,lt,Mt,kt,xn,Er){const hn=[],er=[],Pt=[0,0,0,1];for(const Cr of mt){const Gn=[],zr=[];for(const ui of Cr){const vr=ui.x+xt.x,hi=ui.y+xt.y,_r=Xd(vr,hi,ot,vt,Mt,kt,xn,Er);Pt[0]=vr,Pt[1]=hi,Pt[2]=_r.base,Pt[3]=1,Uu(Pt,Pt,lt),Pt[3]=Math.max(Pt[3],1e-5);const tr=Wd([Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]]);Pt[0]=vr,Pt[1]=hi,Pt[2]=_r.top,Pt[3]=1,Uu(Pt,Pt,lt),Pt[3]=Math.max(Pt[3],1e-5);const Ar=Wd([Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]]);Gn.push(tr),zr.push(Ar)}hn.push(Gn),er.push(zr)}return[hn,er]}(me,xe,Ae,Re,Fe,ze,O,Z,m.center.lat):function(mt,ot,vt,xt,lt){const Mt=[],kt=[],xn=lt[8]*ot,Er=lt[9]*ot,hn=lt[10]*ot,er=lt[11]*ot,Pt=lt[8]*vt,Cr=lt[9]*vt,Gn=lt[10]*vt,zr=lt[11]*vt;for(const ui of mt){const vr=[],hi=[];for(const _r of ui){const tr=_r.x+xt.x,Ar=_r.y+xt.y,Nr=lt[0]*tr+lt[4]*Ar+lt[12],Gr=lt[1]*tr+lt[5]*Ar+lt[13],nr=lt[2]*tr+lt[6]*Ar+lt[14],si=lt[3]*tr+lt[7]*Ar+lt[15],Rr=Nr+xn,Hr=Gr+Er,yr=nr+hn,Br=Math.max(si+er,1e-5),Vr=Nr+Pt,kr=Gr+Cr,Mr=nr+Gn,qr=Math.max(si+zr,1e-5),rr=new Ve(Rr/Br,Hr/Br);rr.z=yr/Br,vr.push(rr);const _i=new Ve(Vr/qr,kr/qr);_i.z=Mr/qr,hi.push(_i)}Mt.push(vr),kt.push(hi)}return[Mt,kt]}(me,xe,Ae,Re,Fe)),ce=i.queryGeometry;var me,xe,Ae,Re,Fe,ze;return function(me,xe,Ae){let Re=1/0;dp(Ae,xe)&&(Re=Hu(Ae,xe[0]));for(let Fe=0;Fe<xe.length;Fe++){const ze=xe[Fe],it=me[Fe];for(let Qe=0;Qe<ze.length-1;Qe++){const At=ze[Qe],mt=[At,ze[Qe+1],it[Qe+1],it[Qe],At];Md(Ae,mt)&&(Re=Math.min(Re,Hu(Ae,mt)))}}return Re!==1/0&&Re}(Q[0],Q[1],ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},line:class extends va{constructor(i){super(i,Ph),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof la,this.gradientVersion=(this.gradientVersion+1)%We}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Kd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Mh(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new fl(this,i)}queryRadius(i){const e=i,s=Fg(hu("line-width",this,e),hu("line-gap-width",this,e)),l=hu("line-offset",this,e);return s/2+Math.abs(l)+du(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,s,l,h,m){if(i.queryGeometry.isAboveHorizon)return!1;const _=kd(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,i.pixelToTileUnitsFactor),x=i.pixelToTileUnitsFactor/2*Fg(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),w=this.paint.get("line-offset").evaluate(e,s);return w&&(l=function(I,P){const R=[],O=new Ve(0,0);for(let G=0;G<I.length;G++){const Z=I[G],Q=[];for(let ce=0;ce<Z.length;ce++){const me=Z[ce-1],xe=Z[ce],Ae=Z[ce+1],Re=0===ce?O:xe.sub(me)._unit()._perp(),Fe=ce===Z.length-1?O:Ae.sub(xe)._unit()._perp(),ze=Re._add(Fe)._unit();ze._mult(1/(ze.x*Fe.x+ze.y*Fe.y)),Q.push(ze._mult(P)._add(xe))}R.push(Q)}return R}(l,w*i.pixelToTileUnitsFactor)),function(I,P,R){for(let O=0;O<P.length;O++){const G=P[O];if(I.length>=3)for(let Z=0;Z<G.length;Z++)if(uu(I,G[Z]))return!0;if(fg(I,G,R))return!0}return!1}(_,l,x)}isTileClipped(){return!0}},symbol:Ku,background:class extends va{constructor(i){super(i,Jg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends va{constructor(i){super(i,im)}getProgramIds(){return["raster"]}},sky:class extends va{constructor(i){super(i,t_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Vd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),h=!l,m=i.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&Nn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Hh(_.azimuthal,90-_.polar,e):Hh(l[0],90-l[1],e)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return Hh(l[0],90-l[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:sm,HTMLCanvasElement:Ca,HTMLVideoElement:qh,ImageData:am,ImageBitmap:Zh}=Se;class yf{constructor(e,s,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,h)}update(e,s,l){const{width:h,height:m}=e,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===m){const{x:w,y:I}=l||{x:0,y:0};e instanceof sm||e instanceof Ca||e instanceof qh||e instanceof am||Zh&&e instanceof Zh?x.texSubImage2D(x.TEXTURE_2D,0,w,I,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,w,I,h,m,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[h,m],e instanceof sm||e instanceof Ca||e instanceof qh||e instanceof am||Zh&&e instanceof Zh?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,h,m,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Wh{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Ms({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const l=this.getKey(e,s);return this.positions[l]}trim(){const e=this.width,s=this.height=or(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,x=!0;h.push({left:m,right:_,isDash:x,zeroLength:0===e[0]});let w=e[0];for(let I=1;I<e.length;I++){x=!x;const P=e[I];m=w*l,w+=P,_=w*l,h.push({left:m,right:_,isDash:x,zeroLength:0===P})}return h}addRoundDash(e,s,l){const h=s/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let x=0,w=e[x];for(let I=0;I<this.width;I++){I/w.right>1&&(w=e[++x]);const P=Math.abs(I-w.left),R=Math.abs(I-w.right),O=Math.min(P,R);let G;const Z=m/l*(h+1);if(w.isDash){const Q=h-Math.abs(Z);G=Math.sqrt(O*O+Q*Q)}else G=h-Math.sqrt(O*O+Z*Z);this.image.data[_+I]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e,s){for(let w=e.length-1;w>=0;--w){const I=e[w],P=e[w+1];I.zeroLength?e.splice(w,1):P&&P.isDash===I.isDash&&(P.left=I.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,x=e[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++_]);const I=Math.abs(w-x.left),P=Math.abs(w-x.right),R=Math.min(I,P);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?R:-R)+s+128))}}addDash(e,s){const l=this.getKey(e,s);if(this.positions[l])return this.positions[l];const h="round"===s,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return Nn("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let P=0;P<e.length;P++)e[P]<0&&(Nn("Negative value is found in line dasharray, replacing values with 0"),e[P]=0),x+=e[P];if(0!==x){const P=this.width/x,R=this.getDashRanges(e,this.width,P);h?this.addRoundDash(R,P,m):this.addRegularDash(R,"square"===s?.5*P:0)}const w=this.nextRow+m;this.nextRow+=_;const I={tl:[w,m],br:[x,0]};return this.positions[l]=I,I}}Ft("LineAtlas",Wh);class n_{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const r_=Se.performance;function lm(i){const e=i?i.url.toString():void 0;return r_.getEntriesByName(e)}class vf{constructor(){this.tasks={},this.taskQueue=[],cn(["process"],this),this.invoker=new n_(this.process),this.nextId=0}add(e,s){const l=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-x:"maybePrepare"===m&&_?400-x:500:200-x:100-x}(s);if(0===h){Bi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Bi();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<s&&(s=m.priority,e=h)}if(null===e)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}function Xh(i,e){const s=Math.pow(2,-i.z),l=i.x*s,h=(i.x+1)*s,m=i.y*s,_=(i.y+1)*s;if("mercator"===e.name)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const x=tc(l),w=tc(h),I=qi(m),P=qi(_),R=e.project(x,I),O=e.project(w,I),G=e.project(w,P),Z=e.project(x,P);let Q=Math.min(R.x,O.x,G.x,Z.x),ce=Math.min(R.y,O.y,G.y,Z.y),me=Math.max(R.x,O.x,G.x,Z.x),xe=Math.max(R.y,O.y,G.y,Z.y);const Ae=s/16;function Re(ze,it,Qe,At,mt,ot){const vt=(Qe+mt)/2,xt=(At+ot)/2,lt=e.project(tc(vt),qi(xt)),Mt=Math.max(0,Q-lt.x,ce-lt.y,lt.x-me,lt.y-xe);Q=Math.min(Q,lt.x),me=Math.max(me,lt.x),ce=Math.min(ce,lt.y),xe=Math.max(xe,lt.y),Mt>Ae&&(Re(ze,lt,Qe,At,vt,xt),Re(lt,it,vt,xt,mt,ot))}Re(R,O,l,m,h,m),Re(O,G,h,m,h,_),Re(G,Z,h,_,l,_),Re(Z,R,l,_,l,m),Q-=Ae,ce-=Ae,me+=Ae,xe+=Ae;const Fe=1/Math.max(me-Q,xe-ce);return{scale:Fe,x:Q*Fe,y:ce*Fe,x2:me*Fe,y2:xe*Fe,projection:e}}function cm(i,e,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Iu{constructor(e,s,l){this.z=e,this.x=s,this.y=l,this.key=Gc(0,e,e,s,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const l=(m=this.y,_=this.z,x=cm(256*(h=this.x),256*(m=Math.pow(2,_)-m-1),_),w=cm(256*(h+1),256*(m+1),_),x[0]+","+x[1]+","+w[0]+","+w[1]);var h,m,_,x,w;const I=function(P,R,O){let G,Z="";for(let Q=P;Q>0;Q--)G=1<<Q-1,Z+=(R&G?1:0)+(O&G?2:0);return Z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yh{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Gc(e,s.z,s.z,s.x,s.y)}}class Jo{constructor(e,s,l,h,m){this.overscaledZ=e,this.wrap=s,this.canonical=new Iu(l,+h,+m),this.key=0===s&&e===l?this.canonical.key:Gc(s,e,l,h,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new Jo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Gc(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Gc(this.wrap*+s,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Jo(s,this.wrap,s,l,h),new Jo(s,this.wrap,s,l+1,h),new Jo(s,this.wrap,s,l,h+1),new Jo(s,this.wrap,s,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gc(i,e,s,l,h){const m=1<<Math.min(s,22);let _=m*(h%m)+l%m;return i&&s<22&&(_+=m*m*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*_+s)+(e-s)}Ft("CanonicalTileID",Iu),Ft("OverscaledTileID",Jo,{omit:["projMatrix"]});class Kh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const l=e[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class xf{constructor(e,s,l,h,m){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=l,e._y=h,this.properties=e.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(e[s]=this[s]);return e}}var i_=He([{name:"a_pos",type:"Int16",components:2}]);const Hc=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,s=0,l=0,h=0,m=0,_=0,x=0;for(1&e?h=m=_=32:s=l=x=32;(e>>=1)>1;){const I=s+h>>1,P=l+m>>1;1&e?(h=s,m=l,s=_,l=x):(s=h,l=m,h=_,m=x),_=I,x=P}const w=4*i;Hc[w+0]=s,Hc[w+1]=l,Hc[w+2]=h,Hc[w+3]=m}const Ga=new Uint16Array(2178),wl=new Uint8Array(1089),Qu=new Uint16Array(1089);function bf(i){return 0===i?-.03125:32===i?.03125:0}var Qh=He([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const wf={type:2,extent:Hn,loadGeometry:()=>[[new Ve(0,0),new Ve(8193,0),new Ve(8193,8193),new Ve(0,8193),new Ve(0,0)]]};class Ha{constructor(e,s,l,h,m){this.tileID=e,this.uid=jt(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<vi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Xh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const x of h){const w=x.layerIds.map(I=>m.getLayer(I)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(I=>w.filter(P=>P.id===I)[0]));for(const I of w)_[I.id]=x}}return _}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof bl){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof bl&&m.hasRTLText){this.hasRTLText=!0,V.isLoading()||V.isLoaded()||"deferred"!==k()||z();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Zo}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yf(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yf(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new yf(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,h,m,_,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=s?s.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const x=nl(s&&s.filter),{z:w,x:I,y:P}=this.tileID.canonical,R={z:w,x:I,y:P};for(let O=0;O<_.length;O++){const G=_.feature(O);if(x.needGeometry){const ce=gl(G,!0);if(!x.filter(new j(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!x.filter(new j(this.tileID.overscaledZ),G))continue;const Z=l.getId(G,m),Q=new xf(G,w,I,P,Z);Q.tile=R,e.push(Q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=fs(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],I=e[x];if(!w||!I||0===Object.keys(I).length)continue;if(_.update(I,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Mh||_ instanceof Dh){const R=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&R&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(R.id,this.tileID)}const P=s&&s.style&&s.style.getLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=vi.now()+e}setDependencies(e,s){const l={};for(const h of s)l[h]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const h=this.dependencies[l];if(h)for(const m of s)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=xa(wf,this.tileID.canonical,this.tileTransform)[0],h=new Lt,m=new li;for(let _=0;_<l.length;_++){const{x,y:w}=l[_];h.emplaceBack(x,w),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(h,Qh.members),this._tileDebugSegments=Hi.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=xa(wf,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(x,w){const I=Xh(x,w),P=Math.pow(2,x.z);for(let ce=0;ce<33;ce++)for(let me=0;me<33;me++){const xe=tc((x.x+(me+bf(me))/32)/P),Ae=qi((x.y+(ce+bf(ce))/32)/P),Re=w.project(xe,Ae),Fe=33*ce+me;Ga[2*Fe+0]=Math.round((Re.x*I.scale-I.x)*Hn),Ga[2*Fe+1]=Math.round((Re.y*I.scale-I.y)*Hn)}wl.fill(0),Qu.fill(0);for(let ce=2045;ce>=0;ce--){const me=4*ce,xe=Hc[me+0],Ae=Hc[me+1],Re=Hc[me+2],Fe=Hc[me+3],ze=xe+Re>>1,it=Ae+Fe>>1,Qe=ze+it-Ae,At=it+xe-ze,mt=33*Ae+xe,ot=33*Fe+Re,vt=33*it+ze,xt=Math.hypot((Ga[2*mt+0]+Ga[2*ot+0])/2-Ga[2*vt+0],(Ga[2*mt+1]+Ga[2*ot+1])/2-Ga[2*vt+1])>=16;if(wl[vt]=wl[vt]||(xt?1:0),ce<1022){const lt=33*(Ae+At>>1)+(xe+Qe>>1),Mt=33*(Fe+At>>1)+(Re+Qe>>1);wl[vt]=wl[vt]||wl[lt]||wl[Mt]}}const R=new Jt,O=new $r;let G=0;function Z(ce,me){const xe=33*me+ce;return 0===Qu[xe]&&(R.emplaceBack(Ga[2*xe+0],Ga[2*xe+1],ce*Hn/32,me*Hn/32),Qu[xe]=++G),Qu[xe]-1}function Q(ce,me,xe,Ae,Re,Fe){const ze=ce+xe>>1,it=me+Ae>>1;if(Math.abs(ce-Re)+Math.abs(me-Fe)>1&&wl[33*it+ze])Q(Re,Fe,ce,me,ze,it),Q(xe,Ae,Re,Fe,ze,it);else{const Qe=Z(ce,me),At=Z(xe,Ae),mt=Z(Re,Fe);O.emplaceBack(Qe,At,mt)}}return Q(0,0,32,32,32,0),Q(32,32,0,0,0,32),{vertices:R,indices:O}}(this.tileID.canonical,s);h=_.vertices,m=_.indices}else{h=new Jt,m=new $r;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const _=Yo(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,Qh.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=Hi.simpleSegment(0,0,h.length,m.length)}}class Jh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const h=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},Pr(this.stateChanges[e][h],l),null===this.deletedStates[e]){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const m in this.state[e][h])l[m]||(this.deletedStates[e][h][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][m]&&delete this.deletedStates[e][h][m]}removeFeatureState(e,s,l){if(null===this.deletedStates[e])return;const h=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&void 0!==s)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(void 0!==s)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),h=Pr({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const m=this.deletedStates[e][s];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),Pr(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];m[_]=this.state[h][_]}l[h]=l[h]||{},Pr(l[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in e)e[h].setFeatureState(l,s)}}class um{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const l=this.toIdx(e,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function hm(i,e,s,l){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<i[_]||s[_]>e[_])return null}else{const x=1/l[_];let w=(i[_]-s[_])*x,I=(e[_]-s[_])*x;if(w>I){const P=w;w=I,I=P}if(w>h&&(h=w),I<m&&(m=I),h>m)return null}return h}function o_(i,e,s,l,h,m,_,x,w,I,P){const R=l-i,O=h-e,G=m-s,Z=_-i,Q=x-e,ce=w-s,me=P[1]*ce-P[2]*Q,xe=P[2]*Z-P[0]*ce,Ae=P[0]*Q-P[1]*Z,Re=R*me+O*xe+G*Ae;if(Math.abs(Re)<1e-15)return null;const Fe=1/Re,ze=I[0]-i,it=I[1]-e,Qe=I[2]-s,At=(ze*me+it*xe+Qe*Ae)*Fe;if(At<0||At>1)return null;const mt=it*G-Qe*O,ot=Qe*R-ze*G,vt=ze*O-it*R,xt=(P[0]*mt+P[1]*ot+P[2]*vt)*Fe;return xt<0||At+xt>1?null:(Z*mt+Q*ot+ce*vt)*Fe}function qc(i,e,s){return(i-e)/(s-e)}function Ef(i,e,s,l,h,m,_,x,w){const I=1<<s,P=m-l,R=_-h,O=(i+1)/I*P+l,G=(e+0)/I*R+h,Z=(e+1)/I*R+h;x[0]=(i+0)/I*P+l,x[1]=G,w[0]=O,w[1]=Z}class Su{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,_));const I=1/w,P=(G,Z,Q,ce,me)=>{const xe=ce?1:0,Ae=(G+1)*Q-xe,Re=Z*Q,Fe=(Z+1)*Q-xe;me[0]=G*Q,me[1]=Re,me[2]=Ae,me[3]=Fe};let R=new um(w);const O=[];for(let G=0;G<w*w;G++){P(G%w,Math.floor(G/w),I,!1,O);const Z=ac(O[0],O[1],m),Q=ac(O[2],O[1],m),ce=ac(O[2],O[3],m),me=ac(O[0],O[3],m);R.minimums.push(Math.min(Z,Q,ce,me)),R.maximums.push(Math.max(Z,Q,ce,me)),R.leaves.push(1)}for(x.push(R),w/=2;w>=1;w/=2){const G=x[x.length-1];R=new um(w);for(let Z=0;Z<w*w;Z++){P(Z%w,Math.floor(Z/w),2,!0,O);const Q=G.getElevation(O[0],O[1]),ce=G.getElevation(O[2],O[1]),me=G.getElevation(O[2],O[3]),xe=G.getElevation(O[0],O[3]),Ae=G.isLeaf(O[0],O[1]),Re=G.isLeaf(O[2],O[1]),Fe=G.isLeaf(O[2],O[3]),ze=G.isLeaf(O[0],O[3]),it=Math.min(Q.min,ce.min,me.min,xe.min),Qe=Math.max(Q.max,ce.max,me.max,xe.max),At=Ae&&Re&&Fe&&ze;R.maximums.push(Qe),R.minimums.push(it),R.leaves.push(Qe-it<=5&&At?1:0)}x.push(R)}return x}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(e,s,l,h,m,_,x=1){return hm([e,s,-100],[l,h,this.maximums[0]*x],m,_)}raycast(e,s,l,h,m,_,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,s,l,h,m,_,x);if(null==w)return null;const I=[],P=[],R=[],O=[],G=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:Z,t:Q,nodex:ce,nodey:me,depth:xe}=G.pop();if(this.leaves[Z]){Ef(ce,me,xe,e,s,l,h,R,O);const Re=1<<xe,Fe=(ce+0)/Re,ze=(ce+1)/Re,it=(me+0)/Re,Qe=(me+1)/Re,At=ac(Fe,it,this.dem)*x,mt=ac(ze,it,this.dem)*x,ot=ac(ze,Qe,this.dem)*x,vt=ac(Fe,Qe,this.dem)*x,xt=o_(R[0],R[1],At,O[0],R[1],mt,O[0],O[1],ot,m,_),lt=o_(O[0],O[1],ot,R[0],O[1],vt,R[0],R[1],At,m,_),Mt=Math.min(null!==xt?xt:Number.MAX_VALUE,null!==lt?lt:Number.MAX_VALUE);if(Mt!==Number.MAX_VALUE)return Mt;{const kt=fu([],m,_,Q);if(Au(At,mt,vt,ot,qc(kt[0],R[0],O[0]),qc(kt[1],R[1],O[1]))>=kt[2])return Q}continue}let Ae=0;for(let Re=0;Re<this._siblingOffset.length;Re++){Ef((ce<<1)+this._siblingOffset[Re][0],(me<<1)+this._siblingOffset[Re][1],xe+1,e,s,l,h,R,O),R[2]=-100,O[2]=this.maximums[this.childOffsets[Z]+Re]*x;const Fe=hm(R,O,m,_);if(null!=Fe){const ze=Fe;I[Re]=ze;let it=!1;for(let Qe=0;Qe<Ae&&!it;Qe++)ze>=I[P[Qe]]&&(P.splice(Qe,0,Re),it=!0);it||(P[Ae]=Re),Ae++}}for(let Re=0;Re<Ae;Re++){const Fe=P[Re];G.push({idx:this.childOffsets[Z]+Fe,t:I[Fe],nodex:(ce<<1)+this._siblingOffset[Fe][0],nodey:(me<<1)+this._siblingOffset[Fe][1],depth:xe+1})}}return null}_addNode(e,s,l){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,l,h,m){if(1===e[h].isLeaf(s,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,x=e[_];let w,I=0;for(let P=0;P<this._siblingOffset.length;P++){const R=2*s+this._siblingOffset[P][0],O=2*l+this._siblingOffset[P][1],G=x.getElevation(R,O),Z=x.isLeaf(R,O),Q=this._addNode(G.min,G.max,Z);Z&&(I|=1<<P),w||(w=Q)}for(let P=0;P<this._siblingOffset.length;P++)I&1<<P||this._construct(e,2*s+this._siblingOffset[P][0],2*l+this._siblingOffset[P][1],_,w+P)}}function Au(i,e,s,l,h,m){return Ln(Ln(i,s,m),Ln(e,l,m),h)}function ac(i,e,s){const l=s.dim,h=_t(i*l-.5,0,l-1),m=_t(e*l-.5,0,l-1),_=Math.floor(h),x=Math.floor(m),w=Math.min(_+1,l-1),I=Math.min(x+1,l-1);return Au(s.get(_,x),s.get(w,x),s.get(_,I),s.get(w,I),h-_,m-x)}const ed={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Ju{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,l,h=!1,m=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Nn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Su(this)}get(e,s,l=!1){const h=new Uint8Array(this.data.buffer);l&&(e=_t(e,-1,this.dim),s=_t(s,-1,this.dim));const m=4*this._idx(e,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[m],h[m+1],h[m+2])}static getUnpackVector(e){return ed[e]}get unpackVector(){return ed[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,l){return(256*e*256+256*s+l)/10-1e4}_unpackTerrarium(e,s,l){return 256*e+s+l/256-32768}static pack(e,s){const l=[0,0,0,0],h=Ju.getUnpackVector(s);let m=Math.floor((e+h[3])/h[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new Ps({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,m=s*this.dim+this.dim,_=l*this.dim,x=l*this.dim+this.dim;switch(s){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:_=x-1;break;case 1:x=_+1}const w=-s*this.dim,I=-l*this.dim;for(let P=_;P<x;P++)for(let R=h;R<m;R++)this.data[this._idx(R,P)]=e.data[this._idx(R+w,P+I)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ft("DEMData",Ju),Ft("DemMinMaxQuadTree",Su,{omit:["dem"]});class s_{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:s,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,h=void 0===s?0:this.data[l].indexOf(s),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class Zc{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}Zc.ReadOnly=!1,Zc.ReadWrite=!0,Zc.disabled=new Zc(519,Zc.ReadOnly,[0,1]);class eh{constructor(e,s,l,h,m,_){this.test=e,this.ref=s,this.mask=l,this.fail=h,this.depthFail=m,this.pass=_}}eh.disabled=new eh({func:519,mask:0},0,0,7680,7680,7680);class qa{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}qa.Replace=[1,0],qa.disabled=new qa(qa.Replace,qe.transparent,[!1,!1,!1,!1]),qa.unblended=new qa(qa.Replace,qe.transparent,[!0,!0,!0,!0]),qa.alphaBlended=new qa([1,771],qe.transparent,[!0,!0,!0,!0]);class No{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}No.disabled=new No(!1,1029,2305),No.backCCW=new No(!0,1029,2305),No.backCW=new No(!0,1029,2304),No.frontCW=new No(!0,1028,2304),No.frontCCW=new No(!0,1028,2305);class lc extends gt{constructor(e,s,l){super(),this.id=e,this._onlySymbols=l,s.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new s_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Jh}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Tr(this._tiles).map(e=>e.tileID).sort(dm).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&s.push(this._tiles[l]);return e?s.sort((l,h)=>{const m=l.tileID,_=h.tileID,x=new Ve(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new Ve(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(dm).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const l=this._tiles[e];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,e,s)))}_tileLoaded(e,s,l,h){if(h)return e.state="errored",void(404!==h.status?this._source.fire(new Ut(h,{tile:e})):this.update(this.transform));e.timeAdded=vi.now(),"expired"===l&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new je("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const m=s[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const _=this.getTileByID(m);l(e,_),l(_,e)}}function l(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const x=m.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),I=m.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,x),h.neighboringTiles&&h.neighboringTiles[I]&&(h.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const I=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[I.key],_&&_.hasData()&&(x=I)}let w=x;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){h[x.key]=x;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const h=e.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const l=Math.ceil(e.width/s)+1,h=Math.ceil(e.height/s)+1,m=Math.floor(l*h*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(e){const s=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,s,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(e,s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Jo(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const m=this._updateRetainedTiles(h);if(fm(this._source.type)&&0!==h.length){const x={},w={},I=Object.keys(m);for(const R of I){const O=m[R],G=this._tiles[R];if(!G||G.fadeEndTime&&G.fadeEndTime<=vi.now())continue;const Z=this.findLoadedParent(O,Math.max(O.overscaledZ-lc.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),x[Z.tileID.key]=Z.tileID),w[R]=O}const P=h[h.length-1].overscaledZ;for(const R in this._tiles){const O=this._tiles[R];if(m[R]||!O.hasData())continue;let G=O.tileID;for(;G.overscaledZ>P;){G=G.scaledTo(G.overscaledZ-1);const Z=this._tiles[G.key];if(Z&&Z.hasData()&&w[G.key]){m[R]=O.tileID;break}}}for(const R in x)m[R]||(this._coveredTiles[R]=!0,m[R]=x[R])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,w){const I=[];for(const P in x)P in w||I.push(P);return I}(this._tiles,m);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(0===e.length)return s;const l={},h=e.reduce((I,P)=>Math.min(I,P.overscaledZ),1/0),m=e[0].overscaledZ,_=Math.max(m-lc.maxOverzooming,this._source.minzoom),x=Math.max(m+lc.maxUnderzooming,this._source.minzoom),w={};for(const I of e){const P=this._addTile(I);s[I.key]=I,P.hasData()||h<this._source.maxzoom&&(w[I.key]=I)}this._retainLoadedChildren(w,h,x,s);for(const I of e){let P=this._tiles[I.key];if(P.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const O=I.children(this._source.maxzoom)[0],G=this.getTile(O);if(G&&G.hasData()){s[O.key]=O;continue}}else{const O=I.children(this._source.maxzoom);if(s[O[0].key]&&s[O[1].key]&&s[O[2].key]&&s[O[3].key])continue}let R=P.wasRequested();for(let O=I.overscaledZ-1;O>=_;--O){const G=I.scaledTo(O);if(l[G.key]||(l[G.key]=!0,P=this.getTile(G),!P&&R&&(P=this._addTile(G)),P&&(s[G.key]=G,R=P.wasRequested(),P.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of s)this._loadedParentTiles[m]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=Boolean(s);if(!l){const h=this.map?this.map.painter:null;s=new Ha(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,l||this._source.fire(new je("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,s,l){const h=[],m=this.transform;if(!m)return h;for(const _ in this._tiles){const x=this._tiles[_];if(l&&x.clearQueryDebugViz(),x.holdingForFade())continue;const w=e.containsTile(x,m,s);w&&h.push(w)}return h}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(fm(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=vi.now())return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const h=this._tiles[e];h&&h.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function dm(i,e){const s=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-s||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function fm(i){return"raster"===i||"image"===i||"video"===i}lc.maxOverzooming=10,lc.maxUnderzooming=3;class El{constructor(e,s,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(e,s,l){const h=l||e.findDEMTileFor(s);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,x=1<<s.canonical.z-_.canonical.z;return new El(h,h.tileSize/Hn/x,[(s.canonical.x/x-_.canonical.x)*m.dim,(s.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(e,s){const l=s*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(l);return new Ve(h,m)}getElevationAt(e,s,l,h){const m=e*this._scale+this._offset[0],_=s*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(_),I=this._dem;return h=!!h,l?Ln(Ln(I.get(x,w,h),I.get(x,w+1,h),_-w),Ln(I.get(x+1,w,h),I.get(x+1,w+1,h),_-w),m-x):I.get(x,w,h)}getElevationAtPixel(e,s,l){return this._dem.get(e,s,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Oc(1,e)*this._dem.stride}}class pm{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ts(Hn,16,0),this.featureIndexArray=new Ou,this.promoteId=s}insert(e,s,l,h,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m,_);const w=this.grid;for(let I=0;I<s.length;I++){const P=s[I],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<P.length;O++){const G=P[O];R[0]=Math.min(R[0],G.x),R[1]=Math.min(R[1],G.y),R[2]=Math.max(R[2],G.x),R[3]=Math.max(R[3],G.y)}R[0]<Hn&&R[1]<Hn&&R[2]>=0&&R[3]>=0&&w.insert(x,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vc.VectorTile(new Eu(this.rawTileData)).layers,this.sourceLayerCoder=new Kh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,l,h){this.loadVTLayers();const m=e.params||{},_=nl(m.filter),x=e.tileResult,w=e.transform,I=x.bufferedTilespaceBounds,P=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(Z,Q,ce,me)=>ci(x.bufferedTilespaceGeometry,Z,Q,ce,me));P.sort(a_);let R=null;w.elevation&&P.length>0&&(R=El.create(w.elevation,this.tileID));const O={};let G;for(let Z=0;Z<P.length;Z++){const Q=P[Z];if(Q===G)continue;G=Q;const ce=this.featureIndexArray.get(Q);let me=null;this.loadMatchingFeature(O,ce,_,m.layers,m.availableImages,s,l,h,(xe,Ae,Re,Fe=0)=>(me||(me=xa(xe,this.tileID.canonical,e.tileTransform)),Ae.queryIntersectsFeature(x,xe,Re,me,this.z,e.transform,e.pixelPosMatrix,R,Fe)))}return O}loadMatchingFeature(e,s,l,h,m,_,x,w,I){const{featureIndex:P,bucketIndex:R,sourceLayerIndex:O,layoutVertexArrayOffset:G}=s,Z=this.bucketLayerIDs[R];if(h&&!function(xe,Ae){for(let Re=0;Re<xe.length;Re++)if(Ae.indexOf(xe[Re])>=0)return!0;return!1}(h,Z))return;const Q=this.sourceLayerCoder.decode(O),ce=this.vtLayers[Q].feature(P);if(l.needGeometry){const xe=gl(ce,!0);if(!l.filter(new j(this.tileID.overscaledZ),xe,this.tileID.canonical))return}else if(!l.filter(new j(this.tileID.overscaledZ),ce))return;const me=this.getId(ce,Q);for(let xe=0;xe<Z.length;xe++){const Ae=Z[xe];if(h&&h.indexOf(Ae)<0)continue;const Re=_[Ae];if(!Re)continue;let Fe={};void 0!==me&&w&&(Fe=w.getState(Re.sourceLayer||"_geojsonTileLayer",me));const ze=Pr({},x[Ae]);ze.paint=mm(ze.paint,Re.paint,ce,Fe,m),ze.layout=mm(ze.layout,Re.layout,ce,Fe,m);const it=!I||I(ce,Re,Fe,G);if(!it)continue;const Qe=new xf(ce,this.z,this.x,this.y,me);Qe.layer=ze;let At=e[Ae];void 0===At&&(At=e[Ae]=[]),At.push({featureIndex:P,feature:Qe,intersectionZ:it})}}lookupSymbolFeatures(e,s,l,h,m,_,x,w){const I={};this.loadVTLayers();const P=nl(m);for(const R of e)this.loadMatchingFeature(I,{bucketIndex:l,sourceLayerIndex:h,featureIndex:R,layoutVertexArrayOffset:0},P,_,x,w,s);return I}loadFeature(e){const{featureIndex:s,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),m=this.vtFeatures[h];if(m[s])return m[s];const _=this.vtLayers[h].feature(s);return m[s]=_,_}hasLayer(e){for(const s of this.bucketLayerIDs)for(const l of s)if(e===l)return!0;return!1}getId(e,s){let l=e.id;return this.promoteId&&(l=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function mm(i,e,s,l,h){return Et(i,(m,_)=>{const x=e instanceof ge?e.get(_):null;return x&&x.evaluate?x.evaluate(s,l,h):x})}function a_(i,e){return e-i}Ft("FeatureIndex",pm,{omit:["rawTileData","sourceLayerCoder"]});class gm{constructor(e){const s={},l=[];for(const x in e){const w=e[x],I=s[x]={};for(const P in w.glyphs){const R=w.glyphs[+P];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const O=R.metrics.localGlyph?2:1,G={x:0,y:0,w:R.bitmap.width+2*O,h:R.bitmap.height+2*O};l.push(G),I[P]=G}}const{w:h,h:m}=Oh(l),_=new Ms({width:h||1,height:m||1});for(const x in e){const w=e[x];for(const I in w.glyphs){const P=w.glyphs[+I];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const R=s[x][I],O=P.metrics.localGlyph?2:1;Ms.copy(P.bitmap,_,{x:0,y:0},{x:R.x+O,y:R.y+O},P.bitmap)}}this.image=_,this.positions=s}}Ft("GlyphAtlas",gm);class Xy{constructor(e){this.tileID=new Jo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,e.projection&&(this.tileTransform=Xh(e.tileID.canonical,e.projection))}parse(e,s,l,h,m){this.status="parsing",this.data=e,this.collisionBoxArray=new Zo;const _=new Kh(Object.keys(e.layers).sort()),x=new pm(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},I=new Wh(256,256),P={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:I,availableImages:l},R=s.familiesBySource[this.source];for(const Fe in R){const ze=e.layers[Fe];if(!ze)continue;let it=!1,Qe=!1;for(const ot of R[Fe])"symbol"===ot[0].type?it=!0:Qe=!0;if(!0===this.isSymbolTile&&!it||!1===this.isSymbolTile&&!Qe)continue;1===ze.version&&Nn(`Vector tile source "${this.source}" layer "${Fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const At=_.encode(Fe),mt=[];for(let ot=0;ot<ze.length;ot++){const vt=ze.feature(ot),xt=x.getId(vt,Fe);mt.push({feature:vt,id:xt,index:ot,sourceLayerIndex:At})}for(const ot of R[Fe]){const vt=ot[0];void 0!==this.isSymbolTile&&"symbol"===vt.type!==this.isSymbolTile||vt.minzoom&&this.zoom<Math.floor(vt.minzoom)||vt.maxzoom&&this.zoom>=vt.maxzoom||"none"!==vt.visibility&&(Df(ot,this.zoom,l),(w[vt.id]=vt.createBucket({index:x.bucketLayerIDs.length,layers:ot,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:At,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(mt,P,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(ot.map(xt=>xt.id)))}}let O,G,Z,Q;I.trim();const ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},me=Et(P.glyphDependencies,Fe=>Object.keys(Fe).map(Number));Object.keys(me).length?h.send("getGlyphs",{uid:this.uid,stacks:me},(Fe,ze)=>{O||(O=Fe,G=ze,Re.call(this))},void 0,!1,ce):G={};const xe=Object.keys(P.iconDependencies);xe.length?h.send("getImages",{icons:xe,source:this.source,tileID:this.tileID,type:"icons"},(Fe,ze)=>{O||(O=Fe,Z=ze,Re.call(this))},void 0,!1,ce):Z={};const Ae=Object.keys(P.patternDependencies);function Re(){if(O)return m(O);if(G&&Z&&Q){const Fe=new gm(G),ze=new Zp(Z,Q);for(const it in w){const Qe=w[it];Qe instanceof bl?(Df(Qe.layers,this.zoom,l),qy(Qe,G,Fe.positions,Z,ze.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom)):Qe.hasPattern&&(Qe instanceof Mh||Qe instanceof Dh||Qe instanceof Ah)&&(Df(Qe.layers,this.zoom,l),Qe.addFeatures(P,this.tileID.canonical,ze.patternPositions,l))}this.status="done",m(null,{buckets:Tr(w).filter(it=>!it.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fe.image,lineAtlas:I,imageAtlas:ze,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?Z:null,glyphPositions:this.returnDependencies?Fe.positions:null})}}Ae.length?h.send("getImages",{icons:Ae,source:this.source,tileID:this.tileID,type:"patterns"},(Fe,ze)=>{O||(O=Fe,Q=ze,Re.call(this))},void 0,!1,ce):Q={},Re.call(this)}}function Df(i,e,s){const l=new j(e);for(const h of i)h.recalculate(l,s)}class If{constructor(e){this.entries={},this.scheduler=e}request(e,s,l,h){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},s):h(_,x),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=l((_,x)=>{m.result=[_,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,x)},s):w(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function ri(i,e,s){const l=JSON.stringify(i.request);return i.data&&(this.deduped.entries[l]={result:[null,i.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const m=q(i.request,(_,x,w,I)=>{_?h(_):x&&h(null,{vectorTile:s?void 0:new Vc.VectorTile(new Eu(x)),rawData:x,cacheControl:w,expires:I})});return()=>{m.cancel(),h()}},e)}var Sf={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&wp(this.parallels,this.constants.parallels))return;const i=Math.sin(ut(this.parallels[0])),e=(i+Math.sin(ut(this.parallels[1])))/2,s=1+i*(2*e-i),l=Math.sqrt(s)/e;this.constants={n:e,c:s,r0:l,parallels:this.parallels}},project(i,e){this.initializeConstants();const s=ut(i-this.center[0]),l=ut(e),{n:h,c:m,r0:_}=this.constants,x=Math.sqrt(m-2*h*Math.sin(l))/h;return{x:x*Math.sin(s*h),y:x*Math.cos(s*h)-_}},unproject(i,e){this.initializeConstants();const{n:s,c:l,r0:h}=this.constants,m=h+e;let _=Math.atan2(i,Math.abs(m))*Math.sign(m);m*s<0&&(_-=Math.PI*Math.sign(i)*Math.sign(m));const x=ut(this.center[0])*s;_=ii(_,-Math.PI-x,Math.PI-x);const w=St(_/s)+this.center[0],I=Math.asin(_t((l-(i*i+m*m)*s*s)/(2*s),-1,1)),P=_t(St(I),-85.051129,ml);return new gr(w,P)}};const nd=1.340264,ks=-.081106,Wc=893e-6,Xc=.003796,Af=Math.sqrt(3)/2;var l_={name:"equalEarth",center:[0,0],range:[3.5,7],project(i,e){e=e/180*Math.PI,i=i/180*Math.PI;const s=Math.asin(Af*Math.sin(e)),l=s*s,h=l*l*l;return{x:.5*(i*Math.cos(s)/(Af*(nd+3*ks*l+h*(7*Wc+9*Xc*l)))/Math.PI+.5),y:1-.5*(s*(nd+ks*l+h*(Wc+Xc*l))/Math.PI+1)}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=s*s,h=l*l*l;for(let I,P,R,O=0;O<12&&(P=s*(nd+ks*l+h*(Wc+Xc*l))-e,R=nd+3*ks*l+h*(7*Wc+9*Xc*l),I=P/R,s=_t(s-I,-Math.PI/3,Math.PI/3),l=s*s,h=l*l*l,!(Math.abs(I)<1e-12));++O);const m=Af*i*(nd+3*ks*l+h*(7*Wc+9*Xc*l))/Math.cos(s),_=Math.asin(Math.sin(s)/Af),x=_t(180*m/Math.PI,-180,180),w=_t(180*_/Math.PI,-85.051129,ml);return new gr(x,w)}},c_={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(i,e)=>({x:.5+i/360,y:.5-e/360}),unproject(i,e){const s=360*(i-.5),l=_t(360*(.5-e),-85.051129,ml);return new gr(s,l)}};const Yc=Math.PI/2;function th(i){return Math.tan((Yc+i)/2)}var _m={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&wp(this.parallels,this.constants.parallels))return;const i=ut(this.parallels[0]),e=ut(this.parallels[1]),s=Math.cos(i),l=i===e?Math.sin(i):Math.log(s/Math.cos(e))/Math.log(th(e)/th(i)),h=s*Math.pow(th(i),l)/l;this.constants={n:l,f:h,parallels:this.parallels}},project(i,e){this.initializeConstants(),e=ut(e),i=ut(i-this.center[0]);const s=1e-6,{n:l,f:h}=this.constants;h>0?e<-Yc+s&&(e=-Yc+s):e>Yc-s&&(e=Yc-s);const m=h/Math.pow(th(e),l),_=m*Math.sin(l*i),x=h-m*Math.cos(l*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5)}},unproject(i,e){this.initializeConstants(),i=(2*i-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:s,f:l}=this.constants,h=l-e,m=Math.sign(h),_=Math.sign(s)*Math.sqrt(i*i+h*h);let x=Math.atan2(i,Math.abs(h))*m;h*s<0&&(x-=Math.PI*Math.sign(i)*m);const w=_t(St(x/s)+this.center[0],-180,180),I=_t(St(2*Math.atan(Math.pow(l/_,1/s))-Yc),-85.051129,ml);return new gr(w,I)}},ym={name:"mercator",wrap:!0,center:[0,0],project:(i,e)=>({x:cp(i),y:Id(e)}),unproject(i,e){const s=tc(i),l=qi(e);return new gr(s,l)}};const vm=ut(ml);var u_={name:"naturalEarth",center:[0,0],range:[3.5,7],project(i,e){const s=(e=ut(e))*e,l=s*s;return{x:.5*((i=ut(i))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1)}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=25,h=0,m=s*s;do{m=s*s;const w=m*m;h=(s*(1.007226+m*(.015085+w*(.028874*m-.044475-.005916*w)))-e)/(1.007226+m*(.045255+w*(.259866*m-.311325-.005916*11*w))),s=_t(s-h,-vm,vm)}while(Math.abs(h)>1e-6&&--l>0);m=s*s;const _=_t(St(i/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=St(s);return new gr(_,x)}};const Mu=ut(ml),rd={albers:Sf,equalEarth:l_,equirectangular:c_,lambertConformalConic:_m,mercator:ym,naturalEarth:u_,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(i,e){e=ut(e),i=ut(i);const s=Math.cos(e),l=2/Math.PI,h=Math.acos(s*Math.cos(i/2)),m=Math.sin(h)/h,_=.5*(i*l+2*s*Math.sin(i/2)/m)||0,x=.5*(e+Math.sin(e)/m)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1)}},unproject(i,e){let s=i=(2*i-.5)*Math.PI,l=e=(2*(1-e)-1)*Math.PI,h=25;const m=1e-6;let _=0,x=0;do{const w=Math.cos(l),I=Math.sin(l),P=2*I*w,R=I*I,O=w*w,G=Math.cos(s/2),Z=Math.sin(s/2),Q=2*G*Z,ce=Z*Z,me=1-O*G*G,xe=me?1/me:0,Ae=me?Math.acos(w*G)*Math.sqrt(1/me):0,Re=.5*(2*Ae*w*Z+2*s/Math.PI)-i,Fe=.5*(Ae*I+l)-e,ze=.5*xe*(O*ce+Ae*w*G*R)+1/Math.PI,it=xe*(Q*P/4-Ae*I*Z),Qe=.125*xe*(P*Z-Ae*I*O*Q),At=.5*xe*(R*G+Ae*ce*w)+.5,mt=it*Qe-At*ze;_=(Fe*it-Re*At)/mt,x=(Re*Qe-Fe*ze)/mt,s=_t(s-_,-Math.PI,Math.PI),l=_t(l-x,-Mu,Mu)}while((Math.abs(_)>m||Math.abs(x)>m)&&--h>0);return new gr(St(s),St(l))}}};d.ARRAY_TYPE=zo,d.AUTH_ERR_MSG=Eo,d.Actor=class{constructor(i,e,s){this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},cn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Bi()?i:Se,this.scheduler=new vf}send(i,e,s,l,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[_]=s);const x=Ur(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!s,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:_a(e,x)},x),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const e=i.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(e.mustQueue||Bi()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),l&&l.metadata||{type:"message"})}else this.processTask(s,e)}processTask(i,e){if("<response>"===e.type){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(Ds(e.error)):s(null,Ds(e.data)))}else{const s=Ur(this.globalScope)?void 0:[],l=e.hasCallback?(m,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:m?_a(m):null,data:_a(_,s)},s)}:m=>{},h=Ds(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,l);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],h.source)[m[1]](h,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=Iu,d.Color=qe,d.ColorMode=qa,d.CullFaceMode=No,d.DEMData=Ju,d.DataConstantProperty=se,d.DedupedRequest=If,d.DepthMode=Zc,d.EXTENT=Hn,d.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,s=!0){null==e&&(e=null);const l=this._source();if(!l||i.y<0||i.y>1)return e;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(i.x),x=i.x-_,w=new Jo(h,_,h,Math.floor(x*m),Math.floor(i.y*m)),I=this.findDEMTileFor(w);if(!I||!I.dem)return e;const P=I.dem,R=1<<I.tileID.canonical.z,O=(x*R-I.tileID.canonical.x)*P.dim,G=(i.y*R-I.tileID.canonical.y)*P.dim,Z=Math.floor(O),Q=Math.floor(G);return(s?this.exaggeration():1)*Ln(Ln(P.get(Z,Q),P.get(Z,Q+1),G-Q),Ln(P.get(Z+1,Q),P.get(Z+1,Q+1),G-Q),O-Z)}getAtTileOffset(i,e,s){const l=1<<i.canonical.z;return this.getAtPointOrZero(new Nu(i.wrap+(i.canonical.x+e/Hn)/l,(i.canonical.y+s/Hn)/l))}getForTilePoints(i,e,s,l){const h=El.create(this,i,l);return!!h&&(e.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const s=e.dem.tree,l=e.tileID,h=1<<i.canonical.z-l.canonical.z;let m=i.canonical.x/h-l.canonical.x,_=i.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<i.canonical.z-l.canonical.z&&!s.leaves[x];w++){m*=2,_*=2;const I=2*Math.floor(_)+Math.floor(m);x=s.childOffsets[x]+I,m%=1,_%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Ut,d.EvaluationParameters=j,d.Event=je,d.Evented=gt,d.GlyphManager=$a,d.ImagePosition=zh,d.LineAtlas=Wh,d.LngLat=gr,d.LngLatBounds=ec,d.LocalGlyphMode=uf,d.MAX_MERCATOR_LATITUDE=ml,d.MAX_SAFE_INTEGER=We,d.MercatorCoordinate=Nu,d.ONE_EM=24,d.OverscaledTileID=Jo,d.Properties=nt,d.RGBAImage=Ps,d.RequestManager=class{constructor(i,e,s){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",co,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!ai(i))return i;const s=Yr(i);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!ai(i))return i;const s=Yr(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!ai(i))return i;const s=Yr(i);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(i,e,s,l){const h=Yr(i);return ai(i)?(h.path=`/styles/v1${h.path}/sprite${e}${s}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${e}${s}`,$t(h))}normalizeTileURL(i,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!ai(i))return i;const l=Yr(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&"raster"!==l.authority&&512===s?"@2x":""}${mr.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${gn.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${gn.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||gn.ACCESS_TOKEN;return gn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(i,e){const s=Yr(i);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${gn.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${gn.TILE_URL_VERSION}/`,"")}`;let h=s.params;return e&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(i,e){const s=!!e&&ai(e),l=[];for(const h of i.tiles||[])Wi(h)?l.push(this.canonicalizeTileURL(h,s)):l.push(h);return l}_makeAPIURL(i,e){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=Yr(gn.API_URL);if(i.protocol=l.protocol,i.authority=l.authority,"http"===i.protocol){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if("/"!==l.path&&(i.path=`${l.path}${i.path}`),!gn.REQUIRE_ACCESS_TOKEN)return $t(i);if(e=e||gn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(h=>-1===h.indexOf("access_token")),i.params.push(`access_token=${e||""}`),$t(i)}},d.ResourceType=fi,d.SegmentVector=Hi,d.SourceCache=lc,d.StencilMode=eh,d.StructArrayLayout1ui2=li,d.StructArrayLayout2f1f2i16=_o,d.StructArrayLayout2i4=Lt,d.StructArrayLayout2ui4=lr,d.StructArrayLayout3f12=rn,d.StructArrayLayout3ui6=$r,d.StructArrayLayout4i8=Jt,d.Texture=yf,d.Tile=Ha,d.Transitionable=oe,d.Uniform1f=Mc,d.Uniform1i=class extends dl{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends dl{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},d.Uniform3f=class extends dl{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},d.Uniform4f=ph,d.UniformColor=Pc,d.UniformMatrix2f=class extends dl{constructor(i,e){super(i,e),this.current=Oy}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},d.UniformMatrix3f=class extends dl{constructor(i,e){super(i,e),this.current=og}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},d.UniformMatrix4f=class extends dl{constructor(i,e){super(i,e),this.current=ig}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},d.UnwrappedTileID=Yh,d.ValidationError=Ye,d.VectorTileWorkerSource=class extends gt{constructor(i,e,s,l,h){super(),this.actor=i,this.layerIndex=e,this.availableImages=s,this.loadVectorData=h||ri,this.loading={},this.loaded={},this.deduped=new If(i.scheduler),this.isSpriteLoaded=l,this.scheduler=i.scheduler}loadTile(i,e){const s=i.uid,l=i&&i.request,h=l&&l.collectResourceTiming,m=this.loading[s]=new Xy(i);m.abort=this.loadVectorData(i,(_,x)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!x)return m.status="done",w||(this.loaded[s]=m),e(_);const I=x.rawData,P={};x.expires&&(P.expires=x.expires),x.cacheControl&&(P.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new Vc.VectorTile(new Eu(I));const R=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(O,G)=>{if(O||!G)return e(O);const Z={};if(h){const Q=lm(l);Q.length>0&&(Z.resourceTiming=JSON.parse(JSON.stringify(Q)))}e(null,Pr({rawTileData:I.slice(0)},G,P,Z))})};this.isSpriteLoaded?R():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(R,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):R()}),this.loaded=this.loaded||{},this.loaded[s]=m})}reloadTile(i,e){const s=this.loaded,l=i.uid,h=this;if(s&&s[l]){const m=s[l];m.showCollisionBoxes=i.showCollisionBoxes,m.enableTerrain=!!i.enableTerrain;const _=(x,w)=>{const I=m.reloadCallback;I&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,I)),e(x,w)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){const s=i.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),e()}removeTile(i,e){const s=this.loaded,l=i.uid;s&&s[l]&&delete s[l],e()}},d.WritingMode=Ko,d.ZoomHistory=al,d.add=function(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i[2]=e[2]+s[2],i},d.addDynamicAttributes=Gh,d.altitudeFromMercatorZ=zc,d.asyncAll=Ai,d.bezier=Vn,d.bindAll=cn,d.boundsAttributes=Qh,d.bufferConvexPolygon=function(i,e){const s=[];for(let l=0;l<i.length;l++){const h=ii(l-1,-1,i.length-1),m=ii(l+1,-1,i.length-1),_=i[l],x=i[m],w=i[h].sub(_).unit(),I=x.sub(_).unit(),P=I.angleWithSep(w.x,w.y),R=w.add(I).unit().mult(-1*e/Math.sin(P/2));s.push(_.add(R))}return s},d.cacheEntryPossiblyAdded=function(i){Co++,Co>Vi&&(i.getActor().send("enforceCacheSizeLimit",Bs),Co=0)},d.clamp=_t,d.clearTileCache=function(i){const e=Se.caches.delete(yn);i&&e.catch(i).then(()=>i())},d.clipLine=Uh,d.clone=function(i){var e=new zo(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},d.clone$1=function(i){var e=new zo(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},d.clone$2=sr,d.collisionCircleLayout=ba,d.config=gn,d.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},d.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},d.create=io,d.create$1=function(){var i=new zo(16);return zo!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.create$2=mp,d.createExpression=ka,d.createLayout=He,d.createStyleLayer=function(i){return"custom"===i.type?new e_(i):new om[i.type](i)},d.cross=function(i,e,s){var l=e[0],h=e[1],m=e[2],_=s[0],x=s[1],w=s[2];return i[0]=h*w-m*x,i[1]=m*_-l*w,i[2]=l*x-h*_,i},d.degToRad=ut,d.div=function(i,e,s){return i[0]=e[0]/s[0],i[1]=e[1]/s[1],i[2]=e[2]/s[2],i},d.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},d.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},d.ease=nn,d.easeCubicInOut=dn,d.emitValidationErrors=Di,d.endsWith=zn,d.enforceCacheSizeLimit=function(i){Dn(),Ri&&Ri.then(e=>{e.keys().then(s=>{for(let l=0;l<s.length-i;l++)e.delete(s[l])})})},d.evaluateSizeForFeature=Rh,d.evaluateSizeForZoom=wu,d.evaluateVariableOffset=ff,d.evented=A,d.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},d.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},d.exported=vi,d.exported$1=mr,d.extend=Pr,d.filterObject=Zr,d.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},d.fromQuat=function(i,e){var s=e[0],l=e[1],h=e[2],m=e[3],_=s+s,x=l+l,w=h+h,I=s*_,P=l*_,R=l*x,O=h*_,G=h*x,Z=h*w,Q=m*_,ce=m*x,me=m*w;return i[0]=1-R-Z,i[1]=P+me,i[2]=O-ce,i[3]=0,i[4]=P-me,i[5]=1-I-Z,i[6]=G+Q,i[7]=0,i[8]=O+ce,i[9]=G-Q,i[10]=1-I-R,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.fromRotation=function(i,e){var s=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=s,i[2]=0,i[3]=-s,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},d.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ct[e]},d.getAABBPointSquareDist=function(i,e,s){let l=0;for(let h=0;h<2;++h){const m=s?s[h]:0;i[h]>m&&(l+=(i[h]-m)*(i[h]-m)),e[h]<m&&(l+=(m-e[h])*(m-e[h]))}return l},d.getAnchorAlignment=Ua,d.getAnchorJustification=jh,d.getBounds=function(i){let e=1/0,s=1/0,l=-1/0,h=-1/0;for(const m of i)e=Math.min(e,m.x),s=Math.min(s,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return{min:new Ve(e,s),max:new Ve(l,h)}},d.getImage=Be,d.getJSON=function(i,e){return $(Pr(i,{type:"json"}),e)},d.getMapSessionAPI=Pi,d.getPerformanceMeasurement=lm,d.getProjection=function(i){const e=rd[i.name];if(!e)throw new Error(`Invalid projection name: ${i.name}`);return e.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let h=function(m){const _=Math.max(.01,Math.cos(ut(m))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,project(w,I){const P=ut(w)*_,R=Math.sin(ut(I))/_;return{x:P*x+.5,y:-R*x+.5}},unproject(w,I){const P=-(I-.5)/x,R=_t(St((w-.5)/x)/_,-180,180),O=Math.asin(_t(P*_,-1,1)),G=_t(St(O),-85.051129,ml);return new gr(R,G)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:m,unproject:_}=rd.mercator;h={wrap:!0,project:m,unproject:_}}return Pr({},s,l,h)}return Pr({},s,l)}(e,i):e},d.getRTLTextPluginStatus=k,d.getReferrer=ie,d.getTilePoint=function(i,{x:e,y:s},l=0){return new Ve(((e-l)*i.scale-i.x)*Hn,(s*i.scale-i.y)*Hn)},d.getTileVec3=function(i,e,s=0){return Nc(((e.x-s)*i.scale-i.x)*Hn,(e.y*i.scale-i.y)*Hn,zc(e.z,e.y))},d.getVideo=function(i,e){const s=Se.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let l=0;l<i.length;l++){const h=Se.document.createElement("source");be(i[l])||(s.crossOrigin="Anonymous"),h.src=i[l],s.appendChild(h)}return{cancel:()=>{}}},d.identity=gp,d.identity$1=xp,d.invert=function(i,e){var s=e[0],l=e[1],h=e[2],m=e[3],_=e[4],x=e[5],w=e[6],I=e[7],P=e[8],R=e[9],O=e[10],G=e[11],Z=e[12],Q=e[13],ce=e[14],me=e[15],xe=s*x-l*_,Ae=s*w-h*_,Re=s*I-m*_,Fe=l*w-h*x,ze=l*I-m*x,it=h*I-m*w,Qe=P*Q-R*Z,At=P*ce-O*Z,mt=P*me-G*Z,ot=R*ce-O*Q,vt=R*me-G*Q,xt=O*me-G*ce,lt=xe*xt-Ae*vt+Re*ot+Fe*mt-ze*At+it*Qe;return lt?(i[0]=(x*xt-w*vt+I*ot)*(lt=1/lt),i[1]=(h*vt-l*xt-m*ot)*lt,i[2]=(Q*it-ce*ze+me*Fe)*lt,i[3]=(O*ze-R*it-G*Fe)*lt,i[4]=(w*mt-_*xt-I*At)*lt,i[5]=(s*xt-h*mt+m*At)*lt,i[6]=(ce*Re-Z*it-me*Ae)*lt,i[7]=(P*it-O*Re+G*Ae)*lt,i[8]=(_*vt-x*mt+I*Qe)*lt,i[9]=(l*mt-s*vt-m*Qe)*lt,i[10]=(Z*ze-Q*Re+me*xe)*lt,i[11]=(R*Re-P*ze-G*xe)*lt,i[12]=(x*At-_*ot-w*Qe)*lt,i[13]=(s*ot-l*At+h*Qe)*lt,i[14]=(Q*Ae-Z*Fe-ce*xe)*lt,i[15]=(P*Fe-R*Ae+O*xe)*lt,i):null},d.isMapAuthenticated=function(i){return $o.has(i)},d.isMapboxURL=ai,d.latFromMercatorY=qi,d.len=vp,d.length=_h,d.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},d.loadVectorTile=ri,d.makeRequest=$,d.mercatorXfromLng=cp,d.mercatorYfromLat=Id,d.mercatorZfromAltitude=Oc,d.mul=function(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i[3]=e[3]*s[3],i},d.mul$1=Bu,d.mul$2=yg,d.multiply=_g,d.multiply$1=yo,d.nextPowerOfTwo=or,d.normalize=yh,d.normalize$1=function(i,e){var s=e[0],l=e[1],h=e[2],m=e[3],_=s*s+l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),i[0]=s*_,i[1]=l*_,i[2]=h*_,i[3]=m*_,i},d.number=Ln,d.ortho=function(i,e,s,l,h,m,_){var x=1/(e-s),w=1/(l-h),I=1/(m-_);return i[0]=-2*x,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+s)*x,i[13]=(h+l)*w,i[14]=(_+m)*I,i[15]=1,i},d.pbf=Eu,d.perspective=function(i,e,s,l,h){var m,_=1/Math.tan(e/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=h&&h!==1/0?(i[10]=(h+l)*(m=1/(l-h)),i[14]=2*h*l*m):(i[10]=-1,i[14]=-2*l),i},d.pick=function(i,e){const s={};for(let l=0;l<e.length;l++){const h=e[l];h in i&&(s[h]=i[h])}return s},d.plugin=V,d.pointGeometry=Ve,d.polygonIntersectsBox=ci,d.polygonIntersectsPolygon=Md,d.polygonizeBounds=function(i,e,s=0,l=!0){const h=new Ve(s,s),m=i.sub(h),_=e.add(h),x=[m,new Ve(_.x,m.y),_,new Ve(m.x,_.y)];return l&&x.push(m),x},d.posAttributes=i_,d.postMapLoadEvent=Kr,d.postTurnstileEvent=Mi,d.potpack=Oh,d.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},d.radToDeg=St,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(i){return i({pluginStatus:p,pluginURL:y}),A.on("pluginStateChange",i),i},d.removeAuthState=function(i){$o.delete(i)},d.renderColorRamp=Vd,d.rotateX=function(i,e,s){var l=Math.sin(s),h=Math.cos(s),m=e[4],_=e[5],x=e[6],w=e[7],I=e[8],P=e[9],R=e[10],O=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*h+I*l,i[5]=_*h+P*l,i[6]=x*h+R*l,i[7]=w*h+O*l,i[8]=I*h-m*l,i[9]=P*h-_*l,i[10]=R*h-x*l,i[11]=O*h-w*l,i},d.rotateX$1=bp,d.rotateY=function(i,e,s){var l=Math.sin(s),h=Math.cos(s),m=e[0],_=e[1],x=e[2],w=e[3],I=e[8],P=e[9],R=e[10],O=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h-I*l,i[1]=_*h-P*l,i[2]=x*h-R*l,i[3]=w*h-O*l,i[8]=m*l+I*h,i[9]=_*l+P*h,i[10]=x*l+R*h,i[11]=w*l+O*h,i},d.rotateZ=function(i,e,s){var l=Math.sin(s),h=Math.cos(s),m=e[0],_=e[1],x=e[2],w=e[3],I=e[4],P=e[5],R=e[6],O=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h+I*l,i[1]=_*h+P*l,i[2]=x*h+R*l,i[3]=w*h+O*l,i[4]=I*h-m*l,i[5]=P*h-_*l,i[6]=R*h-x*l,i[7]=O*h-w*l,i},d.rotateZ$1=function(i,e,s){s*=.5;var l=e[0],h=e[1],m=e[2],_=e[3],x=Math.sin(s),w=Math.cos(s);return i[0]=l*w+h*x,i[1]=h*w-l*x,i[2]=m*w+_*x,i[3]=_*w-m*x,i},d.scale=function(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i},d.scale$1=function(i,e,s){var l=s[0],h=s[1],m=s[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},d.scale$2=function(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i},d.scaleAndAdd=fu,d.setCacheLimits=function(i,e){Bs=i,Vi=e},d.setRTLTextPlugin=function(i,e,s=!1){if(p===ar||p===f||p===r)throw new Error("setRTLTextPlugin cannot be called multiple times.");y=vi.resolveURL(i),p=ar,c=e,D(),s||z()},d.smoothstep=function(i,e,s){return(s=_t((s-i)/(e-i),0,1))*s*(3-2*s)},d.spec=Pe,d.storeAuthState=function(i,e){e?$o.add(i):$o.delete(i)},d.sub=yp,d.subtract=Fd,d.symbolSize=zg,d.tileTransform=Xh,d.transformMat3=function(i,e,s){var l=e[0],h=e[1],m=e[2];return i[0]=l*s[0]+h*s[3]+m*s[6],i[1]=l*s[1]+h*s[4]+m*s[7],i[2]=l*s[2]+h*s[5]+m*s[8],i},d.transformMat4=Uu,d.transformMat4$1=function(i,e,s){var l=e[0],h=e[1],m=e[2],_=s[3]*l+s[7]*h+s[11]*m+s[15];return i[0]=(s[0]*l+s[4]*h+s[8]*m+s[12])/(_=_||1),i[1]=(s[1]*l+s[5]*h+s[9]*m+s[13])/_,i[2]=(s[2]*l+s[6]*h+s[10]*m+s[14])/_,i},d.transformQuat=_p,d.translate=function(i,e,s){var l,h,m,_,x,w,I,P,R,O,G,Z,Q=s[0],ce=s[1],me=s[2];return e===i?(i[12]=e[0]*Q+e[4]*ce+e[8]*me+e[12],i[13]=e[1]*Q+e[5]*ce+e[9]*me+e[13],i[14]=e[2]*Q+e[6]*ce+e[10]*me+e[14],i[15]=e[3]*Q+e[7]*ce+e[11]*me+e[15]):(h=e[1],m=e[2],_=e[3],x=e[4],w=e[5],I=e[6],P=e[7],R=e[8],O=e[9],G=e[10],Z=e[11],i[0]=l=e[0],i[1]=h,i[2]=m,i[3]=_,i[4]=x,i[5]=w,i[6]=I,i[7]=P,i[8]=R,i[9]=O,i[10]=G,i[11]=Z,i[12]=l*Q+x*ce+R*me+e[12],i[13]=h*Q+w*ce+O*me+e[13],i[14]=m*Q+I*ce+G*me+e[14],i[15]=_*Q+P*ce+Z*me+e[15]),i},d.triggerPluginCompletionEvent=v,d.uniqueId=jt,d.validateCustomStyleLayer=function(i){const e=[],s=i.id;return void 0===s&&e.push({message:`layers.${s}: missing required property "id"`}),void 0===i.render&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},d.validateFog=Cs,d.validateLight=iu,d.validateStyle=Ws,d.values=Tr,d.vectorTile=Vc,d.version="2.6.1",d.warnOnce=Nn,d.window=Se,d.wrap=ii}),te(0,function(d){function Zt(ie){const $=typeof ie;if("number"===$||"boolean"===$||"string"===$||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let he="[";for(const be of ie)he+=`${Zt(be)},`;return`${he}]`}const q=Object.keys(ie).sort();let ae="{";for(let he=0;he<q.length;he++)ae+=`${JSON.stringify(q[he])}:${Zt(ie[q[he]])},`;return`${ae}}`}function ht(ie){let $="";for(const q of d.refProperties)$+=`/${Zt(ie[q])}`;return $}class Ot{constructor($){this.keyCache={},$&&this.replace($)}replace($){this._layerConfigs={},this._layers={},this.update($,[])}update($,q){for(const he of $)this._layerConfigs[he.id]=he,(this._layers[he.id]=d.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of q)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const ae=function(he,be){const Le={};for(let Ee=0;Ee<he.length;Ee++){const Be=be&&be[he[Ee].id]||ht(he[Ee]);be&&(be[he[Ee].id]=Be);let tt=Le[Be];tt||(tt=Le[Be]=[]),tt.push(he[Ee])}const Oe=[];for(const Ee in Le)Oe.push(Le[Ee]);return Oe}(d.values(this._layerConfigs),this.keyCache);for(const he of ae){const be=he.map(yt=>this._layers[yt.id]),Le=be[0];if("none"===Le.visibility)continue;const Oe=Le.source||"";let Ee=this.familiesBySource[Oe];Ee||(Ee=this.familiesBySource[Oe]={});const Be=Le.sourceLayer||"_geojsonTileLayer";let tt=Ee[Be];tt||(tt=Ee[Be]=[]),tt.push(be)}}}const{ImageBitmap:Ve}=d.window;class Me{loadTile($,q){const{uid:ae,encoding:he,rawImageData:be,padding:Le,buildQuadTree:Oe}=$,Ee=Ve&&be instanceof Ve?this.getImageData(be,Le):be;q(null,new d.DEMData(ae,Ee,he,Le<1,Oe))}getImageData($,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);const ae=this.offscreenCanvasContext.getImageData(-q,-q,$.width+2*q,$.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:ae.width,height:ae.height},ae.data)}}var Se=function ie($,q){var ae,he=$&&$.type;if("FeatureCollection"===he)for(ae=0;ae<$.features.length;ae++)ie($.features[ae],q);else if("GeometryCollection"===he)for(ae=0;ae<$.geometries.length;ae++)ie($.geometries[ae],q);else if("Feature"===he)ie($.geometry,q);else if("Polygon"===he)We($.coordinates,q);else if("MultiPolygon"===he)for(ae=0;ae<$.coordinates.length;ae++)We($.coordinates[ae],q);return $};function We(ie,$){if(0!==ie.length){st(ie[0],$);for(var q=1;q<ie.length;q++)st(ie[q],!$)}}function st(ie,$){for(var q=0,ae=0,he=0,be=ie.length,Le=be-1;he<be;Le=he++){var Oe=(ie[he][0]-ie[Le][0])*(ie[Le][1]+ie[he][1]),Ee=q+Oe;ae+=Math.abs(q)>=Math.abs(Oe)?q-Ee+Oe:Oe-Ee+q,q=Ee}q+ae>=0!=!!$&&ie.reverse()}const bt=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ut{constructor($){this._feature=$,this.extent=d.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))}loadGeometry(){if(1===this._feature.type){const $=[];for(const q of this._feature.geometry)$.push([new d.pointGeometry(q[0],q[1])]);return $}{const $=[];for(const q of this._feature.geometry){const ae=[];for(const he of q)ae.push(new d.pointGeometry(he[0],he[1]));$.push(ae)}return $}}toGeoJSON($,q,ae){return bt.call(this,$,q,ae)}}class St{constructor($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=$.length,this._features=$}feature($){return new ut(this._features[$])}}var ct=d.vectorTile.VectorTileFeature,dn=Vn;function Vn(ie,$){this.options=$||{},this.features=ie,this.length=ie.length}function nn(ie,$){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=$||4096}Vn.prototype.feature=function(ie){return new nn(this.features[ie],this.options.extent)},nn.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var $=0;$<ie.length;$++){for(var q=ie[$],ae=[],he=0;he<q.length;he++)ae.push(new d.pointGeometry(q[he][0],q[he][1]));this.geometry.push(ae)}return this.geometry},nn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,$=1/0,q=-1/0,ae=1/0,he=-1/0,be=0;be<ie.length;be++)for(var Le=ie[be],Oe=0;Oe<Le.length;Oe++){var Ee=Le[Oe];$=Math.min($,Ee.x),q=Math.max(q,Ee.x),ae=Math.min(ae,Ee.y),he=Math.max(he,Ee.y)}return[$,ae,q,he]},nn.prototype.toGeoJSON=ct.prototype.toGeoJSON;var _t=Ai,ii=dn;function Ai(ie){var $=new d.pbf;return function(q,ae){for(var he in q.layers)ae.writeMessage(3,Tr,q.layers[he])}(ie,$),$.finish()}function Tr(ie,$){var q;$.writeVarintField(15,ie.version||1),$.writeStringField(1,ie.name||""),$.writeVarintField(5,ie.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<ie.length;q++)ae.feature=ie.feature(q),$.writeMessage(2,Pr,ae);var he=ae.keys;for(q=0;q<he.length;q++)$.writeStringField(3,he[q]);var be=ae.values;for(q=0;q<be.length;q++)$.writeMessage(4,Xn,be[q])}function Pr(ie,$){var q=ie.feature;void 0!==q.id&&$.writeVarintField(1,q.id),$.writeMessage(2,bo,ie),$.writeVarintField(3,q.type),$.writeMessage(4,or,q)}function bo(ie,$){var q=ie.feature,ae=ie.keys,he=ie.values,be=ie.keycache,Le=ie.valuecache;for(var Oe in q.properties){var Ee=q.properties[Oe],Be=be[Oe];if(null!==Ee){void 0===Be&&(ae.push(Oe),be[Oe]=Be=ae.length-1),$.writeVarint(Be);var tt=typeof Ee;"string"!==tt&&"boolean"!==tt&&"number"!==tt&&(Ee=JSON.stringify(Ee));var yt=tt+":"+Ee,je=Le[yt];void 0===je&&(he.push(Ee),Le[yt]=je=he.length-1),$.writeVarint(je)}}}function jt(ie,$){return($<<3)+(7&ie)}function Mn(ie){return ie<<1^ie>>31}function or(ie,$){for(var q=ie.loadGeometry(),ae=ie.type,he=0,be=0,Le=q.length,Oe=0;Oe<Le;Oe++){var Ee=q[Oe],Be=1;1===ae&&(Be=Ee.length),$.writeVarint(jt(1,Be));for(var tt=3===ae?Ee.length-1:Ee.length,yt=0;yt<tt;yt++){1===yt&&1!==ae&&$.writeVarint(jt(2,tt-1));var je=Ee[yt].x-he,Ut=Ee[yt].y-be;$.writeVarint(Mn(je)),$.writeVarint(Mn(Ut)),he+=je,be+=Ut}3===ae&&$.writeVarint(jt(7,1))}}function Xn(ie,$){var q=typeof ie;"string"===q?$.writeStringField(1,ie):"boolean"===q?$.writeBooleanField(7,ie):"number"===q&&(ie%1!=0?$.writeDoubleField(3,ie):ie<0?$.writeSVarintField(6,ie):$.writeVarintField(5,ie))}function cn(ie,$,q,ae,he,be){if(he-ae<=q)return;const Le=ae+he>>1;zn(ie,$,Le,ae,he,be%2),cn(ie,$,q,ae,Le-1,be+1),cn(ie,$,q,Le+1,he,be+1)}function zn(ie,$,q,ae,he,be){for(;he>ae;){if(he-ae>600){const Be=he-ae+1,tt=q-ae+1,yt=Math.log(Be),je=.5*Math.exp(2*yt/3),Ut=.5*Math.sqrt(yt*je*(Be-je)/Be)*(tt-Be/2<0?-1:1);zn(ie,$,q,Math.max(ae,Math.floor(q-tt*je/Be+Ut)),Math.min(he,Math.floor(q+(Be-tt)*je/Be+Ut)),be)}const Le=$[2*q+be];let Oe=ae,Ee=he;for(Et(ie,$,ae,q),$[2*he+be]>Le&&Et(ie,$,ae,he);Oe<Ee;){for(Et(ie,$,Oe,Ee),Oe++,Ee--;$[2*Oe+be]<Le;)Oe++;for(;$[2*Ee+be]>Le;)Ee--}$[2*ae+be]===Le?Et(ie,$,ae,Ee):(Ee++,Et(ie,$,Ee,he)),Ee<=q&&(ae=Ee+1),q<=Ee&&(he=Ee-1)}}function Et(ie,$,q,ae){Zr(ie,q,ae),Zr($,2*q,2*ae),Zr($,2*q+1,2*ae+1)}function Zr(ie,$,q){const ae=ie[$];ie[$]=ie[q],ie[q]=ae}function sr(ie,$,q,ae){const he=ie-q,be=$-ae;return he*he+be*be}_t.fromVectorTileJs=Ai,_t.fromGeojsonVt=function(ie,$){$=$||{};var q={};for(var ae in ie)q[ae]=new dn(ie[ae].features,$),q[ae].name=ae,q[ae].version=$.version,q[ae].extent=$.extent;return Ai({layers:q})},_t.GeoJSONWrapper=ii;const jo=ie=>ie[0],Nn=ie=>ie[1];class Ni{constructor($,q=jo,ae=Nn,he=64,be=Float64Array){this.nodeSize=he,this.points=$;const Le=$.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new Le($.length),Ee=this.coords=new be(2*$.length);for(let Be=0;Be<$.length;Be++)Oe[Be]=Be,Ee[2*Be]=q($[Be]),Ee[2*Be+1]=ae($[Be]);cn(Oe,Ee,he,0,Oe.length-1,0)}range($,q,ae,he){return function(be,Le,Oe,Ee,Be,tt,yt){const je=[0,be.length-1,0],Ut=[];let gt,Pe;for(;je.length;){const Ye=je.pop(),bn=je.pop(),sn=je.pop();if(bn-sn<=yt){for(let an=sn;an<=bn;an++)gt=Le[2*an],Pe=Le[2*an+1],gt>=Oe&&gt<=Be&&Pe>=Ee&&Pe<=tt&&Ut.push(be[an]);continue}const Wt=Math.floor((sn+bn)/2);gt=Le[2*Wt],Pe=Le[2*Wt+1],gt>=Oe&&gt<=Be&&Pe>=Ee&&Pe<=tt&&Ut.push(be[Wt]);const en=(Ye+1)%2;(0===Ye?Oe<=gt:Ee<=Pe)&&(je.push(sn),je.push(Wt-1),je.push(en)),(0===Ye?Be>=gt:tt>=Pe)&&(je.push(Wt+1),je.push(bn),je.push(en))}return Ut}(this.ids,this.coords,$,q,ae,he,this.nodeSize)}within($,q,ae){return function(he,be,Le,Oe,Ee,Be){const tt=[0,he.length-1,0],yt=[],je=Ee*Ee;for(;tt.length;){const Ut=tt.pop(),gt=tt.pop(),Pe=tt.pop();if(gt-Pe<=Be){for(let en=Pe;en<=gt;en++)sr(be[2*en],be[2*en+1],Le,Oe)<=je&&yt.push(he[en]);continue}const Ye=Math.floor((Pe+gt)/2),bn=be[2*Ye],sn=be[2*Ye+1];sr(bn,sn,Le,Oe)<=je&&yt.push(he[Ye]);const Wt=(Ut+1)%2;(0===Ut?Le-Ee<=bn:Oe-Ee<=sn)&&(tt.push(Pe),tt.push(Ye-1),tt.push(Wt)),(0===Ut?Le+Ee>=bn:Oe+Ee>=sn)&&(tt.push(Ye+1),tt.push(gt),tt.push(Wt))}return yt}(this.ids,this.coords,$,q,ae,this.nodeSize)}}const ds={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Bi=Math.fround||(fs=new Float32Array(1),ie=>(fs[0]=+ie,fs[0]));var fs;class lo{constructor($){this.options=gn(Object.create(ds),$),this.trees=new Array(this.options.maxZoom+1)}load($){const{log:q,minZoom:ae,maxZoom:he,nodeSize:be}=this.options;q&&console.time("total time");const Le=`prepare ${$.length} points`;q&&console.time(Le),this.points=$;let Oe=[];for(let Ee=0;Ee<$.length;Ee++)$[Ee].geometry&&Oe.push(yi($[Ee],Ee));this.trees[he+1]=new Ni(Oe,mr,wo,be,Float32Array),q&&console.timeEnd(Le);for(let Ee=he;Ee>=ae;Ee--){const Be=+Date.now();Oe=this._cluster(Oe,Ee),this.trees[Ee]=new Ni(Oe,mr,wo,be,Float32Array),q&&console.log("z%d: %d clusters in %dms",Ee,Oe.length,+Date.now()-Be)}return q&&console.timeEnd("total time"),this}getClusters($,q){let ae=(($[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,$[1]));let be=180===$[2]?180:(($[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ae=-180,be=180;else if(ae>be){const tt=this.getClusters([ae,he,180,Le],q),yt=this.getClusters([-180,he,be,Le],q);return tt.concat(yt)}const Oe=this.trees[this._limitZoom(q)],Ee=Oe.range(Sn(ae),vi(Le),Sn(be),vi(he)),Be=[];for(const tt of Ee){const yt=Oe.points[tt];Be.push(yt.numPoints?Wr(yt):this.points[yt.index])}return Be}getChildren($){const q=this._getOriginId($),ae=this._getOriginZoom($),he="No cluster with the specified id.",be=this.trees[ae];if(!be)throw new Error(he);const Le=be.points[q];if(!Le)throw new Error(he);const Oe=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),Ee=be.within(Le.x,Le.y,Oe),Be=[];for(const tt of Ee){const yt=be.points[tt];yt.parentId===$&&Be.push(yt.numPoints?Wr(yt):this.points[yt.index])}if(0===Be.length)throw new Error(he);return Be}getLeaves($,q,ae){const he=[];return this._appendLeaves(he,$,q=q||10,ae=ae||0,0),he}getTile($,q,ae){const he=this.trees[this._limitZoom($)],be=Math.pow(2,$),{extent:Le,radius:Oe}=this.options,Ee=Oe/Le,Be=(ae-Ee)/be,tt=(ae+1+Ee)/be,yt={features:[]};return this._addTileFeatures(he.range((q-Ee)/be,Be,(q+1+Ee)/be,tt),he.points,q,ae,be,yt),0===q&&this._addTileFeatures(he.range(1-Ee/be,Be,1,tt),he.points,be,ae,be,yt),q===be-1&&this._addTileFeatures(he.range(0,Be,Ee/be,tt),he.points,-1,ae,be,yt),yt.features.length?yt:null}getClusterExpansionZoom($){let q=this._getOriginZoom($)-1;for(;q<=this.options.maxZoom;){const ae=this.getChildren($);if(q++,1!==ae.length)break;$=ae[0].properties.cluster_id}return q}_appendLeaves($,q,ae,he,be){const Le=this.getChildren(q);for(const Oe of Le){const Ee=Oe.properties;if(Ee&&Ee.cluster?be+Ee.point_count<=he?be+=Ee.point_count:be=this._appendLeaves($,Ee.cluster_id,ae,he,be):be<he?be++:$.push(Oe),$.length===ae)break}return be}_addTileFeatures($,q,ae,he,be,Le){for(const Oe of $){const Ee=q[Oe],Be=Ee.numPoints;let tt,yt,je;if(Be)tt=Ur(Ee),yt=Ee.x,je=Ee.y;else{const Pe=this.points[Ee.index];tt=Pe.properties,yt=Sn(Pe.geometry.coordinates[0]),je=vi(Pe.geometry.coordinates[1])}const Ut={type:1,geometry:[[Math.round(this.options.extent*(yt*be-ae)),Math.round(this.options.extent*(je*be-he))]],tags:tt};let gt;Be?gt=Ee.id:this.options.generateId?gt=Ee.index:this.points[Ee.index].id&&(gt=this.points[Ee.index].id),void 0!==gt&&(Ut.id=gt),Le.features.push(Ut)}}_limitZoom($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))}_cluster($,q){const ae=[],{radius:he,extent:be,reduce:Le,minPoints:Oe}=this.options,Ee=he/(be*Math.pow(2,q));for(let Be=0;Be<$.length;Be++){const tt=$[Be];if(tt.zoom<=q)continue;tt.zoom=q;const yt=this.trees[q+1],je=yt.within(tt.x,tt.y,Ee),Ut=tt.numPoints||1;let gt=Ut;for(const Pe of je){const Ye=yt.points[Pe];Ye.zoom>q&&(gt+=Ye.numPoints||1)}if(gt>Ut&&gt>=Oe){let Pe=tt.x*Ut,Ye=tt.y*Ut,bn=Le&&Ut>1?this._map(tt,!0):null;const sn=(Be<<5)+(q+1)+this.points.length;for(const Wt of je){const en=yt.points[Wt];if(en.zoom<=q)continue;en.zoom=q;const an=en.numPoints||1;Pe+=en.x*an,Ye+=en.y*an,en.parentId=sn,Le&&(bn||(bn=this._map(tt,!0)),Le(bn,this._map(en)))}tt.parentId=sn,ae.push(Tn(Pe/gt,Ye/gt,sn,gt,bn))}else if(ae.push(tt),gt>1)for(const Pe of je){const Ye=yt.points[Pe];Ye.zoom<=q||(Ye.zoom=q,ae.push(Ye))}}return ae}_getOriginId($){return $-this.points.length>>5}_getOriginZoom($){return($-this.points.length)%32}_map($,q){if($.numPoints)return q?gn({},$.properties):$.properties;const ae=this.points[$.index].properties,he=this.options.map(ae);return q&&he===ae?gn({},he):he}}function Tn(ie,$,q,ae,he){return{x:Bi(ie),y:Bi($),zoom:1/0,id:q,parentId:-1,numPoints:ae,properties:he}}function yi(ie,$){const[q,ae]=ie.geometry.coordinates;return{x:Bi(Sn(q)),y:Bi(vi(ae)),zoom:1/0,index:$,parentId:-1}}function Wr(ie){return{type:"Feature",id:ie.id,properties:Ur(ie),geometry:{type:"Point",coordinates:[($=ie.x,360*($-.5)),ra(ie.y)]}};var $}function Ur(ie){const $=ie.numPoints,q=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$;return gn(gn({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:$,point_count_abbreviated:q})}function Sn(ie){return ie/360+.5}function vi(ie){const $=Math.sin(ie*Math.PI/180),q=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return q<0?0:q>1?1:q}function ra(ie){const $=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp($))/Math.PI-90}function gn(ie,$){for(const q in $)ie[q]=$[q];return ie}function mr(ie){return ie.x}function wo(ie){return ie.y}function Yn(ie,$,q,ae){for(var he,be=ae,Le=q-$>>1,Oe=q-$,Ee=ie[$],Be=ie[$+1],tt=ie[q],yt=ie[q+1],je=$+3;je<q;je+=3){var Ut=Xr(ie[je],ie[je+1],Ee,Be,tt,yt);if(Ut>be)he=je,be=Ut;else if(Ut===be){var gt=Math.abs(je-Le);gt<Oe&&(he=je,Oe=gt)}}be>ae&&(he-$>3&&Yn(ie,$,he,ae),ie[he+2]=be,q-he>3&&Yn(ie,he,q,ae))}function Xr(ie,$,q,ae,he,be){var Le=he-q,Oe=be-ae;if(0!==Le||0!==Oe){var Ee=((ie-q)*Le+($-ae)*Oe)/(Le*Le+Oe*Oe);Ee>1?(q=he,ae=be):Ee>0&&(q+=Le*Ee,ae+=Oe*Ee)}return(Le=ie-q)*Le+(Oe=$-ae)*Oe}function Zi(ie,$,q,ae){var he={id:void 0===ie?null:ie,type:$,geometry:q,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var Le=be.geometry,Oe=be.type;if("Point"===Oe||"MultiPoint"===Oe||"LineString"===Oe)Lr(be,Le);else if("Polygon"===Oe||"MultiLineString"===Oe)for(var Ee=0;Ee<Le.length;Ee++)Lr(be,Le[Ee]);else if("MultiPolygon"===Oe)for(Ee=0;Ee<Le.length;Ee++)for(var Be=0;Be<Le[Ee].length;Be++)Lr(be,Le[Ee][Be])}(he),he}function Lr(ie,$){for(var q=0;q<$.length;q+=3)ie.minX=Math.min(ie.minX,$[q]),ie.minY=Math.min(ie.minY,$[q+1]),ie.maxX=Math.max(ie.maxX,$[q]),ie.maxY=Math.max(ie.maxY,$[q+1])}function co(ie,$,q,ae){if($.geometry){var he=$.geometry.coordinates,be=$.geometry.type,Le=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),Oe=[],Ee=$.id;if(q.promoteId?Ee=$.properties[q.promoteId]:q.generateId&&(Ee=ae||0),"Point"===be)Eo(he,Oe);else if("MultiPoint"===be)for(var Be=0;Be<he.length;Be++)Eo(he[Be],Oe);else if("LineString"===be)ai(he,Oe,Le,!1);else if("MultiLineString"===be){if(q.lineMetrics){for(Be=0;Be<he.length;Be++)ai(he[Be],Oe=[],Le,!1),ie.push(Zi(Ee,"LineString",Oe,$.properties));return}Wi(he,Oe,Le,!1)}else if("Polygon"===be)Wi(he,Oe,Le,!0);else{if("MultiPolygon"!==be){if("GeometryCollection"===be){for(Be=0;Be<$.geometry.geometries.length;Be++)co(ie,{id:Ee,geometry:$.geometry.geometries[Be],properties:$.properties},q,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Be=0;Be<he.length;Be++){var tt=[];Wi(he[Be],tt,Le,!0),Oe.push(tt)}}ie.push(Zi(Ee,be,Oe,$.properties))}}function Eo(ie,$){$.push(Ns(ie[0])),$.push(Yr(ie[1])),$.push(0)}function ai(ie,$,q,ae){for(var he,be,Le=0,Oe=0;Oe<ie.length;Oe++){var Ee=Ns(ie[Oe][0]),Be=Yr(ie[Oe][1]);$.push(Ee),$.push(Be),$.push(0),Oe>0&&(Le+=ae?(he*Be-Ee*be)/2:Math.sqrt(Math.pow(Ee-he,2)+Math.pow(Be-be,2))),he=Ee,be=Be}var tt=$.length-3;$[2]=1,Yn($,0,tt,q),$[tt+2]=1,$.size=Math.abs(Le),$.start=0,$.end=$.size}function Wi(ie,$,q,ae){for(var he=0;he<ie.length;he++){var be=[];ai(ie[he],be,q,ae),$.push(be)}}function Ns(ie){return ie/360+.5}function Yr(ie){var $=Math.sin(ie*Math.PI/180),q=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return q<0?0:q>1?1:q}function $t(ie,$,q,ae,he,be,Le,Oe){if(ae/=$,be>=(q/=$)&&Le<ae)return ie;if(Le<q||be>=ae)return null;for(var Ee=[],Be=0;Be<ie.length;Be++){var tt=ie[Be],yt=tt.geometry,je=tt.type,Ut=0===he?tt.minX:tt.minY,gt=0===he?tt.maxX:tt.maxY;if(Ut>=q&&gt<ae)Ee.push(tt);else if(!(gt<q||Ut>=ae)){var Pe=[];if("Point"===je||"MultiPoint"===je)ur(yt,Pe,q,ae,he);else if("LineString"===je)Xt(yt,Pe,q,ae,he,!1,Oe.lineMetrics);else if("MultiLineString"===je)Mi(yt,Pe,q,ae,he,!1);else if("Polygon"===je)Mi(yt,Pe,q,ae,he,!0);else if("MultiPolygon"===je)for(var Ye=0;Ye<yt.length;Ye++){var bn=[];Mi(yt[Ye],bn,q,ae,he,!0),bn.length&&Pe.push(bn)}if(Pe.length){if(Oe.lineMetrics&&"LineString"===je){for(Ye=0;Ye<Pe.length;Ye++)Ee.push(Zi(tt.id,je,Pe[Ye],tt.tags));continue}"LineString"!==je&&"MultiLineString"!==je||(1===Pe.length?(je="LineString",Pe=Pe[0]):je="MultiLineString"),"Point"!==je&&"MultiPoint"!==je||(je=3===Pe.length?"Point":"MultiPoint"),Ee.push(Zi(tt.id,je,Pe,tt.tags))}}}return Ee.length?Ee:null}function ur(ie,$,q,ae,he){for(var be=0;be<ie.length;be+=3){var Le=ie[be+he];Le>=q&&Le<=ae&&($.push(ie[be]),$.push(ie[be+1]),$.push(ie[be+2]))}}function Xt(ie,$,q,ae,he,be,Le){for(var Oe,Ee,Be=Qt(ie),tt=0===he?Kr:Zn,yt=ie.start,je=0;je<ie.length-3;je+=3){var Ut=ie[je],gt=ie[je+1],Pe=ie[je+2],Ye=ie[je+3],bn=ie[je+4],sn=0===he?Ut:gt,Wt=0===he?Ye:bn,en=!1;Le&&(Oe=Math.sqrt(Math.pow(Ut-Ye,2)+Math.pow(gt-bn,2))),sn<q?Wt>q&&(Ee=tt(Be,Ut,gt,Ye,bn,q),Le&&(Be.start=yt+Oe*Ee)):sn>ae?Wt<ae&&(Ee=tt(Be,Ut,gt,Ye,bn,ae),Le&&(Be.start=yt+Oe*Ee)):di(Be,Ut,gt,Pe),Wt<q&&sn>=q&&(Ee=tt(Be,Ut,gt,Ye,bn,q),en=!0),Wt>ae&&sn<=ae&&(Ee=tt(Be,Ut,gt,Ye,bn,ae),en=!0),!be&&en&&(Le&&(Be.end=yt+Oe*Ee),$.push(Be),Be=Qt(ie)),Le&&(yt+=Oe)}var an=ie.length-3;Ut=ie[an],gt=ie[an+1],Pe=ie[an+2],(sn=0===he?Ut:gt)>=q&&sn<=ae&&di(Be,Ut,gt,Pe),an=Be.length-3,be&&an>=3&&(Be[an]!==Be[0]||Be[an+1]!==Be[1])&&di(Be,Be[0],Be[1],Be[2]),Be.length&&$.push(Be)}function Qt(ie){var $=[];return $.size=ie.size,$.start=ie.start,$.end=ie.end,$}function Mi(ie,$,q,ae,he,be){for(var Le=0;Le<ie.length;Le++)Xt(ie[Le],$,q,ae,he,be,!1)}function di(ie,$,q,ae){ie.push($),ie.push(q),ie.push(ae)}function Kr(ie,$,q,ae,he,be){var Le=(be-$)/(ae-$);return ie.push(be),ie.push(q+(he-q)*Le),ie.push(1),Le}function Zn(ie,$,q,ae,he,be){var Le=(be-q)/(he-q);return ie.push($+(ae-$)*Le),ie.push(be),ie.push(1),Le}function Pi(ie,$){for(var q=[],ae=0;ae<ie.length;ae++){var he,be=ie[ae],Le=be.type;if("Point"===Le||"MultiPoint"===Le||"LineString"===Le)he=$o(be.geometry,$);else if("MultiLineString"===Le||"Polygon"===Le){he=[];for(var Oe=0;Oe<be.geometry.length;Oe++)he.push($o(be.geometry[Oe],$))}else if("MultiPolygon"===Le)for(he=[],Oe=0;Oe<be.geometry.length;Oe++){for(var Ee=[],Be=0;Be<be.geometry[Oe].length;Be++)Ee.push($o(be.geometry[Oe][Be],$));he.push(Ee)}q.push(Zi(be.id,Le,he,be.tags))}return q}function $o(ie,$){var q=[];q.size=ie.size,void 0!==ie.start&&(q.start=ie.start,q.end=ie.end);for(var ae=0;ae<ie.length;ae+=3)q.push(ie[ae]+$,ie[ae+1],ie[ae+2]);return q}function yn(ie,$){if(ie.transformed)return ie;var q,ae,he,be=1<<ie.z,Le=ie.x,Oe=ie.y;for(q=0;q<ie.features.length;q++){var Ee=ie.features[q],Be=Ee.geometry,tt=Ee.type;if(Ee.geometry=[],1===tt)for(ae=0;ae<Be.length;ae+=2)Ee.geometry.push(Ri(Be[ae],Be[ae+1],$,be,Le,Oe));else for(ae=0;ae<Be.length;ae++){var yt=[];for(he=0;he<Be[ae].length;he+=2)yt.push(Ri(Be[ae][he],Be[ae][he+1],$,be,Le,Oe));Ee.geometry.push(yt)}}return ie.transformed=!0,ie}function Ri(ie,$,q,ae,he,be){return[Math.round(q*(ie*ae-he)),Math.round(q*($*ae-be))]}function Bn(ie,$,q,ae,he){for(var be=$===he.maxZoom?0:he.tolerance/((1<<$)*he.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:ae,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Oe=0;Oe<ie.length;Oe++){Le.numFeatures++,Bs(Le,ie[Oe],be,he);var Ee=ie[Oe].minX,Be=ie[Oe].minY,tt=ie[Oe].maxX,yt=ie[Oe].maxY;Ee<Le.minX&&(Le.minX=Ee),Be<Le.minY&&(Le.minY=Be),tt>Le.maxX&&(Le.maxX=tt),yt>Le.maxY&&(Le.maxY=yt)}return Le}function Bs(ie,$,q,ae){var he=$.geometry,be=$.type,Le=[];if("Point"===be||"MultiPoint"===be)for(var Oe=0;Oe<he.length;Oe+=3)Le.push(he[Oe]),Le.push(he[Oe+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===be)Vi(Le,he,ie,q,!1,!1);else if("MultiLineString"===be||"Polygon"===be)for(Oe=0;Oe<he.length;Oe++)Vi(Le,he[Oe],ie,q,"Polygon"===be,0===Oe);else if("MultiPolygon"===be)for(var Ee=0;Ee<he.length;Ee++){var Be=he[Ee];for(Oe=0;Oe<Be.length;Oe++)Vi(Le,Be[Oe],ie,q,!0,0===Oe)}if(Le.length){var tt=$.tags||null;if("LineString"===be&&ae.lineMetrics){for(var yt in tt={},$.tags)tt[yt]=$.tags[yt];tt.mapbox_clip_start=he.start/he.size,tt.mapbox_clip_end=he.end/he.size}var je={geometry:Le,type:"Polygon"===be||"MultiPolygon"===be?3:"LineString"===be||"MultiLineString"===be?2:1,tags:tt};null!==$.id&&(je.id=$.id),ie.features.push(je)}}function Vi(ie,$,q,ae,he,be){var Le=ae*ae;if(ae>0&&$.size<(he?Le:ae))q.numPoints+=$.length/3;else{for(var Oe=[],Ee=0;Ee<$.length;Ee+=3)(0===ae||$[Ee+2]>Le)&&(q.numSimplified++,Oe.push($[Ee]),Oe.push($[Ee+1])),q.numPoints++;he&&function(Be,tt){for(var yt=0,je=0,Ut=Be.length,gt=Ut-2;je<Ut;gt=je,je+=2)yt+=(Be[je]-Be[gt])*(Be[je+1]+Be[gt+1]);if(yt>0===tt)for(je=0,Ut=Be.length;je<Ut/2;je+=2){var Pe=Be[je],Ye=Be[je+1];Be[je]=Be[Ut-2-je],Be[je+1]=Be[Ut-1-je],Be[Ut-2-je]=Pe,Be[Ut-1-je]=Ye}}(Oe,be),ie.push(Oe)}}function Dn(ie,$){var q=($=this.options=function(he,be){for(var Le in be)he[Le]=be[Le];return he}(Object.create(this.options),$)).debug;if(q&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,be,Le,Oe,Ee,Be,ae=function(he,be){var Le=[];if("FeatureCollection"===he.type)for(var Oe=0;Oe<he.features.length;Oe++)co(Le,he.features[Oe],be,Oe);else co(Le,"Feature"===he.type?he:{geometry:he},be);return Le}(ie,$);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=ae,be=$,Le=be.buffer/be.extent,Oe=he,Ee=$t(he,1,-1-Le,Le,0,-1,2,be),Be=$t(he,1,1-Le,2+Le,0,-1,2,be),(Ee||Be)&&(Oe=$t(he,1,-Le,1+Le,0,-1,2,be)||[],Ee&&(Oe=Pi(Ee,1).concat(Oe)),Be&&(Oe=Oe.concat(Pi(Be,-1)))),ae=Oe).length&&this.splitTile(ae,0,0,0),q&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Xi(ie,$,q){return 32*((1<<ie)*q+$)+ie}function Co(ie,$){const q=ie.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);const ae=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ae)return $(null,null);const he=new St(ae.features);let be=_t(he);0===be.byteOffset&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),$(null,{vectorTile:he,rawData:be.buffer})}Dn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Dn.prototype.splitTile=function(ie,$,q,ae,he,be,Le){for(var Oe=[ie,$,q,ae],Ee=this.options,Be=Ee.debug;Oe.length;){ae=Oe.pop(),q=Oe.pop(),$=Oe.pop(),ie=Oe.pop();var tt=1<<$,yt=Xi($,q,ae),je=this.tiles[yt];if(!je&&(Be>1&&console.time("creation"),je=this.tiles[yt]=Bn(ie,$,q,ae,Ee),this.tileCoords.push({z:$,x:q,y:ae}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,q,ae,je.numFeatures,je.numPoints,je.numSimplified),console.timeEnd("creation"));var Ut="z"+$;this.stats[Ut]=(this.stats[Ut]||0)+1,this.total++}if(je.source=ie,he){if($===Ee.maxZoom||$===he)continue;var gt=1<<he-$;if(q!==Math.floor(be/gt)||ae!==Math.floor(Le/gt))continue}else if($===Ee.indexMaxZoom||je.numPoints<=Ee.indexMaxPoints)continue;if(je.source=null,0!==ie.length){Be>1&&console.time("clipping");var Pe,Ye,bn,sn,Wt,en,an=.5*Ee.buffer/Ee.extent,uo=.5-an,Dr=.5+an,$e=1+an;Pe=Ye=bn=sn=null,Wt=$t(ie,tt,q-an,q+Dr,0,je.minX,je.maxX,Ee),en=$t(ie,tt,q+uo,q+$e,0,je.minX,je.maxX,Ee),ie=null,Wt&&(Pe=$t(Wt,tt,ae-an,ae+Dr,1,je.minY,je.maxY,Ee),Ye=$t(Wt,tt,ae+uo,ae+$e,1,je.minY,je.maxY,Ee),Wt=null),en&&(bn=$t(en,tt,ae-an,ae+Dr,1,je.minY,je.maxY,Ee),sn=$t(en,tt,ae+uo,ae+$e,1,je.minY,je.maxY,Ee),en=null),Be>1&&console.timeEnd("clipping"),Oe.push(Pe||[],$+1,2*q,2*ae),Oe.push(Ye||[],$+1,2*q,2*ae+1),Oe.push(bn||[],$+1,2*q+1,2*ae),Oe.push(sn||[],$+1,2*q+1,2*ae+1)}}},Dn.prototype.getTile=function(ie,$,q){var ae=this.options,he=ae.extent,be=ae.debug;if(ie<0||ie>24)return null;var Le=1<<ie,Oe=Xi(ie,$=($%Le+Le)%Le,q);if(this.tiles[Oe])return yn(this.tiles[Oe],he);be>1&&console.log("drilling down to z%d-%d-%d",ie,$,q);for(var Ee,Be=ie,tt=$,yt=q;!Ee&&Be>0;)Be--,tt=Math.floor(tt/2),yt=Math.floor(yt/2),Ee=this.tiles[Xi(Be,tt,yt)];return Ee&&Ee.source?(be>1&&console.log("found parent tile z%d-%d-%d",Be,tt,yt),be>1&&console.time("drilling down"),this.splitTile(Ee.source,Be,tt,yt,ie,$,q),be>1&&console.timeEnd("drilling down"),this.tiles[Oe]?yn(this.tiles[Oe],he):null):null};class fi extends d.VectorTileWorkerSource{constructor($,q,ae,he,be){super($,q,ae,he,Co),be&&(this.loadGeoJSON=be)}loadData($,q){const ae=$&&$.request,he=ae&&ae.collectResourceTiming;this.loadGeoJSON($,(be,Le)=>{if(be||!Le)return q(be);if("object"!=typeof Le)return q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));{Se(Le,!0);try{if($.filter){const Ee=d.createExpression($.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));const Be=Le.features.filter(tt=>Ee.value.evaluate({zoom:0},tt));Le={type:"FeatureCollection",features:Be}}this._geoJSONIndex=$.cluster?new lo(function({superclusterOptions:Ee,clusterProperties:Be}){if(!Be||!Ee)return Ee;const tt={},yt={},je={accumulated:null,zoom:0},Ut={properties:null},gt=Object.keys(Be);for(const Pe of gt){const[Ye,bn]=Be[Pe],sn=d.createExpression(bn),Wt=d.createExpression("string"==typeof Ye?[Ye,["accumulated"],["get",Pe]]:Ye);tt[Pe]=sn.value,yt[Pe]=Wt.value}return Ee.map=Pe=>{Ut.properties=Pe;const Ye={};for(const bn of gt)Ye[bn]=tt[bn].evaluate(je,Ut);return Ye},Ee.reduce=(Pe,Ye)=>{Ut.properties=Ye;for(const bn of gt)je.accumulated=Pe[bn],Pe[bn]=yt[bn].evaluate(je,Ut)},Ee}($)).load(Le.features):new Dn(Ee=Le,$.geojsonVtOptions)}catch(Ee){return q(Ee)}this.loaded={};const Oe={};if(he){const Ee=d.getPerformanceMeasurement(ae);Ee&&(Oe.resourceTiming={},Oe.resourceTiming[$.source]=JSON.parse(JSON.stringify(Ee)))}q(null,Oe)}var Ee})}reloadTile($,q){const ae=this.loaded;return ae&&ae[$.uid]?super.reloadTile($,q):this.loadTile($,q)}loadGeoJSON($,q){if($.request)d.getJSON($.request,q);else{if("string"!=typeof $.data)return q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse($.data))}catch(ae){return q(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom($,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(ae){q(ae)}}getClusterChildren($,q){try{q(null,this._geoJSONIndex.getChildren($.clusterId))}catch(ae){q(ae)}}getClusterLeaves($,q){try{q(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(ae){q(ae)}}}class Pn{constructor($){this.self=$,this.actor=new d.Actor($,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:fi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,ae)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=ae},this.self.registerRTLTextPlugin=q=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=q.applyArabicShaping,d.plugin.processBidirectionalText=q.processBidirectionalText,d.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches($,q,ae){delete this.layerIndexes[$],delete this.availableImages[$],delete this.workerSources[$],delete this.demWorkerSources[$],ae()}checkIfReady($,q,ae){ae()}setReferrer($,q){this.referrer=q}spriteLoaded($,q){this.isSpriteLoaded[$]=q;for(const ae in this.workerSources[$]){const he=this.workerSources[$][ae];for(const be in he)he[be]instanceof d.VectorTileWorkerSource&&(he[be].isSpriteLoaded=q,he[be].fire(new d.Event("isSpriteLoaded")))}}setImages($,q,ae){this.availableImages[$]=q;for(const he in this.workerSources[$]){const be=this.workerSources[$][he];for(const Le in be)be[Le].availableImages=q}ae()}enableTerrain($,q,ae){this.terrain=q,ae()}setProjection($,q){this.projections[$]=d.getProjection(q)}setLayers($,q,ae){this.getLayerIndex($).replace(q),ae()}updateLayers($,q,ae){this.getLayerIndex($).update(q.layers,q.removedIds),ae()}loadTile($,q,ae){const he=this.enableTerrain?d.extend({enableTerrain:this.terrain},q):q;he.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,q.type,q.source).loadTile(he,ae)}loadDEMTile($,q,ae){const he=this.enableTerrain?d.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource($,q.source).loadTile(he,ae)}reloadTile($,q,ae){const he=this.enableTerrain?d.extend({enableTerrain:this.terrain},q):q;he.projection=this.projections[$]||this.defaultProjection,this.getWorkerSource($,q.type,q.source).reloadTile(he,ae)}abortTile($,q,ae){this.getWorkerSource($,q.type,q.source).abortTile(q,ae)}removeTile($,q,ae){this.getWorkerSource($,q.type,q.source).removeTile(q,ae)}removeSource($,q,ae){if(!this.workerSources[$]||!this.workerSources[$][q.type]||!this.workerSources[$][q.type][q.source])return;const he=this.workerSources[$][q.type][q.source];delete this.workerSources[$][q.type][q.source],void 0!==he.removeSource?he.removeSource(q,ae):ae()}loadWorkerSource($,q,ae){try{this.self.importScripts(q.url),ae()}catch(he){ae(he.toString())}}syncRTLPluginState($,q,ae){try{d.plugin.setState(q);const he=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=he){this.self.importScripts(he);const be=d.plugin.isParsed();ae(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),be)}}catch(he){ae(he.toString())}}getAvailableImages($){let q=this.availableImages[$];return q||(q=[]),q}getLayerIndex($){let q=this.layerIndexes[$];return q||(q=this.layerIndexes[$]=new Ot),q}getWorkerSource($,q,ae){return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][q]||(this.workerSources[$][q]={}),this.workerSources[$][q][ae]||(this.workerSources[$][q][ae]=new this.workerSourceTypes[q]({send:(he,be,Le,Oe,Ee,Be)=>{this.actor.send(he,be,Le,$,Ee,Be)},scheduler:this.actor.scheduler},this.getLayerIndex($),this.getAvailableImages($),this.isSpriteLoaded[$])),this.workerSources[$][q][ae]}getDEMWorkerSource($,q){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][q]||(this.demWorkerSources[$][q]=new Me),this.demWorkerSources[$][q]}enforceCacheSizeLimit($,q){d.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics($,q,ae){ae(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Pn(self)),Pn}),te(0,function(d){var Zt=ht;function ht(f){return r=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,y,v=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(v);try{y=new Worker(D),p=!0}catch(A){p=!1}return y&&y.terminate(),URL.revokeObjectURL(D),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var y=p.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===p.width}()||(void 0===Ot[c=r&&r.failIfMajorPerformanceCaveat]&&(Ot[c]=function(p){var y,D,A,k,v=(D=p,A=document.createElement("canvas"),(k=Object.create(ht.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,A.getContext("webgl",k)||A.getContext("experimental-webgl",k));if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch(D){return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),!0===v.getShaderParameter(y,v.COMPILE_STATUS))}(c)),!Ot[c]||document.documentMode));var r,c}var Ot={};function Ve(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let c=0;c<f.length;c++)if(!Ve(f[c],r[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==r){if("object"!=typeof r||Object.keys(f).length!==Object.keys(r).length)return!1;for(const c in f)if(!Ve(f[c],r[c]))return!1;return!0}return f===r}ht.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Me={create:function(f,r,c){const p=d.window.document.createElement(f);return void 0!==r&&(p.className=r),c&&c.appendChild(p),p},createNS:function(f,r){return d.window.document.createElementNS(f,r)}},Se=d.window.document&&d.window.document.documentElement.style,We=Se&&void 0!==Se.userSelect?"userSelect":"WebkitUserSelect";let st;Me.disableDrag=function(){Se&&We&&(st=Se[We],Se[We]="none")},Me.enableDrag=function(){Se&&We&&(Se[We]=st)},Me.setTransform=function(f,r){f.style.transform=r};let bt=!1;try{const f=Object.defineProperty({},"passive",{get(){bt=!0}});d.window.addEventListener("test",f,f),d.window.removeEventListener("test",f,f)}catch(f){bt=!1}Me.addEventListener=function(f,r,c,p={}){f.addEventListener(r,c,"passive"in p&&bt?p:p.capture)},Me.removeEventListener=function(f,r,c,p={}){f.removeEventListener(r,c,"passive"in p&&bt?p:p.capture)};const ut=function(f){f.preventDefault(),f.stopPropagation(),d.window.removeEventListener("click",ut,!0)};function St(f,r,c){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new d.pointGeometry((c.clientX-r.left)*p,(c.clientY-r.top)*p)}function ct(f,r){var c=r[0],p=r[1],y=r[2],v=r[3],D=c*v-y*p;return D?(f[0]=v*(D=1/D),f[1]=-p*D,f[2]=-y*D,f[3]=c*D,f):null}Me.suppressClick=function(){d.window.addEventListener("click",ut,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",ut,!0)},0)},Me.mousePos=function(f,r){const c=f.getBoundingClientRect();return St(f,c,r)},Me.touchPos=function(f,r){const c=f.getBoundingClientRect(),p=[];for(let y=0;y<r.length;y++)p.push(St(f,c,r[y]));return p},Me.mouseButton=function(f){return void 0!==d.window.InstallTrigger&&2===f.button&&f.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},Me.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};class dn{constructor(r,c){this.pos=r,this.dir=c}intersectsPlane(r,c,p){const y=d.dot(c,this.dir);if(Math.abs(y)<1e-6)return!1;const v=d.dot(d.sub(d.create(),r,this.pos),c)/y,D=d.scaleAndAdd(d.create(),this.pos,this.dir,v);return d.copy(p,D),!0}}class Vn{constructor(r,c){this.points=r,this.planes=c}static fromInvProjectionMatrix(r,c,p){const y=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const k=d.transformMat4([],A,r),z=1/k[3]/c*y;return d.mul(k,k,[z,z,1/k[3],z])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const k=d.sub([],v[A[0]],v[A[1]]),z=d.sub([],v[A[2]],v[A[1]]),V=d.normalize([],d.cross([],k,z)),j=-d.dot(V,v[A[1]]);return V.concat(j)});return new Vn(v,D)}}class nn{constructor(r,c){this.min=r,this.max=c,this.center=d.scale([],d.add([],this.min,this.max),.5)}quadrant(r){const c=[r%2==0,r<2],p=d.clone(this.min),y=d.clone(this.max);for(let v=0;v<c.length;v++)p[v]=c[v]?this.min[v]:this.center[v],y[v]=c[v]?this.center[v]:this.max[v];return y[2]=this.max[2],new nn(p,y)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}intersects(r){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let y=0;y<r.planes.length;y++){const v=r.planes[y];let D=0;for(let A=0;A<c.length;A++)D+=d.dot$1(v,c[A])>=0;if(0===D)return 0;D!==c.length&&(p=!1)}if(p)return 2;for(let y=0;y<3;y++){let v=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let A=0;A<r.points.length;A++){const k=r.points[A][y]-this.min[y];v=Math.min(v,k),D=Math.max(D,k)}if(D<0||v>this.max[y]-this.min[y])return 0}return 1}}function _t(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class ii extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new d.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const y of r){if(y[0]<p||y[1]<y[0]||c<y[1])return!1;p=y[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let p=!0;if(!this.isLoaded())for(const y of r)this.images[y]||(p=!1);this.isLoaded()||p?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const p={};for(const y of r){this.images[y]||this.fire(new d.Event("styleimagemissing",{id:y}));const v=this.images[y];v?p[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:d.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],p=this.getImage(r);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const y={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new d.ImagePosition(y,p);this.patterns[r]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const v in this.patterns)r.push(this.patterns[v].bin);const{w:c,h:p}=d.potpack(r),y=this.atlasImage;y.resize({width:c||1,height:p||1});for(const v in this.patterns){const{bin:D}=this.patterns[v],A=D.x+1,k=D.y+1,z=this.images[v].data,V=z.width,j=z.height;d.RGBAImage.copy(z,y,{x:0,y:0},{x:A,y:k},{width:V,height:j}),d.RGBAImage.copy(z,y,{x:0,y:j-1},{x:A,y:k-1},{width:V,height:1}),d.RGBAImage.copy(z,y,{x:0,y:0},{x:A,y:k+j},{width:V,height:1}),d.RGBAImage.copy(z,y,{x:V-1,y:0},{x:A-1,y:k},{width:1,height:j}),d.RGBAImage.copy(z,y,{x:0,y:0},{x:A+V,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];_t(p)&&this.updateImage(c,p)}}}const Ai=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(f,r){return function([c,p,y]){const v=d.degToRad(p+90),D=d.degToRad(y);return{x:c*Math.cos(v)*Math.sin(D),y:c*Math.sin(v)*Math.sin(D),z:c*Math.cos(D),azimuthal:p,polar:y}}(f.expression.evaluate(r))}interpolate(f,r,c){return{x:d.number(f.x,r.x,c),y:d.number(f.y,r.y,c),z:d.number(f.z,r.z,c),azimuthal:d.number(f.azimuthal,r.azimuthal,c),polar:d.number(f.polar,r.polar,c)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Tr="-transition";class Pr extends d.Evented{constructor(r){super(),this._transitionable=new d.Transitionable(Ai),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(d.validateLight,r,c))for(const p in r){const y=r[p];d.endsWith(p,Tr)?this._transitionable.setTransition(p.slice(0,-Tr.length),y):this._transitionable.setValue(p,y)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const bo=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),jt="-transition";class Mn extends d.Evented{constructor(r){super(),this._transitionable=new d.Transitionable(bo),this.set(r),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(r){for(const c in r){const p=r[c];d.endsWith(c,jt)?this._transitionable.setTransition(c.slice(0,-jt.length),p):this._transitionable.setValue(c,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function or(f,r,c,p){const y=d.smoothstep(45,65,c),[v,D]=Xn(f,p),A=d.length(r);let k=1-Math.min(1,Math.exp((A-v)/(D-v)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*y*f.alpha}function Xn(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}const cn=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),zn="-transition";class Et extends d.Evented{constructor(r,c){super(),this._transitionable=new d.Transitionable(cn),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(d.validateFog,r,c))for(const p in r){const y=r[p];d.endsWith(p,zn)?this._transitionable.setTransition(p.slice(0,-zn.length),y):this._transitionable.setValue(p,y)}}getOpacity(r){if(this.isSoftDisabled())return 0;const c=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,r)*c.a}getOpacityAtLatLng(r,c){return this.isSoftDisabled()?0:function(p,y,v){const D=d.MercatorCoordinate.fromLngLat(y),A=v.elevation?v.elevation.getAtPointOrZero(D):0,k=[D.x,D.y,A];return d.transformMat4$1(k,k,v.mercatorFogMatrix),or(p,k,v.pitch,v._fov)}(this.state,r,c)}getFovAdjustedRange(r){return this.isSoftDisabled()?[0,1]:Xn(this.state,r)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&d.emitValidationErrors(this,r.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Zr{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const p=this.workerPool.acquire(this.id);for(let y=0;y<p.length;y++){const v=new Zr.Actor(p[y],c,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,p){d.asyncAll(this.actors,(y,v)=>{y.send(r,c,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function sr(f,r,c){return r*(d.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}Zr.Actor=d.Actor;class jo{constructor(r,c,p,y){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>y.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,c){let p,y;if(r instanceof d.pointGeometry||"number"==typeof r[0]){const v=d.pointGeometry.convert(r);p=[d.pointGeometry.convert(r)],y=c.isPointAboveHorizon(v)}else{const v=d.pointGeometry.convert(r[0]),D=d.pointGeometry.convert(r[1]);p=[v,D],y=d.polygonizeBounds(v,D).every(A=>c.isPointAboveHorizon(A))}return new jo(p,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],y=d.polygonizeBounds(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d.bufferConvexPolygon(y,r)}containsTile(r,c,p){const y=r.queryPadding+1,v=r.tileID.wrap,D=p?this._bufferedCameraMercator(y,c).map(oe=>d.getTilePoint(r.tileTransform,oe,v)):this._bufferedScreenMercator(y,c).map(oe=>d.getTilePoint(r.tileTransform,oe,v)),A=this.screenGeometryMercator.map(oe=>d.getTileVec3(r.tileTransform,oe,v)),k=A.map(oe=>new d.pointGeometry(oe[0],oe[1])),z=c.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),V=d.getTileVec3(r.tileTransform,z,v),j=A.map(oe=>{const ne=d.sub(oe,oe,V);return d.normalize(ne,ne),new dn(V,ne)}),Y=sr(r,1,c.zoom);if(d.polygonIntersectsBox(D,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:j,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(ee=d.getBounds(D),ee.min.x=d.clamp(ee.min.x,0,d.EXTENT),ee.min.y=d.clamp(ee.min.y,0,d.EXTENT),ee.max.x=d.clamp(ee.max.x,0,d.EXTENT),ee.max.y=d.clamp(ee.max.y,0,d.EXTENT),ee),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:Y};var ee}_bufferedScreenMercator(r,c){const p=Nn(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const y=this.bufferedScreenGeometry(r).map(v=>c.pointCoordinate3D(v));return this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(r,c){const p=Nn(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const y=this.bufferedCameraGeometry(r).map(v=>c.pointCoordinate3D(v));return this._cameraRaycastCache[p]=y,y}}}function Nn(f){return 100*f|0}function Ni(f,r,c){const p=function(y,v){if(y)return c(y);if(v){const D=d.pick(d.extend(v,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(D.vectorLayers=v.vector_layers,D.vectorLayerIds=D.vectorLayers.map(A=>A.id)),D.tiles=r.canonicalizeTileset(D,f.url),c(null,D)}};return f.url?d.getJSON(r.transformRequest(r.normalizeSourceURL(f.url),d.ResourceType.Source),p):d.exported.frame(()=>p(null,f))}class ds{constructor(r,c,p){this.bounds=d.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),p=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*c),D=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=p&&r.x<v&&r.y>=y&&r.y<D}}class Bi{constructor(r,c,p){this.context=r;const y=r.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class lo{constructor(r,c,p,y){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),r.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const y=c.attributes[this.attributes[p].name];void 0!==y&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,c,p){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],D=c.attributes[v.name];void 0!==D&&r.vertexAttribPointer(D,v.components,r[fs[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Tn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yi extends Tn{getDefault(){return d.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Wr extends Tn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Ur extends Tn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Sn extends Tn{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class vi extends Tn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class ra extends Tn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class gn extends Tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class mr extends Tn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class wo extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Yn extends Tn{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Xr extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class Zi extends Tn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Lr extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class co extends Tn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Eo extends Tn{getDefault(){return d.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ai extends Tn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Wi extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class Ns extends Tn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Yr extends Tn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class $t extends Tn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ur extends Tn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Xt extends Tn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Qt extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Mi extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class di extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Kr extends Tn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Zn extends Tn{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Pi extends Tn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class $o extends Tn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class yn extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ri extends Tn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Bn extends Tn{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Bs extends Bn{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Vi extends Bn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Dn extends Vi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Xi{constructor(r,c,p,y){this.context=r,this.width=c,this.height=p;const v=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Bs(r,v),y&&(this.depthAttachment=new Vi(r,v))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class Co{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new yi(this),this.clearDepth=new Wr(this),this.clearStencil=new Ur(this),this.colorMask=new Sn(this),this.depthMask=new vi(this),this.stencilMask=new ra(this),this.stencilFunc=new gn(this),this.stencilOp=new mr(this),this.stencilTest=new wo(this),this.depthRange=new Yn(this),this.depthTest=new Xr(this),this.depthFunc=new Zi(this),this.blend=new Lr(this),this.blendFunc=new co(this),this.blendColor=new Eo(this),this.blendEquation=new ai(this),this.cullFace=new Wi(this),this.cullFaceSide=new Ns(this),this.frontFace=new Yr(this),this.program=new $t(this),this.activeTexture=new ur(this),this.viewport=new Xt(this),this.bindFramebuffer=new Qt(this),this.bindRenderbuffer=new Mi(this),this.bindTexture=new di(this),this.bindVertexBuffer=new Kr(this),this.bindElementBuffer=new Zn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pi(this),this.pixelStoreUnpack=new $o(this),this.pixelStoreUnpackPremultiplyAlpha=new yn(this),this.pixelStoreUnpackFlipY=new Ri(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new Bi(this,r,c)}createVertexBuffer(r,c,p){return new lo(this,r,c,p)}createRenderbuffer(r,c,p){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),v}createFramebuffer(r,c,p){return new Xi(this,r,c,p)}clear({color:r,depth:c,stencil:p}){const y=this.gl;let v=0;r&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==p&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),y.clear(v)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Ve(r.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class fi extends d.Evented{constructor(r,c,p,y){super(),this.id=r,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},c),d.extend(this,d.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ni(this._options,this.map._requestManager,(r,c)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):c&&(d.extend(this,c),c.bounds&&(this.tileBounds=new ds(c.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(c.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=d.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),(v,D,A,k)=>{if(delete r.request,r.aborted)r.state="unloaded",c(null);else if(v)r.state="errored",c(v);else if(D){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:A,expires:k});const z=this.map.painter.context,V=z.gl;r.texture=this.map.painter.getTileTexture(D.width),r.texture?r.texture.update(D,{useMipmap:!0}):(r.texture=new d.Texture(z,D,V.RGBA,{useMipmap:!0}),r.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE),z.extTextureFilterAnisotropic&&V.texParameterf(V.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),r.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}}let Pn;class ie extends d.Evented{constructor(r,c,p,y){super(),this.id=r,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(r,c){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(p,y)=>{this._loaded=!0,p?this.fire(new d.ErrorEvent(p)):y&&(this.image=d.exported.getImageData(y),r&&(this.coordinates=r),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r,delete this._boundsArray;const c=r.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let y=1/0,v=1/0,D=-1/0,A=-1/0;for(const j of p)y=Math.min(y,j.x),v=Math.min(v,j.y),D=Math.max(D,j.x),A=Math.max(A,j.y);const k=Math.max(D-y,A-v),z=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),V=Math.pow(2,z);return new d.CanonicalTileID(z,Math.floor((y+D)/2*V),Math.floor((v+A)/2*V))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const r=d.tileTransform(this.tileID,this.map.transform.projection),c=this.coordinates.map(p=>{const y=r.projection.project(p[0],p[1]);return d.getTilePoint(r,y)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const $={vector:class extends d.Evented{constructor(f,r,c,p){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(r,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ni(this._options,this.map._requestManager,(f,r)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new d.ErrorEvent(f)):r&&(d.extend(this,r),r.bounds&&(this.tileBounds=new ds(r.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const r=this.map.style._getSourceCaches(this.id);for(const c of r)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,d.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=r:f.request=f.actor.send("reloadTile",p,y.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);else{const v=d.loadVectorTile.call({deduped:this._deduped},p,(D,A)=>{D||!A?y.call(this,D):(p.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},f.actor&&f.actor.send("loadTile",p,y.bind(this),void 0,!0))},!0);f.request={cancel:v}}function y(v,D){return delete f.request,f.aborted?r(null):v&&404!==v.status?r(v):(D&&D.resourceTiming&&(f.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&f.setExpiryData(D),f.loadVectorData(D,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:fi,"raster-dem":class extends fi{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,v){y&&(f.state="errored",r(y)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=d.getImage(this.map._requestManager.transformRequest(c,d.ResourceType.Tile),function(y,v,D,A){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(y)f.state="errored",r(y);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:D,expires:A});const k=d.window.ImageBitmap&&v instanceof d.window.ImageBitmap&&(null==Pn&&(Pn=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Pn),z=1-(v.width-d.prevPowerOfTwo(v.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const V=k?v:d.exported.getImageData(v,z),j={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:V,encoding:this.encoding,padding:z};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",j,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,y=0===r.x?f.wrap-1:f.wrap,v=(r.x+1+c)%c,D=r.x+1===c?f.wrap+1:f.wrap,A={};return A[new d.OverscaledTileID(f.overscaledZ,y,r.z,p,r.y).key]={backfilled:!1},A[new d.OverscaledTileID(f.overscaledZ,D,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(A[new d.OverscaledTileID(f.overscaledZ,y,r.z,p,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},A[new d.OverscaledTileID(f.overscaledZ,D,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<c&&(A[new d.OverscaledTileID(f.overscaledZ,y,r.z,p,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},A[new d.OverscaledTileID(f.overscaledZ,D,r.z,v,r.y+1).key]={backfilled:!1}),A}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends d.Evented{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=d.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*y,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*y,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=d.extend({},this.workerOptions),r=this._data;"string"==typeof r?(f.request=this.map._requestManager.transformRequest(d.exported.resolveURL(r),d.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,p)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(y.resourceTiming=p.resourceTiming[this.id]),this.fire(new d.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,y)=>(delete f.request,f.unloadVectorData(),f.aborted?r(null):p?r(p):(f.loadVectorData(y,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ie{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,d.ResourceType.Source).url);d.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new d.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ie,canvas:class extends ie{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(v=>"number"!=typeof v))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context,c=r.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(r,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const y=this.tiles[p];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},q=function(f,r,c,p){const y=new $[r.type](f,r,c,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],y),y};function ae(f,r){const c=d.identity([]);return d.scale$1(c,c,[.5*f.width,.5*-f.height,1]),d.translate(c,c,[1,-1,0]),d.multiply(c,c,f.calculateProjMatrix(r.toUnwrapped()))}function he(f,r,c,p,y,v,D,A=!1){const k=f.tilesIn(p,D,A);k.sort(Le);const z=[];for(const j of k)z.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(r,c,f._state,j,y,v,ae(f.transform,j.tile.tileID),A)});const V=function(j){const Y={},ee={};for(const oe of j){const ne=oe.queryResults,de=oe.wrappedTileID,re=ee[de]=ee[de]||{};for(const pe in ne){const ge=ne[pe],se=re[pe]=re[pe]||{},_e=Y[pe]=Y[pe]||[];for(const Ce of ge)se[Ce.featureIndex]||(se[Ce.featureIndex]=!0,_e.push(Ce))}}return Y}(z);for(const j in V)V[j].forEach(Y=>{const ee=Y.feature,oe=f.getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=oe});return V}function be(f,r){const c=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],y={};for(let v=0;v<c.length;v++){const D=c[v],A=D.tileID.canonical.key;y[A]||(y[A]=!0,D.querySourceFeatures(p,r))}return p}function Le(f,r){const c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Oe(){return null!=ar.workerClass?new ar.workerClass:new d.window.Worker(ar.workerUrl)}const Ee="mapboxgl_preloaded_worker_pool";class Be{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new Oe);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ee]}numActive(){return Object.keys(this.active).length}}let tt;function yt(){return tt||(tt=new Be),tt}function je(f,r){const c={};for(const p in f)"ref"!==p&&(c[p]=f[p]);return d.refProperties.forEach(p=>{p in r&&(c[p]=r[p])}),c}function Ut(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=je(f[c],r[f[c].ref]));return f}Be.workerCount=2;const gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pe(f,r,c){c.push({command:gt.addSource,args:[f,r[f]]})}function Ye(f,r,c){r.push({command:gt.removeSource,args:[f]}),c[f]=!0}function bn(f,r,c,p){Ye(f,c,p),Pe(f,r,c)}function sn(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&"data"!==p&&!Ve(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&"data"!==p&&!Ve(f[c][p],r[c][p]))return!1;return!0}function Wt(f,r,c,p,y,v){let D;for(D in r=r||{},f=f||{})f.hasOwnProperty(D)&&(Ve(f[D],r[D])||c.push({command:v,args:[p,D,r[D],y]}));for(D in r)r.hasOwnProperty(D)&&!f.hasOwnProperty(D)&&(Ve(f[D],r[D])||c.push({command:v,args:[p,D,r[D],y]}))}function en(f){return f.id}function an(f,r){return f[r.id]=r,f}class uo{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=d.clamp(r,0,1);let c=1,p=this._distances[c];const y=r*this.paddedLength+this.padding;for(;p<y&&c<this._distances.length;)p=this._distances[++c];const v=c-1,D=this._distances[v],A=p-D,k=A>0?(y-D)/A:0;return this.points[v].mult(1-k).add(this.points[c].mult(k))}}class Dr{constructor(r,c,p){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let D=0;D<this.xCellCount*this.yCellCount;D++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,y,v){this._forEachCell(c,p,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(r,c,p,y){this._forEachCell(c-y,p-y,c+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(y)}_insertBoxCell(r,c,p,y,v,D){this.boxCells[v].push(D)}_insertCircleCell(r,c,p,y,v,D){this.circleCells[v].push(D)}_query(r,c,p,y,v,D){if(p<0||r>this.width||y<0||c>this.height)return!v&&[];const A=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=y){if(v)return!0;for(let k=0;k<this.boxKeys.length;k++)A.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const z=this.circles[3*k],V=this.circles[3*k+1],j=this.circles[3*k+2];A.push({key:this.circleKeys[k],x1:z-j,y1:V-j,x2:z+j,y2:V+j})}return D?A.filter(D):A}return this._forEachCell(r,c,p,y,this._queryCell,A,{hitTest:v,seenUids:{box:{},circle:{}}},D),v?A.length>0:A}_queryCircle(r,c,p,y,v){const D=r-p,A=r+p,k=c-p,z=c+p;if(A<0||D>this.width||z<0||k>this.height)return!y&&[];const V=[];return this._forEachCell(D,k,A,z,this._queryCellCircle,V,{hitTest:y,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},v),y?V.length>0:V}query(r,c,p,y,v){return this._query(r,c,p,y,!1,v)}hitTest(r,c,p,y,v){return this._query(r,c,p,y,!0,v)}hitTestCircle(r,c,p,y){return this._queryCircle(r,c,p,!0,y)}_queryCell(r,c,p,y,v,D,A,k){const z=A.seenUids,V=this.boxCells[v];if(null!==V){const Y=this.bboxes;for(const ee of V)if(!z.box[ee]){z.box[ee]=!0;const oe=4*ee;if(r<=Y[oe+2]&&c<=Y[oe+3]&&p>=Y[oe+0]&&y>=Y[oe+1]&&(!k||k(this.boxKeys[ee]))){if(A.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[ee],x1:Y[oe],y1:Y[oe+1],x2:Y[oe+2],y2:Y[oe+3]})}}}const j=this.circleCells[v];if(null!==j){const Y=this.circles;for(const ee of j)if(!z.circle[ee]){z.circle[ee]=!0;const oe=3*ee;if(this._circleAndRectCollide(Y[oe],Y[oe+1],Y[oe+2],r,c,p,y)&&(!k||k(this.circleKeys[ee]))){if(A.hitTest)return D.push(!0),!0;{const ne=Y[oe],de=Y[oe+1],re=Y[oe+2];D.push({key:this.circleKeys[ee],x1:ne-re,y1:de-re,x2:ne+re,y2:de+re})}}}}}_queryCellCircle(r,c,p,y,v,D,A,k){const z=A.circle,V=A.seenUids,j=this.boxCells[v];if(null!==j){const ee=this.bboxes;for(const oe of j)if(!V.box[oe]){V.box[oe]=!0;const ne=4*oe;if(this._circleAndRectCollide(z.x,z.y,z.radius,ee[ne+0],ee[ne+1],ee[ne+2],ee[ne+3])&&(!k||k(this.boxKeys[oe])))return D.push(!0),!0}}const Y=this.circleCells[v];if(null!==Y){const ee=this.circles;for(const oe of Y)if(!V.circle[oe]){V.circle[oe]=!0;const ne=3*oe;if(this._circlesCollide(ee[ne],ee[ne+1],ee[ne+2],z.x,z.y,z.radius)&&(!k||k(this.circleKeys[oe])))return D.push(!0),!0}}}_forEachCell(r,c,p,y,v,D,A,k){const z=this._convertToXCellCoord(r),V=this._convertToYCellCoord(c),j=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(y);for(let ee=z;ee<=j;ee++)for(let oe=V;oe<=Y;oe++)if(v.call(this,r,c,p,y,this.xCellCount*oe+ee,D,A,k))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,y,v,D){const A=y-r,k=v-c,z=p+D;return z*z>A*A+k*k}_circleAndRectCollide(r,c,p,y,v,D,A){const k=(D-y)/2,z=Math.abs(r-(y+k));if(z>k+p)return!1;const V=(A-v)/2,j=Math.abs(c-(v+V));if(j>V+p)return!1;if(z<=k||j<=V)return!0;const Y=z-k,ee=j-V;return Y*Y+ee*ee<=p*p}}const $e=Math.tan(85*Math.PI/180);function Ct(f,r,c,p,y){const v=d.create$1();if(r){const D=ct([],y);v[0]=D[0],v[1]=D[1],v[4]=D[2],v[5]=D[3],c||d.rotateZ(v,v,p.angle)}else d.multiply(v,p.labelPlaneMatrix,f);return v}function Rt(f,r,c,p,y){if(r){const v=d.clone$1(f),D=d.identity([]);return D[0]=y[0],D[1]=y[1],D[4]=y[2],D[5]=y[3],d.multiply(v,v,D),c||d.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function wn(f,r,c=0){const p=[f.x,f.y,c,1];c?d.transformMat4(p,p,r):ue(p,p,r);const y=p[3];return{point:new d.pointGeometry(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function pi(f,r){return Math.min(.5+f/r*.5,1.5)}function Ht(f,r){const c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function Yi(f,r,c,p,y,v,D,A,k){const z=p?f.textSizeData:f.iconSizeData,V=d.evaluateSizeForZoom(z,c.transform.zoom),j=[256/c.width*2+1,256/c.height*2+1],Y=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Y.clear();const ee=f.lineVertexArray,oe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ne=c.transform.width/c.transform.height;let de=!1;for(let re=0;re<oe.length;re++){const pe=oe.get(re);if(pe.writingMode!==d.WritingMode.vertical||de||0!==re&&oe.get(re-1).writingMode===d.WritingMode.horizontal||(de=!0),pe.hidden||pe.writingMode===d.WritingMode.vertical&&!de){ye(pe.numGlyphs,Y);continue}de=!1;const ge=new d.pointGeometry(pe.tileAnchorX,pe.tileAnchorY),se=k?k(ge):0,_e=[ge.x,ge.y,se],Ce=[..._e,1];if(d.transformMat4(Ce,Ce,r),!Ht(Ce,j)){ye(pe.numGlyphs,Y);continue}const Ze=pi(c.transform.cameraToCenterDistance,Ce[3]),Xe=d.evaluateSizeForFeature(z,V,pe),nt=D?Xe/Ze:Xe*Ze,rt=wn(new d.pointGeometry(_e[0],_e[1]),y,_e[2]);if(rt.signedDistanceFromCamera<=0){ye(pe.numGlyphs,Y);continue}let wt={};const et=D?null:k,Dt=jr(pe,nt,!1,A,r,y,v,f.glyphOffsetArray,ee,Y,rt.point,ge,wt,ne,et);de=Dt.useVertical,et&&Dt.needsFlipping&&(wt={}),(Dt.notEnoughRoom||de||Dt.needsFlipping&&jr(pe,nt,!0,A,r,y,v,f.glyphOffsetArray,ee,Y,rt.point,ge,wt,ne,et).notEnoughRoom)&&ye(pe.numGlyphs,Y)}p?f.text.dynamicLayoutVertexBuffer.updateData(Y):f.icon.dynamicLayoutVertexBuffer.updateData(Y)}function Qn(f,r,c,p,y,v,D,A,k,z,V,j,Y){const ee=A.glyphStartIndex+A.numGlyphs,oe=A.lineStartIndex,ne=A.lineStartIndex+A.lineLength,de=r.getoffsetX(A.glyphStartIndex),re=r.getoffsetX(ee-1),pe=Qr(f*de,c,p,y,v,D,A.segment,oe,ne,k,z,V,j,Y,!0);if(!pe)return null;const ge=Qr(f*re,c,p,y,v,D,A.segment,oe,ne,k,z,V,j,Y,!0);return ge?{first:pe,last:ge}:null}function Ui(f,r,c,p){return f.writingMode===d.WritingMode.horizontal&&Math.abs(c.y-r.y)>Math.abs(c.x-r.x)*p?{useVertical:!0}:f.writingMode===d.WritingMode.vertical?r.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(y,v,D){const A=(v.x-y.x)*D;return 0===A||Math.abs((v.y-y.y)/A)>$e}(r,c,p)?1===f.flipState?{needsFlipping:!0}:null:r.x>c.x?{needsFlipping:!0}:null}function jr(f,r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe){const ne=r/24,de=f.lineOffsetX*ne,re=f.lineOffsetY*ne;let pe;if(f.numGlyphs>1){const ge=f.glyphStartIndex+f.numGlyphs,se=f.lineStartIndex,_e=f.lineStartIndex+f.lineLength,Ce=Qn(ne,A,de,re,c,V,j,f,k,v,Y,oe,!1);if(!Ce)return{notEnoughRoom:!0};const Ze=wn(Ce.first.point,D).point,Xe=wn(Ce.last.point,D).point;if(p&&!c){const nt=Ui(f,Ze,Xe,ee);if(f.flipState=nt&&nt.needsFlipping?1:2,nt)return nt}pe=[Ce.first];for(let nt=f.glyphStartIndex+1;nt<ge-1;nt++)pe.push(Qr(ne*A.getoffsetX(nt),de,re,c,V,j,f.segment,se,_e,k,v,Y,oe,!1,!1));pe.push(Ce.last)}else{if(p&&!c){const se=wn(j,y).point,_e=f.lineStartIndex+f.segment+1,Ce=new d.pointGeometry(k.getx(_e),k.gety(_e)),Ze=wn(Ce,y),Xe=Ui(f,se,Ze.signedDistanceFromCamera>0?Ze.point:Go(j,Ce,se,1,y,void 0),ee);if(f.flipState=Xe&&Xe.needsFlipping?1:2,Xe)return Xe}const ge=Qr(ne*A.getoffsetX(f.glyphStartIndex),de,re,c,V,j,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,k,v,Y,oe,!1,!1);if(!ge)return{notEnoughRoom:!0};pe=[ge]}for(const ge of pe)d.addDynamicAttributes(z,ge.point,ge.angle);return{}}function Vt(f,r,c){const p={x:f.x,y:f.y,z:0};if(!c)return wn(p,r,p.z);const y=c(f);return wn(new d.pointGeometry(p.x,p.y),r,p.z+y)}function Go(f,r,c,p,y,v){const D=Vt(f.add(f.sub(r)._unit()),y,v).point,A=c.sub(D);return c.add(A._mult(p/A.mag()))}function Qr(f,r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe){const ne=p?f-r:f+r;let de=ne>0?1:-1,re=0;p&&(de*=-1,re=Math.PI),de<0&&(re+=Math.PI);let pe=de>0?A+D:A+D+1,ge=y,se=y,_e=0,Ce=0;const Ze=Math.abs(ne),Xe=[],nt=[];let rt=v;const wt=()=>{const Jt=pe-de;return 0===_e?v:new d.pointGeometry(z.getx(Jt),z.gety(Jt))},et=()=>Go(wt(),rt,se,Ze-_e+1,V,Y);for(;_e+Ce<=Ze;){if(pe+=de,pe<A||pe>=k)return null;if(se=ge,Xe.push(ge),ee&&nt.push(rt||wt()),ge=j[pe],void 0===ge){rt=new d.pointGeometry(z.getx(pe),z.gety(pe));const Jt=Vt(rt,V,Y);ge=Jt.signedDistanceFromCamera>0?j[pe]=Jt.point:et()}else rt=null;_e+=Ce,Ce=se.dist(ge)}oe&&Y&&(rt=rt||new d.pointGeometry(z.getx(pe),z.gety(pe)),j[pe]=ge=void 0===j[pe]?ge:et(),Ce=se.dist(ge));const Dt=(Ze-_e)/Ce,He=ge.sub(se),Tt=He.mult(Dt)._add(se);c&&Tt._add(He._unit()._perp()._mult(c*de));const Lt=re+Math.atan2(ge.y-se.y,ge.x-se.x);return Xe.push(Tt),ee&&(rt=rt||new d.pointGeometry(z.getx(pe),z.gety(pe)),nt.push(function(Jt,pn,rn){const ln=1-rn;return new d.pointGeometry(Jt.x*ln+pn.x*rn,Jt.y*ln+pn.y*rn)}(nt.length>0?nt[nt.length-1]:rt,rt,Dt))),{point:Tt,angle:Lt,path:Xe,tilePath:nt}}const De=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ye(f,r){for(let c=0;c<f;c++){const p=r.length;r.resize(p+4),r.float32.set(De,3*p)}}function ue(f,r,c){const p=r[0],y=r[1];return f[0]=c[0]*p+c[4]*y+c[12],f[1]=c[1]*p+c[5]*y+c[13],f[3]=c[3]*p+c[7]*y+c[15],f}const Ne=100;class qe{constructor(r,c,p=new Dr(r.width+200,r.height+200,25),y=new Dr(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ne,this.screenBottomBoundary=r.height+Ne,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,y,v,D,A){let k=c.projectedAnchorZ;c.elevation&&(k+=c.elevation);const z=this.projectAndGetPerspectiveRatio(D,c.projectedAnchorX,c.projectedAnchorY,k,c.tileID),V=v*z.perspectiveRatio,j=(c.x1*r+p.x-c.padding)*V+z.point.x,Y=(c.y1*r+p.y-c.padding)*V+z.point.y,ee=(c.x2*r+p.x+c.padding)*V+z.point.x,oe=(c.y2*r+p.y+c.padding)*V+z.point.y,ne=z.perspectiveRatio<=.55||z.aboveHorizon;return!this.isInsideGrid(j,Y,ee,oe)||!y&&this.grid.hitTest(j,Y,ee,oe,A)||ne?{box:[],offscreen:!1}:{box:[j,Y,ee,oe],offscreen:this.isOffscreen(j,Y,ee,oe)}}placeCollisionCircles(r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe){const ne=[],de=this.transform.elevation,re=de?et=>de.getAtTileOffset(oe,et.x,et.y):et=>0,pe=new d.pointGeometry(c.tileAnchorX,c.tileAnchorY),ge=re(pe),se=this.projectAndGetPerspectiveRatio(D,pe.x,pe.y,ge,oe),{perspectiveRatio:_e}=se,Ce=(V?v/_e:v*_e)/d.ONE_EM,Ze=wn(pe,A,ge).point,Xe=se.signedDistanceFromCamera>0?Qn(Ce,y,c.lineOffsetX*Ce,c.lineOffsetY*Ce,!1,Ze,pe,c,p,A,{},de&&!V?re:null,V&&!!de):null;let nt=!1,rt=!1,wt=!0;if(Xe&&!se.aboveHorizon){const et=.5*Y*_e+ee,Dt=new d.pointGeometry(-100,-100),He=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tt=new uo,Lt=Xe.first,Jt=Xe.last;let pn=[];for(let qt=Lt.path.length-1;qt>=1;qt--)pn.push(Lt.path[qt]);for(let qt=1;qt<Jt.path.length;qt++)pn.push(Jt.path[qt]);const rn=2.5*et;if(k){const qt=pn.map(de?(vn,Jn)=>{const gi=re(Jn<Lt.path.length-1?Lt.tilePath[Lt.path.length-1-Jn]:Jt.tilePath[Jn-Lt.path.length+2]);return wn(vn,k,gi)}:vn=>wn(vn,k));pn=qt.some(vn=>vn.signedDistanceFromCamera<=0)?[]:qt.map(vn=>vn.point)}let ln=[];if(pn.length>0){const qt=pn[0].clone(),vn=pn[0].clone();for(let Jn=1;Jn<pn.length;Jn++)qt.x=Math.min(qt.x,pn[Jn].x),qt.y=Math.min(qt.y,pn[Jn].y),vn.x=Math.max(vn.x,pn[Jn].x),vn.y=Math.max(vn.y,pn[Jn].y);ln=qt.x>=Dt.x&&vn.x<=He.x&&qt.y>=Dt.y&&vn.y<=He.y?[pn]:vn.x<Dt.x||qt.x>He.x||vn.y<Dt.y||qt.y>He.y?[]:d.clipLine([pn],Dt.x,Dt.y,He.x,He.y)}for(const qt of ln){Tt.reset(qt,.25*et);let vn=0;vn=Tt.length<=.5*et?1:Math.ceil(Tt.paddedLength/rn)+1;for(let Jn=0;Jn<vn;Jn++){const gi=Jn/Math.max(vn-1,1),Ii=Tt.lerp(gi),_o=Ii.x+Ne,Gi=Ii.y+Ne;ne.push(_o,Gi,et,0);const $r=_o-et,Lo=Gi-et,Qs=_o+et,En=Gi+et;if(wt=wt&&this.isOffscreen($r,Lo,Qs,En),rt=rt||this.isInsideGrid($r,Lo,Qs,En),!r&&this.grid.hitTestCircle(_o,Gi,et,j)&&(nt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:nt}}}}return{circles:!z&&nt||!rt?[]:ne,offscreen:wt,collisionDetected:nt}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let p=1/0,y=1/0,v=-1/0,D=-1/0;for(const V of r){const j=new d.pointGeometry(V.x+Ne,V.y+Ne);p=Math.min(p,j.x),y=Math.min(y,j.y),v=Math.max(v,j.x),D=Math.max(D,j.y),c.push(j)}const A=this.grid.query(p,y,v,D).concat(this.ignoredGrid.query(p,y,v,D)),k={},z={};for(const V of A){const j=V.key;if(void 0===k[j.bucketInstanceId]&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const Y=[new d.pointGeometry(V.x1,V.y1),new d.pointGeometry(V.x2,V.y1),new d.pointGeometry(V.x2,V.y2),new d.pointGeometry(V.x1,V.y2)];d.polygonIntersectsPolygon(c,Y)&&(k[j.bucketInstanceId][j.featureIndex]=!0,void 0===z[j.bucketInstanceId]&&(z[j.bucketInstanceId]=[]),z[j.bucketInstanceId].push(j.featureIndex))}return z}insertCollisionBox(r,c,p,y,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,y,v){const D=c?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:y,collisionGroupID:v};for(let k=0;k<r.length;k+=4)D.insertCircle(A,r[k],r[k+1],r[k+2])}projectAndGetPerspectiveRatio(r,c,p,y,v){const D=[c,p,y||0,1];let A=!1;if(y||this.transform.pitch>0){d.transformMat4(D,D,r);let k=!1;this.fogState&&v&&(k=function(z,V,j,Y,ee,oe){const ne=oe.calculateFogTileMatrix(ee),de=[V,j,Y];return d.transformMat4$1(de,de,ne),or(z,de,oe.pitch,oe._fov)}(this.fogState,c,p,y||0,v.toUnwrapped(),this.transform)>.9),A=D[2]>D[3]||k}else ue(D,D,r);return{point:new d.pointGeometry((D[0]/D[3]+1)/2*this.transform.width+Ne,(-D[1]/D[3]+1)/2*this.transform.height+Ne),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/D[3]*.5,1.5),signedDistanceFromCamera:D[3],aboveHorizon:A}}isOffscreen(r,c,p,y){return p<Ne||r>=this.screenRightBoundary||y<Ne||c>this.screenBottomBoundary}isInsideGrid(r,c,p,y){return p>=0&&r<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=d.identity([]);return d.translate(r,r,[-100,-100,0]),r}}class Gt{constructor(r,c,p,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):y&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class zt{constructor(r,c,p,y,v,D=!1){this.text=new Gt(r?r.text:null,c,p,v),this.icon=new Gt(r?r.icon:null,c,y,v),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fn{constructor(r,c,p,y=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=y}}class xr{constructor(){this.invProjMatrix=d.create$1(),this.viewportMatrix=d.create$1(),this.circles=[]}}class Ki{constructor(r,c,p,y,v){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=v}}class To{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function hr(f,r,c,p,y){const{horizontalAlign:v,verticalAlign:D}=d.getAnchorAlignment(f),A=-(v-.5)*r,k=-(D-.5)*c,z=d.evaluateVariableOffset(f,p);return new d.pointGeometry(A+z[0]*y,k+z[1]*y)}function ji(f,r,c,p,y){const v=new d.pointGeometry(f,r);return c&&v._rotate(p?y:-y),v}class Qi{constructor(r,c,p,y,v){this.transform=r.clone(),this.collisionIndex=new qe(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new To(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,y){const v=p.getBucket(c),D=p.latestFeatureIndex;if(!v||!D||c.id!==v.layerIds[0])return;const A=v.layers[0].layout,k=p.collisionBoxArray,z=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/d.EXTENT,j=p.tileID.toUnwrapped(),Y=this.transform.calculateProjMatrix(j),ee="map"===A.get("text-pitch-alignment"),oe="map"===A.get("text-rotation-alignment");c.compileFilter();const ne=c.dynamicFilter(),de=c.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(p),pe=Ct(Y,ee,oe,this.transform,re);let ge=null;if(ee){const Ce=Rt(Y,ee,oe,this.transform,re);ge=d.multiply([],this.transform.labelPlaneMatrix,Ce)}let se=null;ne&&p.latestFeatureIndex&&(se={unwrappedTileID:j,dynamicFilter:ne,dynamicFilterNeedsFeature:de,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Ki(v.bucketInstanceId,D,v.sourceLayerIndex,v.index,p.tileID);const _e={bucket:v,layout:A,posMatrix:Y,textLabelPlaneMatrix:pe,labelToScreenMatrix:ge,clippingData:se,scale:z,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const Ce of v.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:Xe,symbolInstanceEnd:nt}=Ce;r.push({sortKey:Ze,symbolInstanceStart:Xe,symbolInstanceEnd:nt,parameters:_e})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe,ne,de,re,pe){const ge=[Y.textOffset0,Y.textOffset1],se=hr(r,p,y,ge,v),_e=this.collisionIndex.placeCollisionBox(v,c,ji(se.x,se.y,D,A,this.transform.angle),j,k,z,V.predicate);if((!de||0!==this.collisionIndex.placeCollisionBox(oe.getSymbolInstanceIconSize(pe,this.transform.zoom,ee),de,ji(se.x,se.y,D,A,this.transform.angle),j,k,z,V.predicate).box.length)&&_e.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),this.variableOffsets[Y.crossTileID]={textOffset:ge,width:p,height:y,anchor:r,textScale:v,prevAnchor:Ce},this.markUsedJustification(oe,r,Y,ne),oe.allowVerticalPlacement&&(this.markUsedOrientation(oe,ne,Y),this.placedOrientations[Y.crossTileID]=ne),{shift:se,placedGlyphBoxes:_e}}}placeLayerBucketPart(r,c,p,y){const{bucket:v,layout:D,posMatrix:A,textLabelPlaneMatrix:k,labelToScreenMatrix:z,clippingData:V,textPixelRatio:j,holdingForFade:Y,collisionBoxArray:ee,partiallyEvaluatedTextSize:oe,partiallyEvaluatedIconSize:ne,collisionGroup:de}=r.parameters,re=D.get("text-optional"),pe=D.get("icon-optional"),ge=D.get("text-allow-overlap"),se=D.get("icon-allow-overlap"),_e="map"===D.get("text-rotation-alignment"),Ce="map"===D.get("text-pitch-alignment"),Ze="none"!==D.get("icon-text-fit"),Xe="viewport-y"===D.get("symbol-z-order"),nt=ge&&(se||!v.hasIconData()||pe),rt=se&&(ge||!v.hasTextData()||re);!v.collisionArrays&&ee&&v.deserializeCollisionBoxes(ee),p&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,ee);const wt=(et,Dt,He)=>{if(V){const En={zoom:this.transform.zoom,pitch:this.transform.pitch};let ti=null;if(V.dynamicFilterNeedsFeature){const Wn=this.retainedQueryData[v.bucketInstanceId];ti=V.featureIndex.loadFeature({featureIndex:et.featureIndex,bucketIndex:Wn.bucketIndex,sourceLayerIndex:Wn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,V.dynamicFilter)(En,ti,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new d.pointGeometry(et.tileAnchorX,et.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[et.crossTileID]=new Fn(!1,!1,!1,!0),void(c[et.crossTileID]=!0)}if(c[et.crossTileID])return;if(Y)return void(this.placements[et.crossTileID]=new Fn(!1,!1,!1));let Tt=!1,Lt=!1,Jt=!0,pn=null,rn={box:null,offscreen:null},ln={box:null,offscreen:null},qt=null,vn=null,Jn=null,gi=0,Ii=0,_o=0;He.textFeatureIndex?gi=He.textFeatureIndex:et.useRuntimeCollisionCircles&&(gi=et.featureIndex),He.verticalTextFeatureIndex&&(Ii=He.verticalTextFeatureIndex);const Gi=En=>{En.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||En.elevation)&&(En.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,En.tileAnchorX,En.tileAnchorY):0)},$r=He.textBox;if($r){Gi($r);const En=Wn=>{let lr=d.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Wn&&this.prevPlacement){const li=this.prevPlacement.placedOrientations[et.crossTileID];li&&(this.placedOrientations[et.crossTileID]=li,lr=li,this.markUsedOrientation(v,lr,et))}return lr},ti=(Wn,lr)=>{if(v.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&He.verticalTextBox){for(const li of v.writingModes)if(li===d.WritingMode.vertical?(rn=lr(),ln=rn):rn=Wn(),rn&&rn.box&&rn.box.length)break}else rn=Wn()};if(D.get("text-variable-anchor")){let Wn=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[et.crossTileID]){const Sr=this.prevPlacement.variableOffsets[et.crossTileID];Wn.indexOf(Sr.anchor)>0&&(Wn=Wn.filter(Oo=>Oo!==Sr.anchor),Wn.unshift(Sr.anchor))}const lr=(Sr,Oo,Kl)=>{const Zo=v.getSymbolInstanceTextSize(oe,et,this.transform.zoom,Dt),Wo=(Sr.x2-Sr.x1)*Zo+2*Sr.padding,Js=(Sr.y2-Sr.y1)*Zo+2*Sr.padding,hl=Ze&&!se?Oo:null;hl&&Gi(hl);let Xo={box:[],offscreen:!1};const uh=ge?2*Wn.length:Wn.length;for(let Ql=0;Ql<uh;++Ql){const Jl=this.attemptAnchorPlacement(Wn[Ql%Wn.length],Sr,Wo,Js,Zo,_e,Ce,j,A,de,Ql>=Wn.length,et,Dt,v,Kl,hl,oe,ne);if(Jl&&(Xo=Jl.placedGlyphBoxes,Xo&&Xo.box&&Xo.box.length)){Tt=!0,pn=Jl.shift;break}}return Xo};ti(()=>lr($r,He.iconBox,d.WritingMode.horizontal),()=>{const Sr=He.verticalTextBox;return Sr&&Gi(Sr),v.allowVerticalPlacement&&!(rn&&rn.box&&rn.box.length)&&et.numVerticalGlyphVertices>0&&Sr?lr(Sr,He.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),rn&&(Tt=rn.box,Jt=rn.offscreen);const li=En(rn&&rn.box);if(!Tt&&this.prevPlacement){const Sr=this.prevPlacement.variableOffsets[et.crossTileID];Sr&&(this.variableOffsets[et.crossTileID]=Sr,this.markUsedJustification(v,Sr.anchor,et,li))}}else{const Wn=(lr,li)=>{const Sr=v.getSymbolInstanceTextSize(oe,et,this.transform.zoom,Dt),Oo=this.collisionIndex.placeCollisionBox(Sr,lr,new d.pointGeometry(0,0),ge,j,A,de.predicate);return Oo&&Oo.box&&Oo.box.length&&(this.markUsedOrientation(v,li,et),this.placedOrientations[et.crossTileID]=li),Oo};ti(()=>Wn($r,d.WritingMode.horizontal),()=>{const lr=He.verticalTextBox;return v.allowVerticalPlacement&&et.numVerticalGlyphVertices>0&&lr?(Gi(lr),Wn(lr,d.WritingMode.vertical)):{box:null,offscreen:null}}),En(rn&&rn.box&&rn.box.length)}}if(qt=rn,Tt=qt&&qt.box&&qt.box.length>0,Jt=qt&&qt.offscreen,et.useRuntimeCollisionCircles){const En=v.text.placedSymbolArray.get(et.centerJustifiedTextSymbolIndex>=0?et.centerJustifiedTextSymbolIndex:et.verticalPlacedTextSymbolIndex),ti=d.evaluateSizeForFeature(v.textSizeData,oe,En),Wn=D.get("text-padding");vn=this.collisionIndex.placeCollisionCircles(ge,En,v.lineVertexArray,v.glyphOffsetArray,ti,A,k,z,p,Ce,de.predicate,et.collisionCircleDiameter*ti/d.ONE_EM,Wn,this.retainedQueryData[v.bucketInstanceId].tileID),Tt=ge||vn.circles.length>0&&!vn.collisionDetected,Jt=Jt&&vn.offscreen}if(He.iconFeatureIndex&&(_o=He.iconFeatureIndex),He.iconBox){const En=ti=>{Gi(ti);const Wn=Ze&&pn?ji(pn.x,pn.y,_e,Ce,this.transform.angle):new d.pointGeometry(0,0),lr=v.getSymbolInstanceIconSize(ne,this.transform.zoom,Dt);return this.collisionIndex.placeCollisionBox(lr,ti,Wn,se,j,A,de.predicate)};ln&&ln.box&&ln.box.length&&He.verticalIconBox?(Jn=En(He.verticalIconBox),Lt=Jn.box.length>0):(Jn=En(He.iconBox),Lt=Jn.box.length>0),Jt=Jt&&Jn.offscreen}const Lo=re||0===et.numHorizontalGlyphVertices&&0===et.numVerticalGlyphVertices,Qs=pe||0===et.numIconVertices;if(Lo||Qs?Qs?Lo||(Lt=Lt&&Tt):Tt=Lt&&Tt:Lt=Tt=Lt&&Tt,Tt&&qt&&qt.box&&this.collisionIndex.insertCollisionBox(qt.box,D.get("text-ignore-placement"),v.bucketInstanceId,ln&&ln.box&&Ii?Ii:gi,de.ID),Lt&&Jn&&this.collisionIndex.insertCollisionBox(Jn.box,D.get("icon-ignore-placement"),v.bucketInstanceId,_o,de.ID),vn&&(Tt&&this.collisionIndex.insertCollisionCircles(vn.circles,D.get("text-ignore-placement"),v.bucketInstanceId,gi,de.ID),p)){const En=v.bucketInstanceId;let ti=this.collisionCircleArrays[En];void 0===ti&&(ti=this.collisionCircleArrays[En]=new xr);for(let Wn=0;Wn<vn.circles.length;Wn+=4)ti.circles.push(vn.circles[Wn+0]),ti.circles.push(vn.circles[Wn+1]),ti.circles.push(vn.circles[Wn+2]),ti.circles.push(vn.collisionDetected?1:0)}this.placements[et.crossTileID]=new Fn(Tt||nt,Lt||rt,Jt||v.justReloaded),c[et.crossTileID]=!0};if(Xe){const et=v.getSortedSymbolIndexes(this.transform.angle);for(let Dt=et.length-1;Dt>=0;--Dt){const He=et[Dt];wt(v.symbolInstances.get(He),He,v.collisionArrays[He])}}else for(let et=r.symbolInstanceStart;et<r.symbolInstanceEnd;et++)wt(v.symbolInstances.get(et),et,v.collisionArrays[et]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const et=this.collisionCircleArrays[v.bucketInstanceId];d.invert(et.invProjMatrix,A),et.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(r,c,p,y){let v;v=y===d.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(c)];const D=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of D)A>=0&&(r.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:p.crossTileID)}markUsedOrientation(r,c,p){const y=c===d.WritingMode.horizontal||c===d.WritingMode.horizontalOnly?c:0,v=c===d.WritingMode.vertical?c:0,D=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of D)r.text.placedSymbolArray.get(A).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(r):1,v=c?c.opacities:{},D=c?c.variableOffsets:{},A=c?c.placedOrientations:{};for(const k in this.placements){const z=this.placements[k],V=v[k];V?(this.opacities[k]=new zt(V,y,z.text,z.icon,null,z.clipped),p=p||z.text!==V.text.placed||z.icon!==V.icon.placed):(this.opacities[k]=new zt(null,y,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const k in v){const z=v[k];if(!this.opacities[k]){const V=new zt(z,y,!1,!1);V.isHidden()||(this.opacities[k]=V,p=p||z.text.placed||z.icon.placed)}}for(const k in D)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=D[k]);for(const k in A)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=A[k]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const p={};for(const y of c){const v=y.getBucket(r);v&&y.latestFeatureIndex&&r.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,y.collisionBoxArray)}}updateBucketOpacities(r,c,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const y=r.layers[0].layout,v=!!r.layers[0].dynamicFilter(),D=new zt(null,0,!1,!1,!0),A=y.get("text-allow-overlap"),k=y.get("icon-allow-overlap"),z=y.get("text-variable-anchor"),V="map"===y.get("text-rotation-alignment"),j="map"===y.get("text-pitch-alignment"),Y="none"!==y.get("icon-text-fit"),ee=new zt(null,0,A&&(k||!r.hasIconData()||y.get("icon-optional")),k&&(A||!r.hasTextData()||y.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const oe=(ne,de,re)=>{for(let pe=0;pe<de/4;pe++)ne.opacityVertexArray.emplaceBack(re)};for(let ne=0;ne<r.symbolInstances.length;ne++){const de=r.symbolInstances.get(ne),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:pe,crossTileID:ge}=de;let se=this.opacities[ge];c[ge]?se=D:se||(se=ee,this.opacities[ge]=se),c[ge]=!0;const _e=de.numIconVertices>0,Ce=this.placedOrientations[de.crossTileID],Ze=Ce===d.WritingMode.vertical,Xe=Ce===d.WritingMode.horizontal||Ce===d.WritingMode.horizontalOnly;if(re>0||pe>0){const nt=Ka(se.text);oe(r.text,re,Ze?xi:nt),oe(r.text,pe,Xe?xi:nt);const rt=se.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(Dt=>{Dt>=0&&(r.text.placedSymbolArray.get(Dt).hidden=rt||Ze?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=rt||Xe?1:0);const wt=this.variableOffsets[de.crossTileID];wt&&this.markUsedJustification(r,wt.anchor,de,Ce);const et=this.placedOrientations[de.crossTileID];et&&(this.markUsedJustification(r,"left",de,et),this.markUsedOrientation(r,et,de))}if(_e){const nt=Ka(se.icon);de.placedIconSymbolIndex>=0&&(oe(r.icon,de.numIconVertices,Ze?xi:nt),r.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=se.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(oe(r.icon,de.numVerticalIconVertices,Xe?xi:nt),r.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const nt=r.collisionArrays[ne];if(nt){let rt=new d.pointGeometry(0,0),wt=!0;if(nt.textBox||nt.verticalTextBox){if(z){const Dt=this.variableOffsets[ge];Dt?(rt=hr(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textScale),V&&rt._rotate(j?this.transform.angle:-this.transform.angle)):wt=!1}v&&(wt=!se.clipped),nt.textBox&&fn(r.textCollisionBox.collisionVertexArray,se.text.placed,!wt||Ze,rt.x,rt.y),nt.verticalTextBox&&fn(r.textCollisionBox.collisionVertexArray,se.text.placed,!wt||Xe,rt.x,rt.y)}const et=wt&&Boolean(!Xe&&nt.verticalIconBox);nt.iconBox&&fn(r.iconCollisionBox.collisionVertexArray,se.icon.placed,et,Y?rt.x:0,Y?rt.y:0),nt.verticalIconBox&&fn(r.iconCollisionBox.collisionVertexArray,se.icon.placed,!et,Y?rt.x:0,Y?rt.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=ne.invProjMatrix,r.placementViewportMatrix=ne.viewportMatrix,r.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function fn(f,r,c,p,y){f.emplaceBack(r?1:0,c?1:0,p||0,y||0),f.emplaceBack(r?1:0,c?1:0,p||0,y||0),f.emplaceBack(r?1:0,c?1:0,p||0,y||0),f.emplaceBack(r?1:0,c?1:0,p||0,y||0)}const Vs=Math.pow(2,25),Or=Math.pow(2,24),mi=Math.pow(2,17),Us=Math.pow(2,16),Ia=Math.pow(2,9),ho=Math.pow(2,8),ki=Math.pow(2,1);function Ka(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Vs+r*Or+c*mi+r*Us+c*Ia+r*ho+c*ki+r}const xi=0;class Sa{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,c,p,y,v){const D=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(D,y,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((A,k)=>A.sortKey-k.sortKey));this._currentPartIndex<D.length;){const A=D[this._currentPartIndex];if(c.placeLayerBucketPart(A,this._seenCrossTileIDs,p,0===A.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class es{constructor(r,c,p,y,v,D,A,k){this.placement=new Qi(r,v,D,A,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p){const y=d.exported.now(),v=()=>{const D=d.exported.now()-y;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=c[r[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=A)&&(!D.maxzoom||D.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Sa(D)),this._inProgressLayer.continuePlacement(p[D.source],this.placement,this._showCollisionBoxes,D,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Pl=512/d.EXTENT/2;class Aa{constructor(r,c,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let y=0;y<c.length;y++){const v=c.get(y),D=v.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,r)})}}getScaledCoordinates(r,c){const p=Pl/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*d.EXTENT+r.tileAnchorX)*p),y:Math.floor((c.canonical.y*d.EXTENT+r.tileAnchorY)*p)}}findMatches(r,c,p){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<r.length;v++){const D=r.get(v);if(D.crossTileID)continue;const A=this.indexedSymbolInstances[D.key];if(!A)continue;const k=this.getScaledCoordinates(D,c);for(const z of A)if(Math.abs(z.coord.x-k.x)<=y&&Math.abs(z.coord.y-k.y)<=y&&!p[z.crossTileID]){p[z.crossTileID]=!0,D.crossTileID=z.crossTileID;break}}}}class Rl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const p in this.indexes){const y=this.indexes[p],v={};for(const D in y){const A=y[D];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+c),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const y=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const D=this.indexes[v];if(Number(v)>r.overscaledZ)for(const A in D){const k=D[A];k.tileID.isChildOf(r)&&k.findMatches(c.symbolInstances,r,y)}else{const A=D[r.scaledTo(Number(v)).key];A&&A.findMatches(c.symbolInstances,r,y)}}for(let v=0;v<c.symbolInstances.length;v++){const D=c.symbolInstances.get(v);D.crossTileID||(D.crossTileID=p.generate(),y[D.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Aa(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][y.crossTileID]}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const y=this.indexes[p];for(const v in y)r[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[v]),delete y[v],c=!0)}return c}}class fo{constructor(){this.layerIndexes={},this.crossTileIDs=new Rl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p){let y=this.layerIndexes[r.id];void 0===y&&(y=this.layerIndexes[r.id]=new kl);let v=!1;const D={};y.handleWrapJump(p);for(const A of c){const k=A.getBucket(r);k&&r.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,k,this.crossTileIDs)&&(v=!0),D[k.bucketInstanceId]=!0)}return y.removeStaleBuckets(D)&&(v=!0),v}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const ts=(f,r)=>d.emitValidationErrors(f,r&&r.filter(c=>"source.canvas"!==c.identifier)),Qa=d.pick(gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),mc=d.pick(gt,["setCenter","setZoom","setBearing","setPitch"]),gc=function(){const f={},r=d.spec.$version;for(const c in d.spec.$root){const p=d.spec.$root[c];if(p.required){let y=null;y="version"===c?r:"array"===p.type?[]:{},null!=y&&(f[c]=y)}}return f}(),ps={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Fi extends d.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Zr(yt(),this),this.imageManager=new ii,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(r._requestManager,c.localFontFamily?d.LocalGlyphMode.all:c.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new fo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const p=this;this._rtlTextPluginCallback=Fi.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,D)=>{if(d.triggerPluginCompletionEvent(v),D&&D.every(A=>A))for(const A in p._sourceCaches){const k=p._sourceCaches[A],z=k.getSource().type;"vector"!==z&&"geojson"!==z||k.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const D in this._layers){const A=this._layers[D];A.source===v.id&&this._validateLayer(A)}})}loadURL(r,c={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof c.validate?c.validate:!d.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const y=this.map._requestManager.transformRequest(r,d.ResourceType.Style);this._request=d.getJSON(y,(v,D)=>{this._request=null,v?this.fire(new d.ErrorEvent(v)):D&&this._load(D,p)})}loadJSON(r,c={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(gc,!1)}_updateLayerCount(r,c){const p=c?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,c){if(c&&ts(this,d.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r,this.updateProjection();for(const y in r.sources)this.addSource(y,r.sources[y],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=Ut(this.stylesheet.layers);this._order=p.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of p)y=d.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Pr(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const r=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),r){this.map.painter.clearBackgroundTiles();for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles();this.map._update(!0)}}_loadSprite(r){this._spriteRequest=function(c,p,y){let v,D,A;const k=d.exported.devicePixelRatio>1?"@2x":"";let z=d.getJSON(p.transformRequest(p.normalizeSpriteURL(c,k,".json"),d.ResourceType.SpriteJSON),(Y,ee)=>{z=null,A||(A=Y,v=ee,j())}),V=d.getImage(p.transformRequest(p.normalizeSpriteURL(c,k,".png"),d.ResourceType.SpriteImage),(Y,ee)=>{V=null,A||(A=Y,D=ee,j())});function j(){if(A)y(A);else if(v&&D){const Y=d.exported.getImageData(D),ee={};for(const oe in v){const{width:ne,height:de,x:re,y:pe,sdf:ge,pixelRatio:se,stretchX:_e,stretchY:Ce,content:Ze}=v[oe],Xe=new d.RGBAImage({width:ne,height:de});d.RGBAImage.copy(Y,Xe,{x:re,y:pe},{x:0,y:0},{width:ne,height:de}),ee[oe]={data:Xe,pixelRatio:se,sdf:ge,stretchX:_e,stretchY:Ce,content:Ze}}y(null,ee)}}return{cancel(){z&&(z.cancel(),z=null),V&&(V.cancel(),V=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new d.ErrorEvent(c));else if(p)for(const y in p)this.imageManager.addImage(y,p[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const p=r.sourceLayer;p&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(p))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const p of r){const y=this._layers[p];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&ps[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const D in this._updatedSources){const A=this._updatedSources[D];"reload"===A?this._reloadSource(D):"clear"===A&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];p[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(r,this._availableImages),!v.isHidden(r.zoom)){const A=this._getLayerSourceCache(v);A&&(A.used=!0)}const D=this.map.painter;if(D){const A=v.getProgramIds();if(!A)continue;const k=v.getProgramConfiguration(r.zoom);for(const z of A)D.useProgram(z,k)}}for(const y in p){const v=this._sourceCaches[y];p[y]!==v.used&&v.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ts(this,d.validateStyle(r)))return!1;(r=d.clone$2(r)).layers=Ut(r.layers);const c=function(y,v){if(!y)return[{command:gt.setStyle,args:[v]}];let D=[];try{if(!Ve(y.version,v.version))return[{command:gt.setStyle,args:[v]}];Ve(y.center,v.center)||D.push({command:gt.setCenter,args:[v.center]}),Ve(y.zoom,v.zoom)||D.push({command:gt.setZoom,args:[v.zoom]}),Ve(y.bearing,v.bearing)||D.push({command:gt.setBearing,args:[v.bearing]}),Ve(y.pitch,v.pitch)||D.push({command:gt.setPitch,args:[v.pitch]}),Ve(y.sprite,v.sprite)||D.push({command:gt.setSprite,args:[v.sprite]}),Ve(y.glyphs,v.glyphs)||D.push({command:gt.setGlyphs,args:[v.glyphs]}),Ve(y.transition,v.transition)||D.push({command:gt.setTransition,args:[v.transition]}),Ve(y.light,v.light)||D.push({command:gt.setLight,args:[v.light]}),Ve(y.fog,v.fog)||D.push({command:gt.setFog,args:[v.fog]}),Ve(y.projection,v.projection)||D.push({command:gt.setProjection,args:[v.projection]});const A={},k=[];!function(j,Y,ee,oe){let ne;for(ne in Y=Y||{},j=j||{})j.hasOwnProperty(ne)&&(Y.hasOwnProperty(ne)||Ye(ne,ee,oe));for(ne in Y)Y.hasOwnProperty(ne)&&(j.hasOwnProperty(ne)?Ve(j[ne],Y[ne])||("geojson"===j[ne].type&&"geojson"===Y[ne].type&&sn(j,Y,ne)?ee.push({command:gt.setGeoJSONSourceData,args:[ne,Y[ne].data]}):bn(ne,Y,ee,oe)):Pe(ne,Y,ee))}(y.sources,v.sources,k,A);const z=[];y.layers&&y.layers.forEach(j=>{A[j.source]?D.push({command:gt.removeLayer,args:[j.id]}):z.push(j)});let V=y.terrain;V&&A[V.source]&&(D.push({command:gt.setTerrain,args:[void 0]}),V=void 0),D=D.concat(k),Ve(V,v.terrain)||D.push({command:gt.setTerrain,args:[v.terrain]}),function(j,Y,ee){Y=Y||[];const oe=(j=j||[]).map(en),ne=Y.map(en),de=j.reduce(an,{}),re=Y.reduce(an,{}),pe=oe.slice(),ge=Object.create(null);let se,_e,Ce,Ze,Xe,nt,rt;for(se=0,_e=0;se<oe.length;se++)Ce=oe[se],re.hasOwnProperty(Ce)?_e++:(ee.push({command:gt.removeLayer,args:[Ce]}),pe.splice(pe.indexOf(Ce,_e),1));for(se=0,_e=0;se<ne.length;se++)Ce=ne[ne.length-1-se],pe[pe.length-1-se]!==Ce&&(de.hasOwnProperty(Ce)?(ee.push({command:gt.removeLayer,args:[Ce]}),pe.splice(pe.lastIndexOf(Ce,pe.length-_e),1)):_e++,nt=pe[pe.length-se],ee.push({command:gt.addLayer,args:[re[Ce],nt]}),pe.splice(pe.length-se,0,Ce),ge[Ce]=!0);for(se=0;se<ne.length;se++)if(Ce=ne[se],Ze=de[Ce],Xe=re[Ce],!ge[Ce]&&!Ve(Ze,Xe))if(Ve(Ze.source,Xe.source)&&Ve(Ze["source-layer"],Xe["source-layer"])&&Ve(Ze.type,Xe.type)){for(rt in Wt(Ze.layout,Xe.layout,ee,Ce,null,gt.setLayoutProperty),Wt(Ze.paint,Xe.paint,ee,Ce,null,gt.setPaintProperty),Ve(Ze.filter,Xe.filter)||ee.push({command:gt.setFilter,args:[Ce,Xe.filter]}),Ve(Ze.minzoom,Xe.minzoom)&&Ve(Ze.maxzoom,Xe.maxzoom)||ee.push({command:gt.setLayerZoomRange,args:[Ce,Xe.minzoom,Xe.maxzoom]}),Ze)Ze.hasOwnProperty(rt)&&"layout"!==rt&&"paint"!==rt&&"filter"!==rt&&"metadata"!==rt&&"minzoom"!==rt&&"maxzoom"!==rt&&(0===rt.indexOf("paint.")?Wt(Ze[rt],Xe[rt],ee,Ce,rt.slice(6),gt.setPaintProperty):Ve(Ze[rt],Xe[rt])||ee.push({command:gt.setLayerProperty,args:[Ce,rt,Xe[rt]]}));for(rt in Xe)Xe.hasOwnProperty(rt)&&!Ze.hasOwnProperty(rt)&&"layout"!==rt&&"paint"!==rt&&"filter"!==rt&&"metadata"!==rt&&"minzoom"!==rt&&"maxzoom"!==rt&&(0===rt.indexOf("paint.")?Wt(Ze[rt],Xe[rt],ee,Ce,rt.slice(6),gt.setPaintProperty):Ve(Ze[rt],Xe[rt])||ee.push({command:gt.setLayerProperty,args:[Ce,rt,Xe[rt]]}))}else ee.push({command:gt.removeLayer,args:[Ce]}),nt=pe[pe.lastIndexOf(Ce)+1],ee.push({command:gt.addLayer,args:[Xe,nt]})}(z,v.layers,D)}catch(A){console.warn("Unable to compute style diff:",A),D=[{command:gt.setStyle,args:[v]}]}return D}(this.serialize(),r).filter(y=>!(y.command in mc));if(0===c.length)return!1;const p=c.filter(y=>!(y.command in Qa));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=r,!0}addImage(r,c){if(this.getImage(r))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(r,c),this._afterImageUpdated(r)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(d.validateStyle.source,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=q(r,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:r}));const v=D=>{const A=(D?"symbol:":"other:")+r,k=this._sourceCaches[A]=new d.SourceCache(A,y,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[r]=k,k.style=this,k.onAdd(this.map)};v(!1),"vector"!==c.type&&"geojson"!==c.type||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new d.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const y of p)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}addLayer(r,c,p={}){this._checkLoaded();const y=r.id;if(this.getLayer(y))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if("custom"===r.type){if(ts(this,d.validateCustomStyleLayer(r)))return;v=d.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(y,r.source),r=d.clone$2(r),r=d.extend(r,{source:y})),this._validate(d.validateStyle.layer,`layers.${y}`,r,{arrayIndex:-1},p))return;v=d.createStyleLayer(r),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const D=c?this._order.indexOf(c):this._order.length;if(c&&-1===D)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(D,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const A=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&A&&"custom"!==v.type){const k=this._removedLayers[y];delete this._removedLayers[y],k.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",A.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const p=this._order.indexOf(r);this._order.splice(p,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const y=this.getLayer(r);y?y.minzoom===c&&y.maxzoom===p||(null!=c&&(y.minzoom=c),null!=p&&(y.maxzoom=p),this._updateLayer(y)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,p={}){this._checkLoaded();const y=this.getLayer(r);if(y){if(!Ve(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(d.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},p)||(y.filter=d.clone$2(c),this._updateLayer(y)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){return d.clone$2(this.getLayer(r).filter)}setLayoutProperty(r,c,p,y={}){this._checkLoaded();const v=this.getLayer(r);v?Ve(v.getLayoutProperty(c),p)||(v.setLayoutProperty(c,p,y),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const p=this.getLayer(r);if(p)return p.getLayoutProperty(c);this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,p,y={}){this._checkLoaded();const v=this.getLayer(r);v?Ve(v.getPaintProperty(c),p)||(v.setPaintProperty(c,p,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){return this.getLayer(r).getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const p=r.source,y=r.sourceLayer,v=this.getSource(p);if(void 0===v)return void this.fire(new d.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const D=v.type;if("geojson"===D&&y)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!y)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const A=this._getSourceCaches(p);for(const k of A)k.setFeatureState(y,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const p=r.source,y=this.getSource(p);if(void 0===y)return void this.fire(new d.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=y.type,D="vector"===v?r.sourceLayer:void 0;if("vector"===v&&!D)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const A=this._getSourceCaches(p);for(const k of A)k.removeFeatureState(D,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,p=r.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||p)return void 0===r.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=D=>"fill-extrusion"===this._layers[D].type,p={},y=[];for(let D=this._order.length-1;D>=0;D--){const A=this._order[D];if(c(A)){p[A]=D;for(const k of r){const z=k[A];if(z)for(const V of z)y.push(V)}}}y.sort((D,A)=>A.intersectionZ-D.intersectionZ);const v=[];for(let D=this._order.length-1;D>=0;D--){const A=this._order[D];if(c(A))for(let k=y.length-1;k>=0;k--){const z=y[k].feature;if(p[z.layer.id]<D)break;v.push(z),y.pop()}else for(const k of r){const z=k[A];if(z)for(const V of z)v.push(V.feature)}}return v}queryRenderedFeatures(r,c,p){c&&c.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of c.layers){const z=this._layers[k];if(!z)return this.fire(new d.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const v=[];c.availableImages=this._availableImages;const D=c&&c.layers?c.layers.some(k=>{const z=this.getLayer(k);return z&&z.is3D()}):this.has3DLayers(),A=jo.createFromScreenPoints(r,p);for(const k in this._sourceCaches){const z=this._sourceCaches[k].getSource().id;c.layers&&!y[z]||v.push(he(this._sourceCaches[k],this._layers,this._serializedLayers,A,c,p,D,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(k,z,V,j,Y,ee,oe){const ne={},de=ee.queryRenderedSymbols(j),re=[];for(const pe of Object.keys(de).map(Number))re.push(oe[pe]);re.sort(Le);for(const pe of re){const ge=pe.featureIndex.lookupSymbolFeatures(de[pe.bucketInstanceId],z,pe.bucketIndex,pe.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,k);for(const se in ge){const _e=ne[se]=ne[se]||[],Ce=ge[se];Ce.sort((Ze,Xe)=>{const nt=pe.featureSortOrder;if(nt){const rt=nt.indexOf(Ze.featureIndex);return nt.indexOf(Xe.featureIndex)-rt}return Xe.featureIndex-Ze.featureIndex});for(const Ze of Ce)_e.push(Ze)}}for(const pe in ne)ne[pe].forEach(ge=>{const se=ge.feature,_e=V(k[pe]).getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=_e});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),A.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(r,c){c&&c.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const p=this._getSourceCaches(r);let y=[];for(const v of p)y=y.concat(be(v,c));return y}addSourceType(r,c,p){return Fi.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Fi.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const p=this.light.getLight();let y=!1;for(const D in r)if(!Ve(r[D],p[D])){y=!0;break}if(!y)return;const v={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(r){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof r.source){const c="terrain-dem-src";this.addSource(c,r.source),r=d.clone$2(r),r=d.extend(r,{source:c})}if(!this._validate(d.validateStyle.terrain,"terrain",r)){if(this.terrain){const c=this.terrain,p=c.get();for(const y in r)if(!Ve(r[y],p[y])){c.set(r),this.stylesheet.terrain=r;const v={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(v);break}}else this._createTerrain(r);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(r){const c=this.fog=new Et(r,this.map.transform);this.stylesheet.fog=r;const p={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,p=c.get();for(const y in r)if(!Ve(r[y],p[y])){c.set(r),this.stylesheet.fog=r;const v={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(v);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),c=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r){const c=this.terrain=new Mn(r);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(p)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_validate(r,c,p,y,v={}){return(!v||!1!==v.validate)&&ts(this,r.call(d.validateStyle,d.extend({key:c,style:this.serialize(),value:p,styleSpec:d.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const p of c)p.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const p of c)p.resume(),p.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,y,v=!1){let D=!1,A=!1;const k={};for(const z of this._order){const V=this._layers[z];if("symbol"!==V.type)continue;if(!k[V.source]){const Y=this._getLayerSourceCache(V);if(!Y)continue;k[V.source]=Y.getRenderableIds(!0).map(ee=>Y.getTileByID(ee)).sort((ee,oe)=>oe.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(oe.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(V,k[V.source],r.center.lng);D=D||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),r.zoom))&&(this.pauseablePlacement=new es(r,this._order,v,c,p,y,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),A=!0),D&&this.pauseablePlacement.placement.setStale()),A||D)for(const z of this._order){const V=this._layers[z];"symbol"===V.type&&this.placement.updateLayerOpacities(V,k[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return d.makeRequest(c,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}Fi.getSourceType=function(f){return $[f]},Fi.setSourceType=function(f,r){$[f]=r},Fi.registerForPluginStateChange=d.registerForPluginStateChange;var Fl="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ma="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ia={},Do={};ia=Un("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Do=Un("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const po=Un("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ms=Fl;var oa={background:Un("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Un("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Un("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Un("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Un("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Un("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Un("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Un("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Un("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Un("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Un("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Un("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Un("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Un("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Un("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Un("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Un("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Un("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ma),skyboxGradient:Un("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ma),skyboxCapture:Un("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Un("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Un("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Un("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Un(f,r,c){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),D=f.match(y),A=r.match(y),k=Fl.match(y);let z=A?A.concat(D):D;c||(ia.staticUniforms&&(z=ia.staticUniforms.concat(z)),Do.staticUniforms&&(z=Do.staticUniforms.concat(z))),z&&(z=z.concat(k));const V={};return{fragmentSource:f=f.replace(p,(j,Y,ee,oe,ne)=>(V[ne]=!0,"define"===Y?`\n#ifndef HAS_UNIFORM_u_${ne}\nvarying ${ee} ${oe} ${ne};\n#else\nuniform ${ee} ${oe} u_${ne};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ne}\n    ${ee} ${oe} ${ne} = u_${ne};\n#endif\n`)),vertexSource:r=r.replace(p,(j,Y,ee,oe,ne)=>{const de="float"===oe?"vec2":"vec4",re=ne.match(/color/)?"color":de;return V[ne]?"define"===Y?`\n#ifndef HAS_UNIFORM_u_${ne}\nuniform lowp float u_${ne}_t;\nattribute ${ee} ${de} a_${ne};\nvarying ${ee} ${oe} ${ne};\n#else\nuniform ${ee} ${oe} u_${ne};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ne} = a_${ne};\n#else\n    ${ee} ${oe} ${ne} = u_${ne};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ne} = unpack_mix_${re}(a_${ne}, u_${ne}_t);\n#else\n    ${ee} ${oe} ${ne} = u_${ne};\n#endif\n`:"define"===Y?`\n#ifndef HAS_UNIFORM_u_${ne}\nuniform lowp float u_${ne}_t;\nattribute ${ee} ${de} a_${ne};\n#else\nuniform ${ee} ${oe} u_${ne};\n#endif\n`:"vec4"===re?`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ee} ${oe} ${ne} = a_${ne};\n#else\n    ${ee} ${oe} ${ne} = u_${ne};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ne}\n    ${ee} ${oe} ${ne} = unpack_mix_${re}(a_${ne}, u_${ne}_t);\n#else\n    ${ee} ${oe} ${ne} = u_${ne};\n#endif\n`}),staticAttributes:v,staticUniforms:z}}class Ji{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,c,p,y,v,D,A,k){this.context=r;let z=this.boundPaintVertexBuffers.length!==y.length;for(let V=0;!z&&V<y.length;V++)this.boundPaintVertexBuffers[V]!==y[V]&&(z=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===k?(r.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),k&&k.bind()):this.freshBind(c,p,y,v,D,A,k)}freshBind(r,c,p,y,v,D,A){let k;const z=r.numAttributes,V=this.context,j=V.gl;if(V.extVertexArrayObject)this.vao&&this.destroy(),this.vao=V.extVertexArrayObject.createVertexArrayOES(),V.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=A;else{k=V.currentNumAttributes||0;for(let Y=z;Y<k;Y++)j.disableVertexAttribArray(Y)}c.enableAttributes(j,r);for(const Y of p)Y.enableAttributes(j,r);D&&D.enableAttributes(j,r),A&&A.enableAttributes(j,r),c.bind(),c.setVertexAttribPointers(j,r,v);for(const Y of p)Y.bind(),Y.setVertexAttribPointers(j,r,v);D&&(D.bind(),D.setVertexAttribPointers(j,r,v)),y&&y.bind(),A&&(A.bind(),A.setVertexAttribPointers(j,r,v)),V.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sa(f,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new d.MercatorCoordinate(0,p/c).toLngLat().lat,new d.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}function Pa(f,r,c,p,y,v,D){const A=f.context,k=A.gl,z=c.fbo;if(!z)return;f.prepareDrawTile(r);const V=f.useProgram("hillshade");A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,z.colorAttachment.get());const j=((ne,de,re,pe)=>{const ge=re.paint.get("hillshade-shadow-color"),se=re.paint.get("hillshade-highlight-color"),_e=re.paint.get("hillshade-accent-color");let Ce=re.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===re.paint.get("hillshade-illumination-anchor")&&(Ce-=ne.transform.angle);const Ze=!ne.options.moving;return{u_matrix:pe||ne.transform.calculateProjMatrix(de.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:sa(0,de.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Ce],u_shadow:ge,u_highlight:se,u_accent:_e}})(f,c,p,f.terrain?r.projMatrix:null);f.prepareDrawProgram(A,V,r.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ee,tileBoundsSegments:oe}=f.getTileBoundsBuffers(c);V.draw(A,k.TRIANGLES,y,v,D,d.CullFaceMode.disabled,j,p.id,Y,ee,oe)}function aa(f,r,c){if(!r.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const v=c.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new d.Texture(p,v,y.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function la(f,r,c,p,y,v){const D=f.context,A=D.gl;if(!r.dem)return;const k=r.dem;if(D.activeTexture.set(A.TEXTURE1),aa(f,r,k),!r.demTexture)return;r.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);const z=k.dim;D.activeTexture.set(A.TEXTURE0);let V=r.fbo;if(!V){const oe=new d.Texture(D,{width:z,height:z,data:null},A.RGBA);oe.bind(A.LINEAR,A.CLAMP_TO_EDGE),V=r.fbo=D.createFramebuffer(z,z,!0),V.colorAttachment.set(oe.texture)}D.bindFramebuffer.set(V.framebuffer),D.viewport.set([0,0,z,z]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:ee}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(D,A.TRIANGLES,p,y,v,d.CullFaceMode.disabled,((oe,ne)=>{const de=ne.stride,re=d.create$1();return d.ortho(re,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(re,re,[0,-d.EXTENT,0]),{u_matrix:re,u_image:1,u_dimension:[de,de],u_zoom:oe.overscaledZ,u_unpack:ne.unpackVector}})(r.tileID,k),c.id,j,Y,ee),r.needsHillshadePrepare=!1}const Ln=(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_image0:new d.Uniform1i(f,r.u_image0),u_skirt_height:new d.Uniform1f(f,r.u_skirt_height)}),mo=(f,r)=>({u_matrix:f,u_image0:0,u_skirt_height:r}),gs=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,y){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:y,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Ja={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ca(f,r){const c=1<<f.z;return!r&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const N=f=>({u_matrix:f});function W(f,r,c,p,y){if(y>0){const v=d.exported.now(),D=(v-f.timeAdded)/y,A=r?(v-r.timeAdded)/y:-1,k=c.getSource(),z=p.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),V=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),j=V&&f.refreshedUponExpiration?1:d.clamp(V?D:1-A,0,1);return f.refreshedUponExpiration&&D>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class U extends d.SourceCache{constructor(r){const c=q("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Zr(yt(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,D)=>{if(v[D.key]="",!this._tiles[D.key]){const A=new d.Tile(D,this._source.tileSize*D.overscaleFactor(),r.tileZoom);A.state="loaded",this._tiles[D.key]=A}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class J extends d.OverscaledTileID{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Te extends d.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,v]=function(k){const z=new d.StructArrayLayout4i8,V=new d.StructArrayLayout3ui6,j=131;z.reserve(17161),V.reserve(33800);const Y=d.EXTENT/128,ee=d.EXTENT+Y/2,oe=ee+Y;for(let de=-Y;de<oe;de+=Y)for(let re=-Y;re<oe;re+=Y){const pe=re<0||re>ee||de<0||de>ee?24575:0,ge=d.clamp(Math.round(re),0,d.EXTENT),se=d.clamp(Math.round(de),0,d.EXTENT);z.emplaceBack(ge+pe,se,ge,se)}const ne=(de,re)=>{const pe=re*j+de;V.emplaceBack(pe+1,pe,pe+j),V.emplaceBack(pe+j,pe+j+1,pe+1)};for(let de=1;de<129;de++)for(let re=1;re<129;re++)ne(re,de);return[0,129].forEach(de=>{for(let re=0;re<130;re++)ne(re,de),ne(de,re)}),[z,V,32768]}(),D=r.context;this.gridBuffer=D.createVertexBuffer(p,d.boundsAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(y),this.gridSegments=d.SegmentVector.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new U(c.map),this.orthoMatrix=d.create$1(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const A=D.gl;this._overlapStencilMode=new d.StencilMode({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const y=r.terrain.properties;this.sourceCache=r._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.sourceCache.getSource().tileSize/128,A=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(c,D*A,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(k=>{const z=c.getTileByID(k).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(k,z){const V=z.transform.pointCoordinate(z.transform.getCameraPoint()),j=new d.pointGeometry(V.x,V.y);k.sort((Y,ee)=>{if(ee.overscaledZ-Y.overscaledZ)return ee.overscaledZ-Y.overscaledZ;const oe=new d.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ne=new d.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),de=j.mult(1<<Y.canonical.z);return de.x-=.5,de.y-=.5,de.distSqr(oe)-de.distSqr(ne)})})(y,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const k in D){const z=D[k];if(!z.used||(z!==this.sourceCache&&(this._findCoveringTileCache[z.id]={}),this._setupProxiedCoordsForOrtho(z,r[k],v),z.usedForTerrain))continue;const V=r[k];z.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[c.id]=y.map(k=>new J(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const A={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const z=this.terrainTileForTile[k.key];if(!z)continue;const V=z.tileID.key;V in A||(this._visibleDemTiles.push(z),A[V]=V)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),aa(this.painter,y,v))}}_prepareDemTileUniforms(r,c,p,y){if(!c||null==c.demTexture)return!1;const v=r.tileID.canonical,D=Math.pow(2,c.tileID.canonical.z-v.z),A=y||"";return p[`u_dem_tl${A}`]=[v.x*D%1,v.y*D%1],p[`u_dem_scale${A}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const v=y.dem.tree.minimums[0];return v>0&&r++,p+v},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(d.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new d.Texture(r,y,c.RGBA,{premultiply:!1}),v}setupElevationDraw(r,c,p){const y=this.painter.context,v=y.gl,D=(A=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(A),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var A;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let k=null,z=null,V=1;if(p&&p.morphing&&this._useVertexMorphing){const j=p.morphing.srcDemTile,Y=p.morphing.dstDemTile;V=p.morphing.phase,j&&Y&&(this._prepareDemTileUniforms(r,j,D,"_prev")&&(z=j),this._prepareDemTileUniforms(r,Y,D)&&(k=Y))}if(z&&k?(y.activeTexture.set(v.TEXTURE2),k.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),z.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),D.u_dem_lerp=V):(k=this.terrainTileForTile[r.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(r,k,D)?k.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),p&&p.useDepthForOcclusion&&(y.activeTexture.set(v.TEXTURE3),this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&k){const j=(1<<k.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=j}p&&p.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(y,D)}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,v,D,A,k){const z=y.context,V=z.gl;let j,Y;const ee=y.options.showTerrainWireframe?2:0,oe=(ge,se)=>{if(Y===ge)return;const _e=[Ja[ge]];se&&_e.push(Ja[ee]),j=y.useProgram("terrainRaster",null,_e),Y=ge},ne=y.colorModeForRenderPass(),de=new d.DepthMode(V.LEQUAL,d.DepthMode.ReadWrite,y.depthRangeFor3D);gs.update(k);const re=y.transform,pe=6*Math.pow(1.5,22-re.zoom)*v.exaggeration();(ee?[!1,!0]:[!1]).forEach(ge=>{Y=-1;const se=ge?V.LINES:V.TRIANGLES,[_e,Ce]=ge?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const nt of A){const rt=D.getTile(nt),wt=d.StencilMode.disabled,et=v.prevTerrainTileForTile[nt.key],Dt=v.terrainTileForTile[nt.key];Xe=Dt,null!=(Ze=et)&&null!=Xe&&Ze.hasData()&&Xe.hasData()&&null!=Ze.demTexture&&null!=Xe.demTexture&&Ze.tileID.key!==Xe.tileID.key&&gs.newMorphing(nt.key,et,Dt,k,250),z.activeTexture.set(V.TEXTURE0),rt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const He=gs.getMorphValuesForProxy(nt.key),Tt=He?1:0;let Lt;He&&(Lt={morphing:{srcDemTile:He.from,dstDemTile:He.to,phase:d.easeCubicInOut(He.phase)}});const Jt=mo(nt.projMatrix,ca(nt.canonical,re.renderWorldCopies)?pe/10:pe);oe(Tt,ge),v.setupElevationDraw(rt,j,Lt),y.prepareDrawProgram(z,j,nt.toUnwrapped()),j.draw(z,se,de,wt,ne,d.CullFaceMode.backCCW,Jt,"terrain_raster",v.gridBuffer,_e,Ce)}var Ze,Xe})}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],D=this._drapedRenderBatches.shift(),A=[],k=c.style.order;let z=0;for(const V of v){const j=y.getTileByID(V.proxyTileKey),Y=y.proxyCachedFBO[V.key]?y.proxyCachedFBO[V.key][r]:void 0,ee=void 0!==Y?y.renderCache[Y]:this.pool[z++],oe=void 0!==Y;if(j.texture=ee.tex,oe&&!ee.dirty){A.push(j.tileID);continue}let ne;p.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(p.clear({color:d.Color.transparent}),ee.dirty=!1);for(let de=D.start;de<=D.end;++de){const re=c.style._layers[k[de]];if(re.isHidden(c.transform.zoom))continue;const pe=c.style._getLayerSourceCache(re),ge=pe?this.proxyToSource[V.key][pe.id]:[V];if(!ge)continue;const se=ge;p.viewport.set([0,0,ee.fb.width,ee.fb.height]),ne!==(pe?pe.id:null)&&(this._setupStencil(ee,ge,re,pe),ne=pe?pe.id:null),c.renderLayer(c,pe,re,se)}this.renderedToTile?(ee.dirty=!0,A.push(j.tileID)):oe||--z,5===z&&(z=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),D.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let p,y=0,v=0,D=!1;for(let A=0;A<c;++A){const k=r._layers[r.order[A]];this._style.isLayerDraped(k)?(D&&++y,++v):D||(D=!0,p=k.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const D=v.tileID,A=Math.pow(2,D.overscaledZ),{x:k,y:z}=D.canonical,V=k/A,j=(k+1)/A,Y=z/A,ee=(z+1)/A;return{minx:V,miny:Y,maxx:j,maxy:ee,t:v.dem.tree.raycastRoot(V,Y,j,ee,r,c,p),tile:v}});y.sort((v,D)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const v of y){if(null==v.t)return null;const D=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,c,p);if(null!=D)return D}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const y=new d.Texture(r,{width:p[0],height:p[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=r.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new Dn(r,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],p=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),v=!!y&&1!==y.t,D=c.hasTransition();return"custom"!==c.type&&!p&&(v||D)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof fi){r=!0;break}if(r)for(let c=0;c<this._style.order.length;++c){const p=this._style._layers[this._style.order[c]],y=p.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(p);if("raster"!==p.type||y||!v)continue;const D=p.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][v.id];if(k)for(const z of k){const V=W(v.getTile(z),v.findLoadedParent(z,0),v,this.painter.transform,D);(1!==V.opacity||0!==V.mix)&&this._clearRenderCacheForTile(v.id,z)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const p=[];let y,v=0,D=this._style._layers[r[v]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++v<c;)D=this._style._layers[r[v]];for(;v<c;++v){const A=this._style._layers[r[v]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?void 0===y&&(y=v):void 0!==y&&(p.push({start:y,end:v-1}),y=void 0))}void 0!==y&&p.push({start:y,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const D=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let A=0;A<D.length;++A){const k=Object.values(D[A]);c.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let D=p.length-1;D>=0;D--){const A=p[D];if(c.getTileByID(A.key),void 0!==c.proxyCachedFBO[A.key]){const k=r[A.key],z=this.proxyToSource[A.key];let V=0;for(const j in z){const Y=z[j],ee=k[j];if(!ee||ee.length!==Y.length||Y.some((oe,ne)=>oe!==ee[ne]||y[j]&&y[j].hasOwnProperty(oe.key))){V=-1;break}++V}for(const j in c.proxyCachedFBO[A.key])c.renderCache[c.proxyCachedFBO[A.key][j]].dirty=V<0||V!==Object.values(k).length}}const v=[...this._drapedRenderBatches];v.sort((D,A)=>A.end-A.start-(D.end-D.start));for(const D of v)for(const A of p){if(c.proxyCachedFBO[A.key])continue;let k=c.renderCachePool.pop();void 0===k&&c.renderCache.length<50&&(k=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==k&&(c.proxyCachedFBO[A.key]={},c.proxyCachedFBO[A.key][D.start]=k,c.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,D=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let A;if(p.isTileClipped())A=c.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(r,c){const p=this.painter,y=this.painter.context,v=y.gl;p._tileClippingMaskIDs={},y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const D=p.useProgram("clippingMask");for(const A of r){const k=p._tileClippingMaskIDs[A.key]=--c;D.draw(y,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,N(A.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];d.transformMat4(p,p,c.pixelMatrixInverse),d.scale$2(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const y=c._camera.position,v=d.mercatorZfromAltitude(1,c.center.lat),D=[y[0],y[1],y[2]/v,0],A=d.subtract([],p.slice(0,3),D);d.normalize(A,A);const k=this.raycast(D,A,this._exaggeration);return null!==k&&k?(d.scaleAndAdd(D,D,A,k),D[3]=D[2],D[2]*=v,D):null}drawDepth(){const r=this.painter,c=r.context,p=this.proxySourceCache,y=Math.ceil(r.width),v=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const D=c.gl,A=c.createFramebuffer(y,v,!0);c.activeTexture.set(D.TEXTURE0);const k=new d.Texture(c,{width:y,height:v,data:null},D.RGBA);k.bind(D.NEAREST,D.CLAMP_TO_EDGE),A.colorAttachment.set(k.texture);const z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,v);A.depthAttachment.set(z),this._depthFBO=A,this._depthTexture=k}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,v]),function(D,A,k,z){const V=D.context,j=V.gl;V.clear({depth:1});const Y=D.useProgram("terrainDepth"),ee=new d.DepthMode(j.LESS,d.DepthMode.ReadWrite,D.depthRangeFor3D);for(const oe of z){const ne=k.getTile(oe),de=mo(oe.projMatrix,0);A.setupElevationDraw(ne,Y),Y.draw(V,j.TRIANGLES,ee,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,de,"terrain_depth",A.gridBuffer,A.gridIndexBuffer,A.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof ie)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let A=0;A<v.length;A++){const k=v[A],z=this._findTileCoveringTileID(k,r);if(z){const V=this._createProxiedId(k,z,p[k.key]&&p[k.key][r.id]);y.push(V),this.proxyToSource[k.key][r.id]=[V]}}let D=!1;for(let A=0;A<c.length;A++){const k=r.getTile(c[A]);if(!k||!k.hasData())continue;const z=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==k.tileID.canonical.z){const V=this.proxyToSource[z.tileID.key][r.id],j=this._createProxiedId(z.tileID,k,p[z.tileID.key]&&p[z.tileID.key][r.id]);V?V.splice(V.length-1,0,j):this.proxyToSource[z.tileID.key][r.id]=[j],y.push(j),D=!0}}this._sourceTilesOverlap[r.id]=D}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords,D=r.getSource(),A=new d.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),k=D.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((V,j)=>(V.min.x=Math.min(V.min.x,j.x-A.x),V.min.y=Math.min(V.min.y,j.y-A.y),V.max.x=Math.max(V.max.x,j.x-A.x),V.max.y=Math.max(V.max.y,j.y-A.y),V),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(V,j)=>{const Y=V.wrap+V.canonical.x/(1<<V.canonical.z),ee=V.canonical.y/(1<<V.canonical.z),oe=d.EXTENT/(1<<V.canonical.z),ne=j.wrap+j.canonical.x/(1<<j.canonical.z),de=j.canonical.y/(1<<j.canonical.z);return Y+oe<ne+k.min.x||Y>ne+k.max.x||ee+oe<de+k.min.y||ee>de+k.max.y};for(let V=0;V<v.length;V++){const j=v[V];for(let Y=0;Y<c.length;Y++){const ee=r.getTile(c[Y]);if(!ee||!ee.hasData()||z(j,ee.tileID))continue;const oe=this._createProxiedId(j,ee,p[j.key]&&p[j.key][r.id]),ne=this.proxyToSource[j.key][r.id];ne?ne.push(oe):this.proxyToSource[j.key][r.id]=[oe],y.push(oe)}}}_createProxiedId(r,c,p){let y=this.orthoMatrix;if(p){const v=p.find(D=>D.key===c.tileID.key);if(v)return v}if(c.tileID.key!==r.key){const v=r.canonical.z-c.tileID.canonical.z;let D,A,k;y=d.create$1();const z=c.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(D=d.EXTENT>>v,A=D*((c.tileID.canonical.x<<v)-r.canonical.x+z),k=D*((c.tileID.canonical.y<<v)-r.canonical.y)):(D=d.EXTENT<<-v,A=d.EXTENT*(c.tileID.canonical.x-(r.canonical.x+z<<-v)),k=d.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-v))),d.ortho(y,0,D,0,D,0,1),d.translate(y,y,[A,k,0])}return new J(c.tileID,r.key,y)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[c.id],v=y[r.key];if(p=v?c.getTileByID(v):null,p&&p.hasData()||null===v)return p;let D=p?p.tileID:r,A=D.overscaledZ;const k=c.getSource().minzoom,z=[];if(!v){const j=c.getSource().maxzoom;if(r.canonical.z>=j){const Y=r.canonical.z-j;c.getSource().reparseOverscaled?(A=Math.max(r.canonical.z+2,c.transform.tileZoom),D=new d.OverscaledTileID(A,r.wrap,j,r.canonical.x>>Y,r.canonical.y>>Y)):0!==Y&&(A=j,D=new d.OverscaledTileID(A,r.wrap,j,r.canonical.x>>Y,r.canonical.y>>Y))}D.key!==r.key&&(z.push(D.key),p=c.getTile(D))}const V=j=>{z.forEach(Y=>{y[Y]=j}),z.length=0};for(A-=1;A>=k&&(!p||!p.hasData());A--){p&&V(p.tileID.key);const j=D.calculateScaledKey(A);if(p=c.getTileByID(j),p&&p.hasData())break;const Y=y[j];if(null===Y)break;void 0===Y?z.push(j):p=c.getTileByID(Y)}return V(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(r){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let p,y,v;const D=new d.StructArrayLayout2ui4,A=131;for(y=1;y<129;y++){for(p=1;p<129;p++)v=y*A+p,D.emplaceBack(v,v+1),D.emplaceBack(v,v+A),D.emplaceBack(v+1,v+A),128===y&&D.emplaceBack(v+A,v+A+1);D.emplaceBack(v+1,v+1+A)}return D}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Je(f){const r=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const p=f[c].split(" ");r.push(p.pop())}return r}class pt{static cacheKey(r,c,p){let y=`${r}${p?p.cacheKey:""}`;for(const v of c)y+=`/${v}`;return y}constructor(r,c,p,y,v,D){const A=r.gl;this.program=A.createProgram();const k=Je(p.staticAttributes),z=y?y.getBinderAttributes():[],V=k.concat(z),j=p.staticUniforms?Je(p.staticUniforms):[],Y=y?y.getBinderUniforms():[],ee=j.concat(Y),oe=[];for(const _e of ee)oe.indexOf(_e)<0&&oe.push(_e);let ne=y?y.defines():[];ne=ne.concat(D.map(_e=>`#define ${_e}`));const de=ne.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ms,po.fragmentSource,Do.fragmentSource,p.fragmentSource).join("\n"),re=ne.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ms,po.vertexSource,Do.vertexSource,ia.vertexSource,p.vertexSource).join("\n"),pe=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(pe,de),A.compileShader(pe),A.attachShader(this.program,pe);const ge=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ge,re),A.compileShader(ge),A.attachShader(this.program,ge),this.attributes={};const se={};this.numAttributes=V.length;for(let _e=0;_e<this.numAttributes;_e++)V[_e]&&(A.bindAttribLocation(this.program,_e,V[_e]),this.attributes[V[_e]]=_e);A.linkProgram(this.program),A.deleteShader(ge),A.deleteShader(pe);for(let _e=0;_e<oe.length;_e++){const Ce=oe[_e];if(Ce&&!se[Ce]){const Ze=A.getUniformLocation(this.program,Ce);Ze&&(se[Ce]=Ze)}}var _e,Ce;this.fixedUniforms=v(r,se),this.binderUniforms=y?y.getUniforms(r,se):[],-1!==D.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(_e=r,(Ce=se).u_dem),u_dem_prev:new d.Uniform1i(_e,Ce.u_dem_prev),u_dem_unpack:new d.Uniform4f(_e,Ce.u_dem_unpack),u_dem_tl:new d.Uniform2f(_e,Ce.u_dem_tl),u_dem_scale:new d.Uniform1f(_e,Ce.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(_e,Ce.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(_e,Ce.u_dem_scale_prev),u_dem_size:new d.Uniform1f(_e,Ce.u_dem_size),u_dem_lerp:new d.Uniform1f(_e,Ce.u_dem_lerp),u_exaggeration:new d.Uniform1f(_e,Ce.u_exaggeration),u_depth:new d.Uniform1i(_e,Ce.u_depth),u_depth_size_inv:new d.Uniform2f(_e,Ce.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(_e,Ce.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(_e,Ce.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(_e,Ce.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(_e,Ce.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(_e,Ce.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(_e,Ce.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(_e,Ce.u_tile_up_scale)}),-1!==D.indexOf("FOG")&&(this.fogUniforms=((_e,Ce)=>({u_fog_matrix:new d.UniformMatrix4f(_e,Ce.u_fog_matrix),u_fog_range:new d.Uniform2f(_e,Ce.u_fog_range),u_fog_color:new d.Uniform4f(_e,Ce.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(_e,Ce.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(_e,Ce.u_fog_temporal_offset)}))(r,se))}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].set(c[y])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)p[y].location&&p[y].set(c[y])}}draw(r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe,ne,de){const re=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(y),r.setColorMode(v),r.setCullFace(D);for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(A[ge]);oe&&oe.setUniforms(r,this.binderUniforms,Y,{zoom:ee});const pe={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[c];for(const ge of j.get()){const se=ge.vaos||(ge.vaos={});(se[k]||(se[k]=new Ji)).bind(r,this,z,oe?oe.getPaintVertexBuffers():[],V,ge.vertexOffset,ne,de),re.drawElements(c,ge.primitiveLength*pe,re.UNSIGNED_SHORT,ge.primitiveOffset*pe*2)}}}function Yt(f,r,c){const p=1/sr(c,1,r.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,r.transform.tileZoom)/y,D=v*(c.tileID.canonical.x+c.tileID.wrap*y),A=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[D>>16,A>>16],u_pixel_coord_lower:[65535&D,65535&A]}}const tn=(f,r,c,p)=>{const y=r.style.light,v=y.properties.get("position"),D=[v.x,v.y,v.z],A=d.create$2();"viewport"===y.properties.get("anchor")&&(d.fromRotation(A,-r.transform.angle),d.transformMat3(D,D,A));const k=y.properties.get("color");return{u_matrix:f,u_lightpos:D,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+c,u_opacity:p}},br=(f,r,c,p,y,v,D)=>d.extend(tn(f,r,c,p),Yt(v,r,D),{u_height_factor:-Math.pow(2,y.overscaledZ)/D.tileSize/8}),dr=f=>({u_matrix:f}),Rn=(f,r,c,p)=>d.extend(dr(f),Yt(c,r,p)),An=(f,r)=>({u_matrix:f,u_world:r}),wr=(f,r,c,p,y)=>d.extend(Rn(f,r,c,p),{u_world:y}),fr=(f,r,c,p)=>{const y=f.transform;let v;return v="map"===p.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:f.translatePosMatrix(r.projMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:v}},Io=f=>{const r=[];return"map"===f.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},Ir=(f,r,c)=>{const p=d.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/p,r.pixelsToGLUnits[1]/p]}},bi=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),So=(f,r,c,p)=>({u_matrix:f,u_extrude_scale:sr(r,1,c),u_intensity:p}),wi=(f,r,c,p,y,v)=>{const D=f.transform,A=D.calculatePixelsToTileUnitsMatrix(r),k={u_matrix:Ra(f,r,c,y),u_pixels_to_tile_units:A,u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(eo(c)){const z=js(r,f.transform);k.u_texsize=r.lineAtlasTexture.size,k.u_scale=[z,p.fromScale,p.toScale],k.u_mix=p.t}return k},oi=(f,r,c,p,y)=>{const v=f.transform,D=js(r,v);return{u_matrix:Ra(f,r,c,y),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[D,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function js(f,r){return 1/sr(f,1,r.tileZoom)}function Ra(f,r,c,p){return f.translatePosMatrix(p||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Ll=f=>{const r=[];return eo(f)&&r.push("RENDER_LINE_DASH"),f.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT"),r};function eo(f){const r=f.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const ua=(f,r,c,p,y)=>{return{u_matrix:f,u_tl_parent:r,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(D=y.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(v=y.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:_s(y.paint.get("raster-hue-rotate"))};var v,D};function _s(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const mn=(f,r,c,p,y,v,D,A,k,z,V,j,Y,ee)=>{const oe=y.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:D,u_coord_matrix:A,u_is_text:+k,u_pitch_with_map:+p,u_texsize:z,u_tile_id:V,u_zoom_transition:j,u_inv_rot_matrix:Y,u_merc_center:ee,u_texture:0}},ku=(f,r,c,p,y,v,D,A,k,z,V,j,Y,ee,oe)=>{const{cameraToCenterDistance:ne,_pitch:de}=y.transform;return d.extend(mn(f,r,c,p,y,v,D,A,k,z,j,Y,ee,oe),{u_gamma_scale:p?ne*Math.cos(y.terrain?0:de):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+V})},Fu=(f,r,c,p,y,v,D,A,k,z,V,j,Y,ee)=>d.extend(ku(f,r,c,p,y,v,D,A,!0,k,!0,V,j,Y,ee),{u_texsize_icon:z,u_texture_icon:1}),_c=(f,r,c)=>({u_matrix:f,u_opacity:r,u_color:c}),Ao=(f,r,c,p,y,v)=>d.extend(function(D,A,k,z){const V=k.imageManager.getPattern(D.from.toString()),j=k.imageManager.getPattern(D.to.toString()),{width:Y,height:ee}=k.imageManager.getPixelSize(),oe=Math.pow(2,z.tileID.overscaledZ),ne=z.tileSize*Math.pow(2,k.transform.tileZoom)/oe,de=ne*(z.tileID.canonical.x+z.tileID.wrap*oe),re=ne*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[Y,ee],u_mix:A.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/sr(z,1,k.transform.tileZoom),u_pixel_coord_upper:[de>>16,re>>16],u_pixel_coord_lower:[65535&de,65535&re]}}(p,v,c,y),{u_matrix:f,u_opacity:r}),yc={fillExtrusion:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_lightpos:new d.Uniform3f(f,r.u_lightpos),u_lightintensity:new d.Uniform1f(f,r.u_lightintensity),u_lightcolor:new d.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,r.u_vertical_gradient),u_opacity:new d.Uniform1f(f,r.u_opacity)}),fillExtrusionPattern:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_lightpos:new d.Uniform3f(f,r.u_lightpos),u_lightintensity:new d.Uniform1f(f,r.u_lightintensity),u_lightcolor:new d.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,r.u_vertical_gradient),u_height_factor:new d.Uniform1f(f,r.u_height_factor),u_image:new d.Uniform1i(f,r.u_image),u_texsize:new d.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,r.u_scale),u_fade:new d.Uniform1f(f,r.u_fade),u_opacity:new d.Uniform1f(f,r.u_opacity)}),fill:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix)}),fillPattern:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_image:new d.Uniform1i(f,r.u_image),u_texsize:new d.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,r.u_scale),u_fade:new d.Uniform1f(f,r.u_fade)}),fillOutline:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_world:new d.Uniform2f(f,r.u_world)}),fillOutlinePattern:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_world:new d.Uniform2f(f,r.u_world),u_image:new d.Uniform1i(f,r.u_image),u_texsize:new d.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,r.u_scale),u_fade:new d.Uniform1f(f,r.u_fade)}),circle:(f,r)=>({u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(f,r.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(f,r.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(f,r.u_matrix)}),collisionBox:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(f,r.u_extrude_scale)}),collisionCircle:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_inv_matrix:new d.UniformMatrix4f(f,r.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(f,r.u_viewport_size)}),debug:(f,r)=>({u_color:new d.UniformColor(f,r.u_color),u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_overlay:new d.Uniform1i(f,r.u_overlay),u_overlay_scale:new d.Uniform1f(f,r.u_overlay_scale)}),clippingMask:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix)}),heatmap:(f,r)=>({u_extrude_scale:new d.Uniform1f(f,r.u_extrude_scale),u_intensity:new d.Uniform1f(f,r.u_intensity),u_matrix:new d.UniformMatrix4f(f,r.u_matrix)}),heatmapTexture:(f,r)=>({u_image:new d.Uniform1i(f,r.u_image),u_color_ramp:new d.Uniform1i(f,r.u_color_ramp),u_opacity:new d.Uniform1f(f,r.u_opacity)}),hillshade:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_image:new d.Uniform1i(f,r.u_image),u_latrange:new d.Uniform2f(f,r.u_latrange),u_light:new d.Uniform2f(f,r.u_light),u_shadow:new d.UniformColor(f,r.u_shadow),u_highlight:new d.UniformColor(f,r.u_highlight),u_accent:new d.UniformColor(f,r.u_accent)}),hillshadePrepare:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_image:new d.Uniform1i(f,r.u_image),u_dimension:new d.Uniform2f(f,r.u_dimension),u_zoom:new d.Uniform1f(f,r.u_zoom),u_unpack:new d.Uniform4f(f,r.u_unpack)}),line:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(f,r.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,r.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(f,r.u_units_to_pixels),u_dash_image:new d.Uniform1i(f,r.u_dash_image),u_gradient_image:new d.Uniform1i(f,r.u_gradient_image),u_image_height:new d.Uniform1f(f,r.u_image_height),u_texsize:new d.Uniform2f(f,r.u_texsize),u_scale:new d.Uniform3f(f,r.u_scale),u_mix:new d.Uniform1f(f,r.u_mix)}),linePattern:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_texsize:new d.Uniform2f(f,r.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(f,r.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,r.u_device_pixel_ratio),u_image:new d.Uniform1i(f,r.u_image),u_units_to_pixels:new d.Uniform2f(f,r.u_units_to_pixels),u_scale:new d.Uniform3f(f,r.u_scale),u_fade:new d.Uniform1f(f,r.u_fade)}),raster:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_tl_parent:new d.Uniform2f(f,r.u_tl_parent),u_scale_parent:new d.Uniform1f(f,r.u_scale_parent),u_buffer_scale:new d.Uniform1f(f,r.u_buffer_scale),u_fade_t:new d.Uniform1f(f,r.u_fade_t),u_opacity:new d.Uniform1f(f,r.u_opacity),u_image0:new d.Uniform1i(f,r.u_image0),u_image1:new d.Uniform1i(f,r.u_image1),u_brightness_low:new d.Uniform1f(f,r.u_brightness_low),u_brightness_high:new d.Uniform1f(f,r.u_brightness_high),u_saturation_factor:new d.Uniform1f(f,r.u_saturation_factor),u_contrast_factor:new d.Uniform1f(f,r.u_contrast_factor),u_spin_weights:new d.Uniform3f(f,r.u_spin_weights)}),symbolIcon:(f,r)=>({u_is_size_zoom_constant:new d.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,r.u_size_t),u_size:new d.Uniform1f(f,r.u_size),u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,r.u_pitch),u_rotate_symbol:new d.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,r.u_fade_change),u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new d.Uniform1i(f,r.u_is_text),u_pitch_with_map:new d.Uniform1i(f,r.u_pitch_with_map),u_texsize:new d.Uniform2f(f,r.u_texsize),u_tile_id:new d.Uniform3f(f,r.u_tile_id),u_zoom_transition:new d.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,r.u_merc_center),u_texture:new d.Uniform1i(f,r.u_texture)}),symbolSDF:(f,r)=>({u_is_size_zoom_constant:new d.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,r.u_size_t),u_size:new d.Uniform1f(f,r.u_size),u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,r.u_pitch),u_rotate_symbol:new d.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,r.u_fade_change),u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new d.Uniform1i(f,r.u_is_text),u_pitch_with_map:new d.Uniform1i(f,r.u_pitch_with_map),u_texsize:new d.Uniform2f(f,r.u_texsize),u_texture:new d.Uniform1i(f,r.u_texture),u_gamma_scale:new d.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,r.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(f,r.u_tile_id),u_zoom_transition:new d.Uniform1f(f,r.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,r.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,r.u_merc_center),u_is_halo:new d.Uniform1i(f,r.u_is_halo)}),symbolTextAndIcon:(f,r)=>({u_is_size_zoom_constant:new d.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,r.u_size_t),u_size:new d.Uniform1f(f,r.u_size),u_camera_to_center_distance:new d.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,r.u_pitch),u_rotate_symbol:new d.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,r.u_fade_change),u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new d.Uniform1i(f,r.u_is_text),u_pitch_with_map:new d.Uniform1i(f,r.u_pitch_with_map),u_texsize:new d.Uniform2f(f,r.u_texsize),u_texsize_icon:new d.Uniform2f(f,r.u_texsize_icon),u_texture:new d.Uniform1i(f,r.u_texture),u_texture_icon:new d.Uniform1i(f,r.u_texture_icon),u_gamma_scale:new d.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,r.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(f,r.u_is_halo)}),background:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_opacity:new d.Uniform1f(f,r.u_opacity),u_color:new d.UniformColor(f,r.u_color)}),backgroundPattern:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_opacity:new d.Uniform1f(f,r.u_opacity),u_image:new d.Uniform1i(f,r.u_image),u_pattern_tl_a:new d.Uniform2f(f,r.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(f,r.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(f,r.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(f,r.u_pattern_br_b),u_texsize:new d.Uniform2f(f,r.u_texsize),u_mix:new d.Uniform1f(f,r.u_mix),u_pattern_size_a:new d.Uniform2f(f,r.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(f,r.u_pattern_size_b),u_scale_a:new d.Uniform1f(f,r.u_scale_a),u_scale_b:new d.Uniform1f(f,r.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,r.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(f,r.u_tile_units_to_pixels)}),terrainRaster:Ln,terrainDepth:Ln,skybox:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_sun_direction:new d.Uniform3f(f,r.u_sun_direction),u_cubemap:new d.Uniform1i(f,r.u_cubemap),u_opacity:new d.Uniform1f(f,r.u_opacity),u_temporal_offset:new d.Uniform1f(f,r.u_temporal_offset)}),skyboxGradient:(f,r)=>({u_matrix:new d.UniformMatrix4f(f,r.u_matrix),u_color_ramp:new d.Uniform1i(f,r.u_color_ramp),u_center_direction:new d.Uniform3f(f,r.u_center_direction),u_radius:new d.Uniform1f(f,r.u_radius),u_opacity:new d.Uniform1f(f,r.u_opacity),u_temporal_offset:new d.Uniform1f(f,r.u_temporal_offset)}),skyboxCapture:(f,r)=>({u_matrix_3f:new d.UniformMatrix3f(f,r.u_matrix_3f),u_sun_direction:new d.Uniform3f(f,r.u_sun_direction),u_sun_intensity:new d.Uniform1f(f,r.u_sun_intensity),u_color_tint_r:new d.Uniform4f(f,r.u_color_tint_r),u_color_tint_m:new d.Uniform4f(f,r.u_color_tint_m),u_luminance:new d.Uniform1f(f,r.u_luminance)})};let ha;function da(f,r,c,p,y,v,D){const A=f.context,k=A.gl,z=f.useProgram("collisionBox"),V=[];let j=0,Y=0;for(let ge=0;ge<p.length;ge++){const se=p[ge],_e=r.getTile(se),Ce=_e.getBucket(c);if(!Ce)continue;let Ze=se.projMatrix;0===y[0]&&0===y[1]||(Ze=f.translatePosMatrix(se.projMatrix,_e,y,v));const Xe=D?Ce.textCollisionBox:Ce.iconCollisionBox,nt=Ce.collisionCircleArray;if(nt.length>0){const rt=d.create$1(),wt=Ze;d.mul$1(rt,Ce.placementInvProjMatrix,f.transform.glCoordMatrix),d.mul$1(rt,rt,Ce.placementViewportMatrix),V.push({circleArray:nt,circleOffset:Y,transform:wt,invTransform:rt}),j+=nt.length/4,Y=j}Xe&&(f.terrain&&f.terrain.setupElevationDraw(_e,z),z.draw(A,k.LINES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,Ir(Ze,f.transform,_e),c.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,null,f.transform.zoom,null,Xe.collisionVertexBuffer,Xe.collisionVertexBufferExt))}if(!D||!V.length)return;const ee=f.useProgram("collisionCircle"),oe=new d.StructArrayLayout2f1f2i16;oe.resize(4*j),oe._trim();let ne=0;for(const ge of V)for(let se=0;se<ge.circleArray.length/4;se++){const _e=4*se,Ce=ge.circleArray[_e+0],Ze=ge.circleArray[_e+1],Xe=ge.circleArray[_e+2],nt=ge.circleArray[_e+3];oe.emplace(ne++,Ce,Ze,Xe,nt,0),oe.emplace(ne++,Ce,Ze,Xe,nt,1),oe.emplace(ne++,Ce,Ze,Xe,nt,2),oe.emplace(ne++,Ce,Ze,Xe,nt,3)}(!ha||ha.length<2*j)&&(ha=function(ge){const se=2*ge,_e=new d.StructArrayLayout3ui6;_e.resize(se),_e._trim();for(let Ce=0;Ce<se;Ce++){const Ze=6*Ce;_e.uint16[Ze+0]=4*Ce+0,_e.uint16[Ze+1]=4*Ce+1,_e.uint16[Ze+2]=4*Ce+2,_e.uint16[Ze+3]=4*Ce+2,_e.uint16[Ze+4]=4*Ce+3,_e.uint16[Ze+5]=4*Ce+0}return _e}(j));const de=A.createIndexBuffer(ha,!0),re=A.createVertexBuffer(oe,d.collisionCircleLayout.members,!0);for(const ge of V){const se={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(pe=f.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};ee.draw(A,k.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,se,c.id,re,de,d.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,f.transform.zoom,null,null,null)}var pe;re.destroy(),de.destroy()}const ft=d.identity(new Float32Array(16));function $n(f,r,c,p,y,v){const{horizontalAlign:D,verticalAlign:A}=d.getAnchorAlignment(f),k=-(D-.5)*r,z=-(A-.5)*c,V=d.evaluateVariableOffset(f,p);return new d.pointGeometry((k/y+V[0])*v,(z/y+V[1])*v)}function vc(f,r,c,p,y,v,D,A,k,z,V,j){const Y=f.text.placedSymbolArray,ee=f.text.dynamicLayoutVertexArray,oe=f.icon.dynamicLayoutVertexArray,ne={};ee.clear();for(let de=0;de<Y.length;de++){const re=Y.get(de),pe=f.allowVerticalPlacement&&!re.placedOrientation,ge=re.hidden||!re.crossTileID||pe?null:p[re.crossTileID];if(ge){const se=new d.pointGeometry(re.tileAnchorX,re.tileAnchorY),_e=j(se),Ce=wn(se,c?A:D,_e),Ze=pi(v.cameraToCenterDistance,Ce.signedDistanceFromCamera);let Xe=y.evaluateSizeForFeature(f.textSizeData,z,re)*Ze/d.ONE_EM;c&&(Xe*=f.tilePixelRatio/k);const{width:nt,height:rt,anchor:wt,textOffset:et,textScale:Dt}=ge,He=$n(wt,nt,rt,et,Dt,Xe),Tt=c?wn(se.add(He),D,_e).point:Ce.point.add(r?He.rotate(-v.angle):He),Lt=f.allowVerticalPlacement&&re.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let Jt=0;Jt<re.numGlyphs;Jt++)d.addDynamicAttributes(ee,Tt,Lt);V&&re.associatedIconIndex>=0&&(ne[re.associatedIconIndex]={shiftedAnchor:Tt,angle:Lt})}else ye(re.numGlyphs,ee)}if(V){oe.clear();const de=f.icon.placedSymbolArray;for(let re=0;re<de.length;re++){const pe=de.get(re);if(pe.hidden)ye(pe.numGlyphs,oe);else{const ge=ne[re];if(ge)for(let se=0;se<pe.numGlyphs;se++)d.addDynamicAttributes(oe,ge.shiftedAnchor,ge.angle);else ye(pe.numGlyphs,oe)}}f.icon.dynamicLayoutVertexBuffer.updateData(oe)}f.text.dynamicLayoutVertexBuffer.updateData(ee)}function Jr(f,r,c){return c.iconsInText&&r?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ys(f,r,c,p,y,v,D,A,k,z,V,j){const Y=f.context,ee=Y.gl,oe=f.transform,ne="map"===A,de="map"===k,re=ne&&"point"!==c.layout.get("symbol-placement"),pe=ne&&!de&&!re,ge=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let se=!1;const _e=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),Ce=[0,0],Ze=c.layout.get("text-variable-anchor"),Xe=[],nt=[];f.terrain&&de&&nt.push("PITCH_WITH_MAP_TERRAIN"),re&&nt.push("PROJECTED_POS_ON_VIEWPORT");for(const rt of p){const wt=r.getTile(rt),et=wt.getBucket(c);if(!et)continue;const Dt=y?et.text:et.icon;if(!Dt||!Dt.segments.get().length)continue;const He=Dt.programConfigurations.get(c.id),Tt=y||et.sdfIcons,Lt=y?et.textSizeData:et.iconSizeData,Jt=de||0!==oe.pitch,pn=f.useProgram(Jr(Tt,y,et),He,nt),rn=d.evaluateSizeForZoom(Lt,oe.zoom),ln=[rt.canonical.x,rt.canonical.y,1<<rt.canonical.z];let qt,vn,Jn,gi,Ii=[0,0],_o=null;if(y){if(vn=wt.glyphAtlasTexture,Jn=ee.LINEAR,qt=wt.glyphAtlasTexture.size,et.iconsInText){Ii=wt.imageAtlasTexture.size,_o=wt.imageAtlasTexture;const Zo="composite"===Lt.kind||"camera"===Lt.kind;gi=Jt||f.options.rotating||f.options.zooming||Zo?ee.LINEAR:ee.NEAREST}}else{const Zo=1!==c.layout.get("icon-size").constantOr(0)||et.iconsNeedLinear;vn=wt.imageAtlasTexture,Jn=Tt||f.options.rotating||f.options.zooming||Zo||Jt?ee.LINEAR:ee.NEAREST,qt=wt.imageAtlasTexture.size}const Gi=f.transform.calculatePixelsToTileUnitsMatrix(wt),$r=Ct(rt.projMatrix,de,ne,f.transform,Gi),Lo=f.terrain&&de&&re?d.invert(new Float32Array(16),$r):ft,Qs=Rt(rt.projMatrix,de,ne,f.transform,Gi),En=Ze&&et.hasTextData(),ti="none"!==c.layout.get("icon-text-fit")&&En&&et.hasIconData();if(re){const Zo=oe.elevation;Yi(et,rt.projMatrix,f,y,$r,Qs,de,z,Zo?Wo=>Zo.getAtTileOffset(rt,Wo.x,Wo.y):null)}const Wn=f.translatePosMatrix(rt.projMatrix,wt,v,D),lr=re||y&&Ze||ti?ft:$r,li=f.translatePosMatrix(Qs,wt,v,D,!0),Sr=Tt&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let Oo;Oo=Tt?et.iconsInText?Fu(Lt.kind,rn,pe,de,f,Wn,lr,li,qt,Ii,ln,0,f.identityMat,Ce):ku(Lt.kind,rn,pe,de,f,Wn,lr,li,y,qt,!0,ln,0,f.identityMat,Ce):mn(Lt.kind,rn,pe,de,f,Wn,lr,li,y,qt,ln,0,f.identityMat,Ce);const Kl={program:pn,buffers:Dt,uniformValues:Oo,atlasTexture:vn,atlasTextureIcon:_o,atlasInterpolation:Jn,atlasInterpolationIcon:gi,isSDF:Tt,hasHalo:Sr,tile:wt,labelPlaneMatrixInv:Lo};if(ge&&et.canOverlap){se=!0;const Zo=Dt.segments.get();for(const Wo of Zo)Xe.push({segments:new d.SegmentVector([Wo]),sortKey:Wo.sortKey,state:Kl})}else Xe.push({segments:Dt.segments,sortKey:0,state:Kl})}se&&Xe.sort((rt,wt)=>rt.sortKey-wt.sortKey);for(const rt of Xe){const wt=rt.state;if(f.terrain&&f.terrain.setupElevationDraw(wt.tile,wt.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:wt.labelPlaneMatrixInv}),Y.activeTexture.set(ee.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,ee.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(Y.activeTexture.set(ee.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),wt.isSDF){const et=wt.uniformValues;wt.hasHalo&&(et.u_is_halo=1,ns(wt.buffers,rt.segments,c,f,wt.program,_e,V,j,et)),et.u_is_halo=0}ns(wt.buffers,rt.segments,c,f,wt.program,_e,V,j,wt.uniformValues)}}function ns(f,r,c,p,y,v,D,A,k){const z=p.context;y.draw(z,z.gl.TRIANGLES,v,D,A,d.CullFaceMode.disabled,k,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ei(f,r,c,p,y,v,D){const A=f.context.gl,k=c.paint.get("fill-pattern"),z=k&&k.constantOr(1),V=c.getCrossfadeParameters();let j,Y,ee,oe,ne;D?(Y=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=A.LINES):(Y=z?"fillPattern":"fill",j=A.TRIANGLES);for(const de of p){const re=r.getTile(de);if(z&&!re.patternsLoaded())continue;const pe=re.getBucket(c);if(!pe)continue;f.prepareDrawTile(de);const ge=pe.programConfigurations.get(c.id),se=f.useProgram(Y,ge);z&&(f.context.activeTexture.set(A.TEXTURE0),re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ge.updatePaintBuffers(V));const _e=k.constantOr(null);if(_e&&re.imageAtlas){const Ze=re.imageAtlas,Xe=Ze.patternPositions[_e.to.toString()],nt=Ze.patternPositions[_e.from.toString()];Xe&&nt&&ge.setConstantPatternPositions(Xe,nt)}const Ce=f.translatePosMatrix(de.projMatrix,re,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(D){oe=pe.indexBuffer2,ne=pe.segments2;const Ze=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];ee="fillOutlinePattern"===Y&&z?wr(Ce,f,V,re,Ze):An(Ce,Ze)}else oe=pe.indexBuffer,ne=pe.segments,ee=z?Rn(Ce,f,V,re):dr(Ce);f.prepareDrawProgram(f.context,se,de.toUnwrapped()),se.draw(f.context,j,y,f.stencilModeForClipping(de),v,d.CullFaceMode.disabled,ee,c.id,pe.layoutVertexBuffer,oe,ne,c.paint,f.transform.zoom,ge)}}function Ho(f,r,c,p,y,v,D){const A=f.context,k=A.gl,z=c.paint.get("fill-extrusion-pattern"),V=z.constantOr(1),j=c.getCrossfadeParameters(),Y=c.paint.get("fill-extrusion-opacity");for(const ee of p){const oe=r.getTile(ee),ne=oe.getBucket(c);if(!ne)continue;const de=ne.programConfigurations.get(c.id),re=f.useProgram(V?"fillExtrusionPattern":"fillExtrusion",de);if(f.terrain){const Ce=f.terrain;if(!ne.enableTerrain)continue;if(Ce.setupElevationDraw(oe,re,{useMeterToDem:!0}),$s(A,r,ee,ne,c,Ce),!ne.centroidVertexBuffer){const Ze=re.attributes.a_centroid_pos;void 0!==Ze&&k.vertexAttrib2f(Ze,0,0)}}V&&(f.context.activeTexture.set(k.TEXTURE0),oe.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),de.updatePaintBuffers(j));const pe=z.constantOr(null);if(pe&&oe.imageAtlas){const Ce=oe.imageAtlas,Ze=Ce.patternPositions[pe.to.toString()],Xe=Ce.patternPositions[pe.from.toString()];Ze&&Xe&&de.setConstantPatternPositions(Ze,Xe)}const ge=f.translatePosMatrix(ee.projMatrix,oe,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),se=c.paint.get("fill-extrusion-vertical-gradient"),_e=V?br(ge,f,se,Y,ee,j,oe):tn(ge,f,se,Y);f.prepareDrawProgram(A,re,ee.toUnwrapped()),re.draw(A,A.gl.TRIANGLES,y,v,D,d.CullFaceMode.backCCW,_e,c.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,c.paint,f.transform.zoom,de,f.terrain?ne.centroidVertexBuffer:null)}}function $s(f,r,c,p,y,v){const D=[re=>{let pe=re.canonical.x-1,ge=re.wrap;return pe<0&&(pe=(1<<re.canonical.z)-1,ge--),new d.OverscaledTileID(re.overscaledZ,ge,re.canonical.z,pe,re.canonical.y)},re=>{let pe=re.canonical.x+1,ge=re.wrap;return pe===1<<re.canonical.z&&(pe=0,ge++),new d.OverscaledTileID(re.overscaledZ,ge,re.canonical.z,pe,re.canonical.y)},re=>new d.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,(0===re.canonical.y?1<<re.canonical.z:re.canonical.y)-1),re=>new d.OverscaledTileID(re.overscaledZ,re.wrap,re.canonical.z,re.canonical.x,re.canonical.y===(1<<re.canonical.z)-1?0:re.canonical.y+1)],A=re=>{const pe=r.getSource().maxzoom,ge=Ze=>{const Xe=r.getTileByID(Ze);if(Xe&&Xe.hasData())return Xe.getBucket(y)};let se,_e,Ce;return(re.overscaledZ===re.canonical.z||re.overscaledZ>=pe)&&(se=ge(re.key)),re.overscaledZ>=pe&&(_e=ge(re.calculateScaledKey(re.overscaledZ+1))),re.overscaledZ>pe&&(Ce=ge(re.calculateScaledKey(re.overscaledZ-1))),se||_e||Ce},k=[0,0,0],z=(re,pe)=>(k[0]=Math.min(re.min.y,pe.min.y),k[1]=Math.max(re.max.y,pe.max.y),k[2]=d.EXTENT-pe.min.x>re.max.x?pe.min.x-d.EXTENT:re.max.x,k),V=(re,pe)=>(k[0]=Math.min(re.min.x,pe.min.x),k[1]=Math.max(re.max.x,pe.max.x),k[2]=d.EXTENT-pe.min.y>re.max.y?pe.min.y-d.EXTENT:re.max.y,k),j=[(re,pe)=>z(re,pe),(re,pe)=>z(pe,re),(re,pe)=>V(re,pe),(re,pe)=>V(pe,re)],Y=new d.pointGeometry(0,0);let ee,oe,ne;const de=(re,pe,ge,se,_e)=>{const Ce=[[se?ge:re,se?re:ge,0],[se?ge:pe,se?pe:ge,0]],Ze=_e<0?d.EXTENT+_e:_e,Xe=[se?Ze:(re+pe)/2,se?(re+pe)/2:Ze,0];return 0===ge&&_e<0||0!==ge&&_e>0?v.getForTilePoints(ne,[Xe],!0,oe):Ce.push(Xe),v.getForTilePoints(c,Ce,!0,ee),Math.max(Ce[0][2],Ce[1][2],Xe[2])/v.exaggeration()};for(let re=0;re<4;re++){const pe=p.borders[re];if(0===pe.length&&(p.borderDone[re]=!0),p.borderDone[re])continue;const ge=ne=D[re](c),se=A(ge);if(!(se&&se.enableTerrain&&(oe=v.findDEMTileFor(ge),oe&&oe.dem)))continue;if(!ee){const Xe=v.findDEMTileFor(c);if(!Xe||!Xe.dem)return;ee=Xe}const _e=(re<2?1:5)-re,Ce=se.borders[_e];let Ze=0;for(let Xe=0;Xe<pe.length;Xe++){const nt=p.featuresOnBorder[pe[Xe]],rt=nt.borders[re];let wt;for(;Ze<Ce.length&&(wt=se.featuresOnBorder[Ce[Ze]],!(wt.borders[_e][1]>rt[0]+3));)se.borderDone[_e]||se.encodeCentroid(void 0,wt,!1),Ze++;if(wt&&Ze<Ce.length){const et=Ze;let Dt=0;for(;!(wt.borders[_e][0]>rt[1]-3)&&(Dt++,++Ze!==Ce.length);)wt=se.featuresOnBorder[Ce[Ze]];if(wt=se.featuresOnBorder[Ce[et]],nt.intersectsCount()>1||wt.intersectsCount()>1||1!==Dt){1!==Dt&&(Ze=et),p.encodeCentroid(void 0,nt,!1),se.borderDone[_e]||se.encodeCentroid(void 0,wt,!1);continue}const He=j[re](nt,wt),Tt=re%2?d.EXTENT-1:0;Y.x=de(He[0],Math.min(d.EXTENT-1,He[1]),Tt,re<2,He[2]),Y.y=0,p.encodeCentroid(Y,nt,!1),se.borderDone[_e]||se.encodeCentroid(Y,wt,!1)}else p.encodeCentroid(void 0,nt,!1)}p.borderDone[re]=p.needsCentroidUpdate=!0,se.borderDone[_e]||(se.borderDone[_e]=se.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(f)}const xc=new d.Color(1,0,0,1),jn=new d.Color(0,1,0,1),Gs=new d.Color(0,0,1,1),Ol=new d.Color(1,0,1,1),Li=new d.Color(0,1,1,1);function $i(f,r,c,p){vs(f,0,r+c/2,f.transform.width,c,p)}function bc(f,r,c,p){vs(f,r-c/2,0,c,f.transform.height,p)}function vs(f,r,c,p,y,v){const D=f.context,A=D.gl;A.enable(A.SCISSOR_TEST),A.scissor(r*d.exported.devicePixelRatio,c*d.exported.devicePixelRatio,p*d.exported.devicePixelRatio,y*d.exported.devicePixelRatio),D.clear({color:v}),A.disable(A.SCISSOR_TEST)}function Mo(f,r,c){const p=f.context,y=p.gl,v=c.projMatrix,D=f.useProgram("debug"),A=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(A,D);const k=d.DepthMode.disabled,z=d.StencilMode.disabled,V=f.colorModeForRenderPass(),j="$debug";p.activeTexture.set(y.TEXTURE0),f.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),A._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const Y=A._tileDebugBuffer||f.debugBuffer,ee=A._tileDebugIndexBuffer||f.debugIndexBuffer,oe=A._tileDebugSegments||f.debugSegments;D.draw(p,y.LINE_STRIP,k,z,V,d.CullFaceMode.disabled,bi(v,d.Color.red),j,Y,ee,oe);const ne=A.latestRawTileData,de=Math.floor((ne&&ne.byteLength||0)/1024),re=r.getTile(c).tileSize,pe=512/Math.min(re,512)*(c.overscaledZ/f.transform.zoom)*.5;let ge=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ge+=` => ${c.overscaledZ}`),function(se,_e){se.initDebugOverlayCanvas();const Ce=se.debugOverlayCanvas,Ze=se.context.gl,Xe=se.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Ce.width,Ce.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(_e,5,5),Xe.strokeText(_e,5,5),se.debugOverlayTexture.update(Ce),se.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(f,`${ge} ${de}kb`),D.draw(p,y.TRIANGLES,k,z,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,bi(v,d.Color.transparent,pe),j,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const Lu=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:el}=Lu;function to(f,r,c,p){f.emplaceBack(r,c,p)}class ka{constructor(r){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,to(this.vertexArray,-1,-1,1),to(this.vertexArray,1,-1,1),to(this.vertexArray,-1,1,1),to(this.vertexArray,1,1,1),to(this.vertexArray,-1,-1,-1),to(this.vertexArray,1,-1,-1),to(this.vertexArray,-1,1,-1),to(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,el),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function rs(f,r,c,p,y,v){const D=f.gl,A=r.paint.get("sky-atmosphere-color"),k=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),V={u_matrix_3f:d.fromMat4([],p),u_sun_direction:y,u_sun_intensity:z,u_color_tint_r:[(oe=A).r,oe.g,oe.b,oe.a],u_color_tint_m:[(ne=k).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var oe,ne;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),c.draw(f,D.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,V,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const xs={symbol:function(f,r,c,p,y){if("translucent"!==f.renderPass)return;const v=d.StencilMode.disabled,D=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(A,k,z,V,j,Y,ee){const oe=k.transform,ne="map"===j,de="map"===Y;for(const re of A){const pe=V.getTile(re),ge=pe.getBucket(z);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const se=d.evaluateSizeForZoom(ge.textSizeData,oe.zoom),_e=k.transform.calculatePixelsToTileUnitsMatrix(pe),Ce=Ct(re.projMatrix,de,ne,k.transform,_e),Ze="none"!==z.layout.get("icon-text-fit")&&ge.hasIconData();if(se){const Xe=Math.pow(2,oe.zoom-pe.tileID.overscaledZ),nt=oe.elevation;vc(ge,ne,de,ee,d.symbolSize,oe,Ce,re.projMatrix,Xe,se,Ze,nt?rt=>nt.getAtTileOffset(re,rt.x,rt.y):rt=>0)}}}(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&ys(f,r,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,D),0!==c.paint.get("text-opacity").constantOr(1)&&ys(f,r,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,D),r.map.showCollisionBoxes&&(da(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),da(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if("translucent"!==f.renderPass)return;const y=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),D=c.paint.get("circle-stroke-opacity"),A=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===v.constantOr(1)||0===D.constantOr(1)))return;const k=f.context,z=k.gl,V=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),j=d.StencilMode.disabled,Y=f.colorModeForRenderPass(),ee=[];for(let oe=0;oe<p.length;oe++){const ne=p[oe],de=r.getTile(ne),re=de.getBucket(c);if(!re)continue;const pe=re.programConfigurations.get(c.id),ge=Io(c),se={programConfiguration:pe,program:f.useProgram("circle",pe,ge),layoutVertexBuffer:re.layoutVertexBuffer,indexBuffer:re.indexBuffer,uniformValues:fr(f,ne,de,c),tile:de};if(A){const _e=re.segments.get();for(const Ce of _e)ee.push({segments:new d.SegmentVector([Ce]),sortKey:Ce.sortKey,state:se})}else ee.push({segments:re.segments,sortKey:0,state:se})}A&&ee.sort((oe,ne)=>oe.sortKey-ne.sortKey);for(const oe of ee){const{programConfiguration:ne,program:de,layoutVertexBuffer:re,indexBuffer:pe,uniformValues:ge,tile:se}=oe.state,_e=oe.segments;f.terrain&&f.terrain.setupElevationDraw(se,de,{useDepthForOcclusion:!0}),f.prepareDrawProgram(k,de,se.tileID.toUnwrapped()),de.draw(k,z.TRIANGLES,V,j,Y,d.CullFaceMode.disabled,ge,c.id,re,pe,_e,c.paint,f.transform.zoom,ne)}},heatmap:function(f,r,c,p){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const y=f.context,v=y.gl,D=d.StencilMode.disabled,A=new d.ColorMode([v.ONE,v.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(k,z,V){const j=k.gl;k.activeTexture.set(j.TEXTURE1),k.viewport.set([0,0,z.width/4,z.height/4]);let Y=V.heatmapFbo;if(Y)j.bindTexture(j.TEXTURE_2D,Y.colorAttachment.get()),k.bindFramebuffer.set(Y.framebuffer);else{const ee=j.createTexture();j.bindTexture(j.TEXTURE_2D,ee),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),Y=V.heatmapFbo=k.createFramebuffer(z.width/4,z.height/4,!1),function(oe,ne,de,re){const pe=oe.gl;pe.texImage2D(pe.TEXTURE_2D,0,pe.RGBA,ne.width/4,ne.height/4,0,pe.RGBA,oe.extRenderToTextureHalfFloat?oe.extTextureHalfFloat.HALF_FLOAT_OES:pe.UNSIGNED_BYTE,null),re.colorAttachment.set(de)}(k,z,ee,Y)}})(y,f,c),y.clear({color:d.Color.transparent});for(let k=0;k<p.length;k++){const z=p[k];if(r.hasRenderableParent(z))continue;const V=r.getTile(z),j=V.getBucket(c);if(!j)continue;const Y=j.programConfigurations.get(c.id),ee=f.useProgram("heatmap",Y),{zoom:oe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(V,ee),f.prepareDrawProgram(y,ee,z.toUnwrapped()),ee.draw(y,v.TRIANGLES,d.DepthMode.disabled,D,A,d.CullFaceMode.disabled,So(z.projMatrix,V,oe,c.paint.get("heatmap-intensity")),c.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,c.paint,f.transform.zoom,Y)}y.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,v){const D=y.context,A=D.gl,k=v.heatmapFbo;if(!k)return;D.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get()),D.activeTexture.set(A.TEXTURE1);let z=v.colorRampTexture;z||(z=v.colorRampTexture=new d.Texture(D,v.colorRamp,A.RGBA)),z.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(D,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,y.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(f,c))},line:function(f,r,c,p){if("translucent"!==f.renderPass)return;const y=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(0===y.constantOr(1)||0===v.constantOr(1))return;const D=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),A=f.colorModeForRenderPass(),k=c.paint.get("line-dasharray"),z=k.constantOr(1),V=c.layout.get("line-cap"),j=c.paint.get("line-pattern"),Y=j.constantOr(1),ee=c.paint.get("line-gradient"),oe=c.getCrossfadeParameters(),ne=Y?"linePattern":"line",de=f.context,re=de.gl;for(const pe of p){const ge=r.getTile(pe);if(Y&&!ge.patternsLoaded())continue;const se=ge.getBucket(c);if(!se)continue;f.prepareDrawTile(pe);const _e=se.programConfigurations.get(c.id),Ce=Ll(c),Ze=f.useProgram(ne,_e,Ce),Xe=j.constantOr(null);if(Xe&&ge.imageAtlas){const Dt=ge.imageAtlas,He=Dt.patternPositions[Xe.to.toString()],Tt=Dt.patternPositions[Xe.from.toString()];He&&Tt&&_e.setConstantPatternPositions(He,Tt)}const nt=k.constantOr(null),rt=V.constantOr(null);if(!Y&&nt&&rt&&ge.lineAtlas){const Dt=ge.lineAtlas,He=Dt.getDash(nt.to,rt),Tt=Dt.getDash(nt.from,rt);He&&Tt&&_e.setConstantPatternPositions(He,Tt)}const wt=f.terrain?pe.projMatrix:null,et=Y?oi(f,ge,c,oe,wt):wi(f,ge,c,oe,wt,se.lineClipsArray.length);if(ee){const Dt=se.gradients[c.id];let He=Dt.texture;if(c.gradientVersion!==Dt.version){let Tt=256;if(c.stepInterpolant){const Lt=r.getSource().maxzoom,Jt=pe.canonical.z===Lt?Math.ceil(1<<f.transform.maxZoom-pe.canonical.z):1;Tt=d.clamp(d.nextPowerOfTwo(se.maxLineLength/d.EXTENT*1024*Jt),256,de.maxTextureSize)}Dt.gradient=d.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Tt,image:Dt.gradient||void 0,clips:se.lineClipsArray}),Dt.texture?Dt.texture.update(Dt.gradient):Dt.texture=new d.Texture(de,Dt.gradient,re.RGBA),Dt.version=c.gradientVersion,He=Dt.texture}de.activeTexture.set(re.TEXTURE1),He.bind(c.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}z&&(de.activeTexture.set(re.TEXTURE0),ge.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),_e.updatePaintBuffers(oe)),Y&&(de.activeTexture.set(re.TEXTURE0),ge.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),_e.updatePaintBuffers(oe)),f.prepareDrawProgram(de,Ze,pe.toUnwrapped()),Ze.draw(de,re.TRIANGLES,D,f.stencilModeForClipping(pe),A,d.CullFaceMode.disabled,et,c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,f.transform.zoom,_e,se.layoutVertexBuffer2)}},fill:function(f,r,c,p){const y=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(0===v.constantOr(1))return;const D=f.colorModeForRenderPass(),A=c.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!A.constantOr(1)&&1===y.constantOr(d.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(f.renderPass===k){const z=f.depthModeForSublayer(1,"opaque"===f.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);Ei(f,r,c,p,z,D,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const z=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);Ei(f,r,c,p,z,D,!0)}},"fill-extrusion":function(f,r,c,p){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===f.renderPass){const v=new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))Ho(f,r,c,p,v,d.StencilMode.disabled,d.ColorMode.disabled),Ho(f,r,c,p,v,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const D=f.colorModeForRenderPass();Ho(f,r,c,p,v,d.StencilMode.disabled,D)}}},hillshade:function(f,r,c,p){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const y=f.context,v=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),D=f.colorModeForRenderPass(),A=f.terrain&&f.terrain.renderingToTexture,[k,z]="translucent"!==f.renderPass||A?[{},p]:f.stencilConfigForOverlap(p);for(const V of z){const j=r.getTile(V);if(j.needsHillshadePrepare&&"offscreen"===f.renderPass)la(f,j,c,v,d.StencilMode.disabled,D);else if("translucent"===f.renderPass){const Y=A&&f.terrain?f.terrain.stencilModeForRTTOverlap(V):k[V.overscaledZ];Pa(f,V,j,c,v,Y,D)}}y.viewport.set([0,0,f.width,f.height])},raster:function(f,r,c,p,y,v){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!p.length)return;const D=f.context,A=D.gl,k=r.getSource(),z=f.useProgram("raster"),V=f.colorModeForRenderPass(),j=f.terrain&&f.terrain.renderingToTexture,[Y,ee]=k instanceof ie||j?[{},p]:f.stencilConfigForOverlap(p),oe=ee[ee.length-1].overscaledZ,ne=!f.options.moving;for(const de of ee){const re=j?d.DepthMode.disabled:f.depthModeForSublayer(de.overscaledZ-oe,1===c.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,A.LESS),pe=de.toUnwrapped(),ge=r.getTile(de);if(j&&(!ge||!ge.hasData()))continue;const se=j?de.projMatrix:f.transform.calculateProjMatrix(pe,ne),_e=f.terrain&&j?f.terrain.stencilModeForRTTOverlap(de):Y[de.overscaledZ],Ce=v?0:c.paint.get("raster-fade-duration");ge.registerFadeDuration(Ce);const Ze=r.findLoadedParent(de,0),Xe=W(ge,Ze,r,f.transform,Ce);let nt,rt;f.terrain&&f.terrain.prepareDrawTile(de);const wt="nearest"===c.paint.get("raster-resampling")?A.NEAREST:A.LINEAR;D.activeTexture.set(A.TEXTURE0),ge.texture.bind(wt,A.CLAMP_TO_EDGE),D.activeTexture.set(A.TEXTURE1),Ze?(Ze.texture.bind(wt,A.CLAMP_TO_EDGE),nt=Math.pow(2,Ze.tileID.overscaledZ-ge.tileID.overscaledZ),rt=[ge.tileID.canonical.x*nt%1,ge.tileID.canonical.y*nt%1]):ge.texture.bind(wt,A.CLAMP_TO_EDGE);const et=ua(se,rt||[0,0],nt||1,Xe,c);if(f.prepareDrawProgram(D,z,pe),k instanceof ie)z.draw(D,A.TRIANGLES,re,d.StencilMode.disabled,V,d.CullFaceMode.disabled,et,c.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:He,tileBoundsSegments:Tt}=f.getTileBoundsBuffers(ge);z.draw(D,A.TRIANGLES,re,_e,V,d.CullFaceMode.disabled,et,c.id,Dt,He,Tt)}}},background:function(f,r,c,p){const y=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(0===v)return;const D=f.context,A=D.gl,k=f.transform,z=k.tileSize,V=c.paint.get("background-pattern");if(f.isPatternMissing(V))return;const j=!V&&1===y.a&&1===v&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==j)return;const Y=d.StencilMode.disabled,ee=f.depthModeForSublayer(0,"opaque"===j?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),oe=f.colorModeForRenderPass(),ne=f.useProgram(V?"backgroundPattern":"background");let de,re=p;re||(de=f.getBackgroundTiles(),re=Object.values(de).map(ge=>ge.tileID)),V&&(D.activeTexture.set(A.TEXTURE0),f.imageManager.bind(f.context));const pe=c.getCrossfadeParameters();for(const ge of re){const se=ge.toUnwrapped(),_e=p?ge.projMatrix:f.transform.calculateProjMatrix(se);f.prepareDrawTile(ge);const Ce=r?r.getTile(ge):de?de[ge.key]:new d.Tile(ge,z,k.zoom,f),Ze=V?Ao(_e,v,f,V,{tileID:ge,tileSize:z},pe):_c(_e,v,y);f.prepareDrawProgram(D,ne,se);const{tileBoundsBuffer:Xe,tileBoundsIndexBuffer:nt,tileBoundsSegments:rt}=f.getTileBoundsBuffers(Ce);ne.draw(D,A.TRIANGLES,ee,Y,oe,d.CullFaceMode.disabled,Ze,c.id,Xe,nt,rt)}},sky:function(f,r,c){const p=f.transform,y="mercator"===p.projection.name?1:d.smoothstep(7,8,p.zoom),v=c.paint.get("sky-opacity")*y;if(0===v)return;const D=f.context,A=c.paint.get("sky-type"),k=new d.DepthMode(D.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),z=f.frameCounter/1e3%1;"atmosphere"===A?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(V,j,Y,ee){const oe=V.context,ne=oe.gl;let de=j.skyboxFbo;if(!de){de=j.skyboxFbo=oe.createFramebuffer(32,32,!1),j.skyboxGeometry=new ka(oe),j.skyboxTexture=oe.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,j.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let se=0;se<6;++se)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}oe.bindFramebuffer.set(de.framebuffer),oe.viewport.set([0,0,32,32]);const re=j.getCenter(V,!0),pe=V.useProgram("skyboxCapture"),ge=new Float64Array(16);d.identity(ge),d.rotateY(ge,ge,.5*-Math.PI),rs(oe,j,pe,ge,re,0),d.identity(ge),d.rotateY(ge,ge,.5*Math.PI),rs(oe,j,pe,ge,re,1),d.identity(ge),d.rotateX(ge,ge,.5*-Math.PI),rs(oe,j,pe,ge,re,2),d.identity(ge),d.rotateX(ge,ge,.5*Math.PI),rs(oe,j,pe,ge,re,3),d.identity(ge),rs(oe,j,pe,ge,re,4),d.identity(ge),d.rotateY(ge,ge,Math.PI),rs(oe,j,pe,ge,re,5),oe.viewport.set([0,0,V.width,V.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(V,j,Y,ee,oe){const ne=V.context,de=ne.gl,re=V.transform,pe=V.useProgram("skybox");ne.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_CUBE_MAP,j.skyboxTexture);const ge={u_matrix:re.skyboxMatrix,u_sun_direction:j.getCenter(V,!1),u_cubemap:0,u_opacity:ee,u_temporal_offset:oe};V.prepareDrawProgram(ne,pe),pe.draw(ne,de.TRIANGLES,Y,d.StencilMode.disabled,V.colorModeForRenderPass(),d.CullFaceMode.backCW,ge,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,c,k,v,z):"gradient"===A&&"sky"===f.renderPass&&function(V,j,Y,ee,oe){const ne=V.context,de=ne.gl,re=V.transform,pe=V.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new ka(ne)),ne.activeTexture.set(de.TEXTURE0);let ge=j.colorRampTexture;ge||(ge=j.colorRampTexture=new d.Texture(ne,j.colorRamp,de.RGBA)),ge.bind(de.LINEAR,de.CLAMP_TO_EDGE);const se=(_e=re.skyboxMatrix,Ce=j.getCenter(V,!1),Ze=j.paint.get("sky-gradient-radius"),Xe=ee,nt=oe,{u_matrix:_e,u_color_ramp:0,u_center_direction:Ce,u_radius:d.degToRad(Ze),u_opacity:Xe,u_temporal_offset:nt});var _e,Ce,Ze,Xe,nt;V.prepareDrawProgram(ne,pe),pe.draw(ne,de.TRIANGLES,Y,d.StencilMode.disabled,V.colorModeForRenderPass(),d.CullFaceMode.backCW,se,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,c,k,v,z)},debug:function(f,r,c){for(let p=0;p<c.length;p++)Mo(f,r,c[p])},custom:function(f,r,c){const p=f.context,y=c.implementation;if("mercator"===f.transform.projection.name){if("offscreen"===f.renderPass){const v=y.prerender;v&&(f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),v.call(y,p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),p.setStencilMode(d.StencilMode.disabled);const v="3d"===y.renderingMode?new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,d.DepthMode.ReadOnly);p.setDepthMode(v),y.render(p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState(),p.bindFramebuffer.set(null)}}else d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class wc{constructor(r,c){this.context=new Co(r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fo,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const p=!!r&&!!r.terrain&&"mercator"===this.transform.projection.name;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Te(this,r));const y=this._terrain;this.transform.elevation=p?y:null,y.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=c.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const v=p+.78*(y-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*d.exported.devicePixelRatio,this.height=c*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,c=new d.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(d.EXTENT,0),c.emplaceBack(0,d.EXTENT),c.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const p=new d.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(d.EXTENT,0),p.emplaceBack(0,d.EXTENT),p.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=r.createVertexBuffer(p,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const y=new d.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const v=new d.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(d.EXTENT,0,d.EXTENT,0),v.emplaceBack(0,d.EXTENT,0,d.EXTENT),v.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(v,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const D=new d.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(D);const A=new d.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])A.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(A),this.emptyTexture=new d.Texture(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA),this.identityMat=d.create$1();const k=this.context.gl;this.stencilClearMode=new d.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(d.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(r,c.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,N(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,c,p){if(!(c&&this.currentStencilSource!==c.id&&r.isTileClipped()&&p&&p.length))return;this.currentStencilSource=c.id;const y=this.context,v=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of p){const k=c.getTile(A),z=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:j,tileBoundsSegments:Y}=this.getTileBoundsBuffers(k);D.draw(y,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},z,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,N(A.projMatrix),"$clipping",V,j,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new d.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new d.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((D,A)=>A.overscaledZ-D.overscaledZ),y=p[p.length-1].overscaledZ,v=p[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const D={};for(let A=0;A<v;A++)D[A+y]=new d.StencilMode({func:c.GEQUAL,mask:255},A+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[D,p]}return[{[y]:d.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new d.ColorMode([r.CONSTANT_COLOR,r.ONE],new d.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(r,c,p){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new d.DepthMode(p||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const p=this.style.order,y=this.style._sourceCaches;for(const z in y){const V=y[z];V.used&&V.prepare(this.context)}const v={},D={},A={};for(const z in y){const V=y[z];v[z]=V.getVisibleCoordinates(),D[z]=v[z].slice().reverse(),A[z]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<p.length;z++)if(this.style._layers[p[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(A),this.opaquePassCutoff=0),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of p){const V=this.style._layers[z],j=r._getLayerSourceCache(V);if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const Y=j?D[j.id]:void 0;("custom"===V.type||V.isSky()||Y&&Y.length)&&this.renderLayer(this,j,V,Y)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=d.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?d.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(z);if(z.isSky())continue;const j=V?D[V.id]:void 0;this._renderTileClippingMasks(z,V,j),this.renderLayer(this,V,z,j)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const z=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,V,z,V?D[V.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const z=this.style._layers[p[this.currentLayer]],V=r._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=V?("symbol"===z.type?A:D)[V.id]:void 0;this._renderTileClippingMasks(z,V,V?v[V.id]:void 0),this.renderLayer(this,V,z,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let z=null;d.values(this.style._layers).forEach(V=>{const j=r._getLayerSourceCache(V);j&&!V.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<j.getSource().maxzoom)&&(z=j)}),z&&this.options.showTileBoundaries&&xs.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const V=z.transform.padding;$i(z,z.transform.height-(V.top||0),3,xc),$i(z,V.bottom||0,3,jn),bc(z,V.left||0,3,Gs),bc(z,z.transform.width-(V.right||0),3,Ol);const j=z.transform.centerPoint;var Y,ee,oe,ne;vs(Y=z,(ee=j.x)-1,(oe=z.transform.height-j.y)-10,2,20,ne=Li),vs(Y,ee-10,oe-1,20,2,ne)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%d.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,c,p,y){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),xs[p.type](r,c,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const c={};for(const p in r){const y=r[p],v=this.context.extTimerQuery,D=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),c[p]=D}return c}translatePosMatrix(r,c,p,y,v){if(!p[0]&&!p[1])return r;const D=v?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(D){const z=Math.sin(D),V=Math.cos(D);p=[p[0]*V-p[1]*z,p[0]*z+p[1]*V]}const A=[v?p[0]:sr(c,p[0],this.transform.zoom),v?p[1]:sr(c,p[1],this.transform.zoom),0],k=new Float32Array(16);return d.translate(k,r,A),k}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const c=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!c||!p}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),c&&!r&&0!==c.getOpacity(this.transform.pitch)&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,c,p){this.cache=this.cache||{};const y=p||[],v=this.currentGlobalDefines().concat(y),D=pt.cacheKey(r,v,c);return this.cache[D]||(this.cache[D]=new pt(this.context,r,oa[r],c,yc[r],v)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(r){this.terrain&&this.terrain.prepareDrawTile(r)}prepareDrawProgram(r,c,p){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch);0!==v&&c.setFogUniformValues(r,((D,A,k,z)=>{const V=A.properties.get("color"),j=D.frameCounter/1e3%1,Y=[V.r/V.a,V.g/V.a,V.b/V.a,z];return{u_fog_matrix:k?D.transform.calculateFogTileMatrix(k):D.identityMat,u_fog_range:A.getFovAdjustedRange(D.transform._fov),u_fog_color:Y,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:j}})(this,y,p,v))}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)c[y.key]=r[y.key]||new d.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Po{constructor(r=0,c=0,p=0,y=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=y}interpolate(r,c,p){return null!=c.top&&null!=r.top&&(this.top=d.number(r.top,c.top,p)),null!=c.bottom&&null!=r.bottom&&(this.bottom=d.number(r.bottom,c.bottom,p)),null!=c.left&&null!=r.left&&(this.left=d.number(r.left,c.left,p)),null!=c.right&&null!=r.right&&(this.right=d.number(r.right,c.right,p)),this}getCenter(r,c){const p=d.clamp((this.left+r-this.right)/2,0,r),y=d.clamp((this.top+c-this.bottom)/2,0,c);return new d.pointGeometry(p,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hs(f,r){return[f[4*r],f[4*r+1],f[4*r+2],f[4*r+3]]}function go(f,r,c){f[4*r+0]=c[0],f[4*r+1]=c[1],f[4*r+2]=c[2],f[4*r+3]=c[3]}function qo(f,r){const c=Hs(f,3);d.fromQuat(f,r),go(f,3,c)}function zl(f,r){go(f,3,[r[0],r[1],r[2],1])}function tl(f,r){const c=d.identity$1([]);return d.rotateZ$1(c,c,-r),d.rotateX$1(c,c,-f),c}function bs(f,r){const c=[f[0],f[1],0],p=[r[0],r[1],0];if(d.length(c)>=1e-15){const D=d.normalize([],c);d.scale(p,D,d.dot(p,D)),r[0]=p[0],r[1]=p[1]}const y=d.cross([],r,f);if(d.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return tl(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}class Nl{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){this._position=this._renderWorldCopies?function(c){if(!c)return;const p=Array.isArray(c)?new d.MercatorCoordinate(c[0],c[1],c[2]):c;return p.x=d.wrap(p.x,0,1),p}(r):r}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(r)):0,y=this.position,v=d.MercatorCoordinate.fromLngLat(r,p),D=[v.x-y.x,v.y-y.y,v.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=bs(D,c)}setPitchBearing(r,c){this.orientation=tl(d.degToRad(r),d.degToRad(-c))}}class ws{constructor(r,c){this._transform=d.identity([]),this._orientation=d.identity$1([]),c&&(this._orientation=c,qo(this._transform,this._orientation)),r&&zl(this._transform,r)}get mercatorPosition(){const r=this.position;return new d.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=Hs(this._transform,3);return[r[0],r[1],r[2]]}set position(r){zl(this._transform,r)}get orientation(){return this._orientation}set orientation(r){this._orientation=r,qo(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=tl(r,c),qo(this._transform,this._orientation)}forward(){const r=Hs(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=Hs(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=Hs(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return d.invert(p,this.getWorldToCamera(r,c)),p}getWorldToCameraPosition(r,c,p){const y=this.position;d.scale(y,y,-r);const v=new Float64Array(16);return d.fromScaling(v,[p,p,p]),d.translate(v,v,y),v[10]*=c,v}getWorldToCamera(r,c){const p=new Float64Array(16),y=new Float64Array(4),v=this.position;return d.conjugate(y,this._orientation),d.scale(v,v,-r),d.fromQuat(p,y),d.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,y){const v=new Float64Array(16);return d.perspective(v,r,c,p,y),v}getDistanceToElevation(r){const c=0===r?0:d.mercatorZfromAltitude(r,this.position[1]),p=this.forward();return(c-this.position[2])/p[2]}clone(){return new ws([...this.position],[...this.orientation])}}function Bl(f,r){const c=Ci(f),p=function(v,D,A,k,z){const V=new d.LngLat(A.lng-180*no,A.lat),j=new d.LngLat(A.lng+180*no,A.lat),Y=v.project(V.lng,V.lat),ee=v.project(j.lng,j.lat),oe=-Math.atan2(ee.y-Y.y,ee.x-Y.x),ne=d.MercatorCoordinate.fromLngLat(A);ne.y=d.clamp(ne.y,-.999975,.999975);const de=ne.toLngLat(),re=v.project(de.lng,de.lat),pe=d.MercatorCoordinate.fromLngLat(de);pe.x+=no;const ge=pe.toLngLat(),se=v.project(ge.lng,ge.lat),_e=tu(se.x-re.x,se.y-re.y,oe),Ce=d.MercatorCoordinate.fromLngLat(de);Ce.y+=no;const Ze=Ce.toLngLat(),Xe=v.project(Ze.lng,Ze.lat),nt=tu(Xe.x-re.x,Xe.y-re.y,oe),rt=Math.abs(_e.x)/Math.abs(nt.y),wt=d.identity([]);d.rotateZ(wt,wt,-oe*(1-(z?0:k)));const et=d.identity([]);return d.scale$1(et,et,[1,1-(1-rt)*k,1]),et[4]=-nt.x/nt.y*k,d.rotateZ(et,et,oe),d.multiply(et,wt,et),et}(f.projection,0,f.center,c,r),y=nl(f);return d.scale$1(p,p,[y,y,1]),p}function nl(f){const r=f.projection,c=Ci(f),p=pr(r,f.center),y=pr(r,d.LngLat.convert(r.center));return Math.pow(2,p*c+(1-c)*y)}function Ci(f){const r=f.projection.range;if(!r)return 0;const c=Math.max(f.width,f.height),p=Math.log(c/1024)/Math.LN2;return d.smoothstep(r[0]+p,r[1]+p,f.zoom)}const no=1/4e4;function pr(f,r){const c=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),p=new d.LngLat(r.lng-180*no,c),y=new d.LngLat(r.lng+180*no,c),v=f.project(p.lng,c),D=f.project(y.lng,c),A=d.MercatorCoordinate.fromLngLat(p),k=d.MercatorCoordinate.fromLngLat(y),z=D.x-v.x,V=D.y-v.y,j=k.x-A.x,Y=k.y-A.y,ee=Math.sqrt((j*j+Y*Y)/(z*z+V*V));return Math.log(ee)/Math.LN2}function tu(f,r,c){const p=Math.cos(c),y=Math.sin(c);return{x:f*p-r*y,y:f*y+r*p}}class Ec{constructor(r,c,p,y,v){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=null==p?0:p,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Po,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ws,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const r=new Ec(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r.tileSize=this.tileSize,r.setMaxBounds(this.getMaxBounds()),r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._cameraZoom=this._cameraZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.setProjection(this.getProjection()),r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,r?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(r){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),r&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(r){null==r&&(r={name:"mercator"}),this.projectionOptions=r;const c=this.projection?this.getProjection():void 0;return this.projection=d.getProjection(r),!Ve(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var p,y,v,D,A,k,z,V,j,Y;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),y=this.rotationMatrix,D=this.angle,A=(v=this.rotationMatrix)[0],k=v[1],z=v[2],V=v[3],j=Math.sin(D),Y=Math.cos(D),y[0]=A*Y+z*j,y[1]=k*Y+V*j,y[2]=A*-j+z*Y,y[3]=k*-j+V*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=d.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===r?(this._cameraZoom=null,!1):(this._centerAltitude=r,!0)}_updateCameraOnTerrain(){const r=this.cameraToCenterDistance/this.worldSize,c=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(c+r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,v=0;for(let D=0;D<c.length;D++){const A=new d.pointGeometry(c[D][0]*this.width,p+c[D][1]*(this.height-p)),k=r.pointCoordinate(A);if(!k)continue;const z=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);y+=k[3]*z,v+=z}return 0===v?NaN:y/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const r=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=d.mercatorZfromAltitude(c,this.center.lat),y=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),D=Math.max(y-p,v);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const y=d.length(d.sub([],this._camera.position,p));return d.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!d.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];d.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Nl;return c.position=new d.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!d.length$1(r))return!1;d.normalize$1(r,r);const c=d.transformQuat([],[0,0,-1],r),p=d.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const y=bs(c,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=d.clamp(r[2],y/p,y/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new d.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new d.pointGeometry(0,0)),y=this.pointCoordinate(new d.pointGeometry(this.width,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new d.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,y.x,v.x,D.x)),k=Math.floor(Math.max(p.x,y.x,v.x,D.x)),z=1;for(let V=A-z;V<=k+z;V++)0!==V&&c.push(new d.UnwrappedTileID(V,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,y=this.elevation&&!r.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const D=this.locationCoordinate(this.center),A=1<<c,k=[A*D.x,A*D.y,0],z=Vn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),V=this.pointCoordinate(this.getCameraPoint()),j=A*d.mercatorZfromAltitude(1,this.center.lat),Y=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),ee=[A*V.x,A*V.y,Y],oe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&v?c:0,de=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=r.isTerrainDEM?-de:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=nl(this),ge=He=>{const Tt=1/4e4,Lt=new d.MercatorCoordinate(He.x+Tt,He.y,He.z),Jt=new d.MercatorCoordinate(He.x,He.y+Tt,He.z),pn=He.toLngLat(),rn=Lt.toLngLat(),ln=Jt.toLngLat(),qt=this.locationCoordinate(pn),vn=this.locationCoordinate(rn),Jn=this.locationCoordinate(ln),gi=Math.hypot(vn.x-qt.x,vn.y-qt.y),Ii=Math.hypot(Jn.x-qt.x,Jn.y-qt.y);return Math.sqrt(gi*Ii)*pe/Tt},se=(He,Tt,Lt,Jt,pn,rn)=>{const ln=d.tileTransform({z:He,x:Tt,y:Lt},this.projection);return new nn([(Jt+ln.x/ln.scale)*A,A*(ln.y/ln.scale),pn],[(Jt+ln.x2/ln.scale)*A,A*(ln.y2/ln.scale),rn])},_e=He=>({aabb:se(0,0,0,He,re,de),zoom:0,x:0,y:0,wrap:He,fullyVisible:!1}),Ce=[];let Ze=[];const Xe=c,nt=r.reparseOverscaled?p:c,rt=He=>{if(!this._elevation||!He.tileID)return;const Tt=this._elevation.getMinMaxForTile(He.tileID),Lt=He.aabb;Tt?(Lt.min[2]=Tt.min,Lt.max[2]=Tt.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(He.shouldSplit=Dt(He),He.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},wt=He=>He*He,et=wt((Y-this._centerAltitude)*j),Dt=He=>{if(He.zoom<ne)return!0;if(He.zoom===Xe)return!1;if(null!=He.shouldSplit)return He.shouldSplit;const Tt=He.aabb.distanceX(ee),Lt=He.aabb.distanceY(ee);let Jt=et;y&&(Jt=wt(He.aabb.distanceZ(ee)*j));let pn=1;if(!v&&p<=5){const ln=Math.pow(2,He.zoom),qt=ge(new d.MercatorCoordinate((He.x+.5)/ln,(He.y+.5)/ln));pn=qt>.85?1:qt}const rn=Tt*Tt+Lt*Lt+Jt;return rn<wt((1<<Xe-He.zoom)*oe*pn*((ln,qt)=>{if(qt*wt(.707)<ln)return 1;const vn=Math.sqrt(qt/ln);return vn/(1.4144271570014144+(Math.pow(1.1,vn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Jt,et),rn))};if(this.renderWorldCopies)for(let He=1;He<=3;He++)Ce.push(_e(-He)),Ce.push(_e(He));for(Ce.push(_e(0));Ce.length>0;){const He=Ce.pop(),Tt=He.x,Lt=He.y;let Jt=He.fullyVisible;if(!Jt){const pn=He.aabb.intersects(z);if(0===pn)continue;Jt=2===pn}if(He.zoom!==Xe&&Dt(He))for(let pn=0;pn<4;pn++){const rn=(Tt<<1)+pn%2,ln=(Lt<<1)+(pn>>1),qt={aabb:"mercator"===this.projection.name?He.aabb.quadrant(pn):se(He.zoom+1,rn,ln,He.wrap,0,0),zoom:He.zoom+1,x:rn,y:ln,wrap:He.wrap,fullyVisible:Jt,tileID:void 0,shouldSplit:void 0};y&&(qt.tileID=new d.OverscaledTileID(He.zoom+1===Xe?nt:He.zoom+1,He.wrap,He.zoom+1,rn,ln),rt(qt)),Ce.push(qt)}else{const pn=He.zoom===Xe?nt:He.zoom;if(r.minzoom&&r.minzoom>pn)continue;const rn=k[0]-(.5+Tt+(He.wrap<<He.zoom))*(1<<c-He.zoom),ln=k[1]-.5-Lt,qt=He.tileID?He.tileID:new d.OverscaledTileID(pn,He.wrap,He.zoom,Tt,Lt);Ze.push({tileID:qt,distanceSq:rn*rn+ln*ln})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,Tt=this.horizonLineFromTop();Ze=Ze.filter(Lt=>{const Jt=[0,0,0,1],pn=[d.EXTENT,d.EXTENT,0,1],rn=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());d.transformMat4(Jt,Jt,rn),d.transformMat4(pn,pn,rn);const ln=d.getAABBPointSquareDist(Jt,pn);if(0===ln)return!0;let qt=!1;const vn=this._elevation;if(vn&&ln>He&&0!==Tt){const Jn=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let gi;r.isTerrainDEM||(gi=vn.getMinMaxForTile(Lt.tileID)),gi||(gi={min:re,max:de});const Ii=d.furthestTileCorner(this.rotation),_o=[Ii[0]*d.EXTENT,Ii[1]*d.EXTENT,gi.max];d.transformMat4$1(_o,_o,Jn),qt=(1-_o[1])*this.height*.5<Tt}return ln<He||qt})}return Ze.sort((He,Tt)=>He.distanceSq-Tt.distanceSq).map(He=>He.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=d.clamp(r.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),p=this.projection.project(r.lng,c);return new d.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(r,c){const p=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(r);this.setLocation(new d.MercatorCoordinate(v.x-(p.x-y.x),v.y-(p.y-y.y)))}setLocation(r){this.center=this.coordinateLocation(r),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r){return this._coordinatePoint(this.locationCoordinate(r),!1)}locationPoint3D(r){return this._coordinatePoint(this.locationCoordinate(r),!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const p=c?d.mercatorZfromAltitude(c,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new d.MercatorCoordinate(y.x,y.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const p=null!=c?c:this._centerAltitude,y=[r.x,r.y,0,1],v=[r.x,r.y,1,1];d.transformMat4(y,y,this.pixelMatrixInverse),d.transformMat4(v,v,this.pixelMatrixInverse);const D=v[3];d.scale$2(y,y,1/y[3]),d.scale$2(v,v,1/D);const A=y[2],k=v[2];return{p0:y,p1:v,t:A===k?0:(p-A)/(k-A)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return d.transformMat4(c,c,this.pixelMatrixInverse),d.transformMat4(p,p,this.pixelMatrixInverse),d.scale$2(c,c,1/c[3]),d.scale$2(p,p,1/p[3]),c[2]=d.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,p[2]=d.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,d.scale$2(c,c,1/this.worldSize),d.scale$2(p,p,1/this.worldSize),new dn([c[0],c[1],c[2]],d.normalize([],d.sub([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:y}=r,v=d.mercatorZfromAltitude(c[2],this._center.lat),D=d.mercatorZfromAltitude(p[2],this._center.lat);return new d.MercatorCoordinate(d.number(c[0],p[0],y)/this.worldSize,d.number(c[1],p[1],y)/this.worldSize,d.number(v,D,y))}pointCoordinate(r,c=this._centerAltitude){const p=this.horizonLineFromTop(!1),y=new d.pointGeometry(r.x,Math.max(p,r.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(y,c))}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);const c=this.elevation;let p=this.elevation.pointCoordinate(r);if(p)return new d.MercatorCoordinate(p[0],p[1],p[2]);let y=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r);const D=.02*v,A=r.clone();for(let k=0;k<10&&v-y>D;k++){A.y=d.number(y,v,.66);const z=c.pointCoordinate(A);z?(v=A.y,p=z):y=A.y}return p?new d.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){if(this.elevation)return!this.elevation.pointCoordinate(r);{const c=this.horizonLineFromTop();return r.y<c}}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return d.transformMat4(y,y,this.pixelMatrix),y[3]>0?new d.pointGeometry(y[0]/y[3],y[1]/y[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,c){const p=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),D=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let A=this.pointCoordinate(p,r),k=this.pointCoordinate(y,r);const z=this.pointCoordinate(v,c),V=this.pointCoordinate(D,c),j=(Y,ee)=>(ee.y-Y.y)/(ee.x-Y.x);return A.y>1&&k.y>=0?A=new d.MercatorCoordinate((1-V.y)/j(V,A)+V.x,1):A.y<0&&k.y<=1&&(A=new d.MercatorCoordinate(-V.y/j(V,A)+V.x,0)),k.y>1&&A.y>=0?k=new d.MercatorCoordinate((1-z.y)/j(z,k)+z.x,1):k.y<0&&A.y<=1&&(k=new d.MercatorCoordinate(-z.y/j(z,k)+z.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(z))}_getBounds3D(){const r=this.elevation,c=r.visibleDemTiles.reduce((p,y)=>{if(y.dem){const v=y.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){let p,y,v;const D=r.canonical,A=d.identity(new Float64Array(16));if("mercator"===this.projection.name)p=c/this.zoomScale(D.z),y=(D.x+Math.pow(2,D.z)*r.wrap)*p,v=D.y*p;else{const k=d.tileTransform(D,this.projection);p=1,y=k.x+r.wrap*k.scale,v=k.y,d.scale$1(A,A,[p/k.scale,p/k.scale,this.pixelsPerMeter/this.worldSize])}return d.translate(A,A,[y,v,0]),d.scale$1(A,A,[p/d.EXTENT,p/d.EXTENT,1]),A}calculateDistanceTileData(r){const c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];const y=r.canonical,v=1/this.height,D=this.cameraWorldSize/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*r.wrap)*D,k=y.y*D,z=this.point,V=this.angle,j=Math.sin(-V),Y=-Math.cos(-V);return p[c]={bearing:[j,Y],center:[(z.x-A)*v,(z.y-k)*v],scale:D/d.EXTENT*v},p[c]}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const y=this.calculatePosMatrix(r,this.cameraWorldSize);return d.multiply(y,this.worldToFogMatrix,y),p[c]=new Float32Array(y),p[c]}calculateProjMatrix(r,c=!1){const p=r.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[p])return y[p];const v=this.calculatePosMatrix(r,this.worldSize);return d.multiply(v,"mercator"===this.projection.name?c?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,v),y[p]=new Float32Array(v),y[p]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const y=function(v,D){const{scale:A}=v.tileTransform,k=A*d.EXTENT/(v.tileSize*Math.pow(2,D.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return z=new Float32Array(4),Y=(V=D.inverseAdjustmentMatrix)[1],ee=V[2],oe=V[3],de=(j=[k,k])[1],z[0]=V[0]*(ne=j[0]),z[1]=Y*ne,z[2]=ee*de,z[3]=oe*de,z;var z,V,j,Y,ee,oe,ne,de}(r,this);return p[c]=y,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const c=this._camera.position,p=this._camera.forward();if(c[2]<=0||p[2]>=0)return;const y=d.mercatorZfromAltitude(1,this._center.lat);c[2]/=y,p[2]/=y,d.normalize(p,p);const v=r.raycast(c,p,r.exaggeration());if(v){const D=d.scaleAndAdd([],c,p,v),A=new d.MercatorCoordinate(D[0],D[1],d.mercatorZfromAltitude(D[2],d.latFromMercatorY(D[1]))),k=this._camera.position,z=A.z+d.length([A.x-k[0],A.y-k[1],A.z-k[2]]);this._cameraZoom=this._zoomFromMercatorZ(z),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const c=r.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),y=d.mercatorZfromAltitude(c,this._center.lat),v=this._camera.position[2]-y;if(v<p){const D=this.locationCoordinate(this._center,this._centerAltitude),A=this._camera.mercatorPosition,k=[D.x-A.x,D.y-A.y,D.z-A.z],z=d.length(k);k[2]-=p-v;const V=d.length(k);if(0===V)return;d.scale(k,k,z/V),this._camera.position=[D.x-k[0],D.y-k[1],D.z-k[2]],this._camera.orientation=bs(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const j=this.center;return j.lat=d.clamp(j.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(j.lng=d.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const r=this._unmodified,{x:c,y:p}=this.point;let y=0,v=c,D=p;const A=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(p-k<z&&(D=z+k),p+k>V&&(D=V-k),V-z<this.height&&(y=Math.max(y,this.height/(V-z)),D=(V+z)/2),this.maxBounds||!this.renderWorldCopies){const j=this.worldMinX*this.scale,Y=this.worldMaxX*this.scale,ee=this.worldSize/2-(j+Y)/2;v=(c+ee+this.worldSize)%this.worldSize-ee,v-A<j&&(v=j+A),v+A>Y&&(v=Y-A),Y-j<this.width&&(y=Math.max(y,this.width/(Y-j)),v=(Y+j)/2)}v===c&&D===p||(this.center=this.unproject(new d.pointGeometry(v,D))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,y=this.fovAboveCenter,v=this.elevation?this.elevation.getMinElevationBelowMSL()*c:0,D=(this._camera.position[2]*this.worldSize-v)/Math.cos(this._pitch),A=Math.sin(y)*D/Math.sin(d.clamp(Math.PI-p-y,.01,Math.PI-.01)),k=this.point,z=k.x,V=k.y,j=Math.cos(Math.PI/2-this._pitch)*A+D,Y=Math.min(1.01*j,D*(1/this._horizonShift)),ee=this.height/50,oe=this._camera.getWorldToCamera(this.worldSize,c),ne=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,ee,Y);ne[8]=2*-r.x/this.width,ne[9]=2*r.y/this.height;let de=d.mul$1([],ne,oe);if("mercator"!==this.projection.name){const wt=this.locationCoordinate(this.center),et=d.identity([]);d.translate(et,et,[wt.x*this.worldSize,wt.y*this.worldSize,0]),d.multiply(et,et,Bl(this)),d.translate(et,et,[-wt.x*this.worldSize,-wt.y*this.worldSize,0]),d.multiply(de,de,et),this.inverseAdjustmentMatrix=function(Dt){const He=Bl(Dt,!0);return ct([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale$1([],de,[this.worldSize,this.worldSize,this.worldSize/c]),this.projMatrix=de,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const re=new Float32Array(16);d.identity(re),d.scale$1(re,re,[1,-1,1]),d.rotateX(re,re,this._pitch),d.rotateZ(re,re,this.angle);const pe=d.perspective(new Float32Array(16),this._fov,this.width/this.height,ee,Y),ge=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;pe[8]=2*-r.x/this.width,pe[9]=2*(r.y+ge)/this.height,this.skyboxMatrix=d.multiply(re,pe,re);const se=this.width%2/2,_e=this.height%2/2,Ce=Math.cos(this.angle),Ze=Math.sin(this.angle),Xe=z-Math.round(z)+Ce*se+Ze*_e,nt=V-Math.round(V)+Ce*_e+Ze*se,rt=new Float64Array(de);if(d.translate(rt,rt,[Xe>.5?Xe-1:Xe,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=rt,de=d.create$1(),d.scale$1(de,de,[this.width/2,-this.height/2,1]),d.translate(de,de,[1,-1,0]),this.labelPlaneMatrix=de,de=d.create$1(),d.scale$1(de,de,[1,-1,1]),d.translate(de,de,[-1,-1,0]),d.scale$1(de,de,[2/this.width,2/this.height,1]),this.glCoordMatrix=de,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},de=d.invert(new Float64Array(16),this.pixelMatrix),!de)throw new Error("failed to invert matrix");this.pixelMatrixInverse=de,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,c=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height,v=[r,r,c];d.scale(v,v,y),d.scale(p,p,-1),d.multiply$1(p,p,v);const D=d.create$1();d.translate(D,D,p),d.scale$1(D,D,v),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,y)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const r=this._camera.forward(),c=this.cameraToCenterDistance,p=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this.cameraToCenterDistance/y;this._camera.position=[p.x/this.worldSize-r[0]*c/v,p.y/this.worldSize-r[1]*c/v,d.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-r[2]*c/v]}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=r[2];let y=1;p>0&&(y=Math.min((c-this._camera.position[2])/p,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,r,y),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),v=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),A=Math.max((r[2]-v)/Math.cos(p),D),k=this._zoomFromMercatorZ(A);d.scaleAndAdd(r,r,c,A),this._pitch=d.clamp(p,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(y,-Math.PI,Math.PI),this._setZoom(d.clamp(k,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new d.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(r,c){const p=Math.min(r.x,c.x),y=Math.max(r.x,c.x),v=Math.min(r.y,c.y),D=Math.max(r.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const A=[new d.pointGeometry(p,v),new d.pointGeometry(y,D),new d.pointGeometry(p,D),new d.pointGeometry(y,v)],k=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const V of A){const j=this.pointRayIntersection(V);if(j.t<0)return!0;const Y=this.rayIntersectionCoordinate(j);if(Y.x<k||Y.y<0||Y.x>z||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,c){const p=d.length(d.sub([],this._camera.position,r)),y=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(y)}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,r))}}function Cc(f,r){let c=!1,p=null;const y=()=>{p=null,c&&(f(),p=setTimeout(y,r),c=!1)};return()=>(c=!0,p||y(),p)}class Vl{constructor(r){this._hashName=r&&encodeURIComponent(r),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Cc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const c=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),D=Math.round(c.lng*v)/v,A=Math.round(c.lat*v)/v,k=this._map.getBearing(),z=this._map.getPitch();let V="";if(V+=r?`/${D}/${A}/${p}`:`${p}/${A}/${D}`,(k||z)&&(V+="/"+Math.round(10*k)/10),z&&(V+=`/${Math.round(z)}`),this._hashName){const j=this._hashName;let Y=!1;const ee=d.window.location.hash.slice(1).split("&").map(oe=>{const ne=oe.split("=")[0];return ne===j?(Y=!0,`${ne}=${V}`):oe}).filter(oe=>oe);return Y||ee.push(`${j}=${V}`),`#${ee.join("&")}`}return`#${V}`}_getCurrentHash(){const r=d.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,r)}}const Fa={linearity:.3,easing:d.bezier(0,0,.3,1)},Tc=d.extend({deceleration:2500,maxSpeed:1400},Fa),Ul=d.extend({deceleration:20,maxSpeed:1400},Fa),qs=d.extend({deceleration:1e3,maxSpeed:360},Fa),fa=d.extend({deceleration:1e3,maxSpeed:90},Fa);class rl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=d.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const v=il(c.pan.mag(),p,d.extend({},Tc,r||{}));y.offset=c.pan.mult(v.amount/c.pan.mag()),y.center=this._map.transform.center,pa(y,v)}if(c.zoom){const v=il(c.zoom,p,Ul);y.zoom=this._map.transform.zoom+v.amount,pa(y,v)}if(c.bearing){const v=il(c.bearing,p,qs);y.bearing=this._map.transform.bearing+d.clamp(v.amount,-179,179),pa(y,v)}if(c.pitch){const v=il(c.pitch,p,fa);y.pitch=this._map.transform.pitch+v.amount,pa(y,v)}if(y.zoom||y.bearing){const v=void 0===c.pinchAround?c.around:c.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),d.extend(y,{noMoveStart:!0})}}function pa(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function il(f,r,c){const{maxSpeed:p,linearity:y,deceleration:v}=c,D=d.clamp(f*y/(r/1e3),-p,p),A=Math.abs(D)/(v*y);return{easing:c.easing,duration:1e3*A,amount:D*(A/2)}}class ei extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,y={}){const v=Me.mousePos(c.getCanvasContainer(),p),D=c.unproject(v);super(r,d.extend({point:v,lngLat:D,originalEvent:p},y)),this._defaultPrevented=!1,this.target=c}}class Es extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const y="touchend"===r?p.changedTouches:p.touches,v=Me.touchPos(c.getCanvasContainer(),y),D=v.map(k=>c.unproject(k)),A=v.reduce((k,z,V,j)=>k.add(z.div(j.length)),new d.pointGeometry(0,0));super(r,{points:v,point:A,lngLats:D,lngLat:c.unproject(A),originalEvent:p}),this._defaultPrevented=!1}}class La extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class nu{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new La(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new ei(r.type,this._map,r))}mouseup(r){this._map.fire(new ei(r.type,this._map,r))}preclick(r){const c=d.extend({},r);c.type="preclick",this._map.fire(new ei(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ei(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ei(r.type,this._map,r))}mouseover(r){this._map.fire(new ei(r.type,this._map,r))}mouseout(r){this._map.fire(new ei(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Es(r.type,this._map,r))}touchmove(r){this._map.fire(new Es(r.type,this._map,r))}touchend(r){this._map.fire(new Es(r.type,this._map,r))}touchcancel(r){this._map.fire(new Es(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zs{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(r){this._map.fire(new ei(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ei("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ei(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jl{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(Me.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=p,this._box||(this._box=Me.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const v=Math.min(y.x,p.x),D=Math.max(y.x,p.x),A=Math.min(y.y,p.y),k=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(Me.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=D-v+"px",this._box.style.height=k-A+"px")})}mouseupWindow(r,c){if(!this._active||0!==r.button)return;const p=this._startPos,y=c;if(this.reset(),Me.suppressClick(),p.x!==y.x||p.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Me.remove(this._box),this._box=null),Me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new d.Event(r,{originalEvent:c}))}}function $l(f,r){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class ru{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const v=new d.pointGeometry(0,0);for(const D of y)v._add(D);return v.div(y.length)}(c),this.touches=$l(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const y=$l(p,c);for(const v in this.touches){const D=this.touches[v],A=y[v];(!A||A.dist(D)>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class ol{constructor(r){this.singleTap=new ru(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const y=this.singleTap.touchend(r,c,p);if(y){const v=r.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(y)<30;if(v&&D||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Oi{constructor(){this._zoomIn=new ol({numTouches:1,numTaps:2}),this._zoomOut=new ol({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const y=this._zoomIn.touchend(r,c,p),v=this._zoomOut.touchend(r,c,p);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(y)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gl={0:1,2:2};class Ti{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=Me.mouseButton(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p)if(r.preventDefault(),function(y,v){const D=Gl[v];return void 0===y.buttons||(y.buttons&D)!==D}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}mouseupWindow(r){this._lastPoint&&Me.mouseButton(r)===this._eventButton&&(this._moved&&Me.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hl extends Ti{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class Ro extends Ti{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Ws extends Ti{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class iu{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const y=$l(p,c),v=new d.pointGeometry(0,0),D=new d.pointGeometry(0,0);let A=0;for(const z in y){const V=y[z],j=this._touches[z];j&&(v._add(V),D._add(V.sub(j)),A++,y[z]=V)}if(this._touches=y,A<this._minTouches||!D.mag())return;const k=D.div(A);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Cs{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){if(!this._firstTwoTouches)return;r.preventDefault();const[y,v]=this._firstTwoTouches,D=ql(p,c,y),A=ql(p,c,v);if(!D||!A)return;const k=this._aroundCenter?null:D.add(A).div(2);return this._move([D,A],k,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,D=ql(p,c,y),A=ql(p,c,v);D&&A||(this._active&&Me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ql(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function ma(f,r){return Math.log(f/r)/Math.LN2}class Di extends Cs{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ma(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ma(this._distance,p),pinchAround:c}}}function Ts(f,r){return 180*f.angleWith(r)/Math.PI}class ko extends Cs{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ts(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=Ts(r,this._startVector);return Math.abs(p)<c}}function Xs(f){return Math.abs(f.y)>Math.abs(f.x)}class sl extends Cs{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(r){this._lastPoints=r,Xs(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const y=r[0].sub(this._lastPoints[0]),v=r[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,v,p.timeStamp),this._valid))return this._lastPoints=r,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5}}gestureBeginsVertically(r,c,p){if(void 0!==this._valid)return this._valid;const y=r.mag()>=2,v=c.mag()>=2;if(!y&&!v)return;if(!y||!v)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const D=r.y>0==c.y>0;return Xs(r)&&Xs(c)&&D}}const is={panStep:100,bearingStep:15,pitchStep:10};class Ft{constructor(){const r=is;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,y=0,v=0,D=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),D=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:A=>{const k=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Oa,zoom:c?Math.round(k)+c*(r.shiftKey?2:1):k,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-D*this._panStep],center:A.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oa(f){return f*(2-f)}const ga=4.000244140625;class _a{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=d.exported.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==c&&c%ga==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Me.mousePos(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,c=()=>r._terrainEnabled()?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>ga?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==z&&(z=1/z);const V=c(),j=Math.pow(2,V),Y="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Y*z))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,v=this._easing;let D,A=!1;if("wheel"===this._type&&y&&v){const k=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),z=v(k);D=d.number(y,p,z),k<1?this._frameId||(this._frameId=!0):A=!0}else D=p,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:D-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=d.ease;if(this._prevEase){const p=this._prevEase,y=(d.exported.now()-p.start)/p.duration,v=p.easing(y+.01)-p.easing(y),D=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-D*D);c=d.bezier(D,A,.25,1)}return this._prevEase={start:d.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ds{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class al{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Dc{constructor(){this._tap=new ol({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=c[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zl{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ll{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ou{constructor(r,c,p,y){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fo=f=>f.zoom||f.drag||f.pitch||f.rotate;class Ic extends d.Event{}class Wl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=d.sub([],c,r);this.radius=d.length(p[2]<0?d.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){d.div(r,r,this.constants),d.normalize(r,r),d.mul$2(r,r,this.constants);const c=d.scale([],r,this.radius);if(c[2]>0){const p=d.scale([],[0,0,1],d.dot(c,[0,0,1])),y=d.scale([],d.normalize([],[c[0],c[1],0]),this.radius),v=d.add([],c,d.scale([],d.sub([],d.add([],y,p),c),2));c[0]=v[0],c[1]=v[1]}return c}}function Is(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Ys{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rl(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[y,v,D]of this._listeners)Me.addEventListener(y,v,y===d.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[r,c,p]of this._listeners)Me.removeEventListener(r,c,r===d.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new nu(c,r));const y=c.boxZoom=new jl(c,r);this._add("boxZoom",y);const v=new Oi,D=new al;c.doubleClickZoom=new Ds(D,v),this._add("tapZoom",v),this._add("clickZoom",D);const A=new Dc;this._add("tapDragZoom",A);const k=c.touchPitch=new sl(c);this._add("touchPitch",k);const z=new Ro(r),V=new Ws(r);c.dragRotate=new ll(r,z,V),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const j=new Hl(r),Y=new iu(c,r);c.dragPan=new Zl(p,j,Y),this._add("mousePan",j),this._add("touchPan",Y,["touchZoom","touchRotate"]);const ee=new ko,oe=new Di;c.touchZoomRotate=new ou(p,oe,ee,A),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zs(c));const ne=c.scrollZoom=new _a(c,this);this._add("scrollZoom",ne,["mousePan"]);const de=c.keyboard=new Ft;this._add("keyboard",de);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[re]&&c[re].enable(r[re])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Fo(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,c,p){for(const y in r)if(y!==p&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p="renderFrame"===r.type,y=p?void 0:r,v={needsRenderFrame:!1},D={},A={},k=r.touches?this._getMapTouches(r.touches):void 0,z=k?Me.touchPos(this._el,k):p?void 0:Me.mousePos(this._el,r);for(const{handlerName:Y,handler:ee,allowed:oe}of this._handlers){if(!ee.isEnabled())continue;let ne;this._blockedByActive(A,oe,Y)?ee.reset():ee[c||r.type]&&(ne=ee[c||r.type](r,z,k),this.mergeHandlerResult(v,D,ne,Y,y),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||ee.isActive())&&(A[Y]=ee)}const V={};for(const Y in this._previousActiveHandlers)A[Y]||(V[Y]=y);this._previousActiveHandlers=A,(Object.keys(V).length||Is(v))&&(this._changes.push([v,D,V]),this._triggerRenderFrame()),(Object.keys(A).length||Is(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=v;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(r,c,p,y,v){if(!p)return;d.extend(r,p);const D={handlerName:y,originalEvent:p.originalEvent||v};void 0!==p.zoomDelta&&(c.zoom=D),void 0!==p.panDelta&&(c.drag=D),void 0!==p.pitchDelta&&(c.pitch=D),void 0!==p.bearingDelta&&(c.rotate=D)}_applyChanges(){const r={},c={},p={};for(const[y,v,D]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new d.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(r.around=y.around),void 0!==y.aroundCoord&&(r.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),d.extend(c,v),d.extend(p,D);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const y=this._map,v=y.transform,D=pe=>[pe.x,pe.y,pe.z];if((pe=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Is(r)){const pe=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",pe!==v.zoom&&this._map._update(!0)}if(!Is(r))return this._fireEvents(c,p,!0);let{panDelta:A,zoomDelta:k,bearingDelta:z,pitchDelta:V,around:j,aroundCoord:Y,pinchAround:ee}=r;void 0!==ee&&(j=ee),(pe=>c.drag&&!this._eventsInProgress.drag)()&&j&&(this._dragOrigin=D(v.pointCoordinate3D(j)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),j=j||y.transform.centerPoint,z&&(v.bearing+=z),V&&(v.pitch+=V),v._updateCameraState();const oe=[0,0,0];if(A){const pe=v.screenPointToMercatorRay(j),ge=v.screenPointToMercatorRay(j.sub(A)),se=this._trackingEllipsoid.projectRay(pe.dir),_e=this._trackingEllipsoid.projectRay(ge.dir);oe[0]=_e[0]-se[0],oe[1]=_e[1]-se[1]}const ne=v.zoom,de=[0,0,0];if(k){const pe=D(Y||v.pointCoordinate3D(j)),ge={dir:d.normalize([],d.sub([],pe,v._camera.position))},se=v.screenPointToMercatorRay(v.centerPoint);if(ge.dir[2]<0){const _e=d.altitudeFromMercatorZ(pe[2],pe[1]),Ce=v.rayIntersectionCoordinate(v.pointRayIntersection(v.centerPoint,_e)),Ze=v.zoomDeltaToMovement(D(Ce),k)*(se.dir[2]/ge.dir[2]);d.scale(de,ge.dir,Ze)}else if(v._terrainEnabled()){const _e=v.zoomDeltaToMovement(pe,k);d.scale(de,ge.dir,_e)}}const re=d.add(oe,oe,de);v._translateCameraConstrained(re),k&&Math.abs(v.zoom-ne)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const y=Fo(this._eventsInProgress),v=Fo(r),D={};for(const V in r){const{originalEvent:j}=r[V];this._eventsInProgress[V]||(D[`${V}start`]=j),this._eventsInProgress[V]=r[V]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in D)this._fireEvent(V,D[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in r){const{originalEvent:j}=r[V];this._fireEvent(V,j)}const A={};let k;for(const V in this._eventsInProgress){const{handlerName:j,originalEvent:Y}=this._eventsInProgress[V];this._handlersById[j].isActive()||(delete this._eventsInProgress[V],k=c[j]||Y,A[`${V}end`]=k)}for(const V in A)this._fireEvent(V,A[V]);const z=Fo(this._eventsInProgress);if(p&&(y||v)&&!z){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;V?(j(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:k})):(this._map.fire(new d.Event("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new d.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Ic("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Sc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ac extends d.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=d.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,d.extend({offset:r},c),p)}panTo(r,c,p){return this.easeTo(d.extend({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(d.extend({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(d.extend({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,d.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=d.LngLatBounds.convert(r);const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=d.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=d.extend(c,r.padding),r}_cameraForBoxAndBearing(r,c,p,y){const v=this._extendCameraOptions(y),D=this.transform,A=D.padding,k=D.project(d.LngLat.convert(r)),z=D.project(d.LngLat.convert(c)),V=k.rotate(-d.degToRad(p)),j=z.rotate(-d.degToRad(p)),Y=new d.pointGeometry(Math.max(V.x,j.x),Math.max(V.y,j.y)),ee=new d.pointGeometry(Math.min(V.x,j.x),Math.min(V.y,j.y)),oe=Y.sub(ee),ne=(D.width-(A.left+A.right+v.padding.left+v.padding.right))/oe.x,de=(D.height-(A.top+A.bottom+v.padding.top+v.padding.bottom))/oe.y;if(de<0||ne<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(D.scaleZoom(D.scale*Math.min(ne,de)),v.maxZoom),pe="number"==typeof v.offset.x?new d.pointGeometry(v.offset.x,v.offset.y):d.pointGeometry.convert(v.offset),ge=new d.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(p*Math.PI/180),se=pe.add(ge).mult(D.scale/D.zoomScale(re));return{center:D.unproject(k.add(z).div(2).sub(se)),zoom:re,bearing:p}}_cameraForBox(r,c,p,y,v){const D=this._extendCameraOptions(v);p=p||0,y=y||0,r=d.LngLat.convert(r),c=d.LngLat.convert(c);const A=this.transform.clone();A.padding=D.padding;const k=this.getFreeCameraOptions(),z=new d.LngLat(.5*(r.lng+c.lng),.5*(r.lat+c.lat)),V=.5*(p+y);if(A._camera.position[2]<d.mercatorZfromAltitude(V,z.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(z),A.setFreeCameraOptions(k);const j=d.MercatorCoordinate.fromLngLat(r),Y=d.MercatorCoordinate.fromLngLat(c),ee=A.pointRayIntersection(A.centerPoint,V),oe=[(ne=A.rayIntersectionCoordinate(ee)).x,ne.y,ne.z];var ne;const de=A.screenPointToMercatorRay(A.centerPoint);let re,pe=0;do{const ge=Math.floor(A.zoom),se=1<<ge,_e=Math.min(se*j.x,se*Y.x),Ce=Math.min(se*j.y,se*Y.y),Ze=Math.max(se*j.x,se*Y.x),Xe=Math.max(se*j.y,se*Y.y),nt=new nn([_e,Ce,p],[Ze,Xe,y]),rt=Vn.fromInvProjectionMatrix(A.invProjMatrix,A.worldSize,ge);if(2!==nt.intersects(rt)){re&&(A._camera.position=d.scaleAndAdd([],A._camera.position,de.dir,-re),A._updateStateFromCamera());break}const wt=d.sub([],A._camera.position,oe);re=.5*d.length(wt),A._camera.position=d.scaleAndAdd([],A._camera.position,de.dir,re);try{A._updateStateFromCamera()}catch(et){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++pe<10);return{center:A.center,zoom:A.zoom,bearing:A.bearing,pitch:A.pitch}}fitBounds(r,c,p){return this._fitInternal(this.cameraForBounds(r,c),c,p)}_raycastElevationBox(r,c){const p=this.transform.elevation;if(!p)return;const y=new d.pointGeometry(r.x,c.y),v=new d.pointGeometry(c.x,r.y),D=p.pointCoordinate(r);if(!D)return;const A=p.pointCoordinate(c);if(!A)return;const k=p.pointCoordinate(y);if(!k)return;const z=p.pointCoordinate(v);if(!z)return;const V=new d.MercatorCoordinate(D[0],D[1]).toLngLat(),j=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),Y=new d.MercatorCoordinate(k[0],k[1]).toLngLat(),ee=new d.MercatorCoordinate(z[0],z[1]).toLngLat(),oe=Math.min(V.lng,Math.min(j.lng,Math.min(Y.lng,ee.lng))),ne=Math.min(V.lat,Math.min(j.lat,Math.min(Y.lat,ee.lat))),de=Math.max(V.lng,Math.max(j.lng,Math.max(Y.lng,ee.lng))),re=Math.max(V.lat,Math.max(j.lat,Math.max(Y.lat,ee.lat))),pe=Math.min(D[3],Math.min(A[3],Math.min(k[3],z[3]))),ge=Math.max(D[3],Math.max(A[3],Math.max(k[3],z[3])));return{minLngLat:new d.LngLat(oe,ne),maxLngLat:new d.LngLat(de,re),minAltitude:pe,maxAltitude:ge}}fitScreenCoordinates(r,c,p,y,v){let D,A,k,z;const V=d.pointGeometry.convert(r),j=d.pointGeometry.convert(c),Y=this._raycastElevationBox(V,j);if(Y)D=Y.minLngLat,A=Y.maxLngLat,k=Y.minAltitude,z=Y.maxAltitude;else{if(this.transform.anyCornerOffEdge(V,j))return this;D=this.transform.pointLocation(V),A=this.transform.pointLocation(j)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(r)),this.transform.pointLocation(d.pointGeometry.convert(c)),p,y):this._cameraForBox(D,A,k,z,y),y,v)}_fitInternal(r,c,p){return r?(delete(c=d.extend(r,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(r,c){this.stop();const p=this.transform;let y=!1,v=!1,D=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(y=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=d.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(v=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(D=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),y&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),v&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),D&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&d.warnOnce(Sc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const p=this.transform;if("mercator"!==p.projection.name)return void d.warnOnce(Sc);this.stop();const y=p.zoom,v=p.pitch,D=p.bearing;p.setFreeCameraOptions(r);const A=y!==p.zoom,k=v!==p.pitch,z=D!==p.bearing;return this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),A&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),z&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),k&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=d.extend({offset:[0,0],duration:500,easing:d.ease},r)).animate||!r.essential&&d.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,y=this.getZoom(),v=this.getBearing(),D=this.getPitch(),A=this.getPadding(),k="zoom"in r?+r.zoom:y,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,V="pitch"in r?+r.pitch:D,j="padding"in r?r.padding:p.padding,Y=d.pointGeometry.convert(r.offset);let ee=p.centerPoint.add(Y);const oe=p.pointLocation(ee),ne=d.LngLat.convert(r.center||oe);this._normalizeCenter(ne);const de=p.project(oe),re=p.project(ne).sub(de),pe=p.zoomScale(k-y);let ge,se;r.around&&(ge=d.LngLat.convert(r.around),se=p.locationPoint(ge));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==y,this._rotating=this._rotating||v!==z,this._pitching=this._pitching||V!==D,this._padding=!p.isPaddingEqual(j),this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,_e),this._ease(Ce=>{if(this._zooming&&(p.zoom=d.number(y,k,Ce)),this._rotating&&(p.bearing=d.number(v,z,Ce)),this._pitching&&(p.pitch=d.number(D,V,Ce)),this._padding&&(p.interpolatePadding(A,j,Ce),ee=p.centerPoint.add(Y)),ge)p.setLocationAtPoint(ge,se);else{const Ze=p.zoomScale(p.zoom-y),Xe=k>y?Math.min(2,pe):Math.max(.5,pe),nt=Math.pow(Xe,1-Ce),rt=p.unproject(de.add(re.mult(Ce*nt)).mult(Ze));p.setLocationAtPoint(p.renderWorldCopies?rt.wrap():rt,ee)}this._fireMoveEvents(c)},Ce=>{p.recenterOnTerrain(),this._afterEase(c,Ce)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||p.moving||this.fire(new d.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new d.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new d.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new d.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new d.Event("move",r)),this._zooming&&this.fire(new d.Event("zoom",r)),this._rotating&&this.fire(new d.Event("rotate",r)),this._pitching&&this.fire(new d.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new d.Event("zoomend",r)),y&&this.fire(new d.Event("rotateend",r)),v&&this.fire(new d.Event("pitchend",r)),this.fire(new d.Event("moveend",r))}flyTo(r,c){if(!r.essential&&d.exported.prefersReducedMotion){const Tt=d.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Tt,c)}this.stop(),r=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},r);const p=this.transform,y=this.getZoom(),v=this.getBearing(),D=this.getPitch(),A=this.getPadding(),k="zoom"in r?d.clamp(+r.zoom,p.minZoom,p.maxZoom):y,z="bearing"in r?this._normalizeBearing(r.bearing,v):v,V="pitch"in r?+r.pitch:D,j="padding"in r?r.padding:p.padding,Y=p.zoomScale(k-y),ee=d.pointGeometry.convert(r.offset);let oe=p.centerPoint.add(ee);const ne=p.pointLocation(oe),de=d.LngLat.convert(r.center||ne);this._normalizeCenter(de);const re=p.project(ne),pe=p.project(de).sub(re);let ge=r.curve;const se=Math.max(p.width,p.height),_e=se/Y,Ce=pe.mag();if("minZoom"in r){const Tt=d.clamp(Math.min(r.minZoom,y,k),p.minZoom,p.maxZoom),Lt=se/p.zoomScale(Tt-y);ge=Math.sqrt(Lt/Ce*2)}const Ze=ge*ge;function Xe(Tt){const Lt=(_e*_e-se*se+(Tt?-1:1)*Ze*Ze*Ce*Ce)/(2*(Tt?_e:se)*Ze*Ce);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function nt(Tt){return(Math.exp(Tt)-Math.exp(-Tt))/2}function rt(Tt){return(Math.exp(Tt)+Math.exp(-Tt))/2}const wt=Xe(0);let et=function(Tt){return rt(wt)/rt(wt+ge*Tt)},Dt=function(Tt){return se*((rt(wt)*(nt(Lt=wt+ge*Tt)/rt(Lt))-nt(wt))/Ze)/Ce;var Lt},He=(Xe(1)-wt)/ge;if(Math.abs(Ce)<1e-6||!isFinite(He)){if(Math.abs(se-_e)<1e-6)return this.easeTo(r,c);const Tt=_e<se?-1:1;He=Math.abs(Math.log(_e/se))/ge,Dt=function(){return 0},et=function(Lt){return Math.exp(Tt*ge*Lt)}}return r.duration="duration"in r?+r.duration:1e3*He/("screenSpeed"in r?+r.screenSpeed/ge:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=v!==z,this._pitching=V!==D,this._padding=!p.isPaddingEqual(j),this._prepareEase(c,!1),this._ease(Tt=>{const Lt=Tt*He,Jt=1/et(Lt);p.zoom=1===Tt?k:y+p.scaleZoom(Jt),this._rotating&&(p.bearing=d.number(v,z,Tt)),this._pitching&&(p.pitch=d.number(D,V,Tt)),this._padding&&(p.interpolatePadding(A,j,Tt),oe=p.centerPoint.add(ee));const pn=1===Tt?de:p.unproject(re.add(pe.mult(Dt(Lt))).mult(Jt));p.setLocationAtPoint(p.renderWorldCopies?pn.wrap():pn,oe),p._updateCenterElevation(),this._fireMoveEvents(c)},()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){!1===p.animate||0===p.duration?(r(1),c()):(this._easeStart=d.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=d.wrap(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}}class Xl{constructor(r={}){this.options=r,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Me.create("button","mapboxgl-ctrl-attrib-button",this._container),Me.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Me.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){Me.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const p=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",p),r.firstElementChild&&r.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(r){const p=c.reduce((y,v,D)=>(v.value&&(y+=`${v.key}=${v.value}${D<c.length-1?"&":""}`),y),"?");r.href=`${d.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const v=c[y];if(v.used){const D=v.getSource();D.attribution&&r.indexOf(D.attribution)<0&&r.push(D.attribution)}}r.sort((y,v)=>y.length-v.length),r=r.filter((y,v)=>{for(let D=v+1;D<r.length;D++)if(r[D].indexOf(y)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ks{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(r){this._map=r,this._container=Me.create("div","mapboxgl-ctrl");const c=Me.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Me.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const y of p)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function cl(f,r,c){if(f=new d.LngLat(f.lng,f.lat),r){const p=new d.LngLat(f.lng-360,f.lat),y=new d.LngLat(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),D=c.locationPoint(f).distSqr(r),A=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(p).distSqr(r)<D&&(A||Math.abs(p.lng-c.center.lng)<v)?f=p:c.locationPoint(y).distSqr(r)<D&&(A||Math.abs(y.lng-c.center.lng)<v)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class os extends d.Evented{constructor(r,c){if(super(),(r instanceof d.window.HTMLElement||c)&&(r=d.extend({element:r},c)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=d.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Me.create("div"),this._element.setAttribute("aria-label","Map marker");const y=Me.createNS("http://www.w3.org/2000/svg","svg"),v=41,D=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${v}px`),y.setAttributeNS(null,"width",`${D}px`),y.setAttributeNS(null,"viewBox",`0 0 ${D} ${v}`);const A=Me.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const k=Me.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill-rule","nonzero");const z=Me.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");const V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ge of V){const se=Me.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",ge.rx),se.setAttributeNS(null,"ry",ge.ry),z.appendChild(se)}const j=Me.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill",this._color);const Y=Me.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),j.appendChild(Y);const ee=Me.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"fill","#000000");const oe=Me.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ee.appendChild(oe);const ne=Me.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const de=Me.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const re=Me.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#000000"),re.setAttributeNS(null,"opacity","0.25"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962");const pe=Me.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#FFFFFF"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962"),de.appendChild(re),de.appendChild(pe),k.appendChild(z),k.appendChild(j),k.appendChild(ee),k.appendChild(ne),k.appendChild(de),y.appendChild(k),y.setAttributeNS(null,"height",v*this._scale+"px"),y.setAttributeNS(null,"width",D*this._scale+"px"),this._element.appendChild(y),this._offset=d.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const p=this._element.classList;for(const y in za)p.remove(`mapboxgl-marker-anchor-${y}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),Me.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=d.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const c=38.1,p=13.5,y=Math.sqrt(Math.pow(p,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[y,-1*(c-p+y)],"bottom-right":[-y,-1*(c-p+y)],left:[p,-1*(c-p)],right:[-p,-1*(c-p)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const r=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(r))return void this._clearFadeTimer();const c=this._map.unproject(r);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const D=v.position.toLngLat();p=D.distanceTo(c)<.9*D.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(p?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(r){const c=this._map.transform;return!!r&&r.x>=0&&r.x<c.width&&r.y>=0&&r.y<c.height}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=cl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),r&&"moveend"!==r.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&Me.setTransform(this._element,`${za[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const r=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(r.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(r._pitch)),c}getOffset(){return this._offset}setOffset(r){return this._offset=d.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&"auto"!==r?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Ss{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=d.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const ya={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:As,HTMLElement:ul,ImageBitmap:ro}=d.window,ch={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function M(f){f.parentNode&&f.parentNode.removeChild(f)}const T={showCompass:!0,showZoom:!0,visualizePitch:!1};class C{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ro({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Ws({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Me.addEventListener(c,"mousedown",this.mousedown),Me.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),Me.addEventListener(c,"touchmove",this.touchmove),Me.addEventListener(c,"touchend",this.touchend),Me.addEventListener(c,"touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Me.disableDrag()}move(r,c){const p=this.map,y=this.mouseRotate.mousemoveWindow(r,c);if(y&&y.bearingDelta&&p.setBearing(p.getBearing()+y.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(r,c);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const r=this.element;Me.removeEventListener(r,"mousedown",this.mousedown),Me.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),Me.removeEventListener(r,"touchmove",this.touchmove),Me.removeEventListener(r,"touchend",this.touchend),Me.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){Me.enableDrag(),Me.removeEventListener(d.window,"mousemove",this.mousemove),Me.removeEventListener(d.window,"mouseup",this.mouseup)}mousedown(r){this.down(d.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Me.mousePos(this.element,r)),Me.addEventListener(d.window,"mousemove",this.mousemove),Me.addEventListener(d.window,"mouseup",this.mouseup)}mousemove(r){this.move(r,Me.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Me.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Me.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const F={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let B,X=0,ve=!1;const Ie={maxWidth:100,unit:"metric"};function at(f,r,c){const p=c&&c.maxWidth||100,y=f._container.getBoundingClientRect().height/2,v=f.unproject([0,y]),D=f.unproject([p,y]),A=v.distanceTo(D);if(c&&"imperial"===c.unit){const k=3.2808*A;k>5280?Nt(r,p,k/5280,f._getUIString("ScaleControl.Miles"),f):Nt(r,p,k,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?Nt(r,p,A/1852,f._getUIString("ScaleControl.NauticalMiles"),f):A>=1e3?Nt(r,p,A/1e3,f._getUIString("ScaleControl.Kilometers"),f):Nt(r,p,A,f._getUIString("ScaleControl.Meters"),f)}function Nt(f,r,c,p,y){const v=function(A){const k=Math.pow(10,`${Math.floor(A)}`.length-1);let z=A/k;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(V){const j=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*j)/j}(z),k*z}(c),D=v/c;y._requestDomTask(()=>{f.style.width=r*D+"px",f.innerHTML=`${v}&nbsp;${p}`})}const Kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},un=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ar={version:d.version,supported:Zt,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Ac{constructor(f){if(null!=(f=d.extend({},ch,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ec(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Yl,this._domRenderTaskQueue=new Yl,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},ya,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Ss(0),this._requestManager=new d.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=d.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof ul))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ys(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Vl("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,d.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Xl({customAttribution:f.customAttribution})),this._logoControl=new Ks,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new d.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new d.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(f,r){if(void 0===r&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){const[r,c]=this._containerDimensions();if(r===this.transform.width&&c===this.transform.height)return this;this._resizeCanvas(r,c),this.transform.resize(r,c),this.painter.resize(Math.ceil(r),Math.ceil(c));const p=!this._moving;return p&&this.fire(new d.Event("movestart",f)).fire(new d.Event("move",f)),this.fire(new d.Event("resize",f)),p&&this.fire(new d.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection()}project(f){return this.transform.locationPoint3D(d.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(d.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,r,c){if("mouseenter"===f||"mouseover"===f){let p=!1;const y=D=>{const A=r.filter(z=>this.getLayer(z)),k=A.length?this.queryRenderedFeatures(D.point,{layers:A}):[];k.length?p||(p=!0,c.call(this,new ei(f,this,D.originalEvent,{features:k}))):p=!1},v=()=>{p=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:y,mouseout:v}}}if("mouseleave"===f||"mouseout"===f){let p=!1;const y=D=>{const A=r.filter(k=>this.getLayer(k));(A.length?this.queryRenderedFeatures(D.point,{layers:A}):[]).length?p=!0:p&&(p=!1,c.call(this,new ei(f,this,D.originalEvent)))},v=D=>{p&&(p=!1,c.call(this,new ei(f,this,D.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:y,mouseout:v}}}{const p=y=>{const v=r.filter(A=>this.getLayer(A)),D=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];D.length&&(y.features=D,c.call(this,y),delete y.features)};return{layers:new Set(r),listener:c,delegates:{[f]:p}}}}on(f,r,c){if(void 0===c)return super.on(f,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,r,c){if(void 0===c)return super.once(f,r);Array.isArray(r)||(r=[r]);const p=this._createDelegatedListener(f,r,c);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,r,c){if(void 0===c)return super.off(f,r);r=new Set(Array.isArray(r)?r:[r]);const p=(v,D)=>{if(v.size!==D.size)return!1;for(const A of v)if(!D.has(A))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(v=>{for(let D=0;D<v.length;D++){const A=v[D];if(A.listener===c&&p(A.layers,r)){for(const k in A.delegates)this.off(k,A.delegates[k]);return v.splice(D,1),this}}})(y),this}queryRenderedFeatures(f,r){return this.style?(void 0!==r||void 0===f||f instanceof d.pointGeometry||Array.isArray(f)||(r=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(f,r){return this.style.querySourceFeatures(f,r)}queryTerrainElevation(f,r){const c=this.transform.elevation;return c?(r=d.extend({},{exaggerated:!0},r),c.getAtPoint(d.MercatorCoordinate.fromLngLat(f),null,r.exaggerated)):null}setStyle(f,r){return!1!==(r=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(null==r)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new Fi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,r){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),p=this._requestManager.transformRequest(c,d.ResourceType.Style);d.getJSON(p,(y,v)=>{y?this.fire(new d.ErrorEvent(y)):v&&this._updateDiff(v,r)})}else"object"==typeof f&&this._updateDiff(f,r)}_updateDiff(f,r){try{this.style.setState(f)&&this._update(!0)}catch(c){d.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(f,r){return this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)}isSourceLoaded(f){const r=this.style&&this.style._getSourceCaches(f);if(0!==r.length)return r.every(c=>c.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const r in f){const c=f[r]._tiles;for(const p in c){const y=c[p];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(f,r,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:y,stretchY:v,content:D}={}){if(this._lazyInitEmptyStyle(),r instanceof As||ro&&r instanceof ro){const{width:A,height:k,data:z}=d.exported.getImageData(r);this.style.addImage(f,{data:new d.RGBAImage({width:A,height:k},z),pixelRatio:c,stretchX:y,stretchY:v,content:D,sdf:p,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:k,data:z}=r,V=r;this.style.addImage(f,{data:new d.RGBAImage({width:A,height:k},new Uint8Array(z)),pixelRatio:c,stretchX:y,stretchY:v,content:D,sdf:p,version:0,userImage:V}),V.onAdd&&V.onAdd(this,f)}}}updateImage(f,r){const c=this.style.getImage(f);if(!c)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof As||ro&&r instanceof ro?d.exported.getImageData(r):r,{width:y,height:v,data:D}=p;return void 0===y||void 0===v?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||v!==c.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(D,!(r instanceof As||ro&&r instanceof ro)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){d.getImage(this._requestManager.transformRequest(f,d.ResourceType.Image),(c,p)=>{r(c,p instanceof As?d.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(f,r){return this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)}moveLayer(f,r){return this.style.moveLayer(f,r),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,r,c){return this.style.setLayerZoomRange(f,r,c),this._update(!0)}setFilter(f,r,c={}){return this.style.setFilter(f,r,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,r,c,p={}){return this.style.setPaintProperty(f,r,c,p),this._update(!0)}getPaintProperty(f,r){return this.style.getPaintProperty(f,r)}setLayoutProperty(f,r,c,p={}){return this.style.setLayoutProperty(f,r,c,p),this._update(!0)}getLayoutProperty(f,r){return this.style.getLayoutProperty(f,r)}setLight(f,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(f),this.transform):0}setFeatureState(f,r){return this.style.setFeatureState(f,r),this._update()}removeFeatureState(f,r){return this.style.removeFeatureState(f,r),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_containerDimensions(){let f=0,r=0;return this._container&&(f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300),[f,r]}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Me.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=Me.create("div","mapboxgl-canvas-container",f);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=Me.create("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);const p=this._controlContainer=Me.create("div","mapboxgl-control-container",f),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{y[v]=Me.create("div",`mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=d.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const f=d.extend({},Zt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);r?(d.storeAuthState(r,!0),this.painter=new wc(r,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(r)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;const c=this.painter.context.extTimerQuery,p=d.exported.now();this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r));let y=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;let v=!1;const D=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,z=this.transform.pitch,V=d.exported.now();this.style.zoomHistory.update(k,V);const j=new d.EvaluationParameters(k,{now:V,fadeDuration:D,pitch:z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=j.crossFadingFactor();1===Y&&Y===this._crossFadingFactor||(v=!0,this._crossFadingFactor=Y),this.style.update(j)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,D,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:D,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=d.exported.now()-p;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const z=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new d.Event("gpu-timing-frame",{cpuTime:k,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(k);this.fire(new d.Event("gpu-timing-layer",{layerTimes:z}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(A||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(y=this._updateAverageElevation(p,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,r=!1){const c=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const p=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const v=Math.abs(p-y);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===d.AUTH_ERR_MSG||401===f.status)){const r=this.painter.context.gl;d.storeAuthState(r,!1),this._logoControl instanceof Ks&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function y(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const D=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,D),D}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0];const y=f.length/4;for(let v=0;v<r.length;v++){const D=r[v];let A=0;for(let k=0;k<D.length;k+=4)D[k]===f[k]&&D[k+1]===f[k+1]&&D[k+2]===f[k+2]&&D[k+3]===f[k+3]&&(A+=1);p+=(c[v+2]-c[v+1])*(1-A/y)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),M(this._canvasContainer),M(this._controlContainer),M(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,r){d.setCacheLimits(f,r)}get version(){return d.version}},NavigationControl:class{constructor(f){this.options=d.extend({},T,f),this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),Me.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),Me.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=Me.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),r=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new C(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Me.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,r){const c=Me.create("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){const c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.Evented{constructor(f){super(),this.options=d.extend({},F,f),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Cc(this._updateMarkerRotation,20)}onAdd(f){var r;return this._map=f,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==B?r(B):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(c=>{B="denied"!==c.state,r(B)}):(B=!!d.window.navigator.geolocation,r(B)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Me.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,X=0,ve=!1}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",f)),this._finish()}}_updateCamera(f){const r=new d.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),y=d.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new d.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.getBoundingClientRect().height/2,r=this._map.unproject([0,f]),c=this._map.unproject([100,f]),p=r.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&ve)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Me.create("button","mapboxgl-ctrl-geolocate",this._container),Me.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Me.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Me.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Me.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new os({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Me.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new os({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":X--,ve=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),X++,X>1?(f={maximumAge:6e5,timeout:0},ve=!0):(f=this.options.positionOptions,ve=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&f()}).catch(console.error):f()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Xl,ScaleControl:class{constructor(f){this.options=d.extend({},Ie,f),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){at(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Me.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,at(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof d.window.HTMLElement?this._container=f.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Me.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Me.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Me.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(f){super(),this.options=d.extend(Object.create(Kn),f),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Me.remove(this._content),this._container&&(Me.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(d.window.document.createTextNode(f))}setHTML(f){const r=d.window.document.createDocumentFragment(),c=d.window.document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Me.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._container&&this._updateClassList(),r}_createCloseButton(){this.options.closeButton&&(this._closeButton=Me.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._pos,c=this._container.offsetWidth,p=this._container.offsetHeight;let y;return y=r.y+f.bottom.y<p?["top"]:r.y>this._map.transform.height-p?["bottom"]:[],r.x<c/2?y.push("left"):r.x>this._map.transform.width-c/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Me.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Me.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const r=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(v){if(v||(v=new d.pointGeometry(0,0)),"number"==typeof v){const D=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,v),"top-left":new d.pointGeometry(D,D),"top-right":new d.pointGeometry(-D,D),bottom:new d.pointGeometry(0,-v),"bottom-left":new d.pointGeometry(D,-D),"bottom-right":new d.pointGeometry(-D,-D),left:new d.pointGeometry(v,0),right:new d.pointGeometry(-v,0)}}if(v instanceof d.pointGeometry||Array.isArray(v)){const D=d.pointGeometry.convert(v);return{center:D,top:D,"top-left":D,"top-right":D,bottom:D,"bottom-left":D,"bottom-right":D,left:D,right:D}}return{center:d.pointGeometry.convert(v.center||[0,0]),top:d.pointGeometry.convert(v.top||[0,0]),"top-left":d.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(v["top-right"]||[0,0]),bottom:d.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(v["bottom-right"]||[0,0]),left:d.pointGeometry.convert(v.left||[0,0]),right:d.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(c),y=r.add(c[p]).round();this._map._requestDomTask(()=>{this._container&&p&&Me.setTransform(this._container,`${za[p]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(un);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:os,Style:Fi,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Nl,Evented:d.Evented,config:d.config,prewarm:function(){yt().acquire(Ee)},clearPrewarmedResources:function(){const f=tt;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ee),tt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(f){d.config.ACCESS_TOKEN=f},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(f){d.config.API_URL=f},get workerCount(){return Be.workerCount},set workerCount(f){Be.workerCount=f},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return ar}),fe}()},574:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{y:()=>We});var fe=Ge(393),Kt=Ge(181),d=Ge(490),ht=Ge(554),Ot=Ge(487);var Se=Ge(494);let We=(()=>{class bt{constructor(St){this._isScalar=!1,St&&(this._subscribe=St)}lift(St){const ct=new bt;return ct.source=this,ct.operator=St,ct}subscribe(St,ct,dn){const{operator:Vn}=this,nn=function(bt,ut,St){if(bt){if(bt instanceof fe.L)return bt;if(bt[Kt.b])return bt[Kt.b]()}return bt||ut||St?new fe.L(bt,ut,St):new fe.L(d.c)}(St,ct,dn);if(nn.add(Vn?Vn.call(nn,this.source):this.source||Se.v.useDeprecatedSynchronousErrorHandling&&!nn.syncErrorThrowable?this._subscribe(nn):this._trySubscribe(nn)),Se.v.useDeprecatedSynchronousErrorHandling&&nn.syncErrorThrowable&&(nn.syncErrorThrowable=!1,nn.syncErrorThrown))throw nn.syncErrorValue;return nn}_trySubscribe(St){try{return this._subscribe(St)}catch(ct){Se.v.useDeprecatedSynchronousErrorHandling&&(St.syncErrorThrown=!0,St.syncErrorValue=ct),function(bt){for(;bt;){const{closed:ut,destination:St,isStopped:ct}=bt;if(ut||ct)return!1;bt=St&&St instanceof fe.L?St:null}return!0}(St)?St.error(ct):console.warn(ct)}}forEach(St,ct){return new(ct=st(ct))((dn,Vn)=>{let nn;nn=this.subscribe(_t=>{try{St(_t)}catch(ii){Vn(ii),nn&&nn.unsubscribe()}},Vn,dn)})}_subscribe(St){const{source:ct}=this;return ct&&ct.subscribe(St)}[ht.L](){return this}pipe(...St){return 0===St.length?this:function(bt){return 0===bt.length?Ot.y:1===bt.length?bt[0]:function(St){return bt.reduce((ct,dn)=>dn(ct),St)}}(St)(this)}toPromise(St){return new(St=st(St))((ct,dn)=>{let Vn;this.subscribe(nn=>Vn=nn,nn=>dn(nn),()=>ct(Vn))})}}return bt.create=ut=>new bt(ut),bt})();function st(bt){if(bt||(bt=Se.v.Promise||Promise),!bt)throw new Error("no Promise impl found");return bt}},490:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{c:()=>Kt});var fe=Ge(494),te=Ge(449);const Kt={closed:!0,next(d){},error(d){if(fe.v.useDeprecatedSynchronousErrorHandling)throw d;(0,te.z)(d)},complete(){}}},709:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{xQ:()=>Ve,Yc:()=>Ot});var fe=Ge(574),te=Ge(393),Kt=Ge(319),d=Ge(971);class Zt extends Kt.w{constructor(We,st){super(),this.subject=We,this.subscriber=st,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const We=this.subject,st=We.observers;if(this.subject=null,!st||0===st.length||We.isStopped||We.closed)return;const bt=st.indexOf(this.subscriber);-1!==bt&&st.splice(bt,1)}}var ht=Ge(181);class Ot extends te.L{constructor(We){super(We),this.destination=We}}let Ve=(()=>{class Se extends fe.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[ht.b](){return new Ot(this)}lift(st){const bt=new Me(this,this);return bt.operator=st,bt}next(st){if(this.closed)throw new d.N;if(!this.isStopped){const{observers:bt}=this,ut=bt.length,St=bt.slice();for(let ct=0;ct<ut;ct++)St[ct].next(st)}}error(st){if(this.closed)throw new d.N;this.hasError=!0,this.thrownError=st,this.isStopped=!0;const{observers:bt}=this,ut=bt.length,St=bt.slice();for(let ct=0;ct<ut;ct++)St[ct].error(st);this.observers.length=0}complete(){if(this.closed)throw new d.N;this.isStopped=!0;const{observers:st}=this,bt=st.length,ut=st.slice();for(let St=0;St<bt;St++)ut[St].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(st){if(this.closed)throw new d.N;return super._trySubscribe(st)}_subscribe(st){if(this.closed)throw new d.N;return this.hasError?(st.error(this.thrownError),Kt.w.EMPTY):this.isStopped?(st.complete(),Kt.w.EMPTY):(this.observers.push(st),new Zt(this,st))}asObservable(){const st=new fe.y;return st.source=this,st}}return Se.create=(We,st)=>new Me(We,st),Se})();class Me extends Ve{constructor(We,st){super(),this.destination=We,this.source=st}next(We){const{destination:st}=this;st&&st.next&&st.next(We)}error(We){const{destination:st}=this;st&&st.error&&this.destination.error(We)}complete(){const{destination:We}=this;We&&We.complete&&this.destination.complete()}_subscribe(We){const{source:st}=this;return st?this.source.subscribe(We):Kt.w.EMPTY}}},393:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{L:()=>Ot});var fe=Ge(105),te=Ge(490),Kt=Ge(319),d=Ge(181),Zt=Ge(494),ht=Ge(449);class Ot extends Kt.w{constructor(Se,We,st){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=te.c;break;case 1:if(!Se){this.destination=te.c;break}if("object"==typeof Se){Se instanceof Ot?(this.syncErrorThrowable=Se.syncErrorThrowable,this.destination=Se,Se.add(this)):(this.syncErrorThrowable=!0,this.destination=new Ve(this,Se));break}default:this.syncErrorThrowable=!0,this.destination=new Ve(this,Se,We,st)}}[d.b](){return this}static create(Se,We,st){const bt=new Ot(Se,We,st);return bt.syncErrorThrowable=!1,bt}next(Se){this.isStopped||this._next(Se)}error(Se){this.isStopped||(this.isStopped=!0,this._error(Se))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(Se){this.destination.next(Se)}_error(Se){this.destination.error(Se),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:Se}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=Se,this}}class Ve extends Ot{constructor(Se,We,st,bt){super(),this._parentSubscriber=Se;let ut,St=this;(0,fe.m)(We)?ut=We:We&&(ut=We.next,st=We.error,bt=We.complete,We!==te.c&&(St=Object.create(We),(0,fe.m)(St.unsubscribe)&&this.add(St.unsubscribe.bind(St)),St.unsubscribe=this.unsubscribe.bind(this))),this._context=St,this._next=ut,this._error=st,this._complete=bt}next(Se){if(!this.isStopped&&this._next){const{_parentSubscriber:We}=this;Zt.v.useDeprecatedSynchronousErrorHandling&&We.syncErrorThrowable?this.__tryOrSetError(We,this._next,Se)&&this.unsubscribe():this.__tryOrUnsub(this._next,Se)}}error(Se){if(!this.isStopped){const{_parentSubscriber:We}=this,{useDeprecatedSynchronousErrorHandling:st}=Zt.v;if(this._error)st&&We.syncErrorThrowable?(this.__tryOrSetError(We,this._error,Se),this.unsubscribe()):(this.__tryOrUnsub(this._error,Se),this.unsubscribe());else if(We.syncErrorThrowable)st?(We.syncErrorValue=Se,We.syncErrorThrown=!0):(0,ht.z)(Se),this.unsubscribe();else{if(this.unsubscribe(),st)throw Se;(0,ht.z)(Se)}}}complete(){if(!this.isStopped){const{_parentSubscriber:Se}=this;if(this._complete){const We=()=>this._complete.call(this._context);Zt.v.useDeprecatedSynchronousErrorHandling&&Se.syncErrorThrowable?(this.__tryOrSetError(Se,We),this.unsubscribe()):(this.__tryOrUnsub(We),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(Se,We){try{Se.call(this._context,We)}catch(st){if(this.unsubscribe(),Zt.v.useDeprecatedSynchronousErrorHandling)throw st;(0,ht.z)(st)}}__tryOrSetError(Se,We,st){if(!Zt.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{We.call(this._context,st)}catch(bt){return Zt.v.useDeprecatedSynchronousErrorHandling?(Se.syncErrorValue=bt,Se.syncErrorThrown=!0,!0):((0,ht.z)(bt),!0)}return!1}_unsubscribe(){const{_parentSubscriber:Se}=this;this._context=null,this._parentSubscriber=null,Se.unsubscribe()}}},319:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{w:()=>ht});var fe=Ge(796),te=Ge(555),Kt=Ge(105);const Zt=(()=>{function Ve(Me){return Error.call(this),this.message=Me?`${Me.length} errors occurred during unsubscription:\n${Me.map((Se,We)=>`${We+1}) ${Se.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Me,this}return Ve.prototype=Object.create(Error.prototype),Ve})();class ht{constructor(Me){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,Me&&(this._ctorUnsubscribe=!0,this._unsubscribe=Me)}unsubscribe(){let Me;if(this.closed)return;let{_parentOrParents:Se,_ctorUnsubscribe:We,_unsubscribe:st,_subscriptions:bt}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,Se instanceof ht)Se.remove(this);else if(null!==Se)for(let ut=0;ut<Se.length;++ut)Se[ut].remove(this);if((0,Kt.m)(st)){We&&(this._unsubscribe=void 0);try{st.call(this)}catch(ut){Me=ut instanceof Zt?Ot(ut.errors):[ut]}}if((0,fe.k)(bt)){let ut=-1,St=bt.length;for(;++ut<St;){const ct=bt[ut];if((0,te.K)(ct))try{ct.unsubscribe()}catch(dn){Me=Me||[],dn instanceof Zt?Me=Me.concat(Ot(dn.errors)):Me.push(dn)}}}if(Me)throw new Zt(Me)}add(Me){let Se=Me;if(!Me)return ht.EMPTY;switch(typeof Me){case"function":Se=new ht(Me);case"object":if(Se===this||Se.closed||"function"!=typeof Se.unsubscribe)return Se;if(this.closed)return Se.unsubscribe(),Se;if(!(Se instanceof ht)){const bt=Se;Se=new ht,Se._subscriptions=[bt]}break;default:throw new Error("unrecognized teardown "+Me+" added to Subscription.")}let{_parentOrParents:We}=Se;if(null===We)Se._parentOrParents=this;else if(We instanceof ht){if(We===this)return Se;Se._parentOrParents=[We,this]}else{if(-1!==We.indexOf(this))return Se;We.push(this)}const st=this._subscriptions;return null===st?this._subscriptions=[Se]:st.push(Se),Se}remove(Me){const Se=this._subscriptions;if(Se){const We=Se.indexOf(Me);-1!==We&&Se.splice(We,1)}}}var Ve;function Ot(Ve){return Ve.reduce((Me,Se)=>Me.concat(Se instanceof Zt?Se.errors:Se),[])}ht.EMPTY=((Ve=new ht).closed=!0,Ve)},494:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{v:()=>te});let fe=!1;const te={Promise:void 0,set useDeprecatedSynchronousErrorHandling(Kt){if(Kt){const d=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+d.stack)}else fe&&console.log("RxJS: Back to a better error behavior. Thank you. <3");fe=Kt},get useDeprecatedSynchronousErrorHandling(){return fe}}},345:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{IY:()=>d,Ds:()=>ht,ft:()=>Ve});var fe=Ge(393),te=Ge(574),Kt=Ge(444);class d extends fe.L{constructor(Se){super(),this.parent=Se}_next(Se){this.parent.notifyNext(Se)}_error(Se){this.parent.notifyError(Se),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class ht extends fe.L{notifyNext(Se){this.destination.next(Se)}notifyError(Se){this.destination.error(Se)}notifyComplete(){this.destination.complete()}}function Ve(Me,Se){if(Se.closed)return;if(Me instanceof te.y)return Me.subscribe(Se);let We;try{We=(0,Kt.s)(Me)(Se)}catch(st){Se.error(st)}return We}},441:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{c:()=>Zt,N:()=>ht});var fe=Ge(709),te=Ge(574),Kt=Ge(319),d=Ge(307);class Zt extends te.y{constructor(We,st){super(),this.source=We,this.subjectFactory=st,this._refCount=0,this._isComplete=!1}_subscribe(We){return this.getSubject().subscribe(We)}getSubject(){const We=this._subject;return(!We||We.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let We=this._connection;return We||(this._isComplete=!1,We=this._connection=new Kt.w,We.add(this.source.subscribe(new Ot(this.getSubject(),this))),We.closed&&(this._connection=null,We=Kt.w.EMPTY)),We}refCount(){return(0,d.x)()(this)}}const ht=(()=>{const Se=Zt.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:Se._subscribe},_isComplete:{value:Se._isComplete,writable:!0},getSubject:{value:Se.getSubject},connect:{value:Se.connect},refCount:{value:Se.refCount}}})();class Ot extends fe.Yc{constructor(We,st){super(We),this.connectable=st}_error(We){this._unsubscribe(),super._error(We)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const We=this.connectable;if(We){this.connectable=null;const st=We._connection;We._refCount=0,We._subject=null,We._connection=null,st&&st.unsubscribe()}}}},402:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{D:()=>St});var fe=Ge(574),te=Ge(444),Kt=Ge(319),d=Ge(554),Ot=Ge(87),Ve=Ge(377),We=Ge(72),st=Ge(489);function St(ct,dn){return dn?function(ct,dn){if(null!=ct){if(function(ct){return ct&&"function"==typeof ct[d.L]}(ct))return function(ct,dn){return new fe.y(Vn=>{const nn=new Kt.w;return nn.add(dn.schedule(()=>{const _t=ct[d.L]();nn.add(_t.subscribe({next(ii){nn.add(dn.schedule(()=>Vn.next(ii)))},error(ii){nn.add(dn.schedule(()=>Vn.error(ii)))},complete(){nn.add(dn.schedule(()=>Vn.complete()))}}))})),nn})}(ct,dn);if((0,We.t)(ct))return function(ct,dn){return new fe.y(Vn=>{const nn=new Kt.w;return nn.add(dn.schedule(()=>ct.then(_t=>{nn.add(dn.schedule(()=>{Vn.next(_t),nn.add(dn.schedule(()=>Vn.complete()))}))},_t=>{nn.add(dn.schedule(()=>Vn.error(_t)))}))),nn})}(ct,dn);if((0,st.z)(ct))return(0,Ot.r)(ct,dn);if(function(ct){return ct&&"function"==typeof ct[Ve.hZ]}(ct)||"string"==typeof ct)return function(ct,dn){if(!ct)throw new Error("Iterable cannot be null");return new fe.y(Vn=>{const nn=new Kt.w;let _t;return nn.add(()=>{_t&&"function"==typeof _t.return&&_t.return()}),nn.add(dn.schedule(()=>{_t=ct[Ve.hZ](),nn.add(dn.schedule(function(){if(Vn.closed)return;let ii,Ai;try{const Tr=_t.next();ii=Tr.value,Ai=Tr.done}catch(Tr){return void Vn.error(Tr)}Ai?Vn.complete():(Vn.next(ii),this.schedule())}))})),nn})}(ct,dn)}throw new TypeError((null!==ct&&typeof ct||ct)+" is not observable")}(ct,dn):ct instanceof fe.y?ct:new fe.y((0,te.s)(ct))}},693:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{n:()=>d});var fe=Ge(574),te=Ge(15),Kt=Ge(87);function d(Zt,ht){return ht?(0,Kt.r)(Zt,ht):new fe.y((0,te.V)(Zt))}},2:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{U:()=>te});var fe=Ge(393);function te(Zt,ht){return function(Ve){if("function"!=typeof Zt)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return Ve.lift(new Kt(Zt,ht))}}class Kt{constructor(ht,Ot){this.project=ht,this.thisArg=Ot}call(ht,Ot){return Ot.subscribe(new d(ht,this.project,this.thisArg))}}class d extends fe.L{constructor(ht,Ot,Ve){super(ht),this.project=Ot,this.count=0,this.thisArg=Ve||this}_next(ht){let Ot;try{Ot=this.project.call(this.thisArg,ht,this.count++)}catch(Ve){return void this.destination.error(Ve)}this.destination.next(Ot)}}},282:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{J:()=>Kt});var fe=Ge(773),te=Ge(487);function Kt(d=Number.POSITIVE_INFINITY){return(0,fe.zg)(te.y,d)}},773:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{zg:()=>d});var fe=Ge(2),te=Ge(402),Kt=Ge(345);function d(Ve,Me,Se=Number.POSITIVE_INFINITY){return"function"==typeof Me?We=>We.pipe(d((st,bt)=>(0,te.D)(Ve(st,bt)).pipe((0,fe.U)((ut,St)=>Me(st,ut,bt,St))),Se)):("number"==typeof Me&&(Se=Me),We=>We.lift(new Zt(Ve,Se)))}class Zt{constructor(Me,Se=Number.POSITIVE_INFINITY){this.project=Me,this.concurrent=Se}call(Me,Se){return Se.subscribe(new ht(Me,this.project,this.concurrent))}}class ht extends Kt.Ds{constructor(Me,Se,We=Number.POSITIVE_INFINITY){super(Me),this.project=Se,this.concurrent=We,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(Me){this.active<this.concurrent?this._tryNext(Me):this.buffer.push(Me)}_tryNext(Me){let Se;const We=this.index++;try{Se=this.project(Me,We)}catch(st){return void this.destination.error(st)}this.active++,this._innerSub(Se)}_innerSub(Me){const Se=new Kt.IY(this),We=this.destination;We.add(Se);const st=(0,Kt.ft)(Me,Se);st!==Se&&We.add(st)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(Me){this.destination.next(Me)}notifyComplete(){const Me=this.buffer;this.active--,Me.length>0?this._next(Me.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},307:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{x:()=>te});var fe=Ge(393);function te(){return function(ht){return ht.lift(new Kt(ht))}}class Kt{constructor(ht){this.connectable=ht}call(ht,Ot){const{connectable:Ve}=this;Ve._refCount++;const Me=new d(ht,Ve),Se=Ot.subscribe(Me);return Me.closed||(Me.connection=Ve.connect()),Se}}class d extends fe.L{constructor(ht,Ot){super(ht),this.connectable=Ot}_unsubscribe(){const{connectable:ht}=this;if(!ht)return void(this.connection=null);this.connectable=null;const Ot=ht._refCount;if(Ot<=0)return void(this.connection=null);if(ht._refCount=Ot-1,Ot>1)return void(this.connection=null);const{connection:Ve}=this,Me=ht._connection;this.connection=null,Me&&(!Ve||Me===Ve)&&Me.unsubscribe()}}},87:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{r:()=>Kt});var fe=Ge(574),te=Ge(319);function Kt(d,Zt){return new fe.y(ht=>{const Ot=new te.w;let Ve=0;return Ot.add(Zt.schedule(function(){Ve!==d.length?(ht.next(d[Ve++]),ht.closed||Ot.add(this.schedule())):ht.complete()})),Ot})}},377:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{hZ:()=>te});const te="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},554:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{L:()=>fe});const fe="function"==typeof Symbol&&Symbol.observable||"@@observable"},181:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{b:()=>fe});const fe="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},971:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{N:()=>te});const te=(()=>{function Kt(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return Kt.prototype=Object.create(Error.prototype),Kt})()},449:(qn,Bt,Ge)=>{"use strict";function fe(te){setTimeout(()=>{throw te},0)}Ge.d(Bt,{z:()=>fe})},487:(qn,Bt,Ge)=>{"use strict";function fe(te){return te}Ge.d(Bt,{y:()=>fe})},796:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{k:()=>fe});const fe=Array.isArray||(te=>te&&"number"==typeof te.length)},489:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{z:()=>fe});const fe=te=>te&&"number"==typeof te.length&&"function"!=typeof te},105:(qn,Bt,Ge)=>{"use strict";function fe(te){return"function"==typeof te}Ge.d(Bt,{m:()=>fe})},555:(qn,Bt,Ge)=>{"use strict";function fe(te){return null!==te&&"object"==typeof te}Ge.d(Bt,{K:()=>fe})},72:(qn,Bt,Ge)=>{"use strict";function fe(te){return!!te&&"function"!=typeof te.subscribe&&"function"==typeof te.then}Ge.d(Bt,{t:()=>fe})},869:(qn,Bt,Ge)=>{"use strict";function fe(te){return te&&"function"==typeof te.schedule}Ge.d(Bt,{K:()=>fe})},444:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{s:()=>We});var fe=Ge(15),te=Ge(449),d=Ge(377),ht=Ge(554),Ve=Ge(489),Me=Ge(72),Se=Ge(555);const We=st=>{if(st&&"function"==typeof st[ht.L])return(st=>bt=>{const ut=st[ht.L]();if("function"!=typeof ut.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return ut.subscribe(bt)})(st);if((0,Ve.z)(st))return(0,fe.V)(st);if((0,Me.t)(st))return(st=>bt=>(st.then(ut=>{bt.closed||(bt.next(ut),bt.complete())},ut=>bt.error(ut)).then(null,te.z),bt))(st);if(st&&"function"==typeof st[d.hZ])return(st=>bt=>{const ut=st[d.hZ]();for(;;){let St;try{St=ut.next()}catch(ct){return bt.error(ct),bt}if(St.done){bt.complete();break}if(bt.next(St.value),bt.closed)break}return"function"==typeof ut.return&&bt.add(()=>{ut.return&&ut.return()}),bt})(st);{const ut=`You provided ${(0,Se.K)(st)?"an invalid object":`'${st}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(ut)}}},15:(qn,Bt,Ge)=>{"use strict";Ge.d(Bt,{V:()=>fe});const fe=te=>Kt=>{for(let d=0,Zt=te.length;d<Zt&&!Kt.closed;d++)Kt.next(te[d]);Kt.complete()}},137:(qn,Bt,Ge)=>{"use strict";var fe=Ge(583),te=Ge(639);class Kt extends fe.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class d extends Kt{static makeCurrent(){(0,fe.HT)(new d)}onAndCancel(ye,ue,Ne){return ye.addEventListener(ue,Ne,!1),()=>{ye.removeEventListener(ue,Ne,!1)}}dispatchEvent(ye,ue){ye.dispatchEvent(ue)}remove(ye){ye.parentNode&&ye.parentNode.removeChild(ye)}createElement(ye,ue){return(ue=ue||this.getDefaultDocument()).createElement(ye)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ye){return ye.nodeType===Node.ELEMENT_NODE}isShadowRoot(ye){return ye instanceof DocumentFragment}getGlobalEventTarget(ye,ue){return"window"===ue?window:"document"===ue?ye:"body"===ue?ye.body:null}getBaseHref(ye){const ue=(Zt=Zt||document.querySelector("base"),Zt?Zt.getAttribute("href"):null);return null==ue?null:function(De){Ot=Ot||document.createElement("a"),Ot.setAttribute("href",De);const ye=Ot.pathname;return"/"===ye.charAt(0)?ye:`/${ye}`}(ue)}resetBaseElement(){Zt=null}getUserAgent(){return window.navigator.userAgent}getCookie(ye){return(0,fe.Mx)(document.cookie,ye)}}let Ot,Zt=null;const Me=new te.OlP("TRANSITION_ID"),We=[{provide:te.ip1,useFactory:function(De,ye,ue){return()=>{ue.get(te.CZH).donePromise.then(()=>{const Ne=(0,fe.q)(),qe=ye.querySelectorAll(`style[ng-transition="${De}"]`);for(let Gt=0;Gt<qe.length;Gt++)Ne.remove(qe[Gt])})}},deps:[Me,fe.K0,te.zs3],multi:!0}];class st{static init(){(0,te.VLi)(new st)}addToWindow(ye){te.dqk.getAngularTestability=(Ne,qe=!0)=>{const Gt=ye.findTestabilityInTree(Ne,qe);if(null==Gt)throw new Error("Could not find testability for element.");return Gt},te.dqk.getAllAngularTestabilities=()=>ye.getAllTestabilities(),te.dqk.getAllAngularRootElements=()=>ye.getAllRootElements(),te.dqk.frameworkStabilizers||(te.dqk.frameworkStabilizers=[]),te.dqk.frameworkStabilizers.push(Ne=>{const qe=te.dqk.getAllAngularTestabilities();let Gt=qe.length,zt=!1;const Fn=function(xr){zt=zt||xr,Gt--,0==Gt&&Ne(zt)};qe.forEach(function(xr){xr.whenStable(Fn)})})}findTestabilityInTree(ye,ue,Ne){if(null==ue)return null;const qe=ye.getTestability(ue);return null!=qe?qe:Ne?(0,fe.q)().isShadowRoot(ue)?this.findTestabilityInTree(ye,ue.host,!0):this.findTestabilityInTree(ye,ue.parentElement,!0):null}}let bt=(()=>{class De{build(){return new XMLHttpRequest}}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();const Xn=new te.OlP("EventManagerPlugins");let cn=(()=>{class De{constructor(ue,Ne){this._zone=Ne,this._eventNameToPlugin=new Map,ue.forEach(qe=>qe.manager=this),this._plugins=ue.slice().reverse()}addEventListener(ue,Ne,qe){return this._findPluginFor(Ne).addEventListener(ue,Ne,qe)}addGlobalEventListener(ue,Ne,qe){return this._findPluginFor(Ne).addGlobalEventListener(ue,Ne,qe)}getZone(){return this._zone}_findPluginFor(ue){const Ne=this._eventNameToPlugin.get(ue);if(Ne)return Ne;const qe=this._plugins;for(let Gt=0;Gt<qe.length;Gt++){const zt=qe[Gt];if(zt.supports(ue))return this._eventNameToPlugin.set(ue,zt),zt}throw new Error(`No event manager plugin found for event ${ue}`)}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(Xn),te.LFG(te.R0b))},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();class zn{constructor(ye){this._doc=ye}addGlobalEventListener(ye,ue,Ne){const qe=(0,fe.q)().getGlobalEventTarget(this._doc,ye);if(!qe)throw new Error(`Unsupported event target ${qe} for event ${ue}`);return this.addEventListener(qe,ue,Ne)}}let Et=(()=>{class De{constructor(){this._stylesSet=new Set}addStyles(ue){const Ne=new Set;ue.forEach(qe=>{this._stylesSet.has(qe)||(this._stylesSet.add(qe),Ne.add(qe))}),this.onStylesAdded(Ne)}onStylesAdded(ue){}getAllStyles(){return Array.from(this._stylesSet)}}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})(),Zr=(()=>{class De extends Et{constructor(ue){super(),this._doc=ue,this._hostNodes=new Map,this._hostNodes.set(ue.head,[])}_addStylesToHost(ue,Ne,qe){ue.forEach(Gt=>{const zt=this._doc.createElement("style");zt.textContent=Gt,qe.push(Ne.appendChild(zt))})}addHost(ue){const Ne=[];this._addStylesToHost(this._stylesSet,ue,Ne),this._hostNodes.set(ue,Ne)}removeHost(ue){const Ne=this._hostNodes.get(ue);Ne&&Ne.forEach(sr),this._hostNodes.delete(ue)}onStylesAdded(ue){this._hostNodes.forEach((Ne,qe)=>{this._addStylesToHost(ue,qe,Ne)})}ngOnDestroy(){this._hostNodes.forEach(ue=>ue.forEach(sr))}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(fe.K0))},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();function sr(De){(0,fe.q)().remove(De)}const jo={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Nn=/%COMP%/g;function yi(De,ye,ue){for(let Ne=0;Ne<ye.length;Ne++){let qe=ye[Ne];Array.isArray(qe)?yi(De,qe,ue):(qe=qe.replace(Nn,De),ue.push(qe))}return ue}function Wr(De){return ye=>{if("__ngUnwrap__"===ye)return De;!1===De(ye)&&(ye.preventDefault(),ye.returnValue=!1)}}let Sn=(()=>{class De{constructor(ue,Ne,qe){this.eventManager=ue,this.sharedStylesHost=Ne,this.appId=qe,this.rendererByCompId=new Map,this.defaultRenderer=new vi(ue)}createRenderer(ue,Ne){if(!ue||!Ne)return this.defaultRenderer;switch(Ne.encapsulation){case te.ifc.Emulated:{let qe=this.rendererByCompId.get(Ne.id);return qe||(qe=new wo(this.eventManager,this.sharedStylesHost,Ne,this.appId),this.rendererByCompId.set(Ne.id,qe)),qe.applyToHost(ue),qe}case 1:case te.ifc.ShadowDom:return new Yn(this.eventManager,this.sharedStylesHost,ue,Ne);default:if(!this.rendererByCompId.has(Ne.id)){const qe=yi(Ne.id,Ne.styles,[]);this.sharedStylesHost.addStyles(qe),this.rendererByCompId.set(Ne.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(cn),te.LFG(Zr),te.LFG(te.AFp))},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();class vi{constructor(ye){this.eventManager=ye,this.data=Object.create(null)}destroy(){}createElement(ye,ue){return ue?document.createElementNS(jo[ue]||ue,ye):document.createElement(ye)}createComment(ye){return document.createComment(ye)}createText(ye){return document.createTextNode(ye)}appendChild(ye,ue){ye.appendChild(ue)}insertBefore(ye,ue,Ne){ye&&ye.insertBefore(ue,Ne)}removeChild(ye,ue){ye&&ye.removeChild(ue)}selectRootElement(ye,ue){let Ne="string"==typeof ye?document.querySelector(ye):ye;if(!Ne)throw new Error(`The selector "${ye}" did not match any elements`);return ue||(Ne.textContent=""),Ne}parentNode(ye){return ye.parentNode}nextSibling(ye){return ye.nextSibling}setAttribute(ye,ue,Ne,qe){if(qe){ue=qe+":"+ue;const Gt=jo[qe];Gt?ye.setAttributeNS(Gt,ue,Ne):ye.setAttribute(ue,Ne)}else ye.setAttribute(ue,Ne)}removeAttribute(ye,ue,Ne){if(Ne){const qe=jo[Ne];qe?ye.removeAttributeNS(qe,ue):ye.removeAttribute(`${Ne}:${ue}`)}else ye.removeAttribute(ue)}addClass(ye,ue){ye.classList.add(ue)}removeClass(ye,ue){ye.classList.remove(ue)}setStyle(ye,ue,Ne,qe){qe&(te.JOm.DashCase|te.JOm.Important)?ye.style.setProperty(ue,Ne,qe&te.JOm.Important?"important":""):ye.style[ue]=Ne}removeStyle(ye,ue,Ne){Ne&te.JOm.DashCase?ye.style.removeProperty(ue):ye.style[ue]=""}setProperty(ye,ue,Ne){ye[ue]=Ne}setValue(ye,ue){ye.nodeValue=ue}listen(ye,ue,Ne){return"string"==typeof ye?this.eventManager.addGlobalEventListener(ye,ue,Wr(Ne)):this.eventManager.addEventListener(ye,ue,Wr(Ne))}}class wo extends vi{constructor(ye,ue,Ne,qe){super(ye),this.component=Ne;const Gt=yi(qe+"-"+Ne.id,Ne.styles,[]);ue.addStyles(Gt),this.contentAttr="_ngcontent-%COMP%".replace(Nn,qe+"-"+Ne.id),this.hostAttr="_nghost-%COMP%".replace(Nn,qe+"-"+Ne.id)}applyToHost(ye){super.setAttribute(ye,this.hostAttr,"")}createElement(ye,ue){const Ne=super.createElement(ye,ue);return super.setAttribute(Ne,this.contentAttr,""),Ne}}class Yn extends vi{constructor(ye,ue,Ne,qe){super(ye),this.sharedStylesHost=ue,this.hostEl=Ne,this.shadowRoot=Ne.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Gt=yi(qe.id,qe.styles,[]);for(let zt=0;zt<Gt.length;zt++){const Fn=document.createElement("style");Fn.textContent=Gt[zt],this.shadowRoot.appendChild(Fn)}}nodeOrShadowRoot(ye){return ye===this.hostEl?this.shadowRoot:ye}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ye,ue){return super.appendChild(this.nodeOrShadowRoot(ye),ue)}insertBefore(ye,ue,Ne){return super.insertBefore(this.nodeOrShadowRoot(ye),ue,Ne)}removeChild(ye,ue){return super.removeChild(this.nodeOrShadowRoot(ye),ue)}parentNode(ye){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ye)))}}let Xr=(()=>{class De extends zn{constructor(ue){super(ue)}supports(ue){return!0}addEventListener(ue,Ne,qe){return ue.addEventListener(Ne,qe,!1),()=>this.removeEventListener(ue,Ne,qe)}removeEventListener(ue,Ne,qe){return ue.removeEventListener(Ne,qe)}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(fe.K0))},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();const ur=["alt","control","meta","shift"],Qt={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Mi={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},$o={alt:De=>De.altKey,control:De=>De.ctrlKey,meta:De=>De.metaKey,shift:De=>De.shiftKey};let yn=(()=>{class De extends zn{constructor(ue){super(ue)}supports(ue){return null!=De.parseEventName(ue)}addEventListener(ue,Ne,qe){const Gt=De.parseEventName(Ne),zt=De.eventCallback(Gt.fullKey,qe,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,fe.q)().onAndCancel(ue,Gt.domEventName,zt))}static parseEventName(ue){const Ne=ue.toLowerCase().split("."),qe=Ne.shift();if(0===Ne.length||"keydown"!==qe&&"keyup"!==qe)return null;const Gt=De._normalizeKey(Ne.pop());let zt="";if(ur.forEach(xr=>{const Ki=Ne.indexOf(xr);Ki>-1&&(Ne.splice(Ki,1),zt+=xr+".")}),zt+=Gt,0!=Ne.length||0===Gt.length)return null;const Fn={};return Fn.domEventName=qe,Fn.fullKey=zt,Fn}static getEventFullKey(ue){let Ne="",qe=function(De){let ye=De.key;if(null==ye){if(ye=De.keyIdentifier,null==ye)return"Unidentified";ye.startsWith("U+")&&(ye=String.fromCharCode(parseInt(ye.substring(2),16)),3===De.location&&Mi.hasOwnProperty(ye)&&(ye=Mi[ye]))}return Qt[ye]||ye}(ue);return qe=qe.toLowerCase()," "===qe?qe="space":"."===qe&&(qe="dot"),ur.forEach(Gt=>{Gt!=qe&&$o[Gt](ue)&&(Ne+=Gt+".")}),Ne+=qe,Ne}static eventCallback(ue,Ne,qe){return Gt=>{De.getEventFullKey(Gt)===ue&&qe.runGuarded(()=>Ne(Gt))}}static _normalizeKey(ue){switch(ue){case"esc":return"escape";default:return ue}}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(fe.K0))},De.\u0275prov=te.Yz7({token:De,factory:De.\u0275fac}),De})();const ae=(0,te.eFA)(te._c5,"browser",[{provide:te.Lbi,useValue:fe.bD},{provide:te.g9A,useValue:function(){d.makeCurrent(),st.init()},multi:!0},{provide:fe.K0,useFactory:function(){return(0,te.RDi)(document),document},deps:[]}]),he=[[],{provide:te.zSh,useValue:"root"},{provide:te.qLn,useFactory:function(){return new te.qLn},deps:[]},{provide:Xn,useClass:Xr,multi:!0,deps:[fe.K0,te.R0b,te.Lbi]},{provide:Xn,useClass:yn,multi:!0,deps:[fe.K0]},[],{provide:Sn,useClass:Sn,deps:[cn,Zr,te.AFp]},{provide:te.FYo,useExisting:Sn},{provide:Et,useExisting:Zr},{provide:Zr,useClass:Zr,deps:[fe.K0]},{provide:te.dDg,useClass:te.dDg,deps:[te.R0b]},{provide:cn,useClass:cn,deps:[Xn,te.R0b]},{provide:fe.JF,useClass:bt,deps:[]},[]];let be=(()=>{class De{constructor(ue){if(ue)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ue){return{ngModule:De,providers:[{provide:te.AFp,useValue:ue.appId},{provide:Me,useExisting:te.AFp},We]}}}return De.\u0275fac=function(ue){return new(ue||De)(te.LFG(De,12))},De.\u0275mod=te.oAB({type:De}),De.\u0275inj=te.cJS({providers:he,imports:[fe.ez,te.hGG]}),De})();"undefined"!=typeof window&&window;var wn=Ge(353);const pi=[{path:"mapas",loadChildren:()=>Ge.e(496).then(Ge.bind(Ge,496)).then(De=>De.MapasModule)},{path:"**",redirectTo:"mapas"}];let Ht=(()=>{class De{}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275mod=te.oAB({type:De}),De.\u0275inj=te.cJS({imports:[[wn.Bz.forRoot(pi)],wn.Bz]}),De})();var Yi=Ge(958);const Ui=function(De){return[De]};function jr(De,ye){if(1&De&&(te.TgZ(0,"li",2),te._uU(1),te.qZA()),2&De){const ue=ye.$implicit;te.Q6J("routerLink",te.VKq(2,Ui,ue.ruta)),te.xp6(1),te.hij(" ",ue.nombre," ")}}let Vt=(()=>{class De{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"Fullscren"},{ruta:"/mapas/zoom-range",nombre:"Zoom Range"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275cmp=te.Xpm({type:De,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["class","list-group-item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(ue,Ne){1&ue&&(te.TgZ(0,"ul",0),te.YNc(1,jr,2,4,"li",1),te.qZA()),2&ue&&(te.xp6(1),te.Q6J("ngForOf",Ne.menuItems))},directives:[fe.sg,wn.Od,wn.rH],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),De})(),Go=(()=>{class De{ngOnInit(){Yi.accessToken="pk.eyJ1Ijoid2hlcnJlcmEwMjE5IiwiYSI6ImNreGF5cDVlYzBmaG0ydnFxZzNjOXVhaDgifQ.bONwo2ha7i-aV7Co2Ji8OA"}}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275cmp=te.Xpm({type:De,selectors:[["app-root"]],decls:2,vars:0,template:function(ue,Ne){1&ue&&(te._UZ(0,"app-menu"),te._UZ(1,"router-outlet"))},directives:[Vt,wn.lC],styles:[""]}),De})(),Qr=(()=>{class De{}return De.\u0275fac=function(ue){return new(ue||De)},De.\u0275mod=te.oAB({type:De,bootstrap:[Go]}),De.\u0275inj=te.cJS({providers:[],imports:[[be,Ht]]}),De})();(0,te.G48)(),ae().bootstrapModule(Qr).catch(De=>console.error(De))}},qn=>{qn(qn.s=137)}]);